/* ND.JS v1.1.1
 *
 * ND.JS is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * ND.JS is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with ND.JS. If not, see <http://www.gnu.org/licenses/>.
 */
 !function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.nd=e():r.nd=e()}(this,(function(){return function(r){var e={};function t(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return r[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}return t.m=r,t.c=e,t.d=function(r,e,n){t.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:n})},t.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,e){if(1&e&&(r=t(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var a in r)t.d(n,a,function(e){return r[e]}.bind(null,a));return n},t.n=function(r){var e=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(e,"a",e),e},t.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},t.p="",t(t.s=25)}([function(r,e,t){var n=t(20),a=t(21),o=t(22);r.exports=function(r,e){return n(r)||a(r,e)||o()}},function(r,e,t){r.exports=t(15)},function(r,e,t){var n=t(12),a=t(13),o=t(14);r.exports=function(r){return n(r)||a(r)||o()}},function(r,e){r.exports=function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}},function(r,e){function t(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}r.exports=function(r,e,n){return e&&t(r.prototype,e),n&&t(r,n),r}},function(r,e){function t(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?r.exports=t=function(r){return typeof r}:r.exports=t=function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},t(e)}r.exports=t},function(r,e,t){var n=t(5),a=t(23);r.exports=function(r,e){return!e||"object"!==n(e)&&"function"!=typeof e?a(r):e}},function(r,e,t){var n=t(11);r.exports=function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),e&&n(r,e)}},function(r,e,t){var n=t(9),a=t(11),o=t(24),i=t(10);function f(e){var t="function"==typeof Map?new Map:void 0;return r.exports=f=function(r){if(null===r||!o(r))return r;if("function"!=typeof r)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(r))return t.get(r);t.set(r,e)}function e(){return i(r,arguments,n(this).constructor)}return e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a(e,r)},f(e)}r.exports=f},function(r,e){function t(e){return r.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},t(e)}r.exports=t},function(r,e,t){var n=t(11);function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(r){return!1}}function o(e,t,i){return a()?r.exports=o=Reflect.construct:r.exports=o=function(r,e,t){var a=[null];a.push.apply(a,e);var o=new(Function.bind.apply(r,a));return t&&n(o,t.prototype),o},o.apply(null,arguments)}r.exports=o},function(r,e){function t(e,n){return r.exports=t=Object.setPrototypeOf||function(r,e){return r.__proto__=e,r},t(e,n)}r.exports=t},function(r,e){r.exports=function(r){if(Array.isArray(r)){for(var e=0,t=new Array(r.length);e<r.length;e++)t[e]=r[e];return t}}},function(r,e){r.exports=function(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}},function(r,e){r.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(r,e,t){var n=function(r){"use strict";var e=Object.prototype,t=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function f(r,e,t,n){var a=e&&e.prototype instanceof l?e:l,o=Object.create(a.prototype),i=new E(n||[]);return o._invoke=function(r,e,t){var n="suspendedStart";return function(a,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw o;return A()}for(t.method=a,t.arg=o;;){var i=t.delegate;if(i){var f=y(i,t);if(f){if(f===u)continue;return f}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if("suspendedStart"===n)throw n="completed",t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);n="executing";var l=s(r,e,t);if("normal"===l.type){if(n=t.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:t.done}}"throw"===l.type&&(n="completed",t.method="throw",t.arg=l.arg)}}}(r,t,i),o}function s(r,e,t){try{return{type:"normal",arg:r.call(e,t)}}catch(r){return{type:"throw",arg:r}}}r.wrap=f;var u={};function l(){}function c(){}function h(){}var d={};d[a]=function(){return this};var v=Object.getPrototypeOf,w=v&&v(v(_([])));w&&w!==e&&t.call(w,a)&&(d=w);var p=h.prototype=l.prototype=Object.create(d);function m(r){["next","throw","return"].forEach((function(e){r[e]=function(r){return this._invoke(e,r)}}))}function g(r){var e;this._invoke=function(n,a){function o(){return new Promise((function(e,o){!function e(n,a,o,i){var f=s(r[n],r,a);if("throw"!==f.type){var u=f.arg,l=u.value;return l&&"object"==typeof l&&t.call(l,"__await")?Promise.resolve(l.__await).then((function(r){e("next",r,o,i)}),(function(r){e("throw",r,o,i)})):Promise.resolve(l).then((function(r){u.value=r,o(u)}),(function(r){return e("throw",r,o,i)}))}i(f.arg)}(n,a,e,o)}))}return e=e?e.then(o,o):o()}}function y(r,e){var t=r.iterator[e.method];if(void 0===t){if(e.delegate=null,"throw"===e.method){if(r.iterator.return&&(e.method="return",e.arg=void 0,y(r,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var n=s(t,r.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,u;var a=n.arg;return a?a.done?(e[r.resultName]=a.value,e.next=r.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function b(r){var e={tryLoc:r[0]};1 in r&&(e.catchLoc=r[1]),2 in r&&(e.finallyLoc=r[2],e.afterLoc=r[3]),this.tryEntries.push(e)}function x(r){var e=r.completion||{};e.type="normal",delete e.arg,r.completion=e}function E(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(b,this),this.reset(!0)}function _(r){if(r){var e=r[a];if(e)return e.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var n=-1,o=function e(){for(;++n<r.length;)if(t.call(r,n))return e.value=r[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return c.prototype=p.constructor=h,h.constructor=c,h[i]=c.displayName="GeneratorFunction",r.isGeneratorFunction=function(r){var e="function"==typeof r&&r.constructor;return!!e&&(e===c||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,h):(r.__proto__=h,i in r||(r[i]="GeneratorFunction")),r.prototype=Object.create(p),r},r.awrap=function(r){return{__await:r}},m(g.prototype),g.prototype[o]=function(){return this},r.AsyncIterator=g,r.async=function(e,t,n,a){var o=new g(f(e,t,n,a));return r.isGeneratorFunction(t)?o:o.next().then((function(r){return r.done?r.value:o.next()}))},m(p),p[i]="Generator",p[a]=function(){return this},p.toString=function(){return"[object Generator]"},r.keys=function(r){var e=[];for(var t in r)e.push(t);return e.reverse(),function t(){for(;e.length;){var n=e.pop();if(n in r)return t.value=n,t.done=!1,t}return t.done=!0,t}},r.values=_,E.prototype={constructor:E,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!r)for(var e in this)"t"===e.charAt(0)&&t.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var r=this.tryEntries[0].completion;if("throw"===r.type)throw r.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var e=this;function n(t,n){return i.type="throw",i.arg=r,e.next=t,n&&(e.method="next",e.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var f=t.call(o,"catchLoc"),s=t.call(o,"finallyLoc");if(f&&s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(f){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(r,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&t.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===r||"continue"===r)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=r,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(i)},complete:function(r,e){if("throw"===r.type)throw r.arg;return"break"===r.type||"continue"===r.type?this.next=r.arg:"return"===r.type?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):"normal"===r.type&&e&&(this.next=e),u},finish:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===r)return this.complete(t.completion,t.afterLoc),x(t),u}},catch:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===r){var n=t.completion;if("throw"===n.type){var a=n.arg;x(t)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(r,e,t){return this.delegate={iterator:_(r),resultName:e,nextLoc:t},"next"===this.method&&(this.arg=void 0),u}},r}(r.exports);try{regeneratorRuntime=n}catch(r){Function("r","regeneratorRuntime = r")(n)}},function(r,e,t){(function(r){var n=Object.getOwnPropertyDescriptors||function(r){for(var e=Object.keys(r),t={},n=0;n<e.length;n++)t[e[n]]=Object.getOwnPropertyDescriptor(r,e[n]);return t},a=/%[sdj%]/g;e.format=function(r){if(!m(r)){for(var e=[],t=0;t<arguments.length;t++)e.push(f(arguments[t]));return e.join(" ")}t=1;for(var n=arguments,o=n.length,i=String(r).replace(a,(function(r){if("%%"===r)return"%";if(t>=o)return r;switch(r){case"%s":return String(n[t++]);case"%d":return Number(n[t++]);case"%j":try{return JSON.stringify(n[t++])}catch(r){return"[Circular]"}default:return r}})),s=n[t];t<o;s=n[++t])w(s)||!b(s)?i+=" "+s:i+=" "+f(s);return i},e.deprecate=function(t,n){if(void 0!==r&&!0===r.noDeprecation)return t;if(void 0===r)return function(){return e.deprecate(t,n).apply(this,arguments)};var a=!1;return function(){if(!a){if(r.throwDeprecation)throw new Error(n);r.traceDeprecation?console.trace(n):console.error(n),a=!0}return t.apply(this,arguments)}};var o,i={};function f(r,t){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),v(t)?n.showHidden=t:t&&e._extend(n,t),g(n.showHidden)&&(n.showHidden=!1),g(n.depth)&&(n.depth=2),g(n.colors)&&(n.colors=!1),g(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=s),l(n,r,n.depth)}function s(r,e){var t=f.styles[e];return t?"["+f.colors[t][0]+"m"+r+"["+f.colors[t][1]+"m":r}function u(r,e){return r}function l(r,t,n){if(r.customInspect&&t&&_(t.inspect)&&t.inspect!==e.inspect&&(!t.constructor||t.constructor.prototype!==t)){var a=t.inspect(n,r);return m(a)||(a=l(r,a,n)),a}var o=function(r,e){if(g(e))return r.stylize("undefined","undefined");if(m(e)){var t="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return r.stylize(t,"string")}if(p(e))return r.stylize(""+e,"number");if(v(e))return r.stylize(""+e,"boolean");if(w(e))return r.stylize("null","null")}(r,t);if(o)return o;var i=Object.keys(t),f=function(r){var e={};return r.forEach((function(r,t){e[r]=!0})),e}(i);if(r.showHidden&&(i=Object.getOwnPropertyNames(t)),E(t)&&(i.indexOf("message")>=0||i.indexOf("description")>=0))return c(t);if(0===i.length){if(_(t)){var s=t.name?": "+t.name:"";return r.stylize("[Function"+s+"]","special")}if(y(t))return r.stylize(RegExp.prototype.toString.call(t),"regexp");if(x(t))return r.stylize(Date.prototype.toString.call(t),"date");if(E(t))return c(t)}var u,b="",A=!1,k=["{","}"];(d(t)&&(A=!0,k=["[","]"]),_(t))&&(b=" [Function"+(t.name?": "+t.name:"")+"]");return y(t)&&(b=" "+RegExp.prototype.toString.call(t)),x(t)&&(b=" "+Date.prototype.toUTCString.call(t)),E(t)&&(b=" "+c(t)),0!==i.length||A&&0!=t.length?n<0?y(t)?r.stylize(RegExp.prototype.toString.call(t),"regexp"):r.stylize("[Object]","special"):(r.seen.push(t),u=A?function(r,e,t,n,a){for(var o=[],i=0,f=e.length;i<f;++i)N(e,String(i))?o.push(h(r,e,t,n,String(i),!0)):o.push("");return a.forEach((function(a){a.match(/^\d+$/)||o.push(h(r,e,t,n,a,!0))})),o}(r,t,n,f,i):i.map((function(e){return h(r,t,n,f,e,A)})),r.seen.pop(),function(r,e,t){if(r.reduce((function(r,e){return e.indexOf("\n")>=0&&0,r+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return t[0]+(""===e?"":e+"\n ")+" "+r.join(",\n  ")+" "+t[1];return t[0]+e+" "+r.join(", ")+" "+t[1]}(u,b,k)):k[0]+b+k[1]}function c(r){return"["+Error.prototype.toString.call(r)+"]"}function h(r,e,t,n,a,o){var i,f,s;if((s=Object.getOwnPropertyDescriptor(e,a)||{value:e[a]}).get?f=s.set?r.stylize("[Getter/Setter]","special"):r.stylize("[Getter]","special"):s.set&&(f=r.stylize("[Setter]","special")),N(n,a)||(i="["+a+"]"),f||(r.seen.indexOf(s.value)<0?(f=w(t)?l(r,s.value,null):l(r,s.value,t-1)).indexOf("\n")>-1&&(f=o?f.split("\n").map((function(r){return"  "+r})).join("\n").substr(2):"\n"+f.split("\n").map((function(r){return"   "+r})).join("\n")):f=r.stylize("[Circular]","special")),g(i)){if(o&&a.match(/^\d+$/))return f;(i=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(i=i.substr(1,i.length-2),i=r.stylize(i,"name")):(i=i.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),i=r.stylize(i,"string"))}return i+": "+f}function d(r){return Array.isArray(r)}function v(r){return"boolean"==typeof r}function w(r){return null===r}function p(r){return"number"==typeof r}function m(r){return"string"==typeof r}function g(r){return void 0===r}function y(r){return b(r)&&"[object RegExp]"===A(r)}function b(r){return"object"==typeof r&&null!==r}function x(r){return b(r)&&"[object Date]"===A(r)}function E(r){return b(r)&&("[object Error]"===A(r)||r instanceof Error)}function _(r){return"function"==typeof r}function A(r){return Object.prototype.toString.call(r)}function k(r){return r<10?"0"+r.toString(10):r.toString(10)}e.debuglog=function(t){if(g(o)&&(o=r.env.NODE_DEBUG||""),t=t.toUpperCase(),!i[t])if(new RegExp("\\b"+t+"\\b","i").test(o)){var n=r.pid;i[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,n,r)}}else i[t]=function(){};return i[t]},e.inspect=f,f.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},f.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=d,e.isBoolean=v,e.isNull=w,e.isNullOrUndefined=function(r){return null==r},e.isNumber=p,e.isString=m,e.isSymbol=function(r){return"symbol"==typeof r},e.isUndefined=g,e.isRegExp=y,e.isObject=b,e.isDate=x,e.isError=E,e.isFunction=_,e.isPrimitive=function(r){return null===r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||"symbol"==typeof r||void 0===r},e.isBuffer=t(18);var M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function q(){var r=new Date,e=[k(r.getHours()),k(r.getMinutes()),k(r.getSeconds())].join(":");return[r.getDate(),M[r.getMonth()],e].join(" ")}function N(r,e){return Object.prototype.hasOwnProperty.call(r,e)}e.log=function(){console.log("%s - %s",q(),e.format.apply(e,arguments))},e.inherits=t(19),e._extend=function(r,e){if(!e||!b(e))return r;for(var t=Object.keys(e),n=t.length;n--;)r[t[n]]=e[t[n]];return r};var P="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function S(r,e){if(!r){var t=new Error("Promise was rejected with a falsy value");t.reason=r,r=t}return e(r)}e.promisify=function(r){if("function"!=typeof r)throw new TypeError('The "original" argument must be of type Function');if(P&&r[P]){var e;if("function"!=typeof(e=r[P]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,P,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,t,n=new Promise((function(r,n){e=r,t=n})),a=[],o=0;o<arguments.length;o++)a.push(arguments[o]);a.push((function(r,n){r?t(r):e(n)}));try{r.apply(this,a)}catch(r){t(r)}return n}return Object.setPrototypeOf(e,Object.getPrototypeOf(r)),P&&Object.defineProperty(e,P,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,n(r))},e.promisify.custom=P,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);var a=t.pop();if("function"!=typeof a)throw new TypeError("The last argument must be of type Function");var o=this,i=function(){return a.apply(o,arguments)};e.apply(this,t).then((function(e){r.nextTick(i,null,e)}),(function(e){r.nextTick(S,e,i)}))}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,n(e)),t}}).call(this,t(17))},function(r,e){var t,n,a=r.exports={};function o(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function f(r){if(t===setTimeout)return setTimeout(r,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(r,0);try{return t(r,0)}catch(e){try{return t.call(null,r,0)}catch(e){return t.call(this,r,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(r){t=o}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(r){n=i}}();var s,u=[],l=!1,c=-1;function h(){l&&s&&(l=!1,s.length?u=s.concat(u):c=-1,u.length&&d())}function d(){if(!l){var r=f(h);l=!0;for(var e=u.length;e;){for(s=u,u=[];++c<e;)s&&s[c].run();c=-1,e=u.length}s=null,l=!1,function(r){if(n===clearTimeout)return clearTimeout(r);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(r);try{n(r)}catch(e){try{return n.call(null,r)}catch(e){return n.call(this,r)}}}(r)}}function v(r,e){this.fun=r,this.array=e}function w(){}a.nextTick=function(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];u.push(new v(r,e)),1!==u.length||l||f(d)},v.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=w,a.addListener=w,a.once=w,a.off=w,a.removeListener=w,a.removeAllListeners=w,a.emit=w,a.prependListener=w,a.prependOnceListener=w,a.listeners=function(r){return[]},a.binding=function(r){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(r){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(r,e){r.exports=function(r){return r&&"object"==typeof r&&"function"==typeof r.copy&&"function"==typeof r.fill&&"function"==typeof r.readUInt8}},function(r,e){"function"==typeof Object.create?r.exports=function(r,e){r.super_=e,r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}})}:r.exports=function(r,e){r.super_=e;var t=function(){};t.prototype=e.prototype,r.prototype=new t,r.prototype.constructor=r}},function(r,e){r.exports=function(r){if(Array.isArray(r))return r}},function(r,e){r.exports=function(r,e){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r)){var t=[],n=!0,a=!1,o=void 0;try{for(var i,f=r[Symbol.iterator]();!(n=(i=f.next()).done)&&(t.push(i.value),!e||t.length!==e);n=!0);}catch(r){a=!0,o=r}finally{try{n||null==f.return||f.return()}finally{if(a)throw o}}return t}}},function(r,e){r.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(r,e){r.exports=function(r){if(void 0===r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}},function(r,e){r.exports=function(r){return-1!==Function.toString.call(r).indexOf("[native code]")}},function(r,e,t){"use strict";t.r(e);var n={};t.r(n),t.d(n,"Complex",(function(){return w})),t.d(n,"Complex128Array",(function(){return A})),t.d(n,"ARRAY_TYPES",(function(){return k})),t.d(n,"eps",(function(){return M})),t.d(n,"cast_scalar",(function(){return q})),t.d(n,"_check_dtype",(function(){return N})),t.d(n,"dtypeof",(function(){return P})),t.d(n,"super_dtype",(function(){return S})),t.d(n,"is_subdtype",(function(){return I}));var a={};t.r(a),t.d(a,"IS_LITTLE_ENDIAN",(function(){return pr})),t.d(a,"WHITESPACES",(function(){return mr})),t.d(a,"b64_decode",(function(){return nr})),t.d(a,"b64_decode_gen",(function(){return ar})),t.d(a,"b64_encode",(function(){return or})),t.d(a,"b64_encode_gen",(function(){return ir})),t.d(a,"istr_parse",(function(){return sr})),t.d(a,"istr_stringify",(function(){return ur})),t.d(a,"istr_stringify_gen",(function(){return lr})),t.d(a,"npy_serialize",(function(){return dr})),t.d(a,"npy_serialize_gen",(function(){return vr})),t.d(a,"npy_deserialize",(function(){return wr}));var o={};t.r(o),t.d(o,"_bidiag_decomp_horiz",(function(){return qr})),t.d(o,"bidiag_decomp",(function(){return Nr})),t.d(o,"cholesky_decomp",(function(){return Jr})),t.d(o,"cholesky_solve",(function(){return Tr})),t.d(o,"diag_mat",(function(){return Lr})),t.d(o,"diag",(function(){return Rr})),t.d(o,"det_tri",(function(){return zr})),t.d(o,"slogdet_tri",(function(){return Qr})),t.d(o,"det",(function(){return Gr})),t.d(o,"slogdet",(function(){return Cr})),t.d(o,"eigen",(function(){return se})),t.d(o,"eigenvals",(function(){return ue})),t.d(o,"eigen_balance_pre",(function(){return le})),t.d(o,"eigen_balance_post",(function(){return ce})),t.d(o,"eye",(function(){return he})),t.d(o,"hessenberg_decomp",(function(){return Wr})),t.d(o,"lstsq",(function(){return ke})),t.d(o,"lu_decomp",(function(){return Me})),t.d(o,"lu_solve",(function(){return qe})),t.d(o,"matmul2",(function(){return ne})),t.d(o,"matmul",(function(){return ae})),t.d(o,"norm",(function(){return Er})),t.d(o,"permute_rows",(function(){return Ne})),t.d(o,"permute_cols",(function(){return Pe})),t.d(o,"unpermute_rows",(function(){return Se})),t.d(o,"unpermute_cols",(function(){return Ie})),t.d(o,"qr_decomp_full",(function(){return Ur})),t.d(o,"qr_decomp",(function(){return Yr})),t.d(o,"qr_lstsq",(function(){return Dr})),t.d(o,"rand_ortho",(function(){return je})),t.d(o,"rank",(function(){return Oe})),t.d(o,"rrqr_decomp",(function(){return Re})),t.d(o,"rrqr_decomp_full",(function(){return Le})),t.d(o,"rrqr_rank",(function(){return Ue})),t.d(o,"rrqr_lstsq",(function(){return De})),t.d(o,"rrqr_solve",(function(){return Ye})),t.d(o,"srrqr_decomp_full",(function(){return Qe})),t.d(o,"schur_eigenvals",(function(){return oe})),t.d(o,"schur_eigen",(function(){return ie})),t.d(o,"schur_decomp",(function(){return fe})),t.d(o,"SingularMatrixSolveError",(function(){return we})),t.d(o,"solve",(function(){return Ge})),t.d(o,"svd_decomp",(function(){return xe})),t.d(o,"svd_rank",(function(){return Ee})),t.d(o,"svd_solve",(function(){return _e})),t.d(o,"svd_lstsq",(function(){return Ae})),t.d(o,"svd_dc",(function(){return xe})),t.d(o,"svd_jac_2sided",(function(){return Ce})),t.d(o,"svd_jac_2sided_blocked",(function(){return Ve})),t.d(o,"svd_jac_classic",(function(){return Be})),t.d(o,"tril",(function(){return Pr})),t.d(o,"triu",(function(){return Sr})),t.d(o,"tril_solve",(function(){return jr})),t.d(o,"triu_solve",(function(){return Fr})),t.d(o,"urv_decomp_full",(function(){return We})),t.d(o,"urv_lstsq",(function(){return He}));var i={};t.r(i),t.d(i,"strong_wolfe",(function(){return rt}));var f={};t.r(f),t.d(f,"line_search",(function(){return i})),t.d(f,"lsq_dogleg_gen",(function(){return ft})),t.d(f,"fit_dogleg_gen",(function(){return st})),t.d(f,"fit_lin",(function(){return ut})),t.d(f,"min1d_gss",(function(){return ct})),t.d(f,"min_lbfgs_gen",(function(){return vt})),t.d(f,"strong_wolfe",(function(){return rt})),t.d(f,"lsq_lm_gen",(function(){return mt})),t.d(f,"fit_lm_gen",(function(){return gt})),t.d(f,"num_grad",(function(){return yt})),t.d(f,"num_grad_forward",(function(){return bt})),t.d(f,"root1d_bisect",(function(){return Br}));var s={};t.r(s),t.d(s,"odeint_rk4",(function(){return xt}));var u=t(3),l=t.n(u),c=t(4),h=t.n(c),d={nextUp:function(r){var e=Number.EPSILON,t=Number.MIN_VALUE,n=r*(r<0?1-e/2:1+e);if(!isFinite(r))throw new Error("Assertion failed!");if(!isFinite(n))throw new Error("Assertion failed!");n===r&&(n+=t);var a=r+(n-r)/2;r<a&&a<n&&(n=a);var o=(n+r)/2;return r<o&&o<n&&(n=o),0===n?-0:n},add:function(r,e){return r instanceof w?r.add(e):e instanceof w?e.add(r):r+e},sub:function(r,e){return r instanceof w?r.sub(e):e instanceof w?new w(r).sub(e):r-e},mul:function(r,e){return r instanceof w?r.mul(e):e instanceof w?e.mul(r):r*e},div:function(r,e){return r instanceof w?r.div(e):e instanceof w?new w(r).div(e):r/e},zero:function(r){return d.cast(0,r)},one:function(r){return d.cast(1,r)},neg:function(r){return r instanceof w?r.neg():-r},abs:function(r){return r instanceof w?r.abs():Math.abs(r)},sqrt:function(r){return r instanceof w?r.sqrt():r>=0?Math.sqrt(r):new w(r).sqrt()},exp:function(r){return r instanceof w?r.exp():Math.exp(r)},min:function(r,e){return Math.min(r,e)},max:function(r,e){return Math.max(r,e)},hypot:function(r,e){return Math.hypot(r,e)},atan2:function(r,e){return Math.atan2(r,e)},conj:function(r){return r instanceof w?r.conj():r},is_equal:function(r,e){return r instanceof w?r.equals(e):e instanceof w?e.equals(r):r==e},is_close:function(r,e){var t=1e-8+1e-5*d.max(d.abs(r),d.abs(e));return d.abs(d.sub(r,e))<=t}},v=d,w=function(){function r(e,t){if(l()(this,r),null==e&&(e=0),null==t&&(t=0),null==e.re&&null==e.im||(t=e.im||0,e=e.re||0),this.re=1*e,this.im=1*t,isNaN(e))throw new Error("Real value is NaN.");if(isNaN(t))throw new Error("Imaginary value is NaN.");Object.freeze(this)}return h()(r,[{key:"add",value:function(e,t){return null==e&&(e=0),null==t&&(t=0),null==e.re&&null==e.im||(t=e.im||0,e=e.re||0),new r(this.re+e,this.im+t)}},{key:"sub",value:function(e,t){return null==e&&(e=0),null==t&&(t=0),null==e.re&&null==e.im||(t=e.im||0,e=e.re||0),new r(this.re-e,this.im-t)}},{key:"mul",value:function(e,t){return null==e&&(e=0),null==t&&(t=0),null==e.re&&null==e.im||(t=e.im||0,e=e.re||0),new r(this.re*e-this.im*t,this.re*t+this.im*e)}},{key:"div",value:function(e,t){if(null==e&&(e=0),null==t&&(t=0),null==e.re&&null==e.im||(t=e.im||0,e=e.re||0),0==t)return new r(this.re/e,this.im/e);if(Math.abs(e)>=Math.abs(t)){var n=t/e;return new r((this.re+this.im*n)/(e+t*n),(this.im-this.re*n)/(e+t*n))}var a=e/t;return new r((this.re*a+this.im)/(e*a+t),(this.im*a-this.re)/(e*a+t))}},{key:"equals",value:function(r,e){return null==r&&(r=0),null==e&&(e=0),null==r.re&&null==r.im||(e=r.im||0,r=r.re||0),this.re==r&&this.im==e}},{key:"abs",value:function(){return Math.hypot(this.re,this.im)}},{key:"arg",value:function(){return Math.atan2(this.im,this.re)}},{key:"conj",value:function(){return new r(this.re,-this.im)}},{key:"toFixed",value:function(e){return new r(this.re.toFixed(e),this.im.toFixed(e))}},{key:"sqrt",value:function(){var e=this.abs();return new r(v.sqrt(v.mul(v.add(e,this.re),.5)),v.sqrt(v.mul(v.sub(e,this.re),.5)))}},{key:Symbol.for("nodejs.util.inspect.custom"),value:function(){return this.toString()}},{key:"toString",value:function(){return 0==this.im?this.re.toString():0==this.re?"".concat(this.im,"j"):this.im<0?"".concat(this.re," - ").concat(-this.im,"j"):"".concat(this.re," + ").concat(this.im,"j")}},{key:"valueOf",value:function(){return 0==this.im?this.re:this}}]),r}(),p=t(2),m=t.n(p),g=t(1),y=t.n(g),b=t(5),x=t.n(b);t(16);var E,_,A=(E=Float64Array,_={get:function(r,e){return"symbol"!==x()(e)&&e%1==0?r.get(e):r[e]},set:function(r,e,t){return"symbol"!==x()(e)&&e%1==0?(r.set(e,t),!0):(r[e]=t,!0)}},function(){function r(e,t,n){return l()(this,r),e%1==0?(n=e,this._array=new E(2*n)):(null!=n&&(n*=2),this._array=new E(e,t,n)),Object.seal(this),new Proxy(this,_)}return h()(r,null,[{key:"BYTES_PER_ELEMENT",get:function(){return 2*E.BYTES_PER_ELEMENT}},{key:"name",get:function(){return"Complex".concat(8*r.BYTES_PER_ELEMENT,"Array")}}]),h()(r,[{key:Symbol.iterator,value:y.a.mark((function r(){var e;return y.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e=0;case 1:if(!(e<this.length)){r.next=7;break}return r.next=4,this[e];case 4:e++,r.next=1;break;case 7:case"end":return r.stop()}}),r,this)}))},{key:"keys",value:y.a.mark((function r(){var e;return y.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e=0;case 1:if(!(e<this.length)){r.next=7;break}return r.next=4,e;case 4:e++,r.next=1;break;case 7:case"end":return r.stop()}}),r,this)}))},{key:"values",value:y.a.mark((function r(){return y.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.delegateYield(this[Symbol.iterator](),"t0",1);case 1:case"end":return r.stop()}}),r,this)}))},{key:"entries",value:y.a.mark((function r(){var e;return y.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e=0;case 1:if(!(e<this.length)){r.next=7;break}return r.next=4,[e,this[e]];case 4:e++,r.next=1;break;case 7:case"end":return r.stop()}}),r,this)}))},{key:"forEach",value:function(r,e){for(var t=0;t<source.length;t++)r.call(e,source[t],t)}},{key:"map",value:function(e,t){return r.from(this,e,t)}},{key:"reduce",value:function(r,e){var t=0;if(null==e){if(0==this.length)throw new TypeError("TypeError: Reduce of empty array with no initial value.");e=this[t++]}for(;t<this.length;t++)e=r(e,this[t],t,this);return e}},{key:"slice",value:function(e,t){return null!=e&&(e*=2),null!=t&&(t*=2),new r(this._array.slice(e,t).buffer)}},{key:"subarray",value:function(e,t){null!=e&&(e*=2),null!=t&&(t*=2);var n=this._array.subarray(e,t);return new r(n.buffer,n.byteOffset,n.length/2)}},{key:"join",value:function(r){null==r&&(r=", ");for(var e="",t=0;t<this.length;t++)t>0&&(e+=r),e+=this[t].toString();return e}},{key:"fill",value:function(r,e,t){r instanceof w||(r=new w(r)),null==e&&(e=0),null==t&&(t=this.length),0>t&&(t+=this.length),0>e&&(e+=this.length);for(var n=this._array.length;(n-=2)>=0;)this._array[n+1]=r.im,this._array[n+0]=r.re;return this}},{key:"get",value:function(r){return new w(this._array[2*r+0],this._array[2*r+1])}},{key:"set",value:function(r,e){if(r*=2,"number"==typeof e||!isNaN(e))return this._array[r+0]=e,void(this._array[r+1]=isNaN(e)?NaN:0);"re"in e&&"im"in e||(e=new w(e)),this._array[r+0]=e.re,this._array[r+1]=e.im}},{key:Symbol.for("nodejs.util.inspect.custom"),value:function(r){return"Complex128Array "+util.inspect(Array.from(this),r)}},{key:"toString",value:function(r){return this.join(",")}},{key:"buffer",get:function(){return this._array.buffer}},{key:"byteOffset",get:function(){return this._array.byteOffset}},{key:"byteLength",get:function(){return this._array.byteLength}},{key:"length",get:function(){return this._array.length>>>1}},{key:Symbol.toStringTag,get:function(){throw new Error("not yet implemented.")}}],[{key:"from",value:function(e,t,n){if(e.hasOwnProperty("length")||(e=m()(e)),null==t){if(e instanceof r)return new r(E.from(e._array).buffer,0,e.length);if(e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array){for(var a=new E(2*e.length),o=e.length;o-- >0;)a[o<<1]=e[o];return new r(a.buffer,0,e.length)}}var i=new r(e.length);t=t||function(r){return r};for(var f=0;f<e.length;f++)i[f]=t.call(n,e[f],f);return i}},{key:"of",value:function(){for(var e=new r(arguments.length),t=0;t<arguments.length;t++)e[t]=t<0||arguments.length<=t?void 0:arguments[t];return e}}]),r}()),k={int32:Int32Array,float32:Float32Array,float64:Float64Array,complex128:A,object:Array};function M(r){switch(N(r),r){case"complex128":return new w(Number.EPSILON);case"float32":return 1.1920928955078125e-7;default:return Number.EPSILON}}function q(r,e){return"int32"===e?4294967295&r:"float32"===e?Math.fround(r):"complex128"===e?r instanceof w?r:new w(r):1*r}function N(r){if(!k.hasOwnProperty(r))throw new Error("Invalid dtype '"+r+"'. Must be one of {'"+Object.getOwnPropertyNames(k).join("', '")+"'}.")}function P(r){return r%1==0?r<=~(1<<31)&&r>=1<<31?"int32":"object":1*r==r?"float64":r instanceof w?"complex128":"object"}var S=function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return e.reduce((function(r,e){return N(r),N(e),"object"===r||"object"===e?"object":"complex128"===r||"complex128"===e?"complex128":"float64"===r||"float64"===e?"float64":"float32"===r||"float32"===e?"float32":"int32"}))};function I(r,e){N(r),N(e);var t={int32:0,float32:1,float64:2,complex128:3,object:4};return t[r]<=t[e]}var j=t(0),O=t.n(j),F=t(6),J=t.n(F),T=t(7),L=t.n(T),U=t(8),Y=t.n(U);function D(r,e,t){if(null==t&&e instanceof Function&&(t=e,e=void 0),r instanceof Array||(r=m()(r)),r=r.map((function(r){return G(r)})),null==e&&(e="object"),null==t){if("object"!==e)throw new Error('If zip_fn is undefined, dtype must be "object" or undefined.');var n=r.length;t=function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return e.slice(0,n)}}N(e);var a=r.reduce((function(r,e){return Math.max(r,e.ndim)}),0),o=Int32Array.from({length:a},(function(){return 1})),i=!0,f=!1,s=void 0;try{for(var u,l=r[Symbol.iterator]();!(i=(u=l.next()).done);i=!0)for(var c=u.value,h=a,d=c.ndim;h-- >0&&d-- >0;)if(1===o[h])o[h]=c.shape[d];else if(o[h]!=c.shape[d]&&1!=c.shape[d])throw new Error("Shapes are not broadcast-compatible.")}catch(r){f=!0,s=r}finally{try{i||null==l.return||l.return()}finally{if(f)throw s}}var v=new Int32Array(a),w=new k[e](o.reduce((function(r,e){return r*e}),1)),p=new Array(r.length),g=new Int32Array(r.length),y=new Int32Array(r.length),b=0;return function e(n){if(n!==a){for(v[n]=0;e(n+1),!(++v[n]>=o[n]);)for(var i=r.length;i-- >0;)r[i].shape[n-a+r[i].ndim]>1||(g[i]-=y[i]);for(var f=r.length;f-- >0;)y[f]*=r[f].shape[n-a+r[f].ndim]||1}else{y.fill(1);for(var s=r.length;s-- >0;)p[s]=r[s].data[g[s]++];w[b++]=t.apply(void 0,p.concat(m()(v)))}}(0),new V(o,w)}function z(r,e){var t=y.a.mark(a);if(null==e&&(e=r,r=void 0),("object"==x()(e)||"function"==typeof e)&&"shape"in e&&"data"in e){var n=e.data;return n=null==r||n instanceof k[r]?n.slice():k[r].from(n),new V(e.shape,n)}function a(r){var e;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("object"===x()(r)&&"length"in r)){t.next=7;break}if("number"==typeof(e=r.length)&&e%1==0&&0!==e){t.next=4;break}throw"Illegal argument(s).";case 4:return t.next=6,e;case 6:return t.delegateYield(a(r[0]),"t0",7);case 7:case"end":return t.stop()}}),t)}a=Int32Array.from(a(e)),null==r&&(r=function r(e,t){if(e===a.length)return P(t);for(var n=a[e]-1,o=r(e+1,t[n]);n>=0;n--)o=S(o,r(e+1,t[n]));return o}(0,e)),N(r);var o=new k[r](a.reduce((function(r,e){return r*e}),1)),i=0;return function r(e,t){if(e===a.length)o[i++]=t;else{if(t.length!==a[e])throw new Error("Nested array not axis-aligned.");for(var n=0;n<a[e];n++)r(e+1,t[n])}}(0,e),new V(a,o)}function G(r,e){if(null==e&&(e=r,r=void 0),null!=r&&"float"!==r&&!(r in k))throw new Error("asarray(dtype, arrayLike): Invalid dtype: '".concat(r,"'."));return e instanceof V?null==r||r===e.dtype||"float"===r&&e.dtype.startsWith("float")?e:new V(e.shape,k[r].from(e.data)):("float"===r&&(r="float64"),z(r,e))}var C,V=function(r){function e(r,t){if(l()(this,e),!(r instanceof Int32Array))throw new Error("Shape must be Int32Array.");if(r.some((function(r){return r<1})))throw new Error("Invalid shape: ".concat(r,"."));if(t.length!=r.reduce((function(r,e){return r*e}),1))throw new Error("Shape [".concat(r,"] does not match array length of ").concat(t.length,"."));var n=function r(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.data[r._flat_idx(t)]};return Object.setPrototypeOf(n,e.prototype),Object.freeze(r.buffer),n.shape=r,n.data=t,Object.seal(n),J()(void 0,n)}return L()(e,r),h()(e,null,[{key:"name",get:function(){return"nd.Array"}}]),h()(e,[{key:"set",value:function(r,e){this.data[this._flat_idx(r)]=e}},{key:"modify",value:function(r,e){var t=this._flat_idx(r);this.data[t]=e.apply(void 0,[this.data[t]].concat(m()(r)))}},{key:"_flat_idx",value:function(r){var e=this.shape;if(r.length!=e.length)throw new Error("Multi-index [".concat(r,"] does not have expected length of ").concat(e.length,"."));for(var t=0,n=1,a=e.length;a-- >0;n*=e[a]){var o=r[a];if(o%1!=0)throw new Error("Multi-index [".concat(r,"] contains non-integer entries."));if(o<0&&(o+=e[a]),o<0||o>=e[a])throw new Error("Multi-index [".concat(r,"] out of bounds [").concat(e,"]."));t+=o*n}return t}},{key:Symbol.for("nodejs.util.inspect.custom"),value:function(r,e){return this.toString()}},{key:"toString",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(r,e){return e.length,6};return function(){var e=y.a.mark(s),t=y.a.mark(c);if(!(r instanceof Function)){var n=1*r;r=function(){return n}}var a=this.shape,o=this.data,i=new Int32Array(a.length);i[i.length-1]=1;for(var f=i.length;--f>0;)i[f-1]=i[f]*a[f];function s(t,n){var f,u,l,c,h,d,v;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=r(t,a),l=f-(u=f>>>1),a.length!==t){e.next=16;break}c=o[n],e.t0=c,e.next=null===e.t0?6:void 0===e.t0?9:12;break;case 6:return e.next=8,"null";case 8:return e.abrupt("break",14);case 9:return e.next=11,"undefined";case 11:return e.abrupt("break",14);case 12:return e.next=14,c.toString();case 14:e.next=37;break;case 16:if(!(a[t]>f+1)){e.next=31;break}h=0;case 18:if(!(h<l)){e.next=23;break}return e.delegateYield(s(t+1,n+h*i[t]),"t1",20);case 20:h++,e.next=18;break;case 23:d=a[t]-u;case 24:if(!(d<a[t])){e.next=29;break}return e.delegateYield(s(t+1,n+d*i[t]),"t2",26);case 26:d++,e.next=24;break;case 29:e.next=37;break;case 31:v=0;case 32:if(!(v<a[t])){e.next=37;break}return e.delegateYield(s(t+1,n+v*i[t]),"t3",34);case 34:v++,e.next=32;break;case 37:case"end":return e.stop()}}),e)}if(s=m()(s(0,0)),this.ndim>1){var u=s.reduce((function(r,e){return Math.max(r,e.length)}),0);s=s.map((function(r){return r.padStart(u)}))}var l=0;function c(e,n,o){var f,u,h,d,v,w,p,m,g;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.length!==n){t.next=4;break}return t.next=3,s[l++];case 3:return t.abrupt("return");case 4:return e+=" ",f="[ ",u=", ",h=" ]",n<a.length-1&&(u=",\n"+e,f="[",h="]"),t.next=9,f;case 9:if(d=r(n,a),w=d-(v=d>>>1),!(a[n]>d+1)){t.next=31;break}p=0;case 12:if(!(p<w)){t.next=19;break}return t.delegateYield(c(e,n+1,o+p*i[n]),"t0",14);case 14:return t.next=16,u;case 16:p++,t.next=12;break;case 19:return t.next=21,"...".concat(a[n]-d," more...");case 21:m=a[n]-v;case 22:if(!(m<a[n])){t.next=29;break}return t.next=25,u;case 25:return t.delegateYield(c(e,n+1,o+m*i[n]),"t1",26);case 26:m++,t.next=22;break;case 29:t.next=40;break;case 31:g=0;case 32:if(!(g<a[n])){t.next=40;break}if(!(g>0)){t.next=36;break}return t.next=36,u;case 36:return t.delegateYield(c(e,n+1,o+g*i[n]),"t2",37);case 37:g++,t.next=32;break;case 40:return t.next=42,h;case 42:case"end":return t.stop()}}),t)}return m()(c("",0,0)).join("")}.apply(this)}},{key:"toNestedArray",value:function(){var r=this.data,e=this.shape,t=0;return function n(a){return a===e.length?r[t++]:Array.from({length:e[a]},(function(){return n(a+1)}))}(0)}},{key:Symbol.iterator,value:y.a.mark((function r(){var t,n,a;return y.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t=this.shape.slice(1),n=t.reduce((function(r,e){return r*e}),1),a=0;case 2:if(!(a<this.data.length)){r.next=7;break}return r.next=5,new e(t,this.data.slice(a,a+=n));case 5:r.next=2;break;case 7:case"end":return r.stop()}}),r,this)}))},{key:"forEach",value:function(r){for(var t=this.shape[0],n=this.shape.slice(1),a=n.reduce((function(r,e){return r*e}),1),o=0,i=0;o<t;o++,i+=a)r(new e(n,this.data.slice(i,i+a)),o)}},{key:"elems",value:y.a.mark((function(){var r,e,t,n,a,o;return y.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=function(i){return y.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i!==e.length){r.next=5;break}return r.next=3,[n.slice(),t[a++]];case 3:r.next=11;break;case 5:n[i]=0;case 6:if(!(n[i]<e[i])){r.next=11;break}return r.delegateYield(o(i+1),"t0",8);case 8:n[i]++,r.next=6;break;case 11:case"end":return r.stop()}}),r)},r=y.a.mark(o),e=this.shape,t=this.data,n=new Int32Array(e.length),a=0,i.delegateYield(o(0),"t0",5);case 5:case"end":return i.stop()}}),o,this)}))},{key:"forElems",value:function(r){var e=this.shape,t=this.data,n=new Int32Array(e.length),a=0;!function o(i){if(i===e.length)r.apply(void 0,[t[a++]].concat(m()(n)));else for(n[i]=0;n[i]<e[i];n[i]++)o(i+1)}(0)}},{key:"valueOf",value:function(){return 0===this.shape.length?this.data[0]:this}},{key:"mapElems",value:function(r,t){if(null==t){if(null==r)return new e(this.shape,this.data.slice());r instanceof Function&&(t=r,r=void 0)}return null==t&&(t=function(r){return r}),D([this],r,t)}},{key:"transpose",value:function(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];t=m()(t);var a=Int32Array.from(this.shape),o=a.length,i=new Int32Array(o);o>0&&(i[o-1]=1);for(var f=o;--f>0;)i[f-1]=a[f]*i[f];if(0==t.length){if(o<=1)return this.sliceElems();a[o-2]=this.shape[o-1],a[o-1]=this.shape[o-2];var s=i[o-2];i[o-2]=i[o-1],i[o-1]=s}else{var u=new Set(t),l=i;if(i=new Int32Array(o),u.size!=t.length)throw new Error("Duplicate axes are not allowed.");for(var c=t.length;c-- >0;){var h=t[c];if(0>h||h>=o)throw new Error("Axis out of bounds.");a[c]=this.shape[h],i[c]=l[h]}for(var d=0,v=u.size;d<o;d++)u.has(d)||(a[v]=this.shape[d],i[v++]=l[d])}var w=this.data,p=new w.__proto__.constructor(w.length),g=w.length;function y(r,e){if(o>r)for(var t=a[r];t-- >0;e-=i[r])y(r+1,e);else p[--g]=w[e]}return y(0,g-1),new e(a,p)}},{key:"reshape",value:function(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];t=Int32Array.from(t);for(var a=this.data.length,o=1,i=-1,f=t.length;--f>=0;)if(t[f]<0){if(-1!==t[f])throw new Error("Invalid dimension: "+t[f]);if(-1!==i)throw new Error("At most on dimension may be -1.");i=f}else o*=t[f];if(-1!==i){if(0!=a%o)throw new Error("Shape cannot be inferred.");t[i]=a/o}return new e(t,this.data)}},{key:"reduceElems",value:function(r,t,n){if(null==n){if(null==t)return this.data.reduce(r);if("string"==typeof r)return this.data.reduce(t);n=t,t=void 0}if(null==t&&(t="object"),!I(this.dtype,t))throw new Error("New dtype must be a super-dtype.");var a=this.ndim;if("number"==typeof r&&(r=[r]),r instanceof e){if(!I(r.dtype,"int32"))throw new Error("Invalid dtype ".concat(r.dtype," for axes."));if(1!==r.ndim)throw new Error("Only 1D nd.Array allowed for axes.");r=r.data}r=new Set(y.a.mark((function e(){var t,n,o,i,f,s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,o=void 0,e.prev=3,i=r[Symbol.iterator]();case 5:if(t=(f=i.next()).done){e.next=15;break}if(0>(s=f.value)&&(s+=a),!(0>s||s>=a)){e.next=10;break}throw new Error("Reduction axis "+s+" out of bounds.");case 10:return e.next=12,+s;case 12:t=!0,e.next=5;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(3),n=!0,o=e.t0;case 21:e.prev=21,e.prev=22,t||null==i.return||i.return();case 24:if(e.prev=24,!n){e.next=27;break}throw o;case 27:return e.finish(24);case 28:return e.finish(21);case 29:case"end":return e.stop()}}),e,null,[[3,17,21,29],[22,,24,28]])}))());var o=this.shape,i=o.filter((function(e,t){return!r.has(t)})),f=new k[t](i.reduce((function(r,e){return r*e}),1)),s=this.data,u=0,l=0;if(function e(t,a){if(o.length===t)f[u]=a?n(s[l++],f[u]):s[l++],++u;else if(r.has(t))for(var i=u,c=o[t];c-- >0;a=!0)u=i,e(t+1,a);else for(var h=o[t];h-- >0;)e(t+1,a)}(0,!1),u!=f.length)throw new Error([u,f.length]);if(l!=this.data.length)throw new Error([l,this.data.length]);return new e(i,f)}},{key:"sliceElems",value:function(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];for(var a=this.ndim,o=this.shape,i=0,f=0,s=0,u=0,l=t;u<l.length;u++){var c=l[u];if("..."===c)++i;else if("new"===c)0;else if("number"==typeof c){if(c%1!=0)throw new Error("Only integral indices allowed.");++f}else{var h=c.length;if("number"!=typeof h||h%1!=0||h>3||1==h)throw new Error("Illegal argument(s).");++s}}if(i>1)throw new Error("Highlander! There can be only one ... (ellipsis).");if(0==i&&t.push("..."),f+s>a)throw new Error("Cannot sliced more dimensions than available.");var d=0,v=[],w=Int32Array.from(y.a.mark((function r(){var e,n,i,u,l,c,h,w,p,m,g,b,x;return y.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e=a,n=1,i=t.length;case 2:if(!(--i>=0)){r.next=54;break}u=t[i],r.t0=u,r.next="new"===r.t0?7:"..."===r.t0?11:21;break;case 7:return v.push(0),r.next=10,1;case 10:return r.abrupt("break",52);case 11:l=f+s;case 12:if(!(l<a)){r.next=20;break}return v.push(n),n*=o[--e],r.next=17,o[e];case 17:l++,r.next=12;break;case 20:return r.abrupt("break",52);case 21:if(--e,"number"!=typeof u){r.next=29;break}if(0>u&&(u+=o[e]),!(0>u||u>=o[e])){r.next=26;break}throw new Error("Index out of bounds.");case 26:d+=n*u,r.next=51;break;case 29:if(c=u,h=O()(c,3),w=h[0],p=void 0===w?void 0:w,m=h[1],g=void 0===m?void 0:m,b=h[2],x=void 0===b?1:b,g<0&&(g+=o[e]),p<0&&(p+=o[e]),!(0>p||p>=o[e])){r.next=34;break}throw new Error("Slice start out of bounds.");case 34:if(0!=x){r.next=36;break}throw new Error("Stride/step cannot be zero.");case 36:if(!(x<0)){r.next=43;break}if(null==p&&(p=o[e]-1),null==g&&(g=-1),!(-1>g||g>=o[e])){r.next=41;break}throw new Error("Slice end out of bounds.");case 41:r.next=47;break;case 43:if(null==p&&(p=0),null==g&&(g=o[e]),!(0>g||g>o[e])){r.next=47;break}throw new Error("Slice end out of bounds.");case 47:return v.push(n*x),d+=n*p,r.next=51,1+Math.trunc((-Math.sign(x)+g-p)/x);case 51:n*=o[e];case 52:r.next=2;break;case 54:case"end":return r.stop()}}),r)}))()),p=this.data,m=new k[this.dtype](w.reduce((function(r,e){return r*e}),1)),g=0;function b(r,e){if(0===r)m[g++]=p[e];else for(var t=w[--r];t-- >0;e+=v[r])b(r,e)}return b(w.length,d),w.reverse(),new e(w,m)}},{key:"ndim",get:function(){return this.shape.length}},{key:"dtype",get:function(){for(var r=0,e=Object.entries(k);r<e.length;r++){var t=O()(e[r],2),n=t[0],a=t[1];if(this.data instanceof a)return n}throw new Error("Data type could not determined.")}},{key:"T",get:function(){return 0==this.ndim?this.sliceElems():1==this.ndim?this.sliceElems([],"new"):this.transpose()}},{key:"H",get:function(){var r=this.T;return"object"!=this.dtype&&"complex128"!=this.dtype?r:r.mapElems(math.conj)}}]),e}(Y()(Function)),B=(C=NaN,function(){if(!isNaN(C)){var r=C;return C=NaN,r}var e,t,n;do{n=(e=2*Math.random()-1)*e+(t=2*Math.random()-1)*t}while(n>1||0==n);var a=Math.sqrt(-2*Math.log(n)/n);return C=a*e,a*t});function X(r,e,t){if(r=Int32Array.from(r,(function(e){if(e%1!=0)throw new Error("tabulate(shape, dtype='object', idx2val): Invalid shape [".concat(r,"]."));return e})),null==t&&(t=e,e=void 0),null==t)throw new Error("tabulate(shape, dtype='object', idx2val): idx2val missing.");null==e&&(e="object"),N(e);var n=new Int32Array(r.length),a=new k[e](r.reduce((function(r,e){return r*e}),1)),o=0;return function e(i){if(i===r.length)a[o++]=t.apply(void 0,m()(n));else for(n[i]=0;n[i]<r[i];n[i]++)e(i+1)}(0),new V(r,a)}function W(r,e,t){if(null==t&&(null==e?(t=r,r=void 0):(t=e,e=void 0,"string"==typeof r&&(e=r,r=void 0))),"length"in t||(t=m()(t)),null==r&&(r=0),null==e&&(e=S.apply(void 0,m()(t.map((function(r){return r.dtype}))))),0>r&&(r+=t[0].shape.length),0>r||r>=t[0].shape.length)throw new Error("Axis out of bounds.");for(var n=Int32Array.from(t[0].shape),a=function(e){var a=t[e].shape;if(n.length!=a.length)throw new Error("All shapes must have the same length.");if(!n.every((function(e,t){return n[t]===a[t]||r===t})))throw new Error("Shape along all axes but the concatentation axis must match.");n[r]+=a[r]},o=t.length;--o>0;)a(o);var i=n.slice(r+1).reduce((function(r,e){return r*e}),1),f=Int32Array.from(t,(function(r){return r.data.length})),s=new k[e](n.reduce((function(r,e){return r*e}),1)),u=s.length;return function e(a){if(a===r)for(var o=t.length;o-- >0;)for(var l=t[o].shape[a]*i;l-- >0;)s[--u]=t[o].data[--f[o]];else for(var c=n[a];c-- >0;)e(a+1)}(0),new V(n,s)}function H(r,e,t){if(null==t&&(null==e?(t=r,r=void 0):(t=e,e=void 0,"string"==typeof r&&(e=r,r=void 0))),"length"in t||(t=m()(t)),null==r&&(r=0),0>r&&(r+=t[0].shape.length+1),0>r||r>t[0].shape.length)throw new Error("Axis out of bounds.");return t=t.map((function(e){return e.reshape.apply(e,m()(e.shape.slice(0,r)).concat([1],m()(e.shape.slice(r))))})),W(r,e,t)}var K=y.a.mark(ar),Z=y.a.mark(ir),$="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",rr=Int32Array.from({length:256},(function(){return-2}));if(64!==$.length)throw new Error("Assertion failed.");for(var er=$.length;er-- >0;)rr[$.charCodeAt(er)]=er;for(var tr="\f\n\r\t\v ".length;tr-- >0;)rr["\f\n\r\t\v ".charCodeAt(tr)]=-1;function nr(r){return Uint8Array.from(ar(r))}function ar(r){var e,t,n,a,o,i,f;return y.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:n=function(){console.warn("_b64_decode(b64_chars): Base64 sequence ended unexpectedly.")},t=function(){for(;;){var t=void 0,n=r.next();if(t=n.value,e=(e=n.done)||"="===t)return NaN;if("string"!=typeof t||1!==t.length)throw new Error("_b64_decode(b64_chars): Invalid token in character sequence: ".concat(t,"."));if(-1!==(t=rr[t.charCodeAt(0)])){if(!(t>=0))throw new Error("_b64_decode(b64_chars): Invalid base64 character '".concat(t,"'."));return t}}},r=r[Symbol.iterator]();case 3:if(a=t(),!e){s.next=7;break}return s.abrupt("return");case 7:if(o=t(),!e){s.next=10;break}return s.abrupt("return",n());case 10:return s.next=12,a<<2|o>>4;case 12:if(i=t(),!e){s.next=15;break}return s.abrupt("return");case 15:return s.next=17,(15&o)<<4|i>>2;case 17:if(f=t(),!e){s.next=20;break}return s.abrupt("return");case 20:return s.next=22,(3&i)<<6|63&f;case 22:s.next=3;break;case 24:case"end":return s.stop()}}),K)}function or(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="",n=!0,a=!1,o=void 0;try{for(var i,f=ir(r,e)[Symbol.iterator]();!(n=(i=f.next()).done);n=!0){var s=i.value;t+=s}}catch(r){a=!0,o=r}finally{try{n||null==f.return||f.return()}finally{if(a)throw o}}return t}function ir(r){var e,t,n,a,o,i,f,s,u,l,c,h,d,v,w=arguments;return y.a.wrap((function(p){for(;;)switch(p.prev=p.next){case 0:if(e=w.length>1&&void 0!==w[1]?w[1]:{},t=e.pad,n=void 0===t||t,a=e.linewidth,0<(o=void 0===a?128:a)){p.next=3;break}throw new Error("_b64_encode(bytes,{linewidth}): Invalid linewidth: ".concat(o,"."));case 3:i=r[Symbol.iterator](),r=y.a.mark((function r(){var e,t,n,a,o,f;return y.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e=!0,t=!1,n=void 0,r.prev=3,a=i[Symbol.iterator]();case 5:if(e=(o=a.next()).done){r.next=15;break}if(f=o.value,0<=(f*=1)&&f<256){r.next=10;break}throw new Error("_b64_encode(bytes): Invalid token in byte sequence: ".concat(f));case 10:return r.next=12,f;case 12:e=!0,r.next=5;break;case 15:r.next=21;break;case 17:r.prev=17,r.t0=r.catch(3),t=!0,n=r.t0;case 21:r.prev=21,r.prev=22,e||null==a.return||a.return();case 24:if(r.prev=24,!t){r.next=27;break}throw n;case 27:return r.finish(24);case 28:return r.finish(21);case 29:case"end":return r.stop()}}),r,null,[[3,17,21,29],[22,,24,28]])}))(),f=y.a.mark((function e(){var t,n,a,o,i;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0,a=r.next(),t=a.value,!a.done){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,t>>2;case 9:if(n=(3&t)<<4,o=r.next(),t=o.value,!o.done){e.next=17;break}return e.next=16,n;case 16:return e.abrupt("return");case 17:return e.next=19,t>>4|n;case 19:if(n=(15&t)<<2,i=r.next(),t=i.value,!i.done){e.next=27;break}return e.next=26,n;case 26:return e.abrupt("return");case 27:return e.next=29,t>>6|n;case 29:return e.next=31,63&t;case 31:e.next=0;break;case 33:case"end":return e.stop()}}),e)}))(),s=0,u=!0,l=!1,c=void 0,p.prev=10,h=f[Symbol.iterator]();case 12:if(u=(d=h.next()).done){p.next=26;break}if("number"==typeof(v=d.value)){p.next=16;break}throw new Error("Assertion failed.");case 16:if(0<=v&&v<64){p.next=18;break}throw new Error("Assertion failed.");case 18:return p.next=20,$[v];case 20:if(0!=++s%o){p.next=23;break}return p.next=23,"\n";case 23:u=!0,p.next=12;break;case 26:p.next=32;break;case 28:p.prev=28,p.t0=p.catch(10),l=!0,c=p.t0;case 32:p.prev=32,p.prev=33,u||null==h.return||h.return();case 35:if(p.prev=35,!l){p.next=38;break}throw c;case 38:return p.finish(35);case 39:return p.finish(32);case 40:if(!n){p.next=46;break}case 41:if(0==s++%4){p.next=46;break}return p.next=44,"=";case 44:p.next=41;break;case 46:case"end":return p.stop()}}),Z,null,[[10,28,32,40],[33,,35,39]])}var fr=y.a.mark(lr);function sr(r){r=r[Symbol.iterator]();for(var e=[];;){var t=r.next(),n=t.value;if(t.done)throw new Error("b64_parse(b64_chars): Invalid b64_chars.");if("["===n)break;e.push(n)}if(""===(e=e.join("").trim()))throw new Error("b64_parse(b64_chars): dtype=object not (yet) supported.");N(e);for(var a=[],o=[];;){var i=r.next(),f=i.value;if(i.done)throw new Error("b64_parse(b64_chars): Invalid b64_chars.");if("]"===f&&0===o.length)break;if("]"!==f&&","!==f)o.push(f);else{var s=o.join("");if(isNaN(s))throw new Error('b64_parse(b64_chars): Invalid shape entry: "'.concat(s,'".'));if(a.push(1*s),"]"===f)break;o=[]}}a=Int32Array.from(a),r=ar(r);for(var u=k[e],l=new Uint8Array(a.reduce((function(r,e){return r*e}),u.BYTES_PER_ELEMENT)),c=new Uint8Array(u.BYTES_PER_ELEMENT),h=0;h<l.length;){for(var d=0;d<c.length;d++){var v=r.next(),w=v.value;if(v.done)throw new Error("b64_parse(b64_chars): b64_chars too short.");c[d]=w}pr||c.reverse();for(var p=0;p<c.length;p++,h++)l[h]=c[p]}return new V(a,new u(l.buffer))}function ur(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="",n=!0,a=!1,o=void 0;try{for(var i,f=lr(r,e)[Symbol.iterator]();!(n=(i=f.next()).done);n=!0){var s=i.value;t+=s}}catch(r){a=!0,o=r}finally{try{n||null==f.return||f.return()}finally{if(a)throw o}}return t}function lr(r){var e,t,n=arguments;return y.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e=n.length>1&&void 0!==n[1]?n[1]:{},r=G(r),t=r.data,"object"!==r.dtype){a.next=5;break}throw new Error("b64_format(A): A.dtype='".concat(r.dtype,"' not supported."));case 5:if(pr){a.next=7;break}throw new Error("Big endianness not (yet) supported.");case 7:return a.delegateYield("".concat(r.dtype,"[").concat(r.shape.join(","),"]\n"),"t0",8);case 8:return a.delegateYield(ir(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),e),"t1",9);case 9:case"end":return a.stop()}}),fr)}function cr(r){var e=function(){var e=!1,t=0,n=r[Symbol.iterator](),a=function(){var r=n.next(),a=r.value,o=r.done;if(++t,o){if(e)throw new Error("pyon_parse: Character sequence ended unexpectedly.");return e=!0,null}return a};return[a,function(){for(var r;;)switch(r=a()){default:return r;case"\f":case"\n":case"\r":case"\t":case"\v":case" ":}},function(r,e){var n=null==e?"Invalid character":"Expected ".concat(e,", but ");throw new Error("pyon_parse: ".concat(n," '").concat(r,"' encountered as ").concat(t,"-th character."))}]}(),t=O()(e,3),n=t[0],a=t[1],o=t[2];function i(){switch(f){default:o(f);case"{":return function(){var r={};if("{"!==f)throw new Error("Assertion failed.");for(;;){if("}"===(f=a()))return f=a(),r;var e=i();switch(":"!==f&&o(f,end),f=a(),r[e]=i(),f){default:o(f,",' or '}");case",":continue;case"}":return f=a(),r}}}();case'"':case"'":return function(){var r=f;switch(r){default:throw new Error("Assertion failed.");case"'":case'"':}for(var e="";;)switch(f=n()){case r:return f=a(),e;case"\\":switch(f=n()){case"u":for(var t=0,i=0;i<4;i++)switch(t<<=8,f=n()){default:o(f,"Hexadecimal digit");case"f":case"F":++t;case"e":case"E":++t;case"d":case"D":++t;case"c":case"C":++t;case"b":case"B":++t;case"a":case"A":++t;case"9":++t;case"8":++t;case"7":++t;case"6":++t;case"5":++t;case"4":++t;case"3":++t;case"2":++t;case"1":++t;case"0":++t}e+=String.fromCodePoint(t);continue;case"b":e+="\b";continue;case"f":e+="\f";continue;case"n":e+="\n";continue;case"r":e+="\r";continue;case"t":e+="\t";continue}default:e+=f}}();case"(":case"[":return function(){for(var r=function(){switch(f){case"(":return")";case"[":return"]";default:throw new Error("Assertion failed.")}}(),e=[];;){switch(f=a()){case r:return f=a(),e}switch(e.push(i()),f){default:o(f,",' or '".concat(r));case",":continue;case r:return f=a(),e}}}();case"T":return function(){if("T"!==f)throw new Error("Assertion failed.");var r=!0,e=!1,t=void 0;try{for(var i,s="rue"[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var u=i.value;f=n(),u!==f&&o(f,u)}}catch(r){e=!0,t=r}finally{try{r||null==s.return||s.return()}finally{if(e)throw t}}return f=a(),!0}();case"F":return function(){if("F"!==f)throw new Error("Assertion failed.");var r=!0,e=!1,t=void 0;try{for(var i,s="alse"[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var u=i.value;f=n(),u!==f&&o(f,u)}}catch(r){e=!0,t=r}finally{try{r||null==s.return||s.return()}finally{if(e)throw t}}return f=a(),!1}();case"N":return function(){if("N"!==f)throw new Error("Assertion failed.");var r=!0,e=!1,t=void 0;try{for(var i,s="one"[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var u=i.value;f=n(),u!==f&&o(f,u)}}catch(r){e=!0,t=r}finally{try{r||null==s.return||s.return()}finally{if(e)throw t}}return f=a(),null}();case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case".":case"8":case"+":case"9":case"-":return function(){var r="";r:for(;;f=n())switch(f){case"\f":case"\n":case"\r":case"\t":case"\v":case" ":f=a();default:break r;case"0":case"1":case"2":case"3":case"a":case"A":case"4":case"b":case"B":case"5":case"c":case"C":case"6":case"d":case"D":case"7":case"e":case"E":case".":case"8":case"f":case"F":case"+":case"9":case"e":case"E":case"-":r+=f}r=1*r.trim(),isNaN(r)&&o(r);return r}()}}var f=a();return i()}var hr=y.a.mark(vr);function dr(r){return Uint8Array.from(vr(r))}function vr(r){var e,t,n,a,o,i;return y.a.wrap((function(f){for(;;)switch(f.prev=f.next){case 0:r=G(r),e=function(){switch(r.dtype){default:throw new Error("nd_to_npy: A.dtype=".concat(r.dtype," not yet supported."));case"int32":return"i4";case"float32":return"f4";case"float64":return"f8";case"complex128":return"c16"}}(),t='{"descr": "'.concat(e=pr?"<"+e:">"+e,'", "fortran_order": False, "shape": (').concat(r.shape).concat(r.ndim>0?",":"",")}"),n=0;case 5:if(!(n<"NUMPY".length)){f.next=11;break}return f.next=8,"NUMPY".codePointAt(n);case 8:n++,f.next=5;break;case 11:return f.next=13,1;case 13:return f.next=15,0;case 15:if(!((a=t.length+11+63>>>6<<6)>65535)){f.next=18;break}throw new Error("nd_to_npy: Header too large.");case 18:return f.next=20,a-10>>>0&255;case 20:return f.next=22,a-10>>>8&255;case 22:if(a%64==0){f.next=24;break}throw new Error("Assertion failed.");case 24:o=0;case 25:if(!(o<t.length)){f.next=31;break}return f.next=28,t.codePointAt(o);case 28:o++,f.next=25;break;case 31:i=t.length+11;case 32:if(!(i<a)){f.next=38;break}return f.next=35," ".codePointAt(0);case 35:i++,f.next=32;break;case 38:return f.next=40,"\n".codePointAt(0);case 40:return f.delegateYield(new Uint8Array(r.data.buffer,r.data.byteOffset,r.data.byteLength),"t0",41);case 41:case"end":return f.stop()}}),hr)}function wr(r){var e,t,n=(t=r[Symbol.iterator](),function(){var r=t.next(),e=r.value,n=r.done;if(n)throw new Error("npy_to_nd: byte sequence ended unexpectedly.");return e});r=void 0;for(var a="";a.length<6;)a+=String.fromCodePoint(n());if("NUMPY"!==a)throw new Error("npy_to_nd: byte sequence does not start with 'NUMPY'.");var o="".concat(n(),".").concat(n());switch(o){default:throw new Error("npy_bytes: npy-file version ".concat(o," not supported."));case"1.0":case"2.0":}var i=function(){var r=1*n()+256*n();if("2.0"===o&&(r+=65536*n()+n()*(1<<24)),r<0)throw new Error("Assertion failed.");return cr(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r-- >0)){e.next=5;break}return e.next=3,String.fromCodePoint(n());case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e)}))())}(),f=function(){switch(i.descr[0]){default:throw new Error("npy_to_nd: dtype '".concat(i.descr,"' not yet supported."));case"<":return!0;case">":return!1}}(),s=function(){switch(i.descr.slice(1)){default:throw new Error("npy_to_nd: dtype '".concat(i.descr,"' not yet supported."));case"i4":return"int32";case"f4":return"float32";case"f8":return"float64";case"c16":return"complex128"}}(),u=k[s],l=Uint8Array.from({length:i.shape.reduce((function(r,e){return r*e}),u.BYTES_PER_ELEMENT)},n);if(f!==pr)for(var c=u.BYTES_PER_ELEMENT>>>s.startsWith("complex"),h=0;h<l.length;h+=c)for(var d=h,v=h+c;d<--v;d++){var w=l[d];l[d]=l[v],l[v]=w}var p=Int32Array.from(i.shape);i.fortran_order&&p.reverse();var g=new V(p,new u(l.buffer));return i.fortran_order&&g.ndim>1&&(g=(e=g).transpose.apply(e,m()(y.a.mark((function r(){var e;return y.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e=g.ndim;case 1:if(!(e-- >0)){r.next=6;break}return r.next=4,e;case 4:r.next=1;break;case 6:case"end":return r.stop()}}),r)}))()))),g}var pr=1===new Int16Array(Uint8Array.of(1,0).buffer)[0],mr="\f\n\r\t\v ";function gr(r,e){var t=Math.max(Math.abs(r),Math.abs(e));if(0===t)return[1,0,0];r/=t,e/=t;var n=Math.sqrt(r*r+e*e);if(r/=n,e/=n,!(0<=(n*=t)))throw new Error("Assertion failed: "+n);return[r,e,n]}function yr(r,e,t,n,a,o){if(!(Math.abs(Math.hypot(a,o)-1)<=1e-6))throw new Error("Assertion failed.");t|=0,n|=0,a=+a,o=+o;for(var i=0|e;i-- >0;){var f=r[t],s=r[n];r[t]=a*f+o*s,r[n]=a*s-o*f,t=t+1|0,n=n+1|0}}function br(r,e,t,n,a,o){if(!(Math.abs(Math.hypot(a,o)-1)<=1e-6))throw new Error("Assertion failed.");t|=0,n|=0,a=+a,o=+o;for(var i=0|e;i-- >0;){var f=r[t],s=r[n];r[t]=a*f-o*s,r[n]=a*s+o*f,t=t+e|0,n=n+e|0}}var xr=function(){function r(){l()(this,r),this.sum=0,this.max=0,Object.seal(this)}return h()(r,[{key:"reset",value:function(){this.sum=this.max=0}},{key:"include",value:function(r){if(0!==(r=Math.abs(r))){if(this.max<r){var e=this.max/r;this.sum*=e*e,this.max=r}r/=this.max,this.sum+=r*r}}},{key:"resultIncl",value:function(r){r=Math.abs(r);var e=this.sum,t=this.max;if(0!==r){if(t<r){var n=t/r;e*=n*n,t=r}e+=(r/=t)*r}return isFinite(t)?Math.sqrt(e)*t:t}},{key:"result",get:function(){return isFinite(this.max)?Math.sqrt(this.sum)*this.max:this.max}}]),r}();function Er(r){var e,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fro",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;switch(t){case"fro":e=new xr;break;default:throw new Error("norm(A,ord,axis): Unsupported ord: ".concat(t,"."))}if(null==n){var a=!0,o=!1,i=void 0;try{for(var f,s=r.data[Symbol.iterator]();!(a=(f=s.next()).done);a=!0){var u=f.value;e.include(u)}}catch(r){o=!0,i=r}finally{try{a||null==s.return||s.return()}finally{if(o)throw i}}return e.result}throw new Error("norm(A,ord,axis): axis argument not yet supported.")}function _r(r,e,t){for(var n=r;--n>0;)for(var a=n;a-- >0;){var o=t+r*n+a,i=t+r*a+n,f=e[o];e[o]=e[i],e[i]=f}}function Ar(r){var e=r.shape.slice(-2),t=O()(e,2),n=t[0];if(n!=t[1])throw new Error("In-place transposition is only supported for square matrices.");r=r.data;for(var a=0;a<r.length;a+=n*n)_r(n,r,a)}function kr(r,e,t,n,a,o,i){r|=0,e|=0,n|=0,i|=0;var f=new xr;if(r<e)throw new Error("Assertion failed.");for(var s=e;s-- >0;)o[i+e*s+s]=1;for(var u=0;u<e;u++){for(var l=n+e*u+u,c=u;++c<r;){var h=n+e*c+u,d=t[h];if(0!==d){var v=gr(t[l],d),w=O()(v,3),p=w[0],m=w[1],g=w[2];0!==m&&(p<0&&(p*=-1,m*=-1,g*=-1),yr(t,e-1-u,l+1,h+1,p,m),t[l]=g),t[h]=m}}if(u<e-2){f.reset();for(var y=e;--y>u+1;)f.include(t[n+e*u+y]);if(0===f.max)continue;var b=f.resultIncl(t[l+1])*(t[l+1]>0?-1:1);f.include(t[l+1]-=b);for(var x=f.max,E=Math.sqrt(f.sum),_=u;++_<e;)t[n+e*u+_]=t[n+e*u+_]/x/E;for(var A=0;A<e;A++){for(var k=0,M=u;++M<e;)k+=o[i+e*A+M]*t[n+e*u+M];k*=2;for(var q=u;++q<e;)o[i+e*A+q]-=t[n+e*u+q]*k}for(var N=u;++N<r;){for(var P=0,S=u;++S<e;)P+=t[n+e*N+S]*t[n+e*u+S];P*=2;for(var I=u;++I<e;)t[n+e*N+I]-=t[n+e*u+I]*P}t[l+1]=b,t.fill(0,l+2,n+e*(u+1))}}_r(e,o,i);for(var j=e;--j>0;)a[i+e*j+j]=t[n+e*j+j],a[i+e*(j-1)+j]=t[n+e*(j-1)+j];a[i]=t[n];for(var F=0;F<e;F++)for(var J=F;J<e;J++)t[n+e*F+J]=+(F===J);for(var T=e;T-- >0;)for(var L=r;--L>T;){var R=t[n+e*L+T];if(0!==R)t[n+e*L+T]=0,yr(t,e-T,n+e*L+T,n+e*T+T,Math.sqrt((1+R)*(1-R)),R)}}function Mr(r,e,t,n,a){r|=0,a|=0;for(var o=new xr,i=r;i-- >0;)e[a+r*i+i]=1;for(var f=r;f-- >0;)n[a+r*f+f]=1;for(var s=0;s<r-1;s++){for(var u=a+r*s+s,l=s;++l<r;){var c=a+r*l+s,h=t[c];if(0!==h){var d=gr(t[u],h),v=O()(d,3),w=v[0],p=v[1],m=v[2];t[c]=0,0!==p&&(t[u]=m,yr(t,r-1-s,u+1,c+1,w,p),yr(e,1+l,a+r*s,a+r*l,w,p))}}o.reset();for(var g=r;--g>s+1;)o.include(t[a+r*s+g]);if(0!==o.max){var y=o.resultIncl(t[u+1])*(t[u+1]>0?-1:1);o.include(t[u+1]-=y);for(var b=o.max,x=Math.sqrt(o.sum),E=s;++E<r;)t[a+r*s+E]=t[a+r*s+E]/b/x;for(var _=0;_<r;_++){for(var A=0,k=s;++k<r;)A+=n[a+r*_+k]*t[a+r*s+k];A*=2;for(var M=s;++M<r;)n[a+r*_+M]-=t[a+r*s+M]*A}for(var q=s;++q<r;){for(var N=0,P=s;++P<r;)N+=t[a+r*q+P]*t[a+r*s+P];N*=2;for(var S=s;++S<r;)t[a+r*q+S]-=t[a+r*s+S]*N}t[u+1]=y,t.fill(0,u+2,a+r*(s+1))}}_r(r,n,a),_r(r,e,a)}function qr(r,e,t,n,a,o,i,f){if(n|=0,o|=0,f=f+(e|=0)|0,!((r|=0)<=e))throw Error("Assertion failed.");for(var s=new xr,u=r;u-- >0;)t[n+r*u+u]=1;for(var l=0;l<r&&l<e-1;l++){for(var c=f+e*l+l,h=l;++h<r;){var d=f+e*h+l,v=i[d];if(0!==v){var w=gr(i[c],v),p=O()(w,3),m=p[0],g=p[1],y=p[2];i[d]=0,0!==g&&(i[c]=y,yr(i,e-1-l,c+1,d+1,m,g),yr(t,1+h,n+r*l,n+r*h,m,g))}}var b=f+e*(l-1);s.reset();for(var x=e-1;;){var E=i[b+x]=i[f+e*l+x];if(--x<=l)break;s.include(E)}if(0!==s.max){var _=s.resultIncl(i[b+(l+1)])*(i[b+(l+1)]>0?-1:1);s.include(i[b+(l+1)]-=_);for(var A=s.max,k=Math.sqrt(s.sum),M=l;++M<e;)i[b+M]=i[b+M]/A/k;for(var q=l;++q<r;){for(var N=0,P=l;++P<e;)N+=i[f+e*q+P]*i[b+P];N*=2;for(var S=l;++S<e;)i[f+e*q+S]-=i[b+S]*N}i[c+1]=_}else i[b+(l+1)]=0}_r(r,t,n);for(var I=r;I-- >0;)a[o+(r+1)*I+(I+1)]=I<e-1?i[f+e*I+(I+1)]:0,a[o+(r+1)*I+I]=i[f+e*I+I];for(var j=Math.min(r,e-1);--j,i.fill(0,f+e*j,f+e*(j+1)),i[f+e*j+(j+1)]=1,!(j<0);)for(var F=f+e*(j-1),J=j;J<r;J++){for(var T=0,L=j;++L<e;)T+=i[f+e*J+L]*i[F+L];T*=2;for(var R=j;++R<e;)i[f+e*J+R]-=i[F+R]*T}}function Nr(r){if((r=G(r)).ndim<2)throw new Error("bidiag_decomp(A): A must be at least 2D.");if(r.dtype.startsWith("complex"))throw new Error("bidiag_decomp(A): complex A not yet supported.");var e="float32"===r.dtype?"float32":"float64",t=k[e],n=Int32Array.from(r.shape),a=Int32Array.from(n),o=Int32Array.from(n),i=r.shape.slice(-2),f=O()(i,2),s=f[0],u=f[1],l=r.data.length/(s*u)|0,c=0|Math.min(s,u),h=0|(s>=u?c:c+1);n[n.length-1]=c,a[a.length-2]=c,a[a.length-1]=h,o[o.length-2]=h;var d=function(){if(s===u){for(var e=t.from(r.data),n=new t(e.length),a=new t(e.length),o=0;o<e.length;o+=u*u)Mr(u,n,e,a,o);return[n,e,a]}if(s>u){var i=t.from(r.data);r=void 0;for(var f=new t(l*u*u),c=new t(l*u*u),h=0,d=0;d<f.length;h+=s*u,d+=u*u)kr(s,u,i,h,f,c,d);return[i,f,c]}var v=new t(l*(s+1)*u);if(!(s<u))throw new Error("Assertion failed.");r=r.data;for(var w=0,p=u;p<v.length;p+=u)for(var m=p+s*u;p<m;w++,p++)v[p]=r[w];r=void 0;for(var g=new t(l*s*s),y=new t(l*s*(s+1)),b=0,x=0,E=0;x<y.length;b+=s*s,x+=s*(s+1),E+=(s+1)*u)qr(s,u,g,b,y,x,v,E);return[g,y,v]}(),v=O()(d,3),w=v[0],p=v[1],m=v[2];return[new V(n,w),new V(a,p),new V(o,m)]}function Pr(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((r=G(r)).ndim<2)throw new Error("Input must be at least 2D.");return r.mapElems(r.dtype,(function(r){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var o=n.slice(-2),i=O()(o,2),f=i[0],s=i[1];return f<s-e?0:r}))}function Sr(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((r=G(r)).ndim<2)throw new Error("Input must be at least 2D.");return r.mapElems(r.dtype,(function(r){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var o=n.slice(-2),i=O()(o,2),f=i[0],s=i[1];return f>s-e?0:r}))}function Ir(r,e,t,n,a,o,i){if(!(r<=e))throw new Error("Assertion failed.");r|=0,e|=0,t|=0,a|=0,i|=0;for(var f=0;f<r;f++){for(var s=0;s<f;s++)for(var u=0;u<t;u++)o[i+t*f+u]-=n[a+e*f+s]*o[i+t*s+u];for(var l=0;l<t;l++)o[i+t*f+l]/=n[a+e*f+f]}}function jr(r,e){if((r=G(r)).ndim<2)throw new Error("tril_solve(L,Y): L.ndim must be at least 2.");if((e=G(e)).ndim<2)throw new Error("tril_solve(L,Y): Y.ndim must be at least 2.");var t=e.shape.slice(-2),n=O()(t,2),a=n[0],o=n[1];if(r.shape[r.ndim-2]!==a)throw new Error("tril_solve(L,Y): L and Y don't match.");if(r.shape[r.ndim-1]!==a)throw new Error("tril_solve(L,Y): Last two dimensions of L must be quadratic.");var i=Math.max(r.ndim,e.ndim),f=r.shape,s=e.shape,u=new Int32Array(i);u.fill(1,0,-2),u[i-2]=a,u[i-1]=o;for(var l=0,c=[f,s];l<c.length;l++)for(var h=c[l],d=i-2,v=h.length-2;d-- >0&&v-- >0;)if(1===u[d])u[d]=h[v];else if(u[d]!=h[v]&&1!=h[v])throw new Error("tril_solve(L,Y): L and Y not broadcast-compatible.");var w=[r,e].every((function(r){return"float32"===r.dtype}))?"float32":"float64";r=r.data,e=e.data;var p=new k[w](u.reduce((function(r,e){return r*e}))),m=0,g=1,y=0,b=1,x=0;return function t(n){if(n===i-2){g=a*a;for(var l=b=a*o;l-- >0;)p[x+l]=e[y+l];Ir(a,a,o,r,m,p,x),m+=g,y+=b,x+=b}else{for(var c=u[n];t(n+1),1!=c;c--)f[n-i+f.length]>1||(m-=g),s[n-i+s.length]>1||(y-=b);g*=f[n-i+f.length]||1,b*=s[n-i+s.length]||1}}(0),new V(u,p)}function Or(r,e,t,n,a,o,i){if(!(r<=e))throw new Error("Assertion failed.");if(r|=0,e|=0,t|=0,i|=0,!(0<=(a|=0)))throw new Error("Assertion failed.");if(!(0<=i))throw new Error("Assertion failed.");if(!(r*e<=n.length-a))throw new Error("Assertion failed.");if(!(r*t<=o.length-i))throw new Error("Assertion failed.");for(var f=r;f-- >0;)for(var s=t;s-- >0;){for(var u=r;--u>f;)o[i+t*f+s]-=n[a+e*f+u]*o[i+t*u+s];o[i+t*f+s]/=n[a+e*f+f]}}function Fr(r,e){if((r=G(r)).ndim<2)throw new Error("triu_solve(U,Y): U.ndim must be at least 2.");if((e=G(e)).ndim<2)throw new Error("triu_solve(U,Y): Y.ndim must be at least 2.");var t=e.shape.slice(-2),n=O()(t,2),a=n[0],o=n[1];if(r.shape[r.ndim-2]!==a)throw new Error("triu_solve(U,Y): U and Y don't match.");if(r.shape[r.ndim-1]!==a)throw new Error("triu_solve(U,Y): Last two dimensions of U must be quadratic.");var i=Math.max(r.ndim,e.ndim),f=r.shape,s=e.shape,u=new Int32Array(i);u.fill(1,0,-2),u[i-2]=a,u[i-1]=o;for(var l=0,c=[f,s];l<c.length;l++)for(var h=c[l],d=i-2,v=h.length-2;d-- >0&&v-- >0;)if(1===u[d])u[d]=h[v];else if(u[d]!=h[v]&&1!=h[v])throw new Error("triu_solve(U,Y): U and Y not broadcast-compatible.");var w=[r,e].every((function(r){return"float32"===r.dtype}))?"float32":"float64";r=r.data,e=e.data;var p=new k[w](u.reduce((function(r,e){return r*e}))),m=r.length,g=1,y=e.length,b=1,x=p.length;return function t(n){if(n===i-2){m-=g=a*a,y-=b=a*o,x-=b;for(var l=b;l-- >0;)p[x+l]=e[y+l];Or(a,a,o,r,m,p,x)}else{for(var c=u[n];t(n+1),1!=c;c--)f[n-i+f.length]>1||(m+=g),s[n-i+s.length]>1||(y+=b);g*=f[n-i+f.length]||1,b*=s[n-i+s.length]||1}}(0),new V(u,p)}function Jr(r){var e="float32"===(r=G(r)).dtype?"float32":"float64",t=r.shape,n=t.slice(-2),a=O()(n,2),o=a[0],i=a[1],f=k[e].from(r.data);if(r=void 0,o!=i)throw new Error("Last two dimensions must be quadratic.");for(var s=0;s<f.length;s+=o*o)for(var u=0;u<o;u++)for(var l=0;l<o;l++)if(u<l)f[s+o*u+l]=0;else{for(var c=f[s+o*u+l],h=0,d=0;d<l;d++){var v=h+f[s+o*u+d]*f[s+o*l+d],w=c-v;h=w-c+v,c=w}if(u>l)f[s+o*u+l]=c/f[s+o*l+l];else if(f[s+o*u+u]=Math.sqrt(c),isNaN(f[s+o*u+u]))throw new Error("Matrix contains NaNs or is (near) singular.")}return new V(t,f)}function Tr(r,e){if(r=G(r),e=G(e),r.ndim<2)throw new Error("L must be at least 2D.");if(e.ndim<2)throw new Error("y must be at least 2D.");var t=r.shape.slice(-2),n=O()(t,2),a=n[0],o=n[1],i=e.shape.slice(-2),f=O()(i,2),s=f[0],u=f[1];if(a!=o)throw new Error("Last two dimensions of L must be quadratic.");if(s!=o)throw new Error("L and y don't match.");var l=Math.max(r.ndim,e.ndim),c=Int32Array.from({length:l},(function(){return 1}));c[l-2]=s,c[l-1]=u;for(var h=0,d=[r,e];h<d.length;h++)for(var v=d[h],w=l-2,p=v.ndim-2;w-- >0&&p-- >0;)if(1===c[w])c[w]=v.shape[p];else if(c[w]!=v.shape[p]&&1!=v.shape[p])throw new Error("Shapes are not broadcast-compatible.");var m="float32"===r.dtype&&"float32"===e.dtype?"float32":"float64",g=new k[m](c.reduce((function(r,e){return r*e}),1)),y=r.data,b=e.data,x=0,E=1,_=0,A=1,M=0;return function t(n){if(n===l-2){E=a*a,A=a*u;for(var o=0;o<A;o++)g[M+o]=b[_+o];Ir(s,s,u,y,x,g,M);for(var i=s;i-- >0;)for(var f=u;f-- >0;){g[M+i*u+f]/=y[x+a*i+i];for(var h=i;h-- >0;)g[M+h*u+f]-=y[x+a*i+h]*g[M+i*u+f]}return x+=E,_+=A,void(M+=A)}for(var d=c[n];t(n+1),1!=d;d--)r.shape[n-l+r.ndim]>1||(x-=E),e.shape[n-l+e.ndim]>1||(_-=A);E*=r.shape[n-l+r.ndim]||1,A*=e.shape[n-l+e.ndim]||1}(0),new V(c,g)}function Lr(r){if(r.ndim<1)throw new Error("diag_mat(diag): diag.ndim=".concat(r.ndim," is less than 1."));var e=(r=G(r)).shape,t=e[e.length-1],n=r.data,a=k[r.dtype].from({length:e.reduce((function(r,e){return r*e}))*t},(function(){return 0}));if(r=void 0,e.length<1)throw new Error("diag_mat(diag): diag must be at least 1d.");if(t<=0)throw new Error("Assertion Failed!");for(var o=0,i=0;;){for(var f=o+t;a[i]=n[o],++o!==f;)i+=t+1;if(++i==a.length)break}return new V(Int32Array.of.apply(Int32Array,m()(e).concat([t])),a)}function Rr(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(r.ndim<2)throw new Error("diag(A, offset): A.ndim=".concat(r.ndim," is less than 2."));var t=(r=G(r)).shape.slice(-2),n=O()(t,2),a=n[0],o=n[1],i=r.shape.slice(0,-1),f=k[r.dtype];if(r=r.data,!(e>-a&&e<+o))throw new Error("diag(A, offset): offset=".concat(e," out of A.shape=[").concat(r.shape,"]."));var s=Math.min(a,a+e,o,o-e);i[i.length-1]=s;for(var u=new f(i.reduce((function(r,e){return r*e}))),l=Math.max(0,e,-e*o),c=0,h=0;h<r.length;c+=s,h+=a*o)for(var d=0;d<s;d++)u[c+d]=r[h+l+o*d+d];return new V(i,u)}function Ur(r){if((r=G(r)).ndim<2)throw new Error("A must be at least 2D.");var e="float32"===r.dtype?"float32":"float64",t=k[e],n="float32"===e?16:8,a=r.shape,o=Int32Array.from(a),i=a.slice(-2),f=O()(i,2),s=f[0],u=f[1],l=t.from(r.data);r=void 0,o[o.length-1]=s;for(var c=new t(l.length/u*s),h=0,d=0;h<c.length;h+=s*s,d+=s*u){for(var v=0;v<s;v++)c[h+s*v+v]=1;for(var w=0;w<u;w+=n)for(var p=w;p<s;p+=n)for(var m=p;m<p+n&&m<s;m++)for(var g=w;g<w+n&&g<u&&g<m;g++){var y=d+u*m+g,b=l[y];if(0!==b){var x=d+u*g+g,E=gr(l[x],b),_=O()(E,3),A=_[0],M=_[1],q=_[2];l[y]=0,0!==M&&(l[x]=q,yr(l,u-1-g,x+1,y+1,A,M),yr(c,1+m,h+s*g,h+s*m,A,M))}}_r(s,c,h)}return[new V(o,c),new V(a,l)]}function Yr(r){if((r=G(r)).ndim<2)throw new Error("qr_decomp(A): A.ndim must be at least 2.");var e=k["float32"===r.dtype?"float32":"float64"],t=r.shape,n=Int32Array.from(t),a=t.slice(-2),o=O()(a,2),i=o[0],f=o[1];if(n[n.length-2]=f,i<=f)return Ur(r);var s=e.from(r.data);r=void 0;for(var u=new e(s.length/i*f),l=0,c=0;c<s.length;c+=i*f,l+=f*f){for(var h=1;h<i;h++)for(var d=Math.min(h,f),v=0;v<d;v++){var w=c+f*h+v,p=s[w];if(0!==p){var m=c+f*v+v,g=gr(s[m],p),y=O()(g,3),b=y[0],x=y[1],E=y[2];0!==x&&(b<0&&(b*=-1,x*=-1,E*=-1),yr(s,f-1-v,m+1,w+1,b,x),s[m]=E),s[w]=x}}for(var _=0;_<f;_++)for(var A=_;A<f;A++)u[l+f*_+A]=s[c+f*_+A],s[c+f*_+A]=+(_===A);for(var M=i;--M>0;)for(var q=Math.min(M,f);q-- >0;){var N=s[c+f*M+q];if(0!==N)s[c+f*M+q]=0,yr(s,f-q,c+f*M+q,c+f*q+q,Math.sqrt((1-N)*(1+N)),N)}}return[new V(t,s),new V(n,u)]}function Dr(r,e,t){if(null==t){t=e;var n=r,a=O()(n,2);r=a[0],e=a[1]}if((r=G(r)).ndim<2)throw new Error("qr_lstsq(Q,R,y): Q.ndim must be at least 2.");if((e=G(e)).ndim<2)throw new Error("qr_lstsq(Q,R,y): R.ndim must be at least 2.");if((t=G(t)).ndim<2)throw new Error("qr_lstsq(Q,R,y): y.ndim must be at least 2.");var o=r.shape.slice(-2),i=O()(o,2),f=i[0],s=i[1],u=e.shape.slice(-1),l=O()(u,1)[0],c=t.shape.slice(-1),h=O()(c,1)[0],d=Math.min(s,l);if(f!=t.shape[t.ndim-2])throw new Error("qr_lstsq(Q,R,y): Q and y don't match.");if(s!=e.shape[e.ndim-2])throw new Error("qr_lstsq(Q,R,y): Q and R don't match.");if(l>f)throw new Error("qr_lstsq(Q,R,y): Under-determined systems not supported. Use rrqr instead.");var v=Math.max(r.ndim,e.ndim,t.ndim),w=Int32Array.from({length:v},(function(){return 1}));w[v-2]=l,w[v-1]=h;for(var p=0,m=[r,e,t];p<m.length;p++)for(var g=m[p],y=v-2,b=g.ndim-2;y-- >0&&b-- >0;)if(1===w[y])w[y]=g.shape[b];else if(w[y]!=g.shape[b]&&1!=g.shape[b])throw new Error("Q, R, y are not broadcast-compatible.");var x=new(0,k[[r,e,t].every((function(r){return"float32"===r.dtype}))?"float32":"float64"])(w.reduce((function(r,e){return r*e}),1)),E=r.data,_=e.data,A=t.data,M=0,q=1,N=0,P=1,S=0,I=1,j=0;return function n(a){if(a===v-2){q=f*s,P=s*l,I=f*h;for(var o=0;o<d;o++)for(var i=0;i<h;i++)for(var u=0;u<f;u++)x[j+o*h+i]+=E[M+u*s+o]*A[S+u*h+i];return Or(d,l,h,_,N,x,j),M+=q,N+=P,S+=I,void(j+=l*h)}for(var c=w[a];n(a+1),1!=c;c--)r.shape[a-v+r.ndim]>1||(M-=q),e.shape[a-v+e.ndim]>1||(N-=P),t.shape[a-v+t.ndim]>1||(S-=I);q*=r.shape[a-v+r.ndim]||1,P*=e.shape[a-v+e.ndim]||1,I*=t.shape[a-v+t.ndim]||1}(0),new V(w,x)}var zr=function(r){if((r=G(r)).ndim<2)throw new Error("det_tri(a): a.shape=[".concat(r.shape,"]; a.ndim must be at least 2."));var e=r.shape,t=e.slice(-2),n=O()(t,2),a=n[0],o=n[1];if(a!==o)throw new Error("det_tri(a): a must be square matrices.");var i=k[r.dtype],f=r.data;r=void 0;for(var s=new i(f.length/(o*o)),u=0,l=0;u<s.length;u++){var c=l;l+=o*o;for(var h=1;c<l;c+=o+1)h*=f[c];s[u]=h}return new V(e.slice(0,-2),s)},Qr=function(r){if((r=G(r)).ndim<2)throw new Error("det_tri(A): A.ndim must be at least 2.");var e=r.shape,t=e.slice(-2),n=O()(t,2),a=n[0],o=n[1];if(a!==o)throw new Error("det_tri(A): A must be square matrices.");for(var i=k["float32"===r.dtype?"float32":"float64"],f=new i((r=r.data).length/(o*o)),s=new i(f.length),u=0,l=0;u<s.length;u++){var c=l;l+=o*o;for(var h=1,d=0;c<l;c+=o+1)h*=Math.sign(r[c]),d+=Math.log(Math.abs(r[c]));f[u]=h,s[u]=d}var v=e.slice(0,-2);return[new V(v,f),new V(v,s)]},Gr=function(r){var e=Yr(r),t=O()(e,2),n=(t[0],t[1]);return zr(n)},Cr=function(r){var e=Yr(r),t=O()(e,2),n=(t[0],t[1]);return Qr(n)},Vr=function(){function r(e,t){l()(this,r),this.re=1*e,this.im=1*t}return h()(r,[{key:"abs",value:function(){return Math.hypot(this.re,this.im)}},{key:"/=",value:function(r,e){if(0===e)this.re/=r,this.im/=r;else{var t=this.re;if(Math.abs(r)>=Math.abs(e)){var n=e/r;this.re=(t+this.im*n)/(r+e*n),this.im=(this.im-t*n)/(r+e*n)}else{var a=r/e;this.re=(t*a+this.im)/(r*a+e),this.im=(this.im*a-t)/(r*a+e)}}}},{key:"= c0*c1",value:function(r,e,t,n){this.re=r*t-e*n,this.im=r*n+e*t}},{key:"-= c0*c1",value:function(r,e,t,n){this.re-=r*t-e*n,this.im-=r*n+e*t}},{key:Symbol.for("nodejs.util.inspect.custom"),value:function(){return this.toString()}},{key:"toString",value:function(){return 0==this.im?this.re.toString():0==this.re?"".concat(this.im,"j"):this.im<0?"".concat(this.re," - ").concat(-this.im,"j"):"".concat(this.re," + ").concat(this.im,"j")}}]),r}();function Br(r,e,t){var n=r(e),a=r(t);if(n>a){var o=[a,n,t,e];n=o[0],a=o[1],e=o[2],t=o[3]}if(n>0){if(n<=a*Number.EPSILON)return e;throw new Error("root1d_bisect(F,x_min,x_max): Both F(x_min) and F(x_max) positive.")}if(a<0){if(a>=n*Number.EPSILON)return t;throw new Error("root1d_bisect(F,x_min,x_max): Both F(x_min) and F(x_max) negaitive.")}if(n>0)return e;if(a<0)return t;for(;;){var i=(e+t)/2;if(e==i||t==i)break;var f=r(i);if(isNaN(f))throw new Error("NaN encountered.");f<=0&&(e=i,n=f),f>=0&&(t=i,a=f)}return Math.abs(n)<=Math.abs(a)?e:t}function Xr(r,e,t,n){n|=0;for(var a=(r|=0)-1;a-- >0;)e[n+r*a+a]=1;for(var o=new xr,i=n+r*(r-1),f=r;--f>1;){var s=n+r*f,u=s+(f-1);o.reset();for(var l=f-1;l-- >0;)o.include(t[s+l]);if(0!==o.max){var c=o.resultIncl(t[u])*(t[u]>0?-1:1);o.include(t[u]-=c);for(var h=o.max,d=Math.sqrt(o.sum),v=f;v-- >0;)t[s+v]=t[s+v]*Math.SQRT2/h/d;for(var w=f;w-- >0;){for(var p=0,m=f;m-- >0;)p+=t[n+r*w+m]*t[s+m];for(var g=f;g-- >0;)t[n+r*w+g]-=t[s+g]*p}e.fill(0,i,n+r*r);for(var y=f;y-- >0;)for(var b=r;b-- >0;)e[i+b]+=t[n+r*y+b]*t[s+y];for(var x=f;x-- >0;)for(var E=r;E-- >0;)t[n+r*x+E]-=t[s+x]*e[i+E];for(var _=r-1;_-- >0;){for(var A=0,k=f;k-- >0;)A+=e[n+r*_+k]*t[s+k];for(var M=f;M-- >0;)e[n+r*_+M]-=t[s+M]*A}t.fill(0,s,u),t[u]=c}}e.fill(0,i,n+r*r-1),e[n+r*r-1]=1}function Wr(r){if((r=G(r)).ndim<2)throw new Error("hessenberg_decomp(A): A must at least be 2D.");r.dtype;var e=k["float32"===r.dtype?"float32":"float64"],t=r.shape,n=0|t[t.length-1];if(n!=t[t.length-2])throw new Error("hessenberg_decomp(A): A must be square.");var a=e.from(r.data);r=void 0;for(var o=new e(a.length),i=a.length;(i-=n*n)>=0;)Xr(n,o,a,i);return[new V(t,o),new V(t,a)]}var Hr=y.a.mark((function r(){var e;return y.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e=function(r){return new Function("A_shape","A","B_shape","B","C_shape","C","\n      const I = A_shape[A_shape.length-2],\n            K = A_shape[A_shape.length-1],\n            J = B_shape[B_shape.length-1]; \n      let\n        a = 0, aStride = 1,\n        b = 0, bStride = 1,\n        c = 0;\n\n      const loops = new Int32Array(C_shape.length-2);\n      for( let d=0; d >= 0; )\n        if( d === C_shape.length-2 ) {\n          aStride = I*K;\n          bStride = K*J;\n          for( const cEnd = c + I*J; c < cEnd; c += J, b -= bStride ) {\n          for( const aEnd = a + K  ; a < aEnd; c -= J, a++ ) {\n          for( const bEnd = b +   J; b < bEnd; c += 1, b++ ) {\n            ".concat(r,"\n          }}}\n          b += bStride;\n          d -= 1;\n        }\n        else\n        {\n          if( loops[d]++ > 0 ) {\n            if( loops[d] > C_shape[d] ) {\n              aStride *= A_shape[ d - C_shape.length + A_shape.length ] || 1;\n              bStride *= B_shape[ d - C_shape.length + B_shape.length ] || 1;\n              loops[d--] = 0;\n              continue;\n            }\n            if( ! (A_shape[ d - C_shape.length + A_shape.length ] > 1) ) a -= aStride;\n            if( ! (B_shape[ d - C_shape.length + B_shape.length ] > 1) ) b -= bStride;\n          }\n          ++d;\n        }\n    "))},r.next=3,e("C[c] += A[a]*B[b];");case 3:return r.next=5,e("\n    C[2*c+0] += A[a] * B[2*b+0];\n    C[2*c+1] += A[a] * B[2*b+1];\n  ");case 5:return r.next=7,e("\n    C[2*c+0] += B[b] * A[2*a+0];\n    C[2*c+1] += B[b] * A[2*a+1];\n  ");case 7:return r.next=9,e("\n    C[2*c+0] += B[2*b+0] * A[2*a+0]  -  B[2*b+1] * A[2*a+1];\n    C[2*c+1] += B[2*b+0] * A[2*a+1]  +  B[2*b+1] * A[2*a+0];\n  ");case 9:return r.next=11,e("C[c] = this.add(C[c], this.mul(A[a],B[b]));").bind(v);case 11:case"end":return r.stop()}}),r)}))(),Kr=O()(Hr,5),Zr=Kr[0],$r=Kr[1],re=Kr[2],ee=Kr[3],te=Kr[4];function ne(r,e){if(r=G(r),e=G(e),r.ndim<2)throw new Error("A must be at least 2D.");if(e.ndim<2)throw new Error("B must be at least 2D.");var t=r.shape.slice(-2),n=O()(t,2),a=n[0],o=n[1],i=e.shape[e.ndim-1];if(e.shape[e.ndim-2]!=o)throw new Error("The last dimension of A and the 2nd to last dimension of B do not match.");var f=Math.max(r.ndim,e.ndim),s=Int32Array.from({length:f},(function(){return 1}));s[f-2]=a,s[f-1]=i;for(var u=0,l=[r,e];u<l.length;u++)for(var c=l[u],h=f-2,d=c.ndim-2;h-- >0&&d-- >0;)if(1===s[h])s[h]=c.shape[d];else if(s[h]!=c.shape[d]&&1!=c.shape[d])throw new Error("Shapes are not broadcast-compatible.");var v=new(0,k[S(r.dtype,e.dtype)])(s.reduce((function(r,e){return r*e}),1));v instanceof Array&&v.fill(0);for(var w=0,p=0,m=[r,e];p<m.length;p++){switch(w*=3,m[p].dtype){default:w+=1;case"complex128":w+=1;case"int32":case"float32":case"float64":}}switch(w){case 0:Zr(r.shape,r.data,e.shape,e.data,s,v);break;case 1:$r(r.shape,r.data,e.shape,e.data._array,s,v._array);break;case 3:re(r.shape,r.data._array,e.shape,e.data,s,v._array);break;case 4:ee(r.shape,r.data._array,e.shape,e.data._array,s,v._array);break;default:te(r.shape,r.data,e.shape,e.data,s,v)}return new V(s,v)}function ae(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];if(1==(e=e.map((function(r){return G(r)}))).length)return e[0];if(2==e.length)return ne.apply(void 0,m()(e));function n(r,e){var t=r.slice(-2),n=O()(t,2),a=n[0],o=n[1],i=e[e.length-1];if(e[e.length-2]!=o)throw new Error("Shape mismatch.");var f=Math.max(r.length,e.length),s=Int32Array.from({length:f},(function(){return 1}));s[f-2]=a,s[f-1]=i;for(var u=0,l=[r,e];u<l.length;u++)for(var c=l[u],h=f-2,d=c.length-2;h-- >0&&d-- >0;)if(1===s[h])s[h]=c[d];else if(s[h]!=c[d]&&1!=c[d])throw new Error("Shapes are not broadcast-compatible.");return[s.reduce((function(r,e){return r*e}),1)*o,s]}for(var a=Array.from({length:e.length},(function(){return[]})),o=0;o<e.length;o++)a[o][o]=[0,e[o].shape];for(var i=2;i<=e.length;i++)for(var f=0;f<=e.length-i;f++){for(var s=1/0,u=void 0,l=1;l<i;l++){var c=O()(a[f][f+l-1],2),h=c[0],d=c[1],v=O()(a[f+l][f+i-1],2),w=v[0],p=v[1],g=n(d,p),y=O()(g,2),b=y[0],x=y[1];(b+=h+w)<s&&(s=b,u=x)}if(void 0===u)throw new Error("Integer overflow (too many FLOPs).");a[f][f+i-1]=[s,u]}function E(r,t){if(r==t)return e[r];for(var o,i=1/0,f=r;f<t;f++){var s=O()(a[r][f],2),u=s[0],l=s[1],c=O()(a[f+1][t],2),h=c[0],d=n(l,c[1]),v=O()(d,2),w=v[0];v[1];(w+=u+h)<i&&(i=w,o=f)}return ne(E(r,o),E(o+1,t))}return E(0,e.length-1)}function oe(r){var e=(r=G(r)).shape.slice(-1),t=O()(e,1)[0],n=r.shape.slice(0,-1),a=new k.complex128(r.data.length/t);if(r.shape[r.ndim-2]!=t)throw new Error("T is not square.");r=r.data;for(var o=0,i=function(e,n){return r[o+t*e+n]},f=0;o<r.length;o+=t*t,f+=t)for(var s=t-1;s>=0;s--){var u=s-1;if(0===s||0==i(s,u))a[f+s]=i(s,s);else{var l=i(u,u),c=i(u,s),h=i(s,u),v=i(s,s),w=d.add(l,v),p=d.sub(d.mul(l,v),d.mul(c,h)),m=void 0,g=void 0,y=d.sqrt(d.sub(d.mul(w,w),d.mul(p,4)));if(w*w>=4*p)throw new Error("schur_eigenvals(T): T must not contain real eigenvalued 2x2 blocks.");m=d.mul(d.add(w,y),.5),g=d.mul(d.sub(w,y),.5),a[f+u]=m,a[f+s]=g,s--}}return new V(n,a)}function ie(r,e){if(r=G(r),e=G(e),r.ndim!=e.ndim)throw new Error("Q.ndim != T.ndim.");for(var t=e.ndim;t-- >0;)if(r.shape[t]!=e.shape[t])throw new Error("Q.shape != T.shape.");var n=e.shape.slice(-1),a=O()(n,1)[0],o=e.shape,i=o.slice(0,-1);if(e.shape[e.ndim-2]!=a)throw new Error("Q is not square.");var f=k.complex128,s=f.from(e.data);e=void 0;var u=new f(s.length/a),l=s._array,c=(u._array,new f(a)),h=c._array,v=new f(a),w=v._array,p=c._array.subarray(0,a),m=v._array.subarray(a),g=new Vr(NaN,NaN),y=new Vr(NaN,NaN),b=new Vr(NaN,NaN),x=NaN;function E(r,e,t){for(var n=Math.min(a,t+2),o=e._array,i=t;i-- >0;){for(var f=n;--f>i;){var s=o[2*f+0],u=l[2*(_+a*i+f)+0],c=o[2*f+1],h=l[2*(_+a*i+f)+1];o[2*i+0]-=s*u-c*h,o[2*i+1]-=s*h+c*u}if(0==i||0==A(i,i-1)){var d=l[2*(_+a*i+i)+0]-r.re,v=l[2*(_+a*i+i)+1]-r.im;y.re=o[2*i+0],y.im=o[2*i+1],Math.hypot(d,v)<=x?y.abs()<=x?(o[2*i+0]=0,o[2*i+1]=0):(o[2*i]=1,o.fill(0,2*i+1,2*n)):(y["/="](d,v),o[2*i+0]=y.re,o[2*i+1]=y.im)}else{for(var w=i-1,p=n;--p>i;){var m=o[2*p+0],E=l[2*(_+a*w+p)+0],k=o[2*p+1],M=l[2*(_+a*w+p)+1];o[2*w+0]-=m*E-k*M,o[2*w+1]-=m*M+k*E}var q=l[2*(_+a*w+w)+0]-r.re,N=l[2*(_+a*w+w)+1]-r.im,P=l[2*(_+a*i+i)+0]-r.re,S=l[2*(_+a*i+i)+1]-r.im,I=l[2*(_+a*w+i)+0],j=l[2*(_+a*w+i)+1],O=l[2*(_+a*i+w)+0],F=l[2*(_+a*i+w)+1];if(b["= c0*c1"](q,N,P,S),b["-= c0*c1"](I,j,O,F),0===b.re&&0===b.im)throw new Error("Assertion failed.");y["= c0*c1"](q,N,o[2*i+0],o[2*i+1]),y["-= c0*c1"](O,F,o[2*w+0],o[2*w+1]),y["/="](b.re,b.im),g["= c0*c1"](P,S,o[2*w+0],o[2*w+1]),g["-= c0*c1"](I,j,o[2*i+0],o[2*i+1]),g["/="](b.re,b.im),o[2*w+0]=g.re,o[2*w+1]=g.im,o[2*i+0]=y.re,o[2*i+1]=y.im,i--}}}for(var _=0,A=function(r,e){return s[_+a*r+e]},M=0;_<s.length;_+=a*a,M+=a){if(!((x=Math.sqrt(Number.EPSILON)*function(){for(var r=0,e=0,t=_+a*a,n=_;n<t;n++){var o=d.abs(s[n]);0!=o&&(o>e&&(r*=Math.pow(e/o,2),e=o),r+=Math.pow(o/e,2))}return Math.sqrt(r)*e}())>=0))throw new Error("Assertion failed.");for(var q=a-1;q>=0;q--){var N=q-1;if(0==q||0==A(q,N)){var P=A(q,q);u[M+q]=P,c.fill(0,0,q+2),c[q]=1,E(P,c,q);for(var S=Math.min(a,q+2);S-- >0;)l[2*(_+a*S+q)+0]=h[2*S+0],l[2*(_+a*S+q)+1]=h[2*S+1]}else{var I=A(N,N),j=A(N,q),F=A(q,N),J=A(q,q),T=d.add(I,J),L=d.sub(d.mul(I,J),d.mul(j,F)),R=void 0,U=void 0,Y=d.sqrt(d.sub(d.mul(T,T),d.mul(L,4)));if(T*T>=4*L)throw new Error("The given Schur decomposition must not contain 2x2 diagonal blocks with real eigenvalues.");R=d.mul(d.add(T,Y),.5),U=d.mul(d.sub(T,Y),.5),h.fill(0,0,2*(q+1)),w.fill(0,0,2*(q+1)),d.abs(j)>=d.abs(F)?(c[N]=j,c[q]=d.sub(R,I),v[N]=j,v[q]=d.sub(U,I)):(c[q]=F,c[N]=d.sub(R,J),v[q]=F,v[N]=d.sub(U,J)),E(R,c,N),E(U,v,N);for(var D=q+1;D-- >0;)l[2*(_+a*D+N)+0]=h[2*D+0],l[2*(_+a*D+N)+1]=h[2*D+1],l[2*(_+a*D+q)+0]=w[2*D+0],l[2*(_+a*D+q)+1]=w[2*D+1];u[M+N]=R,u[M+q]=U,--q}}p.fill(0),m.fill(0);for(var z=0;z<a;z++)for(var Q=0;Q<2*a;Q++){var C=Q>>>1,B=Math.abs(l[2*(_+a*z)+Q]);if(B>0){if(B>m[C]){var X=m[C]/B;m[C]=B,p[C]*=X*X}var W=B/m[C];p[C]+=W*W}}for(var H=p,K=0;K<a;K++){var Z=m[K];H[K]=isFinite(Z)?Math.sqrt(p[K])*Z:Z}for(var $=0;$<a;$++)for(var rr=0;rr<a;rr++)s[_+a*$+rr]=d.div(s[_+a*$+rr],H[rr])}return[new V(i,u),ne(r,new V(o,s))]}function fe(r){(r=G(r)).shape[r.ndim-1];var e=Wr(r),t=O()(e,2),n=t[0],a=t[1];return r=void 0,function(r,e){var t=r.shape[r.ndim-1],n=k[r.dtype],a=new n(t);if(r.shape[r.ndim-2]!=t)throw new Error("Q is not square.");if(r.ndim!=e.ndim)throw new Error("Q.ndim != H.ndim.");for(var o=r.ndim;o-- >0;)if(r.shape[o]!=e.shape[o])throw new Error("Q.shape != H.shape.");r=r.data,e=e.data;for(var i=Number.EPSILON,f=function r(o,f,s,u){for(var l=function(r,n){return e[u+t*r+n]},c=function(r){return!(Math.abs(l(r,r-1))>i*(Math.abs(l(r-1,r-1))+Math.abs(l(r,r))))&&(e[u+t*r+r-1]*=0,!0)},h=function(r,n,a,i){if(n<=r)throw new Error("Assertion failed.");for(var l=Math.max(0,r-1);l<s;l++){var c=e[u+t*r+l],h=e[u+t*n+l];e[u+t*r+l]=i*h+a*c,e[u+t*n+l]=a*h-i*c}for(var d=Math.min(s,n+2);d-- >0;){var v=e[u+t*d+r],w=e[u+t*d+n];e[u+t*d+r]=i*w+a*v,e[u+t*d+n]=a*w-i*v}for(var p=s;p-- >0;){var m=o[f+s*r+p],g=o[f+s*n+p];o[f+s*r+p]=i*g+a*m,o[f+s*n+p]=a*g-i*m}},d=function(i,l){if(l-i>s>>>1)throw new Error("Assertion failed.");var c=l-i;if(c<3)throw new Error("Assertion failed.");for(var h=new n(c*c),d=0;d<c;d++)h[c*d+d]=1;r(h,0,c,u+t*i+i);for(var v=0;v<c;v++)for(var w=0;w<v;w++){var p=h[c*v+w];h[c*v+w]=h[c*w+v],h[c*w+v]=p}for(var m=0;m<s;m++){a.fill(0,0,c);for(var g=0;g<c;g++)for(var y=0;y<c;y++)a[y]+=h[c*g+y]*o[f+s*(i+g)+m];for(var b=0;b<c;b++)o[f+s*(i+b)+m]=a[b]}for(var x=l;x<s;x++){a.fill(0,0,c);for(var E=0;E<c;E++)for(var _=0;_<c;_++)a[_]+=h[c*E+_]*e[u+t*(i+E)+x];for(var A=0;A<c;A++)e[u+t*(i+A)+x]=a[A]}for(var k=0;k<i;k++){a.fill(0,0,c);for(var M=0;M<c;M++)for(var q=0;q<c;q++)a[q]+=h[c*M+q]*e[u+t*k+(i+M)];for(var N=0;N<c;N++)e[u+t*k+(i+N)]=a[N]}},v=0,w=0,p=s;;){for(var m=!1;!m;){if(p-w<3)return;if(p-w<s>>>4)return d(w,p);m=!1,c(w+1)?w+=1:c(p-1)?p-=1:c(w+2)?w+=2:c(p-2)?p-=2:m=!0;for(var g=w+p>>>1,y=w+2;m&&++y<p-2;)c(y)&&(m=!1,y>g?(d(y,p),p=y):(d(w,y),w=y));m||(v=0)}v+=1;var b=p-2,x=p-1,E=l(b,b)+l(x,x),_=l(b,b)*l(x,x)-l(b,x)*l(x,b);if(E*E>4*_){var A=E>=0?1:-1,k=.5*(E+A*Math.sqrt(E*E-4*_)),M=2*_/(E+A*Math.sqrt(E*E-4*_));Math.abs(l(x,x)-k)>Math.abs(l(x,x)-M)&&(k=M),E=2*k,_=k*k}if(v%16==0){if(v>1e9)throw new Error("Too many iterations for a single eigenvalue.");_=(E=Math.abs(l(x,b))+Math.abs(l(b,p-3)))*E,E*=.5*Math.random()+1.25}x=w+1;for(var q=w+2,N=l(b=w+0,b)*l(b,b)+l(b,x)*l(x,b)-E*l(b,b)+_,P=l(x,b)*(l(b,b)+l(x,x)-E),S=l(x,b)*l(q,x),I=2;I-- >0;x=q,P=S)if(0!=P){var j=gr(N,P),F=O()(j,3),J=F[0],T=F[1],L=F[2];h(b,x,J,T),N=L}for(var R=w;R<p-2;R++){b=R+1;var U=Math.min(p,R+4);for(x=R+2;x<U;x++){var Y=l(b,R),D=l(x,R);if(0!==D){var z=gr(Y,D),Q=O()(z,3),G=Q[0],C=Q[1];Q[2];h(b,x,G,C),e[u+t*x+R]*=0}}}}},s=0;s<r.length;s+=t*t){for(var u=0;u<t;u++)for(var l=0;l<u;l++){var c=r[s+t*u+l];r[s+t*u+l]=r[s+t*l+u],r[s+t*l+u]=c}f(r,s,t,s);for(var h=1;h<t;h++){var d=h-1;if(0!=e[s+t*h+d])if("continue"===function(){var n=e[s+t*d+d],a=e[s+t*d+h],o=e[s+t*h+d],i=e[s+t*h+h],f=n+i;if(f*f<4*(n*i-a*o))return"continue";for(var u=Math.atan2(i-n,a+o)/2,l=Br((function(r){return(o*Math.cos(r)-n*Math.sin(r))*Math.cos(r)+(i*Math.cos(r)-a*Math.sin(r))*Math.sin(r)}),u,u+Math.PI/2*(u<=0?1:-1)),c=Math.cos(l),v=Math.sin(l),w=d;w<t;w++){var p=e[s+t*d+w],m=e[s+t*h+w];e[s+t*d+w]=v*m+c*p,e[s+t*h+w]=c*m-v*p}for(var g=h+1;g-- >0;){var y=e[s+t*g+d],b=e[s+t*g+h];e[s+t*g+d]=v*b+c*y,e[s+t*g+h]=c*b-v*y}for(var x=t;x-- >0;){var E=r[s+t*d+x],_=r[s+t*h+x];r[s+t*d+x]=v*_+c*E,r[s+t*h+x]=c*_-v*E}e[s+t*h+d]*=0}())continue}for(var v=0;v<t;v++)for(var w=0;w<v;w++){var p=r[s+t*v+w];r[s+t*v+w]=r[s+t*w+v],r[s+t*w+v]=p}}}(n,a),[n,a]}function se(r){var e=le(r,2),t=O()(e,2),n=t[0],a=fe(t[1]),o=O()(a,2),i=ie(o[0],o[1]),f=O()(i,2),s=f[0],u=f[1];if(!u.dtype.startsWith("complex"))throw new Error("Assertion failed.");if(!n.dtype.startsWith("float"))throw new Error("Assertion failed.");for(var l=r.shape[r.ndim-1],c=new Float64Array(l),h=new Float64Array(l),d=u.data._array,v=n.data,w=0,p=0;p<d.length;w+=l,p+=2*l*l){c.fill(0),h.fill(0);for(var m=0;m<l;m++)for(var g=v[w+m],y=0;y<2*l;y++){var b=Math.abs(d[p+2*l*m+y]*=g);if(b>0){var x=y>>1;b>h[x]&&(c[x]*=Math.pow(h[x]/b,2),h[x]=b),c[x]+=Math.pow(b/h[x],2)}}for(var E=0;E<l;E++){var _=h[E];c[E]=isFinite(_)?Math.sqrt(c[E])*_:_}for(var A=0;A<l;A++)for(var k=0;k<2*l;k++)d[p+2*l*A+k]/=c[k>>1]}return[s,u]}function ue(r){var e=le(r,2),t=O()(e,2),n=(t[0],fe(t[1])),a=O()(n,2);a[0];return oe(a[1])}function le(r,e){if(null==e&&(e=2),e>Number.MAX_VALUE)return function(r){var e=r.shape[r.ndim-1],t=k["float32"===r.dtype?"float32":"float64"],n=r.shape,a=n.slice(0,-1);if(r.shape[r.ndim-2]!=e)throw new Error("A is not square");r=t.from(r.data);var o=new t(r.length/e);o.fill(1);for(var i=r.length,f=o.length;i>0;){i-=e*e,f-=e;for(var s,u=!1;!u;)for(s=0,u=!0;s<e;s++){for(var l=0,c=0,h=0;h<e;h++)if(s!==h){var d=Math.abs(r[i+e*s+h]);c=Math.max(c,d);var v=Math.abs(r[i+e*h+s]);l=Math.max(l,v)}if(c*l!=0){var w=Math.max(l,c);if(0!=w){if(!isFinite(w))throw new Error("NaN encountered.");for(var p=1;c>=2*l;)l*=2,c/=2,p*=2;for(;l>=2*c;)l/=2,c*=2,p/=2;if(!(Math.max(l,c)>=w)){u=!1,o[f+s]*=p;for(var m=0;m<e;m++)r[i+e*s+m]/=p,r[i+e*m+s]*=p}}}}}return[new V(a,o),new V(n,r)]}(r);var t=r.shape[r.ndim-1],n=k["float32"===r.dtype?"float32":"float64"],a=r.shape,o=a.slice(0,-1);if(!(e>=1))throw new Error("Invalid norm p=".concat(e,";"));if(r.shape[r.ndim-2]!=t)throw new Error("A is not square");r=n.from(r.data);var i=new n(r.length/t),f=Math.pow(.95,1/e);i.fill(1);for(var s=r.length,u=i.length;s>0;){s-=t*t,u-=t;for(var l,c=!1;!c;)for(l=0,c=!0;l<t;l++){for(var h=0,d=0,v=0,w=0,p=0;p<t;p++)if(l!==p){var m=Math.abs(r[s+t*l+p]);if(m>0){if(m>w){var g=w/m;w=m,v*=Math.pow(g,e)}var y=m/w;v+=Math.pow(y,e)}var b=Math.abs(r[s+t*p+l]);if(b>0){if(b>d){var x=d/b;d=b,h*=Math.pow(x,e)}var E=b/d;h+=Math.pow(E,e)}}if((v=isFinite(v)?Math.pow(v,1/e)*w:v)*(h=isFinite(h)?Math.pow(h,1/e)*d:h)!=0){if(!isFinite(v*h))throw new Error("NaN encountered.");for(var _=h>=v?Math.pow(1+Math.pow(v/h,e),1/e)*h:Math.pow(1+Math.pow(h/v,e),1/e)*v,A=1;v>=2*h;)h*=2,v/=2,A*=2;for(;h>=2*v;)h/=2,v*=2,A/=2;if(!((h>=v?Math.pow(1+Math.pow(v/h,e),1/e)*h:Math.pow(1+Math.pow(h/v,e),1/e)*v)>=f*_)){c=!1,i[u+l]*=A;for(var M=0;M<t;M++)r[s+t*l+M]/=A,r[s+t*M+l]*=A}}}}return[new V(o,i),new V(a,r)]}function ce(r,e){if(e.ndim<2)throw new Error("eigen_balance_post(D,V): V.ndim must be at least 2.");var t=e.shape.slice(-2),n=O()(t,2),a=n[0],o=n[1];if(a!==o)throw new Error("eigen_balance_post(D,V): V must be square.");var i=k.float64,f=D([e,r.reshape.apply(r,m()(r.shape).concat([1]))],"complex128",v.mul);e=f.data;for(var s=new i(o),u=new i(o),l=0;l<e.length;l+=a*o){s.fill(0),u.fill(0);for(var c=0;c<o;c++)for(var h=0;h<o;h++){var d=v.abs(e[l+o*c+h]);d>0&&(d>u[h]&&(s[h]*=Math.pow(u[h]/d,2),u[h]=d),s[h]+=Math.pow(d/u[h],2))}for(var w=0;w<o;w++){var p=u[w];s[w]=isFinite(p)?Math.sqrt(s[w])*p:p}for(var g=0;g<o;g++)for(var y=0;y<o;y++)e[l+o*g+y]=v.div(e[l+o*g+y],s[y])}return f}function he(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];var n=e[0]in k?e.shift():"float64";if(e.length<1)throw new Error("Size parameter missing.");1==e.length&&e.push(e[e.length-1]),e=Int32Array.from(e,(function(r){if(0!=r%1)throw new Error("eye(): Invalid shape [".concat(e,"]."));return r}));for(var a=new k[n](e.reduce((function(r,e){return r*e}))),o=e.slice(-2),i=O()(o,2),f=i[0],s=i[1],u=a.length;(u-=f*s)>=0;)for(var l=Math.min(f,s);l-- >0;)a[u+s*l+l]=1;var c=new V(e,a);return c}var de=t(9),ve=t.n(de),we=function(r){function e(r){var t,n;l()(this,e);for(var a=arguments.length,o=new Array(a>1?a-1:0),i=1;i<a;i++)o[i-1]=arguments[i];if(n=J()(this,(t=ve()(e)).call.apply(t,[this].concat(o))),!(r instanceof V))throw new Error("Assertion failed.");return n.x=r,n}return L()(e,r),e}(Y()(Error));function pe(r,e,t,n){var a=Math.atan2(t-e,n+r),o=Math.atan2(t+e,n-r),i=(a-o)/2,f=(a+o)/2,s=Math.cos(i),u=Math.sin(i),l=Math.cos(f),c=Math.sin(f);if(a=l*(u*t+s*r)-c*(u*n+s*e),o=c*(s*t-u*r)+l*(s*n-u*e),Math.abs(a)<Math.abs(o)){var h=[s,-u];u=h[0],s=h[1];var d=[c,-l];l=d[0],c=d[1],a=o}return a<0&&(l=-l,c=-c),[s,u,l,c]}function me(r,e,t,n,a,o,i,f){r|=0,a|=0,i|=0;for(var s=0;s<r;s++)o[i+s]=t[r*s+s];ge(r,e,n,a,o,i,f)}function ge(r,e,t,n,a,o,i){n|=0,o|=0;for(var f=r|=0;f-- >0;){var s=a[o+f];if(s<0||Object.is(s,-0)){a[o+f]=-s;for(var u=0;u<r;u++)e[n+r*f+u]*=-1}}i.sort((function(r,e){return a[o+e]-a[o+r]}));for(var l=0;l<r;++l)for(var c=l;;){var h=i[c];if(i[c]=c,(c=h)<=l)break;for(var d=n+i[c]*r,v=n+c*r,w=0;w<r;w++){var p=e[d+w];e[d+w]=e[v+w],e[v+w]=p}for(var m=0;m<r;m++){var g=t[d+m];t[d+m]=t[v+m],t[v+m]=g}h=a[o+i[c]],a[o+i[c]]=a[o+c],a[o+c]=h}for(var y=0;y<r-1;y++)for(var b=y;++b<r;){var x=n+r*y+b,E=n+r*b+y,_=e[x];e[x]=e[E],e[E]=_}}function ye(r,e,t,n,a,o,i,f){if(e>r)throw new Error("Assertion failed.");if(1>=e)throw new Error("Assertion failed.");if(2===e)return function(r,e,t,n,a,o){r|=0,t|=0,o|=0;var i=gr(n[a|=0],n[a+1]),f=O()(i,3),s=f[0],u=f[1],l=f[2];0!==l?(n[a]=l,n[a+1]=NaN,n[o]=s,n[o+1]=-u,n[o+1*r]=u,n[o+1*r+1]=s):(n[o]=1,n[o+1*r+1]=1),e[t]=1}(r,t,n,a,o,i);if(3===e)return function(r,e,t,n,a,o){t|=0,o|=0;var i=(r|=0)-1|0,f=n[a|=0],s=n[a+1],u=n[a+2],l=n[a+3];if(0!==l){var c=gr(u,l),h=O()(c,3),d=h[0],v=h[1],w=h[2];if(n[o+1*r+1]=d,n[o+2*r+1]=v,u=w,l=-v*s,s*=d,0!==l){var p=gr(f,l),m=O()(p,3),g=m[0],y=m[1];f=m[2],n[o]=g,n[o+1*r]=y*-v,n[o+2*r]=y*d,n[o+2]=-y,n[o+1*r+2]=g*-v,n[o+2*r+2]=g*d}else n[o]=1,n[o+1*r+2]=-v,n[o+2*r+2]=d}else n[o]=1,n[o+1*r+1]=1,n[o+2*r+2]=1;var b=pe(f,s,0,u),x=O()(b,4),E=x[0],_=x[1],A=x[2],k=x[3];n[a+1]=NaN,n[a+3]=NaN,n[a]=E*f*A-(E*s+_*u)*k;var M=(u=(-_*s+E*u)*A-_*f*k)<0?-1:1;n[a+2]=M*u,e[t]=E,e[t+1]=-_*M,e[t+1*i]=_,e[t+1*i+1]=E*M,n[o+1]=k*n[o],n[o]*=A;var q=n[o+1*r]*A-n[o+1*r+1]*k;n[o+1*r+1]=n[o+1*r]*k+n[o+1*r+1]*A,n[o+1*r]=q;var N=n[o+2*r]*A-n[o+2*r+1]*k;n[o+2*r+1]=n[o+2*r]*k+n[o+2*r+1]*A,n[o+2*r]=N}(r,t,n,a,o,i);var s=r-1,u=e-1,l=e>>>1,c=l-1;if(f.length<s)throw new Error("Assertion failed: Integer work matrix I too small.");if(a.length<2*s)throw new Error("Assertion failed: Scalar work matrix F too small.");ye(r,l,t,n,a,o,i,f),ye(r,e-l,t,n+s*l+l,a,o+2*l,i+r*l+l,f),t[n+s*c+c]=1;for(var h=a[o+2*c],d=a[o+2*c+1],v=0;v<c;v++)a[o+2*v+1]=h*a[i+r*c+v];for(var w=l;w<u;w++)a[o+2*w+1]=d*a[i+r*l+w];var p=gr(h*a[i+r*c+c],d*a[i+r*l+u]),m=O()(p,3),g=m[0],y=m[1],b=m[2];if(a[o+2*c]=0,a[o+2*c+1]=b,0!==b){for(var x=0;x<l;x++)a[i+r*x+u]=a[i+r*x+c]*-y,a[i+r*x+c]*=g;for(var E=l;E<e;E++)a[i+r*E+c]=a[i+r*E+u]*y,a[i+r*E+u]*=g}f[u-1]=c;for(var _=0,A=l,k=0;k<u-1;k++)f[k]=A>=u||_<c&&a[o+2*_]>=a[o+2*A]?_++:A++;for(var q=0;q<u;q++){var N=f[q];a[2*q]=a[o+2*N],a[2*q+1]=a[o+2*N+1]}for(var P=0;P<u;P++)a[o+2*P]=a[2*P],a[o+2*P+1]=a[2*P+1];!function(r,e,t,n,a,o,i,f){n|=0,o|=0,i|=0;var s=(r|=0)-1|0,u=(e|=0)-1|0;if(f.length<3*s)throw new Error("Assertion failed: Integer work matrix I too small.");if(a.length<s*(s+2)+2*s+(s+1)*(s+1))throw new Error("Assertion failed: Scalar work matrix F too small.");var l=s*(s+2)-u,c=s*(s+2)-2*u,h=s*(s+2)-u*(u+2),d=2*u,v=u;if(e<2)throw new Error("Assertion failed.");if(0!==a[o+2*u-2])throw new Error("Assertion failed.");for(var w=1;w<u;w++)if(a[o+2*(w-1)]<a[o+2*w])throw new Error("Assertion failed.");for(var p=new xr,m=function(){for(var r=0;r<u;r++)p.include(a[o+2*r+1]);for(var e=p.result,t=0;t<u;t++)p.include(a[o+2*t]);var n=p.result;return 0===n&&(n=1),[e/n,n]}(),g=O()(m,2),y=g[0],b=g[1],x=0;x<2*u;x++)a[o+x]/=b;for(var E=M(t instanceof Float32Array?"float32":"float64"),_=function(){for(var r=0,e=u-1,t=u-1;t-- >0;){var n=a[o+2*t],i=a[o+2*t+1],s=f[0+t];Math.abs(i)/E<=n?(a[l+r]=n,f[v+r]=s,++r):(--e,a[o+2*e]=n,a[o+2*e+1]=a[o+2*t+1],f[v+e]=s)}return r}(),A=0;A<_;A++)f[0+A]=f[v+A];for(var k=function(){for(var r=_,e=u-1,t=u-1;t-- >_;){var n=a[o+2*t],i=a[o+2*e],s=f[v+t],c=a[o+2*t+1],w=gr(a[o+2*e+1],c),p=O()(w,3),m=p[0],g=p[1],y=p[2];(n-i)/E<=n||!isFinite(Math.sqrt(u)/(n-i))?(a[h+2*r]=m,a[h+2*r+1]=g,a[o+2*e+1]=y,a[o+2*e]=a[l+r]=n,f[0+r]=s,f[d+r]=e,++r):(--e,a[o+2*e]=n,a[o+2*e+1]=a[o+2*t+1],f[0+e]=s)}return r}(),q=2*_;q<2*k;q++)a[o+q]=a[h+q],a[h+q]=0;for(var N=function(r){var e=a[o+2*r],t=k<r?a[o+2*r-2]:e+y;if(e>t)throw new Error("Assertion failed.");for(var n=function(){if(r>k){for(var n=(e+t)/2,i=1,f=k;f<u;f++){var s=a[o+2*f],l=a[o+2*f+1];i+=l/(s-n)*(l/(s+n))}if(!isFinite(i))throw new Error("Assertion failed.");if(i<0){var c=t;return e-=t,t=-Number.MIN_VALUE,c}}var h=e;return t-=e,e=+Number.MIN_VALUE,h}();;){var i=(e+t)/2;if(i===e||i===t){a[l+r]=i;break}for(var f=1,s=k;s<u;s++){var c=a[o+2*s],h=a[o+2*s+1];f+=h/(c-n-i)*(h/(c+n+i))}if(!isFinite(f))throw new Error("Assertion failed.");f<=0&&(e=i),f>=0&&(t=i)}},P=k;P<u;P++)N(P);0===Math.abs(a[o+2*u-1])&&(a[o+2*u-2]=0,a[o+2*u-1]=0,a[l+u-1]=0);for(var S=a[l+u-1],I=a[o+2*(u-1-(S<0))],j=k;j<u;j++){for(var F=a[o+2*j],J=(I-F+S)*(I+F+S),T=k;T<j;T++){var L=a[l+T],R=a[o+2*(T-(L<0))],U=a[o+2*T];J*=(R-F+L)/(U-F)*((R+F+L)/(U+F))}for(var Y=j;Y<u-1;Y++){var D=a[l+Y],z=a[o+2*(Y-(D<0))],Q=a[o+2*Y+2];J*=(z-F+D)/(Q-F)*((z+F+D)/(Q+F))}a[o+2*j+1]=Math.sign(a[o+2*j+1])*Math.sqrt(J)}for(var G=_-1,C=k-1,V=k,B=0;B<u;B++){var X=-1/0,W=3;if(V<u){var H=a[l+V];W=2,X=H+a[o+2*(V-(H<0))]}if(C>=_){var K=a[l+C];K<X||(W=1,X=K)}if(G>=0){var Z=a[l+G];Z<X||(W=0,X=Z)}switch(W){case 0:f[v+G--]=B;continue;case 1:f[v+C--]=B;continue;case 2:f[v+V++]=B;continue;default:throw new Error("Assertion failed.")}}for(var $=k;$<u;$++){var rr=a[l+$],er=a[o+2*($-(rr<0))];p.reset();for(var tr=k;tr<u-1;tr++){var nr=a[o+2*tr],ar=a[o+2*tr+1]/(nr-er-rr)*(nr/(nr+er+rr));p.include(a[h+u*$+tr]=ar)}p.include(a[h+u*$+u-1]=-1);var or=p.result;if(!(0<or))throw new Error("Assertion failed.");for(var ir=k;ir<u;ir++)a[h+u*$+ir]/=or}for(var fr=k;fr<u;fr++)for(var sr=fr;++sr<u;){var ur=a[h+u*fr+sr];a[h+u*fr+sr]=a[h+u*sr+fr],a[h+u*sr+fr]=ur}if(_<k){for(var lr=_;lr<k;lr++)a.fill(0,h+u*lr+_,h+u*lr+u),a[h+u*lr+lr]=1;for(var cr=k;cr<u;cr++)a.fill(0,h+u*cr+_,h+u*cr+k);for(var hr=k;hr-- >_;){var dr=f[d+hr];if(dr<u-1){var vr=a[o+2*hr],wr=a[o+2*hr+1];yr(a,u-hr,h+u*hr+hr,h+u*dr+hr,vr,wr)}}}for(var pr=0;pr<u;pr++){a.fill(0,c+_,c+u);for(var mr=_;mr<u;mr++){var br=t[n+s*pr+f[0+mr]];if(0!==br)for(var Er=_;Er<u;Er++)a[c+Er]+=br*a[h+u*mr+Er]}for(var _r=0;_r<_;_r++){var Ar=f[0+_r];a[c+_r]=t[n+s*pr+Ar]}for(var kr=0;kr<u;kr++){t[n+s*pr+f[v+kr]]=a[c+kr]}}for(var Mr=k;Mr<u;Mr++){var qr=a[l+Mr],Nr=a[o+2*(Mr-(qr<0))];p.reset();for(var Pr=k;Pr<u;Pr++){var Sr=a[o+2*Pr],Ir=a[o+2*Pr+1]/(Sr-Nr-qr)/(Sr+Nr+qr);p.include(a[h+u*Mr+Pr]=Ir)}var jr=p.result;if(!(0<jr||Mr===u-1))throw new Error("Assertion failed: "+jr);for(var Or=k;Or<u;Or++)a[h+u*Mr+Or]/=jr}if(0===a[o+2*u-1]){for(var Fr=k;Fr<u-1;Fr++)a[h+u*(u-1)+Fr]=0;a[h+u*(u-1)+(u-1)]=1}for(var Jr=k;Jr<u;Jr++)for(var Tr=Jr;++Tr<u;){var Lr=a[h+u*Jr+Tr];a[h+u*Jr+Tr]=a[h+u*Tr+Jr],a[h+u*Tr+Jr]=Lr}if(_<k){for(var Rr=_;Rr<k;Rr++)a.fill(0,h+u*Rr+_,h+u*Rr+u),a[h+u*Rr+Rr]=1;for(var Ur=k;Ur<u;Ur++)a.fill(0,h+u*Ur+_,h+u*Ur+k);for(var Yr=k;Yr-- >_;){var Dr=f[d+Yr],zr=a[o+2*Yr],Qr=a[o+2*Yr+1];yr(a,u-Yr,h+u*Yr+Yr,h+u*Dr+Yr,zr,Qr)}}for(var Gr=0;Gr<e;Gr++){a.fill(0,c+_,c+u);for(var Cr=_;Cr<u;Cr++){var Vr=a[i+r*Gr+f[0+Cr]];if(0!==Vr)for(var Br=_;Br<u;Br++)a[c+Br]+=Vr*a[h+u*Cr+Br]}for(var Xr=0;Xr<_;Xr++){var Wr=f[0+Xr];a[c+Xr]=a[i+r*Gr+Wr]}for(var Hr=0;Hr<u;Hr++){var Kr=f[v+Hr];a[i+r*Gr+Kr]=a[c+Hr]}}for(var Zr=k;Zr<u;Zr++)a[l+Zr]+=a[o+2*(Zr-(a[l+Zr]<0))];for(var $r=0;$r<u;$r++){var re=f[v+$r];a[o+2*re]=a[l+$r]*b,a[o+2*re+1]=NaN}}(r,e,t,n,a,o,i,f)}function be(r,e,t,n,a,o,i,f,s,u){if(r>e)throw new Error("Assertion failed.");if(s.length<3*r)throw new Error("Assertion failed: Integer work matrix I too small.");if(u.length<r*(r+2)+2*r+(r+1)*(r+1)+(r+1)*e)throw new Error("Assertion failed: Scalar work matrix F too small.");var l=r*(r+2),c=l+2*r,h=c+(r+1)*(r+1);u.fill(0,c,h+e);for(var d=0;d<r;d++)for(var v=0;v<e;v++)u[h+e+e*d+v]=i[f+e*d+v];i.fill(0,f,f+r*e),qr(r,e,t,n,u,0,u,h);for(var w=0;w<r;w++)u[l+2*w]=u[(r+1)*w+w],u[l+2*w+1]=u[(r+1)*w+w+1];ye(r+1,r+1,i,f,u,l,c,s);for(var p=0;p<r;p++)a[o+p]=u[l+2*p];for(var m=0;m<r;m++){u.fill(0,0,r);for(var g=0;g<r;g++)for(var y=0;y<r;y++)u[y]+=t[n+r*m+g]*i[f+r*g+y];for(var b=0;b<r;b++)t[n+r*m+b]=u[b]}i.fill(0,f,f+r*r);for(var x=0;x<r+1;x++)for(var E=0;E<r;E++)for(var _=0;_<e;_++)i[f+e*E+_]+=u[c+(r+1)*x+E]*u[h+e*x+_]}function xe(r){if((r=G(r)).dtype.startsWith("complex"))throw new Error("svd_dc(A): A.dtype must be float.");var e=r.shape.slice(-2),t=O()(e,2),n=t[0],a=t[1];if(n>a){var o=xe(r.T),i=O()(o,3),f=i[0],s=i[1],u=i[2];return Ar(f),[u.T,s,f]}var l=r.shape,c=l.slice(),h=l.slice(0,-1);c[c.length-1]=n;var d="float32"===r.dtype?"float32":"float64",v=k[d],w=(r=r.data).length/(n*a),p=v.from(r);r=void 0;for(var m=new v(w*n*n),g=new v(w*n),y=new v(n*(n+2)+2*n+(n+1)*(n+1)+(n+1)*Math.max(1+n,a)),b=new Int32Array(3*n),x=0,E=0,_=0;E<g.length;x+=n*n,E+=n,_+=n*a)be(n,a,m,x,g,E,p,_,b,y);return[new V(c,m),new V(h,g),new V(l,p)]}function Ee(r){var e=(r=G(r)).shape[r.ndim-1],t=r.shape.slice(0,-1),n=v.sqrt(M(r.dtype));r=r.data;for(var a=new k.int32(r.length/e),o=0;o<a.length;o++){var i=n*v.abs(r[e*o]);if(0!==a[o])throw new Error("Assertion failed.");for(;a[o]<e;a[o]++){var f=v.abs(r[e*o+a[o]]);if(!isFinite(f))throw new Error("svd_rank(): NaN or Infinity encountered.");if(f<=i)break}}return new V(t,a)}function _e(r,e,t,n){if(r=G(r),e=G(e),t=G(t),r.shape[r.ndim-2]!==t.shape[t.ndim-1])throw new Error("rrqr_solve(Q,R,P, y): System not square.");var a=Ae(r,e,t,n),o=v.sqrt(M(e.dtype)),i=e.shape[e.ndim-1];e=e.data;for(var f=0;f<e.length;f+=i)for(var s,u=o*v.abs(e[f]);s<i;s++){var l=v.abs(e[f+s]);if(!isFinite(l))throw new Error("svd_solve(): NaN or Infinity encountered.");if(l<=u)throw new we(a)}return a}function Ae(r,e,t,n){if(null==n){var a,o;if(null!=t)throw new Error("svd_lstsq(Q,R,P, y): Either 2 ([Q,R,P], y) or 4 arguments (Q,R,P, y) expected.");n=R((a=Q,o=O()(a,3),r=o[0],e=o[1],t=o[2],a))}if((r=G(r)).ndim<2)throw new Error("svd_lstsq(U,sv,V, y): U.ndim must be at least 2.");if((e=G(e)).ndim<1)throw new Error("svd_lstsq(U,sv,V, y): sv.ndim must be at least 1.");if((t=G(t)).ndim<2)throw new Error("svd_lstsq(U,sv,V, y): V.ndim must be at least 2.");if((n=G(n)).ndim<2)throw new Error("svd_lstsq(U,sv,V, y): y.ndim must be at least 2.");var i=r.shape.slice(-2),f=O()(i,2),s=f[0],u=f[1],l=t.shape.slice(-1),c=O()(l,1)[0],h=n.shape.slice(-1),d=O()(h,1)[0];if(s!==n.shape[n.ndim-2])throw new Error("svd_lstsq(U,sv,V, y): U and y don't match.");if(u!==e.shape[e.ndim-1])throw new Error("svd_lstsq(U,sv,V, y): U and sv don't match.");if(u!==t.shape[t.ndim-2])throw new Error("svd_lstsq(U,sv,V, y): V and sv don't match.");var w=Math.max(r.ndim,e.ndim+1,t.ndim,n.ndim),p=Int32Array.from({length:w},(function(){return 1}));p[w-2]=c,p[w-1]=d;for(var m=0,g=[r,t,n];m<g.length;m++)for(var y=g[m],b=w-2,x=y.ndim-2;b-- >0&&x-- >0;)if(1===p[b])p[b]=y.shape[x];else if(p[b]!=y.shape[x]&&1!=y.shape[x])throw new Error("svd_lstsq(U,sv,V, y): U,sv,V,y not broadcast-compatible.");for(var E=w-2,_=e.ndim-1;E-- >0&&_-- >0;)if(1===p[E])p[E]=e.shape[_];else if(p[E]!=e.shape[_]&&1!=e.shape[_])throw new Error("svd_lstsq(U,sv,V, y): U,sv,V,y not broadcast-compatible.");var A=v.sqrt(M(e.dtype)),q=k[[r,e,t,n].every((function(r){return"float32"===r.dtype}))?"float32":"float64"],N=new q(u*d),P=new q(p.reduce((function(r,e){return r*e}),1)),S=r.data,I=e.data,j=t.data,F=n.data,J=0,T=1,L=0,U=1,Y=0,D=1,z=0,C=1,B=0;return function a(o){if(o===w-2){T=s*u,U=u,D=u*c,C=s*d;var i=function(){for(var r=A*v.abs(I[L]),e=0;e<u;e++){var t=v.abs(I[L+e]);if(!isFinite(t))throw new Error("svd_solve(): NaN or Infinity encountered.");if(t<=r)return e}return u}();N.fill(0);for(var f=0;f<s;f++)for(var l=0;l<i;l++)for(var h=0;h<d;h++)N[d*l+h]+=S[J+u*f+l]*F[z+d*f+h];for(var m=0;m<i;m++)for(var g=0;g<d;g++)N[d*m+g]/=I[L+m];for(var y=0;y<i;y++)for(var b=0;b<c;b++)for(var x=0;x<d;x++)P[B+d*b+x]+=j[Y+c*y+b]*N[d*y+x];return J+=T,L+=U,Y+=D,z+=C,void(B+=c*d)}for(var E=p[o];a(o+1),1!=E;E--)r.shape[o-w+r.ndim]>1||(J-=T),e.shape[o-w+1+e.ndim]>1||(L-=U),t.shape[o-w+t.ndim]>1||(Y-=D),n.shape[o-w+n.ndim]>1||(z-=C);T*=r.shape[o-w+r.ndim]||1,U*=e.shape[o-w+1+e.ndim]||1,D*=t.shape[o-w+t.ndim]||1,C*=n.shape[o-w+n.ndim]||1}(0),new V(p,P)}function ke(r,e){var t=xe(r),n=O()(t,3);return Ae(n[0],n[1],n[2],e)}function Me(r){r=G(r);var e=k["float32"===r.dtype?"float32":"float64"].from(r.data),t=r.shape.slice(-2),n=O()(t,2),a=n[0],o=n[1],i=new Int32Array(e.length/o);if(a!=o)throw new Error("Last two dimensions must be quadratic.");for(var f=0,s=0;f<e.length;f+=a*a,s+=a){for(var u=0;u<a;u++)i[s+u]=u;for(var l=0;l<a;l++){for(var c=f+l*a,h=l,d=l+1;d<a;d++)Math.abs(e[f+a*d+l])>Math.abs(e[f+a*h+l])&&(h=d);if(l!=h){var v=i[s+l];i[s+l]=i[s+h],i[s+h]=v;for(var w=f+h*a,p=0;p<a;p++){var m=e[c+p];e[c+p]=e[w+p],e[w+p]=m}}for(var g=l+1;g<a;g++){var y=f+g*a,b=e[y+l]/e[c+l];e[y+l]=b;for(var x=l+1;x<a;x++)e[y+x]-=b*e[c+x]}}}return[new V(r.shape,e),new V(r.shape.slice(0,-1),i)]}function qe(r,e,t){if(null==t){t=e;var n=r,a=O()(n,2);r=a[0],e=a[1]}if((r=G(r)).ndim<2)throw new Error("LU must be at least 2D.");if((e=G(e)).ndim<1)throw new Error("P must be at least 1D.");if((t=G(t)).ndim<2)throw new Error("y must be at least 2D.");var o=r.shape.slice(-2),i=O()(o,2),f=i[0],s=i[1],u=t.shape.slice(-2),l=O()(u,2),c=l[0],h=l[1];if(s!=f)throw new Error("Last two dimensions of LU must be quadratic.");if(s!=c)throw new Error("LU and y don't match.");if(s!=e.shape.slice(-1))throw new Error("LU and P don't match.");var d=Math.max(r.ndim,e.ndim+1,t.ndim),v=Int32Array.from({length:d},(function(){return 1}));v[d-2]=c,v[d-1]=h;for(var w=0,p=[r,t];w<p.length;w++)for(var m=p[w],g=d-2,y=m.ndim-2;g-- >0&&y-- >0;)if(1===v[g])v[g]=m.shape[y];else if(v[g]!=m.shape[y]&&1!=m.shape[y])throw new Error("LU and y are not broadcast-compatible.");for(var b=d-2,x=e.ndim-1;b-- >0&&x-- >0;)if(1===v[b])v[b]=e.shape[x];else if(v[b]!=e.shape[x]&&1!=e.shape[x])throw new Error("P is not broadcast-compatible.");var E=new(k[[r,e,t].every((function(r){return"float32"===r.dtype}))?"float32":"float64"])(v.reduce((function(r,e){return r*e}),1)),_=r.data,A=e.data,M=t.data,q=0,N=1,P=0,S=1,I=0,j=1,F=0;return function n(a){if(a===d-2){N=f*f,S=f,j=f*h;for(var o=0;o<c;o++)for(var i=F+h*o,s=I+h*A[P+o],u=0;u<h;u++)E[i+u]=M[s+u];for(var l=0;l<c;l++)for(var w=0;w<h;w++)for(var p=0;p<l;p++)E[F+l*h+w]-=_[q+f*l+p]*E[F+p*h+w];return Or(c,c,h,_,q,E,F),q+=N,P+=S,I+=j,void(F+=j)}for(var m=v[a];n(a+1),1!=m;m--)r.shape[a-d+r.ndim]>1||(q-=N),e.shape[a-d+e.ndim+1]>1||(P-=S),t.shape[a-d+t.ndim]>1||(I-=j);N*=r.shape[a-d+r.ndim]||1,S*=e.shape[a-d+e.ndim+1]||1,j*=t.shape[a-d+t.ndim]||1}(0),new V(v,E)}function Ne(r,e){if((r=G(r)).ndim<2)throw new Error("permute_rows(A,P): A.ndim must be at least 2.");if((e=G(e)).ndim<1)throw new Error("permute_rows(A,P): P.ndim must be at least 1.");if("int32"!==e.dtype)throw new Error('permute_rows(A,P): P.dtype must be "int32".');var t=Math.max(r.ndim,e.ndim+1),n=Int32Array.from({length:t},(function(){return 1})),a=r.shape.slice(-2),o=O()(a,2),i=o[0],f=o[1];if(i!==e.shape[e.ndim-1])throw new Error("permute_rows(A,P): A.shape[-2] and P.shape[-1] must match.");for(var s=t,u=r.ndim;s-- >0&&u-- >0;)n[s]=r.shape[u];for(var l=t-2,c=e.ndim-1;l-- >0&&c-- >0;)if(1===n[l])n[l]=e.shape[c];else if(n[l]!=e.shape[c]&&1!=e.shape[c])throw new Error("permute_rows(A,P): A and P not broadcast-compatible.");var h=new k[r.dtype](n.reduce((function(r,e){return r*e}))),d=r.shape,v=r.ndim,w=e.shape,p=e.ndim;r=r.data,e=e.data;var m=0,g=-1,y=0,b=-1,x=0;return function a(o){if(o===t-2){for(var s=0;s<i;s++){var u=e[y+s];if(!(u>=0))throw new Error("permute_rows(A,P): P.contains invalid indices.");if(!(u<i))throw new Error("permute_rows(A,P): P.contains invalid indices.");for(var l=0;l<f;l++)h[x+f*s+l]=r[m+f*u+l]}return m+=g=i*f,y+=b=i,void(x+=g)}for(var c=n[o];a(o+1),1!==c;c--)d[o-t+v]>1||(m-=g),w[o-t+1+p]>1||(y-=b);g*=d[o-t+v]||1,b*=w[o-t+1+p]||1}(0),new V(n,h)}function Pe(r,e){if((r=G(r)).ndim<2)throw new Error("permute_cols(A,P): A.ndim must be at least 2.");if((e=G(e)).ndim<1)throw new Error("permute_cols(A,P): P.ndim must be at least 1.");if("int32"!==e.dtype)throw new Error('permute_cols(A,P): P.dtype must be "int32".');var t=Math.max(r.ndim,e.ndim+1),n=Int32Array.from({length:t},(function(){return 1})),a=r.shape.slice(-2),o=O()(a,2),i=o[0],f=o[1];if(f!==e.shape[e.ndim-1])throw new Error("permute_cols(A,P): A.shape[-1] and P.shape[-1] must match.");for(var s=t,u=r.ndim;s-- >0&&u-- >0;)n[s]=r.shape[u];for(var l=t-2,c=e.ndim-1;l-- >0&&c-- >0;)if(1===n[l])n[l]=e.shape[c];else if(n[l]!=e.shape[c]&&1!=e.shape[c])throw new Error("permute_cols(A,P): A and P not broadcast-compatible.");var h=new k[r.dtype](n.reduce((function(r,e){return r*e}))),d=r.shape,v=r.ndim,w=e.shape,p=e.ndim;r=r.data,e=e.data;var m=0,g=-1,y=0,b=-1,x=0;return function a(o){if(o===t-2){for(var s=0;s<i;s++)for(var u=0;u<f;u++){var l=e[y+u];if(!(l>=0))throw new Error("permute_cols(A,P): P.contains invalid indices.");if(!(l<f))throw new Error("permute_cols(A,P): P.contains invalid indices.");h[x+f*s+u]=r[m+f*s+l]}return m+=g=i*f,y+=b=f,void(x+=g)}for(var c=n[o];a(o+1),1!==c;c--)d[o-t+v]>1||(m-=g),w[o-t+1+p]>1||(y-=b);g*=d[o-t+v]||1,b*=w[o-t+1+p]||1}(0),new V(n,h)}function Se(r,e){if((r=G(r)).ndim<2)throw new Error("unpermute_rows(A,P): A.ndim must be at least 2.");if((e=G(e)).ndim<1)throw new Error("unpermute_rows(A,P): P.ndim must be at least 1.");if("int32"!==e.dtype)throw new Error('unpermute_rows(A,P): P.dtype must be "int32".');var t=Math.max(r.ndim,e.ndim+1),n=Int32Array.from({length:t},(function(){return 1})),a=r.shape.slice(-2),o=O()(a,2),i=o[0],f=o[1];if(i!==e.shape[e.ndim-1])throw new Error("unpermute_rows(A,P): A.shape[-2] and P.shape[-1] must match.");for(var s=t,u=r.ndim;s-- >0&&u-- >0;)n[s]=r.shape[u];for(var l=t-2,c=e.ndim-1;l-- >0&&c-- >0;)if(1===n[l])n[l]=e.shape[c];else if(n[l]!=e.shape[c]&&1!=e.shape[c])throw new Error("unpermute_rows(A,P): A and P not broadcast-compatible.");var h=new k[r.dtype](n.reduce((function(r,e){return r*e}))),d=r.shape,v=r.ndim,w=e.shape,p=e.ndim;r=r.data,e=e.data;var m=0,g=-1,y=0,b=-1,x=0;return function a(o){if(o===t-2){for(var s=0;s<i;s++){var u=e[y+s];if(!(u>=0))throw new Error("unpermute_rows(A,P): P.contains invalid indices.");if(!(u<i))throw new Error("unpermute_rows(A,P): P.contains invalid indices.");for(var l=0;l<f;l++)h[x+f*u+l]=r[m+f*s+l]}return m+=g=i*f,y+=b=i,void(x+=g)}for(var c=n[o];a(o+1),1!==c;c--)d[o-t+v]>1||(m-=g),w[o-t+1+p]>1||(y-=b);g*=d[o-t+v]||1,b*=w[o-t+1+p]||1}(0),new V(n,h)}function Ie(r,e){if((r=G(r)).ndim<2)throw new Error("unpermute_cols(A,P): A.ndim must be at least 2.");if((e=G(e)).ndim<1)throw new Error("unpermute_cols(A,P): P.ndim must be at least 1.");if("int32"!==e.dtype)throw new Error('unpermute_cols(A,P): P.dtype must be "int32".');var t=Math.max(r.ndim,e.ndim+1),n=Int32Array.from({length:t},(function(){return 1})),a=r.shape.slice(-2),o=O()(a,2),i=o[0],f=o[1];if(f!==e.shape[e.ndim-1])throw new Error("unpermute_cols(A,P): A.shape[-1] and P.shape[-1] must match.");for(var s=t,u=r.ndim;s-- >0&&u-- >0;)n[s]=r.shape[u];for(var l=t-2,c=e.ndim-1;l-- >0&&c-- >0;)if(1===n[l])n[l]=e.shape[c];else if(n[l]!=e.shape[c]&&1!=e.shape[c])throw new Error("unpermute_cols(A,P): A and P not broadcast-compatible.");var h=new k[r.dtype](n.reduce((function(r,e){return r*e}))),d=r.shape,v=r.ndim,w=e.shape,p=e.ndim;r=r.data,e=e.data;var m=0,g=-1,y=0,b=-1,x=0;return function a(o){if(o===t-2){for(var s=0;s<i;s++)for(var u=0;u<f;u++){var l=e[y+u];if(!(l>=0))throw new Error("unpermute_cols(A,P): P.contains invalid indices.");if(!(l<f))throw new Error("unpermute_cols(A,P): P.contains invalid indices.");h[x+f*s+l]=r[m+f*s+u]}return m+=g=i*f,y+=b=f,void(x+=g)}for(var c=n[o];a(o+1),1!==c;c--)d[o-t+v]>1||(m-=g),w[o-t+1+p]>1||(y-=b);g*=d[o-t+v]||1,b*=w[o-t+1+p]||1}(0),new V(n,h)}function je(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];if(r in k||(t.unshift(r),r="float64"),!r.startsWith("float"))throw new Error("Unsupported dtype: '".concat(r,"'."));1===t.length&&t.push(t[0]);for(var a=t.length;a-- >0;)if(t[a]%1!=0||t[a]<1)throw new Error("shape[".concat(a,"] = ").concat(t[a]," not a positive integer."));for(var o=(t=Int32Array.from(t)).slice(-2),i=O()(o,2),f=i[0],s=i[1],u=Math.max(f,s),l=k[r],c=new l(t.reduce((function(r,e){return r*e}))),h=new l(u*u),d=new l(u),v=new l(u),w=new xr,p=0;p<c.length;p+=f*s){for(var m=0;m<u;m++)for(var g=0;g<u;g++)h[u*m+g]=m===g;v[0]=Math.random()<=.5?-1:1;for(var y=u;y-- >1;){w.reset();for(var b=0;;b++){var x=d[b]=B();if(b>=y)break;w.include(x)}v[y]=d[y]>0?-1:1;var E=w.resultIncl(d[y])*v[y];if(0!==E){w.include(d[y]-=E);for(var _=w.max,A=Math.sqrt(w.sum),M=y;M>=0;M--)d[M]=d[M]/_/A;for(var q=u;q-- >0;){for(var N=0,P=y;P>=0;P--)N+=h[u*q+P]*d[P];N*=2;for(var S=y;S>=0;S--)h[u*q+S]-=d[S]*N}}}for(var I=0;I<u;I++)for(var j=0;j<u;j++)h[u*I+j]*=v[I];for(var F=0;F<f;F++)for(var J=0;J<s;J++)c[p+s*F+J]=h[u*F+J]}return new V(t,c)}function Oe(r){var e=xe(r),t=O()(e,3),n=(t[0],t[1]);t[2];return Ee(n)}function Fe(r,e,t,n){for(t|=0,n<<=1;n<r.length;n=n+2|0){var a=Math.abs(e[t+(n>>>1)]);if(0!==a){if(r[n]<a){var o=r[n]/a;r[n+1]*=o*o,r[n]=a}a/=r[n],r[n+1]+=a*a}}}function Je(r,e){var t=r[e<<=1];return isFinite(t)?Math.sqrt(r[e+1])*t:t}function Te(r,e,t,n,a){var o=Math.min(r,e);if(!(a.length>=o))throw new Error("Assertion failed.");for(var i=new xr,f=o;f-- >0;){for(var s=e;s-- >f;)i.include(t[n+e*f+s]);if(a[f]=i.result,!isFinite(a[f]))throw new Error("Infinity or NaN encountered during rank estimation.")}for(var u=2*M(a instanceof Float32Array?"float32":"float64")*Math.max(r,e)*a[0],l=o;l>0&&a[l-1]<=u;)--l;return l}function Le(r){if((r=G(r)).ndim<2)throw new Error("A must be at least 2D.");var e=k["float32"===r.dtype?"float32":"float64"],t=r.shape,n=Int32Array.from(t),a=n.slice(0,-1),o=t.slice(-2),i=O()(o,2),f=i[0],s=i[1],u=Math.min(f,s);n[n.length-1]=f,a[a.length-1]=s;var l=e.from(r.data);r=void 0;for(var c=new Int32Array(l.length/f),h=new e(l.length/s*f),d=new e(s<<1),v=0,w=0,p=0;v<h.length;v+=f*f,w+=f*s,p+=s){for(var m=0;m<s;m++)c[p+m]=m;for(var g=0;g<f;g++)h[v+f*g+g]=1;for(var y=0;y<f;y++)Fe(d,l,w+s*y,0);for(var b=0;b<u;b++){for(var x=-1,E=-1/0,_=b;_<s;_++){var A=Je(d,_);E<A&&(x=_,E=A)}if(x!==b){for(var M=0;M<f;M++){var q=w+s*M+b,N=w+s*M+x,P=l[q];l[q]=l[N],l[N]=P}var S=c[p+b];c[p+b]=c[p+x],c[p+x]=S}if(d.fill(0,b<<1),0===E)break;for(var I=w+s*b+b,j=b;++j<f;){var F=w+s*j+b,J=l[F];if(0!==J){var T=gr(l[I],J),L=O()(T,3),R=L[0],U=L[1],Y=L[2];l[F]=0,0!==U&&(l[I]=Y,yr(l,s-1-b,I+1,F+1,R,U),yr(h,1+j,v+f*b,v+f*j,R,U))}Fe(d,l,w+s*j,b+1)}l[I]=(l[I]<0||Object.is(-0,l[I])?-1:1)*E}_r(f,h,v)}return[new V(n,h),new V(t,l),new V(a,c)]}function Re(r){if((r=G(r)).ndim<2)throw new Error("A must be at least 2D.");var e=k["float32"===r.dtype?"float32":"float64"],t=r.shape,n=Int32Array.from(t),a=t.slice(0,-1),o=t.slice(-2),i=O()(o,2),f=i[0],s=i[1];if(n[n.length-2]=s,a[a.length-1]=s,f<=s)return Le(r);var u=e.from(r.data);r=void 0;for(var l=new Int32Array(u.length/f),c=new e(u.length/f*s),h=new e(s<<1),d=0,v=0,w=0;d<u.length;d+=f*s,v+=s*s,w+=s){for(var p=0;p<s;p++)l[w+p]=p;for(var m=0;m<f;m++)Fe(h,u,d+s*m,0);for(var g=0;g<s;g++){for(var y=-1,b=-1/0,x=g;x<s;x++){var E=Je(h,x);b<E&&(y=x,b=E)}if(y!==g){for(var _=0;_<f;_++){var A=d+s*_+g,M=d+s*_+y,q=u[A];u[A]=u[M],u[M]=q}var N=l[w+g];l[w+g]=l[w+y],l[w+y]=N}if(h.fill(0,g<<1),0===b)break;for(var P=d+s*g+g,S=g;++S<f;){var I=d+s*S+g,j=u[I];if(0!==j){var F=gr(u[P],j),J=O()(F,3),T=J[0],L=J[1],R=J[2];0!==L&&(T<0&&(T*=-1,L*=-1,R*=-1),yr(u,s-1-g,P+1,I+1,T,L),u[P]=R),u[I]=L}Fe(h,u,d+s*S,g+1)}u[P]=(u[P]<0||Object.is(u[P],-0)?-1:1)*b}for(var U=0;U<s;U++)for(var Y=c[v+s*U+U],D=Y<0||Object.is(Y,-0)?-1:1,z=U;z<s;z++)c[v+s*U+z]=u[d+s*U+z]*D,u[d+s*U+z]=D*(U===z);for(var Q=s;Q-- >0;)for(var C=f;--C>Q;){var B=u[d+s*C+Q];if(0!==B)u[d+s*C+Q]=0,yr(u,s-Q,d+s*C+Q,d+s*Q+Q,Math.sqrt((1-B)*(1+B)),B)}}return[new V(t,u),new V(n,c),new V(a,l)]}function Ue(r){var e=(r=G(r)).shape.slice(-2),t=O()(e,2),n=t[0],a=t[1],o=r.shape.slice(0,-2);r=r.data;for(var i=new k.int32(r.length/n/a),f=new k["float32"===r.dtype?"float32":"float64"](Math.min(n,a)),s=0,u=0;s<i.length;s++,u+=n*a)i[s]=Te(n,a,r,u,f);return new V(o,i)}function Ye(r,e,t,n){r=G(r),e=G(e);var a=r.shape[r.ndim-2];if(a!==e.shape[e.ndim-1])throw new Error("rrqr_solve(Q,R,P, y): Q @ R not square.");for(var o=De(r,e,t,n),i=new k["float32"===e.dtype?"float32":"float64"](a),f=0;f<e.data.length;f+=a*a){if(Te(a,a,e.data,f,i)<a)throw new we(o)}return o}function De(r,e,t,n){if(null==n){var a,o;if(null!=t)throw new Error("rrqr_lstsq(Q,R,P, y): Either 2 ([Q,R,P], y) or 4 arguments (Q,R,P, y) expected.");n=e((a=r,o=O()(a,3),r=o[0],e=o[1],t=o[2],a))}if((r=G(r)).ndim<2)throw new Error("rrqr_lstsq(Q,R,P, y): Q.ndim must be at least 2.");if((e=G(e)).ndim<2)throw new Error("rrqr_lstsq(Q,R,P, y): R.ndim must be at least 2.");if((t=G(t)).ndim<1)throw new Error("rrqr_lstsq(Q,R,P, y): P.ndim must be at least 1.");if((n=G(n)).ndim<2)throw new Error("rrqr_lstsq(Q,R,P, y): y.ndim must be at least 2.");if("int32"!==t.dtype)throw new Error('rrqr_lstsq(Q,R,P, y): P.dtype must be "int32".');var i=r.shape.slice(-2),f=O()(i,2),s=f[0],u=f[1],l=e.shape.slice(-1),c=O()(l,1)[0],h=n.shape.slice(-1),d=O()(h,1)[0];if(s!=n.shape[n.ndim-2])throw new Error("rrqr_lstsq(Q,R,P,y): Q and y don't match.");if(u!=e.shape[e.ndim-2])throw new Error("rrqr_lstsq(Q,R,P,y): Q and R don't match.");if(c!=t.shape[t.ndim-1])throw new Error("rrqr_lstsq(Q,R,P,y): R and P don't match.");var v=Math.max(r.ndim,e.ndim,t.ndim+1,n.ndim),w=Int32Array.from({length:v},(function(){return 1}));w[v-2]=c,w[v-1]=d;for(var p=0,m=[r,e,n];p<m.length;p++)for(var g=m[p],y=v-2,b=g.ndim-2;y-- >0&&b-- >0;)if(1===w[y])w[y]=g.shape[b];else if(w[y]!=g.shape[b]&&1!=g.shape[b])throw new Error("rrqr_lstsq(Q,R,P,y): Q,R,P,y not broadcast-compatible.");for(var x=v-2,E=t.ndim-1;x-- >0&&E-- >0;)if(1===w[x])w[x]=t.shape[E];else if(w[x]!=t.shape[E]&&1!=t.shape[E])throw new Error("rrqr_lstsq(Q,R,P,y): Q,R,P,y not broadcast-compatible.");var _=k[[r,e,n].every((function(r){return"float32"===r.dtype}))?"float32":"float64"],A=new _(Math.min(u,c)),M=new Int32Array(c),q=new _(w.reduce((function(r,e){return r*e}),1)),N=r.data,P=e.data,S=t.data,I=n.data,j=0,F=1,J=0,T=1,L=0,R=1,U=0,Y=1,D=0;return function a(o){if(o===v-2){F=s*u,T=u*c,R=c,Y=s*d;for(var i=Te(u,c,P,J,A),f=0;f<s;f++)for(var l=0;l<i;l++)for(var h=0;h<d;h++)q[D+l*d+h]+=N[j+f*u+l]*I[U+f*d+h];Or(i,c,d,P,J,q,D);for(var p=c;p-- >0;)M[p]=S[L+p];for(var m=c;m-- >0;)for(var g=void 0;(g=M[m])!==m;){if(M[g]===g)throw new Error("rrqr_lstsq(Q,R,P,y): Invalid indices in P.");M[m]=M[g],M[g]=g;for(var y=d;y-- >0;){var b=q[D+d*m+y];q[D+d*m+y]=q[D+d*g+y],q[D+d*g+y]=b}}return j+=F,J+=T,L+=R,U+=Y,void(D+=c*d)}for(var x=w[o];a(o+1),1!=x;x--)r.shape[o-v+r.ndim]>1||(j-=F),e.shape[o-v+e.ndim]>1||(J-=T),t.shape[o-v+1+t.ndim]>1||(L-=R),n.shape[o-v+n.ndim]>1||(U-=Y);F*=r.shape[o-v+r.ndim]||1,T*=e.shape[o-v+e.ndim]||1,R*=t.shape[o-v+1+t.ndim]||1,Y*=n.shape[o-v+n.ndim]||1}(0),new V(w,q)}function ze(r,e,t,n){t|=0,n<<=1;for(var a=0;a<n;a+=2){var o=Math.abs(e[t+(a>>>1)]);if(0!==o){if(r[a]<o){var i=r[a]/o;r[a+1]*=i*i,r[a]=o}o/=r[a],r[a+1]+=o*o}}}function Qe(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((r=G(r)).ndim<2)throw new Error("srrqr_decomp_full(A,opt): A must be at least 2D.");if(r.dtype.startsWith("complex"))throw new Error("srrqr_decomp_full(A,opt): Complex A not (yet) supported.");var t="float32"===r.dtype?"float32":"float64",n=k[t],a=r.shape,o=Int32Array.from(a),i=o.slice(0,-1),f=a.slice(0,-2),s=a.slice(-2),u=O()(s,2),l=u[0],c=u[1],h=Math.min(l,c);o[o.length-1]=l,i[i.length-1]=c;var d=n.from(r.data);r=void 0;for(var v=new Int32Array(d.length/c/l),w=new Int32Array(d.length/l),p=new n(d.length/c*l),m=new n(l*c),g=new n(l*c),y=new n(c<<1),b=new xr,x=v.length;x-- >0;)v[x]=1024*Math.random()-1024;var E=NaN,_=NaN,A=!1,q=0,N=0,P=0,S=0,I=0,j=0,F=function(){var r=e,n=r.dtol,a=void 0===n?1.01:n,o=r.ztol,i=void 0===o?void 0:o;if(a instanceof V)throw new Error("srrqr_decomp_full(A,opt): NDArray as opt.dtol not yet supported.");if(!(a>=1))throw new Error("srrqr_decomp_full(A,opt): Invalid opt.dtol: ".concat(a,". Must be >=1."));var f=Number(a);if(a=function(){return f},i instanceof V)throw new Error("srrqr_decomp_full(A,opt): NDArray as opt.ztol not yet supported.");if(null==i){var s=Math.sqrt(M(t));i=function(r){var e=(r*=l*c)+l*c;for(b.reset();r<e;r++)b.include(d[r]);return s*b.result*Math.max(l,c)}}else{if(!(i>=0))throw new Error("srrqr_decomp_full(A,opt): invalid opt.ztol: ".concat(i,". Must be non-negative number."));var u=Number(i);i=function(){return u}}return[a,i]}(),J=O()(F,2),T=J[0],L=J[1];e=void 0;for(var R=function(r,e){var t=-d[N+c*e+e];r[e+e*l]=-1/t;for(var n=e;n-- >0;)r[n+e*l]/=t;for(var a=e;++a<c;)for(var o=0;o<=e;o++)r[o+a*l]+=r[o+e*l]*d[N+c*e+a]},U=function(r,e){for(var t=c;--t>e;){r[e+t*l]=0;for(var n=e;n-- >0;)r[n+t*l]-=r[n+e*l]*d[N+c*e+t]}r[e+e*l]=0;for(var a=-d[N+c*e+e],o=e;o-- >0;)r[o+e*l]*=a},Y=function(r){for(var e=0;e<l;e++){var t=d[N+c*e+I];d[N+c*e+I]=d[N+c*e+r],d[N+c*e+r]=t}for(var n=0;n<I;n++){var a=g[n+I*l];g[n+I*l]=g[n+r*l],g[n+r*l]=a}for(var o=0;o<I;o++){var i=m[o+I*l];m[o+I*l]=m[o+r*l],m[o+r*l]=i}var f=w[P+I];w[P+I]=w[P+r],w[P+r]=f,y.fill(0);for(var s=I;++s<l;){var u=N+c*I+I,h=N+c*s+I,v=d[h];if(0!==v){var b=gr(d[u],v),x=O()(b,3),E=x[0],_=x[1],k=x[2];d[h]=0,0!==_&&(d[u]=k,yr(d,c-1-I,u+1,h+1,E,_),yr(p,A?l:s+1,q+l*I,q+l*s,E,_))}Fe(y,d,N+c*s,I+1)}},D=function(){for(var r=-1,e=-1/0,t=I;t<c;t++){var n=Je(y,t);e<n&&(r=t,e=n)}Y(r)},z=function(r,e){for(var t=0;t<c;t++)for(var n=0;n<I;n++)e[n+t*l]=r[n+t*l]},Q=function(r,e,t){for(var n=e;n<c;n++){var a=r[e+n*l];if(n<t){for(var o=e;o<n;o++)r[o+n*l]=r[o+1+n*l];r[n+n*l]=0}else for(var i=e;i<t;i++)r[i+n*l]=r[i+1+n*l];r[t+n*l]=a}},C=function(){y.fill(0);for(var r=I;r<l;r++)Fe(y,d,N+c*r,I)},B=function(){b.reset();for(var r=I;r<c;r++)b.include(Je(y,r));return b.result},X=function(r){r?(D(),R(m,I++),z(m,g),S=I):(z(g,m),I=S,C());for(var e=S+j>>>1;I<e;){if(B()<=E){if(j=I,S<I){z(g,m),I=S,C(),e=S+j>>>1,r=!1;continue}break}r&&D(),R(m,I++),r||C()}},W=0;q<p.length;q+=l*l,N+=l*c,P+=c,W+=1){b.reset();for(var H=l*c;H-- >0;)b.include(d[N+H]);var K=0===b.max?1:b.result;if(!isFinite(K))throw new Error("Assertion failed: "+K);if(!(0<K))throw new Error("Assertion failed: "+K);if(1!==K)for(var Z=l*c;Z-- >0;)d[N+Z]/=K;for(var $=0;$<c;$++)w[P+$]=$;for(var rr=0;rr<l;rr++)p[q+l*rr+rr]=1;if(g.fill(0),m.fill(0),_=T(W),E=L(W),!isFinite(_))throw new Error("Assertion failed. Invalid dtol: ".concat(_,"."));if(!isFinite(E))throw new Error("Assertion failed. Invalid ztol: ".concat(E,"."));if(!(1<=_))throw new Error("Assertion failed. Invalid dtol: ".concat(_,"."));if(!(0<=E))throw new Error("Assertion failed. Invalid ztol: ".concat(E,"."));S=I=0,j=h,A=!1,C();r:for(;;){if(B()<=E)if(j=I,S<I)X(!1);else if(I===c)break r;for(var er=-1,tr=-1,nr=-1/0,ar=0;ar<I;ar++)ze(y,m,ar*l,ar+1);for(var or=0;or<I;or++)for(var ir=Je(y,or),fr=I;fr<c;fr++){var sr=Je(y,fr),ur=Math.hypot(m[or+fr*l],ir*sr);nr<ur&&(nr=ur,er=or,tr=fr)}if(nr>_){if(A=!0,er<S){--S;for(var lr=0;lr<=S;lr++){for(var cr=d[N+c*lr+er],hr=Math.max(er,lr-1);hr<S;hr++)d[N+c*lr+hr]=d[N+c*lr+(hr+1)];d[N+c*lr+S]=cr}Q(m,er,S),Q(g,er,S);for(var dr=w[P+er],vr=er;vr<S;vr++)w[P+vr]=w[P+vr+1];w[P+S]=dr;for(var wr=er;wr<S;wr++){var pr=N+c*wr+wr,mr=N+c*(wr+1)+wr,br=d[mr];if(0!==br){var Er=d[pr],Ar=gr(Er,br),kr=O()(Ar,3),Mr=kr[0],qr=kr[1],Nr=kr[2];d[mr]=0,0!==qr&&(d[pr]=Nr,yr(d,c-1-wr,pr+1,mr+1,Mr,qr),yr(p,l,q+l*wr,q+l*(wr+1),Mr,qr),yr(m,wr+1,l*wr,l*(wr+1),Mr,qr),m[S+(wr+1)*l]=-qr*m[S+wr*l]+Mr*m[S+(wr+1)*l],yr(g,wr+1,l*wr,l*(wr+1),Mr,qr),g[S+(wr+1)*l]=-qr*g[S+wr*l]+Mr*g[S+(wr+1)*l])}m[S+wr*l]=0,g[S+wr*l]=0}U(g,S),er=S++}--I;for(var Pr=0;Pr<=I;Pr++){for(var Sr=d[N+c*Pr+er],Ir=Math.max(er,Pr-1);Ir<I;Ir++)d[N+c*Pr+Ir]=d[N+c*Pr+(Ir+1)];d[N+c*Pr+I]=Sr}Q(m,er,I);for(var jr=0;jr<S;jr++)y[jr]=g[jr+er*l];for(var Or=er;Or<I;Or++)for(var Fr=0;Fr<S;Fr++)g[Fr+Or*l]=g[Fr+(Or+1)*l];for(var Jr=0;Jr<S;Jr++)g[Jr+I*l]=y[Jr];for(var Tr=w[P+er],Lr=er;Lr<I;Lr++)w[P+Lr]=w[P+Lr+1];w[P+I]=Tr;for(var Rr=er;Rr<I;Rr++){var Ur=N+c*Rr+Rr,Yr=N+c*(Rr+1)+Rr,Dr=d[Yr];if(0!==Dr){var zr=d[Ur],Qr=gr(zr,Dr),Gr=O()(Qr,3),Cr=Gr[0],Vr=Gr[1],Br=Gr[2];d[Yr]=0,0!==Vr&&(d[Ur]=Br,yr(d,c-1-Rr,Ur+1,Yr+1,Cr,Vr),yr(p,l,q+l*Rr,q+l*(Rr+1),Cr,Vr),yr(m,Rr+1,l*Rr,l*(Rr+1),Cr,Vr),m[I+(Rr+1)*l]=-Vr*m[I+Rr*l]+Cr*m[I+(Rr+1)*l])}m[I+Rr*l]=0}U(m,I),Y(tr),er<S&&R(g,er),R(m,I++)}else{if(S>=j)break r;X(!0)}}if(1!==K)for(var Xr=l*c;Xr-- >0;)d[N+Xr]*=K;v[W]=I,_r(l,p,q)}return[new V(o,p),new V(a,d),new V(i,w),new V(f,v)]}function Ge(r,e){var t=Re(r),n=O()(t,3);return Ye(n[0],n[1],n[2],e)}function Ce(r){if((r=G(r)).dtype.startsWith("complex"))throw new Error("svd_jac_1sided(A): A.dtype must be float.");var e=r.shape,t=0|e[e.length-2],n=e[e.length-1];if(t>n){var a=Yr(r),o=O()(a,2),i=o[0],f=Ce(o[1]),s=O()(f,3),u=s[0],l=s[1],c=s[2];return[ne(i,u),l,c]}if(t<n){var h=Yr(r.T),d=O()(h,2),v=d[0],w=Ce(d[1]),p=O()(w,3),m=p[0],g=p[1],y=p[2];return Ar(y),[y,g,ne(v,m).T]}var b="float32"===r.dtype?"float32":"float64",x=k[b],E=Math.pow(t*M(b),2),_="float32"===b?16:8,A=x.from(r.data);r=void 0;var q=new x(t*t),N=new x(A.length),P=new x(A.length/t),S=Int32Array.from({length:t},(function(r,e){return e}));if(1>t)throw new Error("Assertion failed.");if(1==t){for(var I=A.length;I-- >0;)A[I]<0?(A[I]*=-1,P[I]=-1):P[I]=1;return[new V(e,P),new V(e.slice(0,-1),A),new V(e,N.fill(1))]}for(var j=0,F=0;F<P.length;j+=t*t,F+=t){for(var J=0;J<t;J++)for(var T=0;T<t;T++)q[t*J+T]=A[j+t*J+T],A[j+t*J+T]=+(J===T);for(var L=0;L<t;L++)for(var R=0;R<t;R++)N[j+t*L+R]=+(L===R);for(var U=!1;!U;){U=!0;for(var Y=0;Y<t;Y+=_)for(var D=0;D<=Y;D+=_)for(var z=Y;z<Y+_&&z<t;z++)for(var Q=D;Q<D+_&&Q<z;Q++){var C=q[t*Q+Q],B=q[t*Q+z],X=q[t*z+Q],W=q[t*z+z];if(B*B+X*X>Math.abs(C*W)*E){U=!1;var H=pe(C,B,X,W),K=O()(H,4),Z=K[0],$=K[1],rr=K[2],er=K[3];yr(q,t,t*Q,t*z,Z,$),br(q,t,Q,z,rr,er),q[t*Q+z]=q[t*z+Q]=0,yr(A,t,j+t*Q,j+t*z,Z,$),yr(N,t,j+t*Q,j+t*z,rr,-er)}}}me(t,A,q,N,j,P,F,S)}return[new V(e,A),new V(e.slice(0,-1),P),new V(e,N)]}function Ve(r){if((r=G(r)).dtype.startsWith("complex"))throw new Error("svd_jac_1sided(A): A.dtype must be float.");var e=r.shape,t=0|e[e.length-2],n=e[e.length-1];if(t>n){var a=Yr(r),o=O()(a,2),i=o[0],f=Ve(o[1]),s=O()(f,3),u=s[0],l=s[1],c=s[2];return[ne(i,u),l,c]}if(t<n){var h=Yr(r.T),d=O()(h,2),v=d[0],w=Ve(d[1]),p=O()(w,3),m=p[0],g=p[1],y=p[2];return Ar(y),[y,g,ne(v,m).T]}var b="float32"===r.dtype?"float32":"float64",x=k[b],E=Math.pow(t*M(b),2),_=0|Math.ceil(t/4),A=x.from(r.data);r=void 0;var q=new x(_*_*4*4),N=new x(A.length),P=new x(A.length/t),S=Int32Array.from({length:t},(function(r,e){return e}));if(1>t)throw new Error("Assertion failed.");if(1==t){for(var I=A.length;I-- >0;)A[I]<0?(A[I]*=-1,P[I]=-1):P[I]=1;return[new V(e,P),new V(e.slice(0,-1),A),new V(e,N.fill(1))]}for(var j=0,F=0;F<P.length;j+=t*t,F+=t){for(var J=0;J<t;J++)for(var T=0;T<t;T++){q[16*(_*(J/4|0)+(T/4|0))+J%4*4+T%4|0]=A[j+t*J+T],A[j+t*J+T]=+(J===T)}for(var L=0;L<t;L++)for(var R=0;R<t;R++)N[j+t*L+R]=+(L===R);for(var U=!1;!U;){U=!0;for(var Y=_;Y-- >0;)for(var D=Y;D>=0;D--)for(var z=4;z-- >0;)for(var Q=D===Y?z:4;Q-- >0;){var C=q[16*(_*D+D)+4*Q+Q],B=q[16*(_*D+Y)+4*Q+z],X=q[16*(_*Y+D)+4*z+Q],W=q[16*(_*Y+Y)+4*z+z];if(B*B+X*X>Math.abs(C*W)*E){U=!1;for(var H=pe(C,B,X,W),K=O()(H,4),Z=K[0],$=K[1],rr=K[2],er=K[3],tr=D*_*16+4*Q,nr=Y*_*16+4*z,ar=tr+16*_;tr<ar;tr+=16,nr+=16)for(var or=0;or<4;or++){var ir=Z*q[or+tr]+$*q[or+nr];q[or+nr]=-$*q[or+tr]+Z*q[or+nr],q[or+tr]=ir}for(var fr=16*D+Q+_*_*4*4,sr=16*Y+z+_*_*4*4;(fr-=16*_)>=0;){sr-=16*_;for(var ur=16;(ur-=4)>=0;){var lr=q[fr+ur]*rr+q[sr+ur]*-er;q[sr+ur]=q[fr+ur]*er+q[sr+ur]*rr,q[fr+ur]=lr}}q[16*(_*D+Y)+4*Q+z]=q[16*(_*Y+D)+4*z+Q]=0;var cr=j+t*(4*D+Q),hr=j+t*(4*Y+z);yr(A,t,cr,hr,Z,$),yr(N,t,cr,hr,rr,-er)}}}for(var dr=0;dr<t;dr++){var vr=16*(_+1)*(dr/4|0)+dr%4*5|0;P[F+dr]=q[vr]}ge(t,A,N,j,P,F,S)}return[new V(e,A),new V(e.slice(0,-1),P),new V(e,N)]}function Be(r){if((r=G(r)).dtype.startsWith("complex"))throw new Error("svd_jac_1sided(A): A.dtype must be float.");var e=r.shape,t=e[e.length-2],n=e[e.length-1];if(t>n){var a=Yr(r),o=O()(a,2),i=o[0],f=Be(o[1]),s=O()(f,3),u=s[0],l=s[1],c=s[2];return[ne(i,u),l,c]}if(t<n){var h=Yr(r.T),d=O()(h,2),v=d[0],w=Be(d[1]),p=O()(w,3),m=p[0],g=p[1],b=p[2];return Ar(b),[b,g,ne(v,m).T]}var x="float32"===r.dtype?"float32":"float64",E=k[x],_=M(x)*t,A=E.from(r.data);r=void 0;var q=new E(t*t),N=new E(A.length),P=new E(A.length/t),S=(new E(t),Int32Array.from({length:t},(function(r,e){return e})));if(1>t)throw new Error("Assertion failed.");if(1===t){for(var I=A.length;I-- >0;)A[I]<0?(A[I]*=-1,P[I]=-1):P[I]=1;return[new V(e,P),new V(e.slice(0,-1),A),new V(e,N.fill(1))]}for(var j=Int32Array.from(y.a.mark((function r(){var e;return y.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e=t;case 1:if(!(e>1)){r.next=7;break}return e=e+1>>>1,r.next=5,e;case 5:r.next=1;break;case 7:case"end":return r.stop()}}),r)}))()),F=new E(j.reduce((function(r,e){return r+(e*e+e>>>1)}),0)),J=function(){for(var r=0,e=0,n=0,a=0,o=function(t,o){var f=function(r,e){return i=t,F[t+((r+=n)*r+r>>>1)+(e+=a)]},s=j[o];t-=s*s+s>>>1;var u=f(0,0);if(r=n,e=a,n+1<s){var l=f(1,0);l>u&&(u=l,r=n+1,e=a);var c=f(1,1);c>u&&(u=c,r=n+1,e=a+1)}if(n!=a){var h=f(0,1);h>u&&(u=h,r=n,e=a+1)}n=2*r,a=2*e,i=t},i=F.length,f=j.length;f-- >0;)o(i,f);var s=-1/0,u=function(r,e){var o=q[t*(r+=n)+(e+=a)],i=q[t*e+r];return o*o+i*i};if(n+1<t){var l=u(1,0);l>s&&(s=l,r=n+1,e=a)}if(a+1<t){var c=u(0,1);c>s&&(s=c,r=n,e=a+1)}if(n!=a){var h=u(0,0);if(h>s&&(s=h,r=n,e=a),n+1<t)u(1,1)>s&&(r=n+1,e=a+1)}return[e,r]},T=function(r){for(var e=r=r>>>1<<1;e<r+2&&e<t;e++)for(var n=e>>>1,a=n*n+n>>>1,o=0;o<r+1;o++){var i=q[t*e+o],f=q[t*o+e],s=e===o?-1/0:i*i+f*f,u=a+(o>>>1);F[u]=e%2||o%2?Math.max(F[u],s):s}for(var l=0,c=1;c<j.length;c++){var h=j[c-1],d=l;l+=h*h+h>>>1;for(var v=r=r>>>2<<1;v<r+2&&v<h;v++)for(var w=d+(v*v+v>>>1),p=v>>>1,m=l+(p*p+p>>>1),g=0;g<=v;g++){var y=m+(g>>>1),b=F[w+g];F[y]=v%2||g%2?Math.max(F[y],b):b}}},L=function(r){r=r>>>1<<1;for(var e=Math.min(r+2,t),n=r;n<t;n++)for(var a=n>>>1,o=a*a+a>>>1,i=r;i<e;i++){var f=q[t*n+i],s=q[t*i+n],u=n===i?-1/0:f*f+s*s,l=o+(i>>>1);F[l]=n%2||i%2?Math.max(F[l],u):u}for(var c=0,h=1;h<j.length;h++){r=r>>>2<<1;var d=j[h-1],v=Math.min(r+2,d),w=c;c+=d*d+d>>>1;for(var p=r;p<d;p++)for(var m=w+(p*p+p>>>1),g=p>>>1,y=c+(g*g+g>>>1),b=r;b<v&&b<=p;b++){var x=y+(b>>>1),E=F[m+b];F[x]=p%2||b%2?Math.max(F[x],E):E}}},R=0,U=0;U<P.length;R+=t*t,U+=t){for(var Y=0;Y<t;Y++)for(var D=0;D<t;D++)q[t*Y+D]=A[R+t*Y+D],A[R+t*Y+D]=+(Y===D);for(var z=0;z<t;z++)for(var Q=0;Q<t;Q++)N[R+t*z+Q]=+(z===Q);for(var C=0;C<t;C+=2)T(C);for(var B=-1,X=-1;;){var W=J(),H=O()(W,2),K=H[0],Z=H[1];if(K>=Z)throw new Error("Assertion failed.");if(B==Z&&X==K)break;B=Z,X=K;var $=q[t*Z+Z],rr=q[t*Z+K],er=q[t*K+Z],tr=q[t*K+K];if(!(Math.max(Math.abs(rr),Math.abs(er))>Math.sqrt(Math.abs($*tr))*_))break;var nr=pe(tr,er,rr,$),ar=O()(nr,4),or=ar[0],ir=ar[1],fr=ar[2],sr=ar[3];yr(q,t,t*K,t*Z,or,ir),br(q,t,K,Z,fr,sr),q[t*Z+K]=0,q[t*K+Z]=0,T(Z),T(K),L(Z),L(K),yr(A,t,R+t*K,R+t*Z,or,ir),yr(N,t,R+t*K,R+t*Z,fr,-sr)}me(t,A,q,N,R,P,U,S)}return[new V(e,A),new V(e.slice(0,-1),P),new V(e,N)]}function Xe(r,e,t,n,a,o,i,f){if(0!=r%1)throw new Error("Assertion failed.");if(0!=e%1)throw new Error("Assertion failed.");if(0!=n%1)throw new Error("Assertion failed.");if(0!=o%1)throw new Error("Assertion failed.");for(var s=e;s-- >0;)for(var u=e;u-- >0;)if(0!==a[o+e*s+u])throw new Error("Assertion failed.");if(n|=0,o|=0,!((r|=0)<=(e|=0)))throw new Error("Assertion failed.");if(r===e)for(var l=e;l-- >0;){a[o+e*l+i[f+l]]=1}else{for(var c=e;c-- >0;)a[o+e*c+c]=1;for(var h=r;h-- >0;)for(var d=r;d<e;d++){var v=n+e*h+d,w=t[v];if(0!==w){var p=n+e*h+h,m=gr(t[p],w),g=O()(m,3),y=g[0],b=g[1],x=g[2];if(0!==b){for(var E=h;E-- >0;){var _=n+e*E+h,A=t[_],k=n+e*E+d,M=t[k];t[_]=M*b+A*y,t[k]=M*y-A*b}yr(a,1+d-h,o+e*h+h,o+e*d+h,y,b),t[p]=x}t[v]=0}}for(var q=0;q<e;++q)for(;;){var N=i[f+q];if(i[f+q]=i[f+N],i[f+N]=N,N<=q)break;for(var P=e;P-- >0;){var S=a[o+e*P+q];a[o+e*P+q]=a[o+e*P+N],a[o+e*P+N]=S}}}}function We(r){var e=Qe(r),t=O()(e,4),n=t[0],a=t[1],o=t[2],i=t[3];r=void 0;var f=a.shape.slice(-2),s=O()(f,2),u=s[0],l=s[1],c=a.shape.slice();c[c.length-2]=l,o=o.data;for(var h=i.data,d=a.data,v=new k[a.dtype](d.length/u*l),w=0,p=0,m=0,g=0;g<h.length;w+=u*l,p+=l*l,m+=l,g+=1){var y=h[g];if(y<l)for(var b=y;b<u;b++)for(var x=y;x<l;x++)d[w+l*b+x]=0;Xe(y,l,d,w,v,p,o,m)}return[n,a,new V(c,v),i]}function He(r,e,t,n,a){if(null==a){if(null!=n||null!=t)throw new Error("urv_lstsq( U,R,V,ranks, Y ): Either 2 ([U,R,V,ranks], Y) or 5 arguments (U,R,V,ranks, Y) expected.");a=e;var o=r,i=O()(o,4);r=i[0],e=i[1],t=i[2],n=i[3]}if(!((r=G(r)).ndim>=2))throw new Error("urv_lstsq(U,R,V, Y): U.ndim must be at least 2.");if(!((e=G(e)).ndim>=2))throw new Error("urv_lstsq(U,R,V, Y): R.ndim must be at least 2.");if(!((t=G(t)).ndim>=2))throw new Error("urv_lstsq(U,R,V, Y): V.ndim must be at least 2.");if(!((a=G(a)).ndim>=2))throw new Error("urv_lstsq(U,R,V, Y): Y.ndim must be at least 2.");n=G(n);var f=r.shape,s=e.shape,u=t.shape,l=a.shape,c=n.shape,h=[r,e,t,a].every((function(r){return"float32"===r.dtype}))?"float32":"float64",d=k[h],v=[r,e,t,a].reduce((function(r,e){var t=e.ndim;return Math.max(r,t)}),n.ndim+2),w=new Int32Array(v);w.fill(1);for(var p=0,m=[r,e,t,a];p<m.length;p++)for(var g=m[p],y=v-2,b=g.ndim-2;y-- >0&&b-- >0;)if(1===w[y])w[y]=g.shape[b];else if(w[y]!=g.shape[b]&&1!=g.shape[b])throw new Error("urv_lstsq( U,R,V,ranks, Y ): U,R,V,ranks, Y not broadcast-compatible.");for(var x=v-2,E=n.ndim;x-- >0&&E-- >0;)if(1===w[x])w[x]=n.shape[E];else if(w[x]!=n.shape[E]&&1!=n.shape[E])throw new Error("urv_lstsq( U,R,V,ranks, Y ): U,R,V,ranks, Y not broadcast-compatible.");var _=r.shape.slice(-2),A=O()(_,2),M=A[0],q=A[1],N=t.shape.slice(-2),P=O()(N,2),S=P[0],I=P[1],j=a.shape[a.ndim-1];if(e.shape[e.ndim-2]!==q)throw new Error("urv_lstsq( U,R,V,ranks, Y ): Matrix dimensions incompatible.");if(e.shape[e.ndim-1]!==S)throw new Error("urv_lstsq( U,R,V,ranks, Y ): Matrix dimensions incompatible.");if(q!==S&&M<I){if(M!==q)throw new Error("Assertion failed.");if(S!==I)throw new Error("Assertion failed.")}if(!(M>=q))throw new Error("Assertion failed.");if(!(S<=I))throw new Error("Assertion failed.");w[v-2]=I,w[v-1]=j,n=n.data,r=r.data,e=e.data,t=t.data,a=a.data;var F=new d(w.reduce((function(r,e){return r*e}))),J=new d(M*j),T=r.length,L=1,R=e.length,U=1,Y=t.length,D=1,z=a.length,Q=1,C=n.length,B=1,X=F.length;return function o(i){if(i===v-2){T-=L=M*q,R-=U=q*S,Y-=D=S*I,z-=Q=M*j,X-=I*j,function(r,e,t,n,a,o,i,f,s,u,l,c,h,d,v,w,p){if(r%1!=0)throw new Error("Assertion failed.");if(e%1!=0)throw new Error("Assertion failed.");if(t%1!=0)throw new Error("Assertion failed.");if(n%1!=0)throw new Error("Assertion failed.");if(a%1!=0)throw new Error("Assertion failed.");if(o%1!=0)throw new Error("Assertion failed.");if(f%1!=0)throw new Error("Assertion failed.");if(u%1!=0)throw new Error("Assertion failed.");if(c%1!=0)throw new Error("Assertion failed.");if(d%1!=0)throw new Error("Assertion failed.");if(w%1!=0)throw new Error("Assertion failed.");if(p.length<e*o)throw new Error("Assertion failed.");p.fill(0,0,e*o);for(var m=0;m<e;m++)for(var g=0;g<r;g++)for(var y=0;y<o;y++)p[o*g+y]+=i[f+t*m+g]*v[w+o*m+y];Or(r,n,o,s,u,p,0);for(var b=0;b<r;b++)for(var x=0;x<a;x++)for(var E=0;E<o;E++)h[d+o*x+E]+=l[c+a*b+x]*p[o*b+E]}(n[C-=B=1],M,q,S,I,j,r,T,e,R,t,Y,F,X,a,z,J)}else{for(var h=w[i];o(i+1),1!=h;h--)f[i-v+f.length]>1||(T+=L),s[i-v+s.length]>1||(R+=U),u[i-v+u.length]>1||(Y+=D),l[i-v+l.length]>1||(z+=Q),c[i-v+2+c.length]>1||(C+=B);L*=f[i-v+f.length]||1,U*=s[i-v+s.length]||1,D*=u[i-v+u.length]||1,Q*=l[i-v+l.length]||1,B*=c[i-v+2+c.length]||1}}(0),new V(w,F)}function Ke(r,e,t,n,a){if(r*=1,!isFinite(r))throw new Error("Assertion failed.");if(e*=1,!isFinite(e))throw new Error("Assertion failed.");if(t*=1,!isFinite(t))throw new Error("Assertion failed.");if(n*=1,!isFinite(n))throw new Error("Assertion failed.");if(a*=1,!isFinite(a))throw new Error("Assertion failed.");if(r===e)throw new Error("Assertion failed.");var o=(n-t)/(e-r),i=-a/2,f=(r*(o+i)+e*i)/(o-a);if(!(0<=Math.sign(a)*Math.sign(r-f)))throw new Error("Assertion failed.");return f}var Ze=function(r){function e(){return l()(this,e),J()(this,ve()(e).apply(this,arguments))}return L()(e,r),e}(Y()(Error)),$e=function(r){function e(){return l()(this,e),J()(this,ve()(e).apply(this,arguments))}return L()(e,r),e}(Ze),rt=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=r.c1,t=void 0===e?.01:e,n=r.c2,a=void 0===n?.9:n,o=r.c3,i=void 0===o?2:o,f=r.minRed,s=void 0===f?.2:f;if(a*=1,i*=1,s*=1,!((t*=1)>0))throw new Error("strong_wolfe(opt): opt.c1 must be positive.");if(!(t<a))throw new Error("strong_wolfe(opt): opt.c1 must less than opt.c2.");if(!(1>a))throw new Error("strong_wolfe(opt): opt.c2 must less than 1.");if(!(1<i))throw new Error("strong_wolfe(opt): opt.c3 must larger than 1.");if(!(s>=0))throw new Error("Assertion failed.");if(!(s<=.5))throw new Error("Assertion failed.");var u=1/s,l=u-1;return function(r){return function(e,n,o,f){if(e=G(e),o=G(o),n*=1,!(f instanceof V))throw new Error("Assertion failed.");var s=f.shape;if(1!==e.ndim)throw new Error("strong_wolfe()(fg)(X0,f0,G0): X0.ndim must be 1.");if(1!==o.ndim)throw new Error("strong_wolfe()(fg)(X0,f0,G0): G0.ndim must be 1.");if(1!==f.ndim)throw new Error("strong_wolfe()(fg)(X0,f0,G0): negDir.ndim must be 1.");if(e.shape[0]!==s[0])throw new Error("strong_wolfe()(fg)(X0,f0,G0): negDir and X0 must have the same shape.");if(o.shape[0]!==s[0])throw new Error("strong_wolfe()(fg)(X0,f0,G0): negDir and G0 must have the same shape.");if(isNaN(n))throw new Error("strong_wolfe()(fg)(X0,f0,G0): f0 is NaN.");[e,o].every((function(r){return"float32"===r.dtype}));var c=function(e){var t=r(e),n=O()(t,2),a=n[0],o=n[1];if(a*=1,o=G(o),isNaN(a))throw new Error("strong_wolfe()(fg)(X0,f0,G0): fg returned NaN.");if(1!==o.ndim)throw new Error("strong_wolfe()(fg)(X0,f0,G0): fg returned gradient with invalid shape.");if(o.shape[0]!==s[0])throw new Error("strong_wolfe()(fg)(X0,f0,G0): fg returned gradient with invalid shape.");return[a,o]};f=f.data;var h=function(r){for(var e=0,t=f.length;t-- >0;)e-=f[t]*r.data[t];return e},d=h(o);if(d>=0)throw new Error("strong_wolfe: Initial projected gradient not negative.");var v=0,w=1,p=n,m=d,g=1/0,y=NaN;r:for(;;){var b=new V(s,e.data.map((function(r,e){return r-w*f[e]}))),x=c(b),E=O()(x,2),_=E[0],A=E[1],k=h(A);if(_-n>t*w*d||0<v&&_>=p){g=w,y=_;break r}if(Math.abs(k)<=-a*d)return[b,_,A];if(k>=0){g=v,y=p,v=w,p=_,m=k;break r}if(!(w<g))throw new Ze("strong_wolfe: Strong Wolfe condition not satisfiable in range.");v=w,w*=i,p=_,m=k}if(v===g)throw new Ze("strong_wolfe: bracketing failed.");for(var M=function(){if(0===v)throw new $e("strongWolfeLineSearch(): no progress.");throw new Ze("strong_wolfe: bisection failed ".concat(JSON.stringify({"αMin":v,"α":w,"αMax":g}),"."))},q=1;;q++){if(2===u)w=(v+g)/2;else{w=Ke(v,g,p,y,m);var N=(g+l*v)/u,P=(v+l*g)/u;N<=w?P>=w||(w=P):w=N}var S=new V(s,e.data.map((function(r,e){return r-w*f[e]}))),I=c(S),j=O()(I,2),F=j[0],J=j[1],T=h(J);if(F-n>t*w*d||F>=p)g===w&&M(),g=w,y=F;else{if(Math.abs(T)<=-a*d)return[S,F,J];T*(g-v)>=0&&(g=v,y=p),v===w&&M(),v=w,p=F,m=T}}}}},et=t(10),tt=t.n(et),nt=function(){function r(e,t){if(l()(this,r),e%1!=0)throw new Error("Assertion failed.");if(t%1!=0)throw new Error("Assertion failed.");if(!(0<e))throw new Error("Assertion failed.");if(!(0<t))throw new Error("Assertion failed.");this.M=0|e,this.N=0|t;var n=Math.min(e,t),a=Math.max(n+t,e);this.P=new Int32Array(t),this.Q=new Int32Array(t),this.D=new Float64Array(t),this.R=new Float64Array(n*t),this.S=new Float64Array(n*n),this.T=new Float64Array(a*t),this.V=new Float64Array(t*t),this.F=new Float64Array(1*e),this.Y=new Float64Array(1*a),this.X=new Float64Array(1*t),this.Z=new Float64Array(1*t),this.norm=new Float64Array(2*t),this.G=new Float64Array(t),this.rank=-1,this._state=0,Object.seal(this)}return h()(r,[{key:"scaledNorm",value:function(r){var e=this.N,t=this.D;if(r.length!==e)throw new Error("Assertion failed.");for(var n=new xr,a=e;a-- >0;)n.include(t[a]*r[a]);return n.result}},{key:"cauchyPointTravel",value:function(){if(1!==this._state)throw new Error("TrustRegionSolverLSQ.prototype.cauchyPointTravel(): can only be called directly after update(f,J) call.");for(var r=this.M,e=this.N,t=(this.X,this.F,this.T),n=this.G,a=0,o=0,i=e;i-- >0;)a+=n[i]*n[i];for(var f=r;f-- >0;){for(var s=0,u=e;u-- >0;)s+=t[e*f+u]*n[u];o+=s*s}return 0===a?0:0===o?-1/0:-a/o}},{key:"update",value:function(r,e){this._state=1;var t=this.M,n=this.N,a=this.D,o=this.P,i=(this.Q,this.T),f=this.F,s=this.G,u=this.norm;if(!(r instanceof V))throw new Error("Assertion failed.");if(!(e instanceof V))throw new Error("Assertion failed.");if(1!==r.ndim)throw new Error("Assertion failed.");if(2!==e.ndim)throw new Error("Assertion failed.");if(r.shape[0]!==t)throw new Error("Assertion failed.");if(e.shape[0]!==t)throw new Error("Assertion failed.");if(e.shape[1]!==n)throw new Error("Assertion failed.");r=r.data,e=e.data;for(var l=1*t;l-- >0;)f[l]=r[l];for(var c=t*n;c-- >0;)i[c]=e[c];for(var h=n;h-- >0;)o[h]=h;u.fill(0);for(var d=0;d<t;d++)Fe(u,e,n*d,0);for(var v=0;v<n;v++)a[v]=Math.max(a[v],Je(u,v));s.fill(0);for(var w=t;w-- >0;)for(var p=n;p-- >0;)s[p]+=e[n*w+p]*f[w]}},{key:"computeMinGlobal",value:function(){if(1!==this._state&&2!==this._state&&3!==this._state)throw new Error("TrustRegionSolverLSQ.prototype.computeMinGlobal(): can only be called once after every update(f,J) call.");var r=this.M,e=this.N,t=this.P,n=this.Q,a=this.D,o=this.R,i=this.S,f=this.T,s=this.V,u=this.X,l=this.Z,c=this.F,h=this.Y,d=this.norm;if(1===this._state){var v=Math.min(r,e);!function(r,e,t,n,a,o,i,f,s,u){if(0!=r%1)throw new Error("Assertion failed.");if(0!=e%1)throw new Error("Assertion failed.");if(0!=t%1)throw new Error("Assertion failed.");if(0!=a%1)throw new Error("Assertion failed.");if(0!=i%1)throw new Error("Assertion failed.");if(0!=s%1)throw new Error("Assertion failed.");if(!(0<r))throw new Error("Assertion failed.");if(!(0<e))throw new Error("Assertion failed.");if(!(0<t))throw new Error("Assertion failed.");if(!(0<=a))throw new Error("Assertion failed.");if(!(0<=i))throw new Error("Assertion failed.");if(!(0<=s))throw new Error("Assertion failed.");if(!(r*e<=n.length-a))throw new Error("Assertion failed.");if(!(r*t<=o.length-i))throw new Error("Assertion failed.");if(!(e<=f.length-s))throw new Error("Assertion failed.");if(r|=0,e|=0,t|=0,a|=0,i|=0,s|=0,u.length!==e<<1)throw new Error("Assertion failed.");u.fill(0,0,e<<1);for(var l=0;l<r;l++)Fe(u,n,a+e*l,0);for(var c=Math.min(r,e),h=0;h<c;h++){for(var d=-1,v=-1/0,w=h;w<e;w++){var p=Je(u,w);v<p&&(d=w,v=p)}if(d!==h){for(var m=0;m<r;m++){var g=a+e*m+h,y=a+e*m+d,b=n[g];n[g]=n[y],n[y]=b}var x=f[s+h];f[s+h]=f[s+d],f[s+d]=x}if(u.fill(0,h<<1),0===v)break;for(var E=a+e*h+h,_=h;++_<r;){var A=a+e*_+h,k=n[A];if(0!==k){var M=gr(n[E],k),q=O()(M,3),N=q[0],P=q[1],S=q[2];n[A]=0,0!==P&&(n[E]=S,yr(n,e-1-h,E+1,A+1,N,P),yr(o,t,i+t*h,i+t*_,N,P))}Fe(u,n,a+e*_,h+1)}n[E]=(n[E]<0||Object.is(-0,n[E])?-1:1)*v}}(r,e,1,f,0,c,0,t,0,d);for(var w=v*e;w-- >0;)o[w]=f[w];var p=this.rank=Te(r,e,f,0,d);if(p<e){for(var m=v;m-- >0;)for(var g=e;g-- >0;){var y=a[t[g]];0!==y&&(f[e*m+g]/=y)}for(var b=e;b-- >0;)n[b]=t[b];s.fill(0),Xe(p,e,f,0,s,0,n,0);for(var x=p;x-- >0;)for(var E=p;E-- >0;)i[v*x+E]=f[e*x+E];for(var _=p;_-- >0;)h[_]=-c[_];Or(p,v,1,i,0,h,0),u.fill(0);for(var A=p;A-- >0;)for(var k=e;k-- >0;)u[k]+=s[e*A+k]*h[A];for(var M=e;M-- >0;){var q=a[M];0!==q&&(u[M]/=q)}}else{for(var N=e;N-- >0;)h[N]=-c[N];Or(e,e,1,f,0,h,0);for(var P=e;P-- >0;)u[t[P]]=h[P]}for(var S=e;S-- >0;)l[S]=u[S]}else if(3===this._state)for(var I=e;I-- >0;)u[I]=l[I];this._state=2}},{key:"computeMinRegularized",value:function(r){if(2!==this._state&&3!==this._state)throw new Error("TrustRegionSolverLSQ.prototype.computeMinRegularized(λ): can only be (repeatedly) called after computeMinGlobal().");0!==r&&(this._state=3);var e=this.M,t=this.N,n=this.P,a=this.D,o=this.R,i=this.S,f=this.T,s=this.V,u=this.X,l=this.F,c=this.Y,h=this.rank,d=Math.min(e,t);if(0===r&&h<t){this.computeMinGlobal();var v=this.scaledNorm(u);if(0===v)return[0,0];c.fill(0,0,h);for(var w=h;w-- >0;)for(var p=t;p-- >0;)c[w]+=u[p]*a[p]*s[t*w+p];for(var m=0;m<h;m++){c[m]/=i[d*m+m];for(var g=m;++g<h;)c[g]-=i[d*m+g]*c[m]}for(var y=0,b=h;b-- >0;){var x=c[b];y+=x*x}return[v,y/=-v]}if(!(0<=r))throw new Error("TrustRegionSolverLSQ.prototype.computeMinRegularized(λ): λ must be positive.");for(var E=h;E-- >0;)c[E]=-l[E];c.fill(0,h,h+t);for(var _=h*t;_-- >0;)f[_]=o[_];if(f.fill(0,h*t,(h+t)*t),0!==r){for(var A=Math.sqrt(r),k=t;k-- >0;){var M=a[n[k]];if(0===M?M=1:M*=A,!(0<M))throw new Error("TrustRegionSolverLSQ.prototype.computeMinRegularized(λ): λ too small (caused underflow).");f[h*t+t*((k-h+t)%t)+k]=M}for(var q=0;q<t;q++)for(var N=Math.min(q+1,h)+t,P=t;P<N;P++){var S=t*P+q,I=f[S];if(0!==I){var j=t*q+q,F=gr(f[j],I),J=O()(F,3),T=J[0],L=J[1],R=J[2];f[S]=0,0!==L&&(f[j]=R,yr(f,t-1-q,j+1,S+1,T,L),yr(c,1,q,P,T,L))}}}else if(h!==t)throw new Error("Assertion failed.");if(0===r)this.computeMinGlobal();else{Or(t,t,1,f,0,c,0);for(var U=t;U-- >0;)u[n[U]]=c[U]}var Y=this.scaledNorm(u);if(0===Y)return[0,0];for(var D=t;D-- >0;){var z=n[D];c[D]=u[z]*a[z]*a[z]}for(var Q=0;Q<t;Q++){c[Q]/=f[t*Q+Q];for(var G=Q;++G<t;)c[G]-=f[t*Q+G]*c[Q]}for(var C=0,V=t;V-- >0;){var B=c[V];C+=B*B}return[Y,C/=-Y]}}]),r}();function at(r,e,t){if(isNaN(r))throw new Error("roots_quad_poly(a,b,c): a must be number.");if(isNaN(e))throw new Error("roots_quad_poly(a,b,c): b must be number.");if(isNaN(t))throw new Error("roots_quad_poly(a,b,c): c must be number.");if(0===t){var n=-r/e;return[n,n]}if(r/=t,0===(e/=t)){var a=Math.sqrt(-r);return[-a,+a]}if(0===r)return 0<=e?[-e,0]:[0,-e];e/=2*(t=Math.sqrt(Math.abs(r))*Math.sign(e));var o,i,f=Number.EPSILON;if(0<r){if(e<1-f)throw new Error("Complex roots not yet supported: "+e);e<1&&(e=1),i=1/(o=-e-Math.sqrt((e+1)*(e-1)))}else i=-1/(o=-e-Math.sqrt(e*e+1));return(o*=t)<=(i*=t)?[o,i]:[i,o]}var ot=y.a.mark(ft),it=y.a.mark(st);function ft(r,e){var t,n,a,o,i,f,s,u,l,c,h,d,v,w,p,g,b,x,E,_,A,k,M,q,N,P,S,I,j,F,J,T,L,R,U,Y,D,Q,G,C,B,X,W,H,K,Z,$,rr,er,tr,nr,ar,or,ir,fr,sr,ur,lr,cr,hr,dr,vr,wr,pr,mr,gr,yr,br,xr,Er,_r,Ar=arguments;return y.a.wrap((function(y){for(;;)switch(y.prev=y.next){case 0:if(t=Ar.length>2&&void 0!==Ar[2]?Ar[2]:{},n=t.r0,a=void 0===n?1.1:n,o=t.rMin,i=void 0===o?1e-8:o,f=t.rMax,s=void 0===f?1/0:f,u=t.shrinkLower,l=void 0===u?.05:u,c=t.shrinkUpper,h=void 0===c?.95:c,d=t.grow,v=void 0===d?1.5:d,w=t.expectGainMin,p=void 0===w?.25:w,g=t.expectGainMax,b=void 0===g?.75:g,1===(e=z("float64",e)).ndim){y.next=4;break}throw new Error("lsq_dogleg_gen(fJ, x0): x0.ndim must be 1.");case 4:if(r instanceof Function){y.next=6;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ must be Function.");case 6:if(0<a){y.next=8;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.r0 must be positive number.");case 8:if(0<i){y.next=10;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.rMin must be positive number.");case 10:if(i<=s){y.next=12;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.rMin must not be greater than opt.rMax.");case 12:if(i<=a){y.next=14;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.r0 must not be less than opt.rMin.");case 14:if(s>=a){y.next=16;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.r0 must not be greater than opt.rMax.");case 16:if(0<l){y.next=18;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.shrinkLower must be positive number.");case 18:if(l<=h){y.next=20;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.shrinkLower must not be greater than opt.shrinkUpper.");case 20:if(h<1){y.next=22;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.shrinkUpper must be less than 1.");case 22:if(1<v){y.next=24;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.grow must be number greater than 1.");case 24:if(0<p){y.next=26;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.expectGainMin must be positive number.");case 26:if(p<b){y.next=28;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.expectGainMin must be less than expectGainMax.");case 28:if(b<1||console.warn("lsq_dogleg_gen(fJ, x0, opt): opt.expectGainMax should be less than 1."),x=e.data,E=new Float64Array(x.length),_=new Float64Array(x.length),A=e.shape,k=new Int32Array(0),M=r(new V(A,x.slice())),q=O()(M,2),N=q[0],P=q[1],N=z(N),P=z(P),1===N.ndim){y.next=36;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ(x) returned [f,J] with f.ndim !== 1.");case 36:if(2===P.ndim){y.next=38;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ(x) returned [f,J] with J.ndim !== 2.");case 38:if(S=tt()(nt,m()(P.shape)),I=S.M,j=S.N,F=S.D,J=S.X,T=S.G,e.shape[0]===j){y.next=41;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ(x) returned [f,J] where J.shape[1] did not match x0.shape[0].");case 41:for(L=N.data,R=P.data,S.update(N,P),U=S.scaledNorm(T),Y=S.cauchyPointTravel(),D=a*-U*Y,Q=0,G=I;G-- >0;)C=L[G],Q+=C*C;case 47:if(Y<=0){y.next=49;break}throw new Error("Assertion failed.");case 49:return y.next=51,[new V(A,x.slice()),new V(k,Float64Array.of(Q/I)),new V(A,T.map((function(r){return 2*r/I}))),new V(N.shape,N.data.slice()),new V(P.shape,P.data.slice())];case 51:for(B=Math.max(-D/U,Y),X=j;X-- >0;)_[X]=B*T[X];if(!(-U*Y<D)){y.next=66;break}for(S.computeMinGlobal(),W=0,H=0,K=0,Z=j;Z-- >0;)$=F[Z],rr=$*_[Z],er=$*(J[Z]-_[Z]),W+=rr*rr,H+=rr*er,K+=er*er;if(W-=D*D,H*=2,0<=(tr=Math.min(1,at(W,H,K)[1]))){y.next=63;break}throw new Error("Assertion failed.");case 63:for(nr=j;nr-- >0;)ar=J[nr]-_[nr],_[nr]+=ar*tr;if(1!==tr){y.next=66;break}return y.abrupt("break",68);case 66:if(Math.abs(S.scaledNorm(_)-D)<=1e-6){y.next=68;break}throw new Error("Assertion failed.");case 68:if(S.scaledNorm(_)<=D+1e-6){y.next=70;break}throw new Error("Assertion failed.");case 70:for(or=0,ir=I;ir-- >0;){for(fr=0,sr=j;sr-- >0;)fr+=R[j*ir+sr]*_[sr];fr+=L[ir],or+=fr*fr}if(or<=Q){y.next=74;break}throw new Error("Assertion failed.");case 74:for(ur=j;ur-- >0;)E[ur]=_[ur]+x[ur];if(lr=r(new V(A,E.slice())),cr=O()(lr,2),hr=cr[0],dr=cr[1],hr=z(hr),dr=z(dr),1===hr.ndim){y.next=80;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ(x) returned [f,J] with f.ndim !== 1.");case 80:if(2===dr.ndim){y.next=82;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ(x) returned [f,J] with J.ndim !== 2.");case 82:if(I===hr.shape[0]){y.next=84;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ must return [f,J] with consistent shapes");case 84:if(I===dr.shape[0]){y.next=86;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ must return [f,J] with consistent shapes");case 86:if(j===dr.shape[1]){y.next=88;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ must return [f,J] with consistent shapes");case 88:for(L=hr.data,vr=0,wr=I;wr-- >0;)pr=L[wr],vr+=pr*pr;if(mr=function(){return U},(yr=Q-vr)>(gr=Q-or)*b)D=Math.min(s*mr(),D*v);else if(yr<gr*p){for(br=0,xr=j;xr-- >0;)br+=_[xr]*T[xr];l<=(Er=.5*(br*=2)/(br+Q-vr))||(Er=l),h>=Er||(Er=h),D=Math.max(i*mr(),D*Er)}Q>vr&&(Q=vr,E=(_r=[x,E])[0],x=_r[1],N=hr,P=dr,S.update(N,P),U=S.scaledNorm(T),Y=S.cauchyPointTravel()),L=N.data,R=P.data;case 97:y.next=47;break;case 99:case"end":return y.stop()}}),ot)}function st(r,e,t,n,a){var o,i,f,s,u,l,c,h,d,v,w;return y.a.wrap((function(p){for(;;)switch(p.prev=p.next){case 0:if(t instanceof Function){p.next=2;break}throw new Error("fit_lm_gen(x,y, fg, p0): fg must be a function.");case 2:if(r=z("float64",r),e=z("float64",e),n=z("float64",n),o=Float64Array,2===r.ndim){p.next=8;break}throw new Error("fit_lm_gen(x,y, fg, p0): x.ndim must be 2.");case 8:if(1===e.ndim){p.next=10;break}throw new Error("fit_lm_gen(x,y, fg, p0): y.ndim must be 1.");case 10:if(1===n.ndim){p.next=12;break}throw new Error("fit_lm_gen(x,y, fg, p0): p0.ndim must be 1.");case 12:if(i=O()(n.shape,1),f=i[0],s=O()(r.shape,2),u=s[0],l=s[1],c=Int32Array.of(l),u==e.shape[0]){p.next=15;break}throw new Error("fit_lm_gen(x,y, fg, p0): x.shape[0] must be equal to y.shape[0].");case 15:return r=r.data.slice(),e=e.data,Object.freeze(r.buffer),r=Array.from({length:u},(function(e,t){return Object.freeze(new V(c,r.subarray(l*t,l*t+1)))})),Object.freeze(r),h=new o(u),d=new o(u*f),v=[new V(Int32Array.of(u),h),new V(Int32Array.of(u,f),d)],w=function(n){var a=t(n);if(!(a instanceof Function))throw new Error;for(var o=u;o-- >0;){var i=a(r[o]),s=O()(i,2),l=s[0],c=s[1];if(l=G(l),c=G(c),0!==l.ndim)throw new Error("fit_lm_gen(x,y, fg, p0): fg must have signature float[nParams] => float[nDim] => [float, float[nParams]].");if(1!==c.ndim)throw new Error("fit_lm_gen(x,y, fg, p0): fg must have signature float[nParams] => float[nDim] => [float, float[nParams]].");if(c.shape[0]!==f)throw new Error("fit_lm_gen(x,y, fg, p0): fg must have signature float[nParams] => float[nDim] => [float, float[nParams]].");if(l=l.data[0],c=c.data,isNaN(l))throw new Error("fit_lm_gen(x,y, fg, p0): NaN encountered.");if(c.some(isNaN))throw new Error("fit_lm_gen(x,y, fg, p0): NaN encountered.");h[o]=l-e[o];for(var w=f;w-- >0;)d[f*o+w]=c[w]}return v},p.delegateYield(ft(w,n,a),"t0",23);case 23:case"end":return p.stop()}}),it)}function ut(r,e,t,n){if(null==n)n=t,t=0;else if(null==t)t=0;else if(!(0<=t&&t<1/0))throw new Error("fit_lin(x,y, regularization, funcs): Invalid regularization: ".concat(t,"."));if(n=m()(n),r=G("float64",r),1!==(e=G("float64",e)).ndim)throw new Error("fit_lin(x,y, (regularization,) funcs): y.ndim must be 1.");var a=e.shape[0],o=n.length;r.ndim;if(1!==r.ndim&&2!==r.ndim)throw new Error("fit_lin(x,y, (regularization,) funcs): x.ndim must be 1 or 2.");if(r.shape[0]!==e.shape[0])throw new Error("fit_lin(x,y, (regularization,) funcs): x.shape[0] and y.shape[0] must equal.");if(1===r.ndim)r=r.data;else{var i=r.shape.slice(1),f=O()(i,1)[0];r=r.data.slice(),Object.freeze(r.buffer),r=Array.from({length:a},(function(e,t){return Object.freeze(new V(i,r.subarray(f*t,f*(t+1))))}))}var s=Int32Array.of((0!==t)*o+a,o),u=new Float64Array(s[0]*s[1]);if(0!==t){t=Math.sqrt(t);for(var l=o;l-- >0;)u[a*o+o*l+l]=t}for(var c=a;c-- >0;)for(var h=o;h-- >0;)u[o*c+h]=n[h](r[c]);if(0!==t){e=e.data;for(var d=new Float64Array(a+o),v=a;v-- >0;)d[v]=e[v];e=new V(Int32Array.of(a+o,1),d)}else e=new V(Int32Array.of(a,1),e.data);var w=ke(u=new V(s,u),e).data,p=function r(e){var t=r.coeffs,n=r.funcs;if(t.length!==n.length)throw new Error("Assertion failed.");for(var a=0,o=t.length;o-- >0;)a+=t[o]*n[o](e);return a};return p.coeffs=w,p.funcs=n,p}var lt=1.5-Math.sqrt(5/4);function ct(r,e,t){if(e>t)throw new Error("opt1d_golden(F,x_min,x_max): x_max must not be less than x_min.");for(var n=e,a=t,o=n+(a-n)*lt,i=r(o);;){var f=a-(a-n)*lt;if(f===a)return(a+n)/2;var s=r(f);i<s?(a=n,n=f):(n=o,o=f,i=s)}}var ht=y.a.mark(vt);function dt(r,e){if(r.length!==e.length)throw new Error;for(var t=0,n=r.length;n-- >0;)t+=r[n]*e[n];return t}function vt(r,e){var t,n,a,o,i,f,s,u,l,c,h,d,v,w,p,m,g,b,x,E,_=arguments;return y.a.wrap((function(y){for(;;)switch(y.prev=y.next){case 0:if(t=_.length>2&&void 0!==_[2]?_[2]:{},n=t.historySize,a=void 0===n?8:n,o=t.lineSearch,i=void 0===o?rt():o,f=t.negDir0,s=void 0===f?function(r){return r}:f,u=z("float64",e),e=void 0,l=r(u),c=O()(l,2),h=c[0],d=c[1],h.dtype.startsWith("float")){y.next=6;break}throw new Error("min_lbfgs_gen(fg, x0, opt): fg must return [float,float[]].");case 6:if(d.dtype.startsWith("float")){y.next=8;break}throw new Error("min_lbfgs_gen(fg, x0, opt): fg must return [float,float[]].");case 8:v=O()(u.shape,1),w=v[0],p=u.shape,i=i(r),m=[],g=[],b=[],x=function(r){r=Float64Array.from(r.data);for(var e=new Float64Array(m.length),t=g.length;t-- >0;){e[t]=dt(m[t],r)/g[t];for(var n=w;n-- >0;)r[n]-=e[t]*b[t][n]}r=s(new V(p,r)),r=Float64Array.from(r.data);for(var a=0;a<g.length;a++)for(var o=dt(b[a],r)/g[a],i=w;i-- >0;)r[i]+=(e[a]-o)*m[a][i];return new V(p,r)},E=function(){var r=i(u,h,d,x(d)),e=O()(r,3),t=e[0],n=e[1],o=e[2];u=u.data,d=d.data;var f=Float64Array.from(o.data,(function(r,e){return r-d[e]})),s=Float64Array.from(t.data,(function(r,e){return r-u[e]}));if(b.push(f),g.push(dt(f,s)),m.push(s),m.length>a&&(m.shift(),g.shift(),b.shift()),m.length>a)throw new Error("Assertion#1 failed.");if(m.length!==g.length)throw new Error("Assertion#2 failed.");if(m.length!==b.length)throw new Error("Assertion#3 failed.");u=t,h=n,d=o};case 13:if(1===u.ndim){y.next=15;break}throw new Error("Assertion#4 failed.");case 15:if(!isNaN(1*h)){y.next=17;break}throw new Error("Assertion#5 failed.");case 17:if(1===d.ndim){y.next=19;break}throw new Error("Assertion#6 failed.");case 19:if(u.shape[0]===w){y.next=21;break}throw new Error("Assertion#7 failed.");case 21:if(d.shape[0]===w){y.next=23;break}throw new Error("Assertion#8 failed.");case 23:return y.next=25,[new V(p,u.data.slice()),1*h,new V(p,d.data.slice())];case 25:y.prev=25,E(),y.next=37;break;case 29:if(y.prev=29,y.t0=y.catch(25),!(y.t0 instanceof $e)){y.next=36;break}m=[],g=[],b=[],E(),y.next=37;break;case 36:throw y.t0;case 37:y.next=13;break;case 39:case"end":return y.stop()}}),ht,null,[[25,29]])}var wt=y.a.mark(mt),pt=y.a.mark(gt);function mt(r,e){var t,n,a,o,i,f,s,u,l,c,h,d,v,w,p,g,b,x,E,_,A,k,M,q,N,P,S,I,j,F,J,T,L,R,U,Y,D,Q,G,C,B,X,W,H,K,Z,$,rr,er,tr,nr,ar,or,ir,fr,sr,ur,lr,cr,hr,dr,vr,wr,pr,mr,gr,yr,br,Er,_r,Ar,kr,Mr,qr,Nr=arguments;return y.a.wrap((function(y){for(;;)switch(y.prev=y.next){case 0:if(t=Nr.length>2&&void 0!==Nr[2]?Nr[2]:{},n=t.r0,a=void 0===n?1.1:n,o=t.rMin,i=void 0===o?1e-8:o,f=t.rMax,s=void 0===f?1/0:f,u=t.rTol,l=void 0===u?.05:u,c=t.lmLower,h=void 0===c?.001:c,d=t.shrinkLower,v=void 0===d?.1:d,w=t.shrinkUpper,p=void 0===w?.5:w,g=t.grow,b=void 0===g?1.5:g,x=t.expectGainMin,E=void 0===x?.25:x,_=t.expectGainMax,A=void 0===_?.75:_,1===(e=z("float64",e)).ndim){y.next=4;break}throw new Error("lsq_dogleg_gen(fJ, x0): x0.ndim must be 1.");case 4:if(r instanceof Function){y.next=6;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ must be Function.");case 6:if(0<=h){y.next=8;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.lmLower must be within [0,1).");case 8:if(h<1){y.next=10;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.lmLower must be within [0,1).");case 10:if(1>l){y.next=12;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.rTol must be less than 1.");case 12:if(0<l){y.next=14;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.rTol must be positive number.");case 14:if(0<a){y.next=16;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.r0 must be positive number.");case 16:if(0<i){y.next=18;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.rMin must be positive number.");case 18:if(i<=s){y.next=20;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.rMin must not be greater than opt.rMax.");case 20:if(i<=a){y.next=22;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.r0 must not be less than opt.rMin.");case 22:if(s>=a){y.next=24;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.r0 must not be greater than opt.rMax.");case 24:if(0<v){y.next=26;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.shrinkLower must be positive number.");case 26:if(v<=p){y.next=28;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.shrinkLower must not be greater than opt.shrinkUpper.");case 28:if(p<1){y.next=30;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.shrinkUpper must be less than 1.");case 30:if(1<b){y.next=32;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.grow must be number greater than 1.");case 32:if(0<E){y.next=34;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.expectGainMin must be positive number.");case 34:if(E<A){y.next=36;break}throw new Error("lsq_dogleg_gen(fJ, x0, opt): opt.expectGainMin must be less than expectGainMax.");case 36:if(A<1||console.warn("lsq_dogleg_gen(fJ, x0, opt): opt.expectGainMax should be less than 1."),k=e.data,M=new Float64Array(k.length),q=new xr,N=e.shape,P=new Int32Array(0),S=r(new V(N,k.slice())),I=O()(S,2),j=I[0],F=I[1],j=z(j),F=z(F),1===j.ndim){y.next=45;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ(x) returned [f,J] with f.ndim !== 1.");case 45:if(2===F.ndim){y.next=47;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ(x) returned [f,J] with J.ndim !== 2.");case 47:if(J=tt()(nt,m()(F.shape)),T=J.M,L=J.N,R=J.D,U=J.X,Y=J.G,e.shape[0]===L){y.next=50;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ(x) returned [f,J] where J.shape[1] did not match x0.shape[0].");case 50:for(D=j.data,Q=F.data,J.update(j,F),G=-a*J.cauchyPointTravel()*J.scaledNorm(Y),C=0,B=T;B-- >0;)X=D[B],C+=X*X;case 55:return y.next=57,[new V(N,k.slice()),new V(P,Float64Array.of(C/T)),new V(N,Y.map((function(r){return 2*r/T}))),new V(j.shape,j.data.slice()),new V(F.shape,F.data.slice())];case 57:if(J.computeMinGlobal(),J.scaledNorm(U)<=G*(1+l)){y.next=99;break}for(q.reset(),W=L;W-- >0;)H=R[W],K=Y[W],0!==H&&(K/=H),q.include(K);if(Z=J.computeMinRegularized(0),$=O()(Z,2),rr=$[0],er=$[1],rr-=G,isFinite(rr)){y.next=65;break}throw new Error("Assertion failed.");case 65:if(0<rr){y.next=67;break}throw new Error("Assertion failed.");case 67:if(0>er){y.next=69;break}throw new Error("Assertion failed.");case 69:tr=-rr/er,nr=q.result/G,ar=0,or=-1;case 71:if(!(8<++or)){y.next=73;break}throw new Error("Assertion failed.");case 73:if(tr>=0){y.next=75;break}throw new Error("Assertion failed.");case 75:if(0<=nr){y.next=77;break}throw new Error("Assertion failed.");case 77:if(tr<nr){y.next=79;break}throw new Error("Assertion failed.");case 79:if(tr<ar&&ar<nr||(ar=Math.max(h*nr,Math.sqrt(tr*nr))),tr<ar&&ar<nr){y.next=82;break}throw new Error("Assertion failed.");case 82:if(ir=J.computeMinRegularized(ar),fr=O()(ir,2),rr=fr[0],er=fr[1],isFinite(rr)){y.next=88;break}throw new Error("Assertion failed.");case 88:if(!(Math.abs(G-rr)<=G*l)){y.next=90;break}return y.abrupt("break",95);case 90:rr<G&&(nr=ar),tr=Math.max(tr,ar+(G-rr)/er),ar+=(G-rr)/er*(rr/G);case 93:y.next=71;break;case 95:if(Math.abs(J.scaledNorm(U)-G)<=G*l){y.next=97;break}throw new Error("Assertion failed.");case 97:y.next=99;break;case 99:if(J.scaledNorm(U)<=G*(1+l)){y.next=101;break}throw new Error("Assertion failed.");case 101:for(sr=0,ur=T;ur-- >0;){for(lr=0,cr=L;cr-- >0;)lr+=Q[L*ur+cr]*U[cr];lr+=D[ur],sr+=lr*lr}if(sr<=C){y.next=105;break}throw new Error("Assertion failed.");case 105:for(hr=L;hr-- >0;)M[hr]=U[hr]+k[hr];if(dr=r(new V(N,M.slice())),vr=O()(dr,2),wr=vr[0],pr=vr[1],wr=z(wr),pr=z(pr),1===wr.ndim){y.next=111;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ(x) returned [f,J] with f.ndim !== 1.");case 111:if(2===pr.ndim){y.next=113;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ(x) returned [f,J] with J.ndim !== 2.");case 113:if(T===wr.shape[0]){y.next=115;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ must return [f,J] with consistent shapes");case 115:if(T===pr.shape[0]){y.next=117;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ must return [f,J] with consistent shapes");case 117:if(L===pr.shape[1]){y.next=119;break}throw new Error("lsq_dogleg_gen(fJ, x0): fJ must return [f,J] with consistent shapes");case 119:for(D=wr.data,mr=0,gr=T;gr-- >0;)yr=D[gr],mr+=yr*yr;if(br=function(){return J.scaledNorm(Y)},(_r=C-mr)>(Er=C-sr)*A)G=Math.min(s*br(),G*b);else if(_r<Er*E){for(Ar=0,kr=L;kr-- >0;)Ar+=U[kr]*Y[kr];v<=(Mr=.5*(Ar*=2)/(Ar+C-mr))||(Mr=v),p>=Mr||(Mr=p),G=Math.max(i*br(),G*Mr)}C>mr&&(C=mr,M=(qr=[k,M])[0],k=qr[1],j=wr,F=pr,J.update(j,F)),D=j.data,Q=F.data;case 128:y.next=55;break;case 130:case"end":return y.stop()}}),wt)}function gt(r,e,t,n,a){var o,i,f,s,u,l,c,h,d,v,w;return y.a.wrap((function(p){for(;;)switch(p.prev=p.next){case 0:if(t instanceof Function){p.next=2;break}throw new Error("fit_lm_gen(x,y, fg, p0): fg must be a function.");case 2:if(r=G(r),e=G("float64",e),n=G("float64",n),o=Float64Array,2===r.ndim){p.next=8;break}throw new Error("fit_lm_gen(x,y, fg, p0): x.ndim must be 2.");case 8:if(1===e.ndim){p.next=10;break}throw new Error("fit_lm_gen(x,y, fg, p0): y.ndim must be 1.");case 10:if(1===n.ndim){p.next=12;break}throw new Error("fit_lm_gen(x,y, fg, p0): p0.ndim must be 1.");case 12:if(i=O()(n.shape,1),f=i[0],s=O()(r.shape,2),u=s[0],l=s[1],c=Int32Array.of(l),u==e.shape[0]){p.next=15;break}throw new Error("fit_lm_gen(x,y, fg, p0): x.shape[0] must be equal to y.shape[0].");case 15:return r=r.data.slice(),e=e.data,Object.freeze(r.buffer),r=Array.from({length:u},(function(e,t){return Object.freeze(new V(c,r.subarray(l*t,l*t+1)))})),Object.freeze(r),h=new o(u),d=new o(u*f),v=[new V(Int32Array.of(u),h),new V(Int32Array.of(u,f),d)],w=function(n){var a=t(n);if(!(a instanceof Function))throw new Error;for(var o=u;o-- >0;){var i=a(r[o]),s=O()(i,2),l=s[0],c=s[1];if(l=G(l),c=G(c),0!==l.ndim)throw new Error("fit_lm_gen(x,y, fg, p0): fg must have signature float[nParams] => float[nDim] => [float, float[nParams]].");if(1!==c.ndim)throw new Error("fit_lm_gen(x,y, fg, p0): fg must have signature float[nParams] => float[nDim] => [float, float[nParams]].");if(c.shape[0]!==f)throw new Error("fit_lm_gen(x,y, fg, p0): fg must have signature float[nParams] => float[nDim] => [float, float[nParams]].");if(l=l.data[0],c=c.data,isNaN(l))throw new Error("fit_lm_gen(x,y, fg, p0): NaN encountered.");if(c.some(isNaN))throw new Error("fit_lm_gen(x,y, fg, p0): NaN encountered.");h[o]=l-e[o];for(var w=f;w-- >0;)d[f*o+w]=c[w]}return v},p.delegateYield(mt(w,n,a),"t0",23);case 23:case"end":return p.stop()}}),pt)}var yt=function(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=e.h_rel,n=void 0===t?void 0:t,a=e.h_abs,o=void 0===a?void 0:a;return function(e){for(var t="float32"===(e=z(e)).dtype?"float32":"float64",a=k[t],i=e.shape,f=new a((e=e.data).length),s=null!=n?n:Math.pow(M(t),1/3),u=null!=o?o:Math.pow(M(t),1/3),l=e.length;l-- >0;){for(var c=Math.max(Math.abs(e[l])*s,u),h=0,d=[[2*c,-1],[1*c,8],[-1*c,-8],[-2*c,1]];h<d.length;h++){var v=O()(d[h],2),w=v[0],p=v[1],m=new V(i,a.from(e));m.data[l]+=w,f[l]+=r(m)*p}f[l]/=12*c}return new V(i,f)}},bt=function(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=e.h_rel,n=void 0===t?void 0:t,a=e.h_abs,o=void 0===a?void 0:a;return function(e){var t="float32"===(e=z(e)).dtype?"float32":"float64",a=k[t],i=e.shape,f=new a((e=e.data).length),s=null!=n?n:Math.pow(M(t),1/3),u=null!=o?o:Math.pow(M(t),1/3),l=r(new V(i,e.slice()));f.fill(-1.5*l);for(var c=e.length;c-- >0;){for(var h=Math.max(Math.abs(e[c])*s,u),d=0,v=[[1*h,2],[2*h,-.5]];d<v.length;d++){var w=O()(v[d],2),p=w[0],m=w[1],g=new V(i,a.from(e));g.data[c]+=p,f[c]+=r(g)*m}f[c]/=h}return new V(i,f)}};function xt(r,e,t,n){var a=r(e=G(e),t).mapElems((function(r){return r*n})),o=r(D([e,a],(function(r,e){return r+e/2})),t+n/2).mapElems((function(r){return r*n})),i=r(D([e,o],(function(r,e){return r+e/2})),t+n/2).mapElems((function(r){return r*n})),f=r(D([e,i],(function(r,e){return r+e})),t+n).mapElems((function(r){return r*n}));return D([e,a,o,i,f],(function(r,e,t,n,a){return r+(e+2*(t+n)+a)/6}))}t.d(e,"math",(function(){return d})),t.d(e,"array",(function(){return z})),t.d(e,"asarray",(function(){return G})),t.d(e,"NDArray",(function(){return V})),t.d(e,"rand_normal",(function(){return B})),t.d(e,"tabulate",(function(){return X})),t.d(e,"zip_elems",(function(){return D})),t.d(e,"concat",(function(){return W})),t.d(e,"stack",(function(){return H})),t.d(e,"dt",(function(){return n})),t.d(e,"io",(function(){return a})),t.d(e,"la",(function(){return o})),t.d(e,"opt",(function(){return f})),t.d(e,"integrate",(function(){return s}))}])}));