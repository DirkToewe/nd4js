/* ND.JS v1.3.0
 *
 * ND.JS is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * ND.JS is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with ND.JS. If not, see <http://www.gnu.org/licenses/>.
 */
 !function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.nd=e():r.nd=e()}(this,(function(){return function(r){var e={};function t(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return r[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}return t.m=r,t.c=e,t.d=function(r,e,n){t.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:n})},t.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,e){if(1&e&&(r=t(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var a in r)t.d(n,a,function(e){return r[e]}.bind(null,a));return n},t.n=function(r){var e=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(e,"a",e),e},t.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},t.p="",t(t.s=29)}([function(r,e,t){var n=t(23),a=t(24),o=t(14),i=t(25);r.exports=function(r,e){return n(r)||a(r,e)||o(r,e)||i()}},function(r,e,t){r.exports=t(18)},function(r,e,t){var n=t(15),a=t(16),o=t(14),i=t(17);r.exports=function(r){return n(r)||a(r)||o(r)||i()}},function(r,e){r.exports=function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}},function(r,e){function t(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}r.exports=function(r,e,n){return e&&t(r.prototype,e),n&&t(r,n),r}},function(r,e){function t(e){return r.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},t(e)}r.exports=t},function(r,e,t){var n=t(12);r.exports=function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),e&&n(r,e)}},function(r,e,t){var n=t(9),a=t(10);r.exports=function(r,e){return!e||"object"!==n(e)&&"function"!=typeof e?a(r):e}},function(r,e,t){var n=t(5),a=t(12),o=t(26),i=t(27);function s(e){var t="function"==typeof Map?new Map:void 0;return r.exports=s=function(r){if(null===r||!o(r))return r;if("function"!=typeof r)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(r))return t.get(r);t.set(r,e)}function e(){return i(r,arguments,n(this).constructor)}return e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a(e,r)},s(e)}r.exports=s},function(r,e){function t(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?r.exports=t=function(r){return typeof r}:r.exports=t=function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},t(e)}r.exports=t},function(r,e){r.exports=function(r){if(void 0===r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}},function(r,e){r.exports=function(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}},function(r,e){function t(e,n){return r.exports=t=Object.setPrototypeOf||function(r,e){return r.__proto__=e,r},t(e,n)}r.exports=t},function(r,e){r.exports=function(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}},function(r,e,t){var n=t(13);r.exports=function(r,e){if(r){if("string"==typeof r)return n(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?n(r,e):void 0}}},function(r,e,t){var n=t(13);r.exports=function(r){if(Array.isArray(r))return n(r)}},function(r,e){r.exports=function(r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(r))return Array.from(r)}},function(r,e){r.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(r,e,t){var n=function(r){"use strict";var e=Object.prototype,t=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function s(r,e,t){return Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}),r[e]}try{s({},"")}catch(r){s=function(r,e,t){return r[e]=t}}function f(r,e,t,n){var a=e&&e.prototype instanceof u?e:u,o=Object.create(a.prototype),i=new x(n||[]);return o._invoke=function(r,e,t){var n="suspendedStart";return function(a,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw o;return M()}for(t.method=a,t.arg=o;;){var i=t.delegate;if(i){var s=b(i,t);if(s){if(s===h)continue;return s}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if("suspendedStart"===n)throw n="completed",t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);n="executing";var f=l(r,e,t);if("normal"===f.type){if(n=t.done?"completed":"suspendedYield",f.arg===h)continue;return{value:f.arg,done:t.done}}"throw"===f.type&&(n="completed",t.method="throw",t.arg=f.arg)}}}(r,t,i),o}function l(r,e,t){try{return{type:"normal",arg:r.call(e,t)}}catch(r){return{type:"throw",arg:r}}}r.wrap=f;var h={};function u(){}function c(){}function d(){}var w={};w[a]=function(){return this};var v=Object.getPrototypeOf,p=v&&v(v(A([])));p&&p!==e&&t.call(p,a)&&(w=p);var m=d.prototype=u.prototype=Object.create(w);function g(r){["next","throw","return"].forEach((function(e){s(r,e,(function(r){return this._invoke(e,r)}))}))}function y(r,e){var n;this._invoke=function(a,o){function i(){return new e((function(n,i){!function n(a,o,i,s){var f=l(r[a],r,o);if("throw"!==f.type){var h=f.arg,u=h.value;return u&&"object"==typeof u&&t.call(u,"__await")?e.resolve(u.__await).then((function(r){n("next",r,i,s)}),(function(r){n("throw",r,i,s)})):e.resolve(u).then((function(r){h.value=r,i(h)}),(function(r){return n("throw",r,i,s)}))}s(f.arg)}(a,o,n,i)}))}return n=n?n.then(i,i):i()}}function b(r,e){var t=r.iterator[e.method];if(void 0===t){if(e.delegate=null,"throw"===e.method){if(r.iterator.return&&(e.method="return",e.arg=void 0,b(r,e),"throw"===e.method))return h;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var n=l(t,r.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,h;var a=n.arg;return a?a.done?(e[r.resultName]=a.value,e.next=r.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function E(r){var e={tryLoc:r[0]};1 in r&&(e.catchLoc=r[1]),2 in r&&(e.finallyLoc=r[2],e.afterLoc=r[3]),this.tryEntries.push(e)}function _(r){var e=r.completion||{};e.type="normal",delete e.arg,r.completion=e}function x(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(E,this),this.reset(!0)}function A(r){if(r){var e=r[a];if(e)return e.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var n=-1,o=function e(){for(;++n<r.length;)if(t.call(r,n))return e.value=r[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:M}}function M(){return{value:void 0,done:!0}}return c.prototype=m.constructor=d,d.constructor=c,c.displayName=s(d,i,"GeneratorFunction"),r.isGeneratorFunction=function(r){var e="function"==typeof r&&r.constructor;return!!e&&(e===c||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,d):(r.__proto__=d,s(r,i,"GeneratorFunction")),r.prototype=Object.create(m),r},r.awrap=function(r){return{__await:r}},g(y.prototype),y.prototype[o]=function(){return this},r.AsyncIterator=y,r.async=function(e,t,n,a,o){void 0===o&&(o=Promise);var i=new y(f(e,t,n,a),o);return r.isGeneratorFunction(t)?i:i.next().then((function(r){return r.done?r.value:i.next()}))},g(m),s(m,i,"Generator"),m[a]=function(){return this},m.toString=function(){return"[object Generator]"},r.keys=function(r){var e=[];for(var t in r)e.push(t);return e.reverse(),function t(){for(;e.length;){var n=e.pop();if(n in r)return t.value=n,t.done=!1,t}return t.done=!0,t}},r.values=A,x.prototype={constructor:x,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!r)for(var e in this)"t"===e.charAt(0)&&t.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var r=this.tryEntries[0].completion;if("throw"===r.type)throw r.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var e=this;function n(t,n){return i.type="throw",i.arg=r,e.next=t,n&&(e.method="next",e.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=t.call(o,"catchLoc"),f=t.call(o,"finallyLoc");if(s&&f){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!f)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(r,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&t.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===r||"continue"===r)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=r,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(i)},complete:function(r,e){if("throw"===r.type)throw r.arg;return"break"===r.type||"continue"===r.type?this.next=r.arg:"return"===r.type?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):"normal"===r.type&&e&&(this.next=e),h},finish:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===r)return this.complete(t.completion,t.afterLoc),_(t),h}},catch:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===r){var n=t.completion;if("throw"===n.type){var a=n.arg;_(t)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(r,e,t){return this.delegate={iterator:A(r),resultName:e,nextLoc:t},"next"===this.method&&(this.arg=void 0),h}},r}(r.exports);try{regeneratorRuntime=n}catch(r){Function("r","regeneratorRuntime = r")(n)}},function(r,e,t){(function(r){var n=Object.getOwnPropertyDescriptors||function(r){for(var e=Object.keys(r),t={},n=0;n<e.length;n++)t[e[n]]=Object.getOwnPropertyDescriptor(r,e[n]);return t},a=/%[sdj%]/g;e.format=function(r){if(!m(r)){for(var e=[],t=0;t<arguments.length;t++)e.push(s(arguments[t]));return e.join(" ")}t=1;for(var n=arguments,o=n.length,i=String(r).replace(a,(function(r){if("%%"===r)return"%";if(t>=o)return r;switch(r){case"%s":return String(n[t++]);case"%d":return Number(n[t++]);case"%j":try{return JSON.stringify(n[t++])}catch(r){return"[Circular]"}default:return r}})),f=n[t];t<o;f=n[++t])v(f)||!b(f)?i+=" "+f:i+=" "+s(f);return i},e.deprecate=function(t,n){if(void 0!==r&&!0===r.noDeprecation)return t;if(void 0===r)return function(){return e.deprecate(t,n).apply(this,arguments)};var a=!1;return function(){if(!a){if(r.throwDeprecation)throw new Error(n);r.traceDeprecation?console.trace(n):console.error(n),a=!0}return t.apply(this,arguments)}};var o,i={};function s(r,t){var n={seen:[],stylize:l};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),w(t)?n.showHidden=t:t&&e._extend(n,t),g(n.showHidden)&&(n.showHidden=!1),g(n.depth)&&(n.depth=2),g(n.colors)&&(n.colors=!1),g(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=f),h(n,r,n.depth)}function f(r,e){var t=s.styles[e];return t?"["+s.colors[t][0]+"m"+r+"["+s.colors[t][1]+"m":r}function l(r,e){return r}function h(r,t,n){if(r.customInspect&&t&&x(t.inspect)&&t.inspect!==e.inspect&&(!t.constructor||t.constructor.prototype!==t)){var a=t.inspect(n,r);return m(a)||(a=h(r,a,n)),a}var o=function(r,e){if(g(e))return r.stylize("undefined","undefined");if(m(e)){var t="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return r.stylize(t,"string")}if(p(e))return r.stylize(""+e,"number");if(w(e))return r.stylize(""+e,"boolean");if(v(e))return r.stylize("null","null")}(r,t);if(o)return o;var i=Object.keys(t),s=function(r){var e={};return r.forEach((function(r,t){e[r]=!0})),e}(i);if(r.showHidden&&(i=Object.getOwnPropertyNames(t)),_(t)&&(i.indexOf("message")>=0||i.indexOf("description")>=0))return u(t);if(0===i.length){if(x(t)){var f=t.name?": "+t.name:"";return r.stylize("[Function"+f+"]","special")}if(y(t))return r.stylize(RegExp.prototype.toString.call(t),"regexp");if(E(t))return r.stylize(Date.prototype.toString.call(t),"date");if(_(t))return u(t)}var l,b="",A=!1,M=["{","}"];(d(t)&&(A=!0,M=["[","]"]),x(t))&&(b=" [Function"+(t.name?": "+t.name:"")+"]");return y(t)&&(b=" "+RegExp.prototype.toString.call(t)),E(t)&&(b=" "+Date.prototype.toUTCString.call(t)),_(t)&&(b=" "+u(t)),0!==i.length||A&&0!=t.length?n<0?y(t)?r.stylize(RegExp.prototype.toString.call(t),"regexp"):r.stylize("[Object]","special"):(r.seen.push(t),l=A?function(r,e,t,n,a){for(var o=[],i=0,s=e.length;i<s;++i)F(e,String(i))?o.push(c(r,e,t,n,String(i),!0)):o.push("");return a.forEach((function(a){a.match(/^\d+$/)||o.push(c(r,e,t,n,a,!0))})),o}(r,t,n,s,i):i.map((function(e){return c(r,t,n,s,e,A)})),r.seen.pop(),function(r,e,t){if(r.reduce((function(r,e){return e.indexOf("\n")>=0&&0,r+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return t[0]+(""===e?"":e+"\n ")+" "+r.join(",\n  ")+" "+t[1];return t[0]+e+" "+r.join(", ")+" "+t[1]}(l,b,M)):M[0]+b+M[1]}function u(r){return"["+Error.prototype.toString.call(r)+"]"}function c(r,e,t,n,a,o){var i,s,f;if((f=Object.getOwnPropertyDescriptor(e,a)||{value:e[a]}).get?s=f.set?r.stylize("[Getter/Setter]","special"):r.stylize("[Getter]","special"):f.set&&(s=r.stylize("[Setter]","special")),F(n,a)||(i="["+a+"]"),s||(r.seen.indexOf(f.value)<0?(s=v(t)?h(r,f.value,null):h(r,f.value,t-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(r){return"  "+r})).join("\n").substr(2):"\n"+s.split("\n").map((function(r){return"   "+r})).join("\n")):s=r.stylize("[Circular]","special")),g(i)){if(o&&a.match(/^\d+$/))return s;(i=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(i=i.substr(1,i.length-2),i=r.stylize(i,"name")):(i=i.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),i=r.stylize(i,"string"))}return i+": "+s}function d(r){return Array.isArray(r)}function w(r){return"boolean"==typeof r}function v(r){return null===r}function p(r){return"number"==typeof r}function m(r){return"string"==typeof r}function g(r){return void 0===r}function y(r){return b(r)&&"[object RegExp]"===A(r)}function b(r){return"object"==typeof r&&null!==r}function E(r){return b(r)&&"[object Date]"===A(r)}function _(r){return b(r)&&("[object Error]"===A(r)||r instanceof Error)}function x(r){return"function"==typeof r}function A(r){return Object.prototype.toString.call(r)}function M(r){return r<10?"0"+r.toString(10):r.toString(10)}e.debuglog=function(t){if(g(o)&&(o=r.env.NODE_DEBUG||""),t=t.toUpperCase(),!i[t])if(new RegExp("\\b"+t+"\\b","i").test(o)){var n=r.pid;i[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,n,r)}}else i[t]=function(){};return i[t]},e.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=d,e.isBoolean=w,e.isNull=v,e.isNullOrUndefined=function(r){return null==r},e.isNumber=p,e.isString=m,e.isSymbol=function(r){return"symbol"==typeof r},e.isUndefined=g,e.isRegExp=y,e.isObject=b,e.isDate=E,e.isError=_,e.isFunction=x,e.isPrimitive=function(r){return null===r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||"symbol"==typeof r||void 0===r},e.isBuffer=t(21);var k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function N(){var r=new Date,e=[M(r.getHours()),M(r.getMinutes()),M(r.getSeconds())].join(":");return[r.getDate(),k[r.getMonth()],e].join(" ")}function F(r,e){return Object.prototype.hasOwnProperty.call(r,e)}e.log=function(){console.log("%s - %s",N(),e.format.apply(e,arguments))},e.inherits=t(22),e._extend=function(r,e){if(!e||!b(e))return r;for(var t=Object.keys(e),n=t.length;n--;)r[t[n]]=e[t[n]];return r};var I="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function P(r,e){if(!r){var t=new Error("Promise was rejected with a falsy value");t.reason=r,r=t}return e(r)}e.promisify=function(r){if("function"!=typeof r)throw new TypeError('The "original" argument must be of type Function');if(I&&r[I]){var e;if("function"!=typeof(e=r[I]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,I,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,t,n=new Promise((function(r,n){e=r,t=n})),a=[],o=0;o<arguments.length;o++)a.push(arguments[o]);a.push((function(r,n){r?t(r):e(n)}));try{r.apply(this,a)}catch(r){t(r)}return n}return Object.setPrototypeOf(e,Object.getPrototypeOf(r)),I&&Object.defineProperty(e,I,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,n(r))},e.promisify.custom=I,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);var a=t.pop();if("function"!=typeof a)throw new TypeError("The last argument must be of type Function");var o=this,i=function(){return a.apply(o,arguments)};e.apply(this,t).then((function(e){r.nextTick(i,null,e)}),(function(e){r.nextTick(P,e,i)}))}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,n(e)),t}}).call(this,t(20))},function(r,e){var t,n,a=r.exports={};function o(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(r){if(t===setTimeout)return setTimeout(r,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(r,0);try{return t(r,0)}catch(e){try{return t.call(null,r,0)}catch(e){return t.call(this,r,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(r){t=o}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(r){n=i}}();var f,l=[],h=!1,u=-1;function c(){h&&f&&(h=!1,f.length?l=f.concat(l):u=-1,l.length&&d())}function d(){if(!h){var r=s(c);h=!0;for(var e=l.length;e;){for(f=l,l=[];++u<e;)f&&f[u].run();u=-1,e=l.length}f=null,h=!1,function(r){if(n===clearTimeout)return clearTimeout(r);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(r);try{n(r)}catch(e){try{return n.call(null,r)}catch(e){return n.call(this,r)}}}(r)}}function w(r,e){this.fun=r,this.array=e}function v(){}a.nextTick=function(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];l.push(new w(r,e)),1!==l.length||h||s(d)},w.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=v,a.addListener=v,a.once=v,a.off=v,a.removeListener=v,a.removeAllListeners=v,a.emit=v,a.prependListener=v,a.prependOnceListener=v,a.listeners=function(r){return[]},a.binding=function(r){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(r){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(r,e){r.exports=function(r){return r&&"object"==typeof r&&"function"==typeof r.copy&&"function"==typeof r.fill&&"function"==typeof r.readUInt8}},function(r,e){"function"==typeof Object.create?r.exports=function(r,e){r.super_=e,r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}})}:r.exports=function(r,e){r.super_=e;var t=function(){};t.prototype=e.prototype,r.prototype=new t,r.prototype.constructor=r}},function(r,e){r.exports=function(r){if(Array.isArray(r))return r}},function(r,e){r.exports=function(r,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(r)){var t=[],n=!0,a=!1,o=void 0;try{for(var i,s=r[Symbol.iterator]();!(n=(i=s.next()).done)&&(t.push(i.value),!e||t.length!==e);n=!0);}catch(r){a=!0,o=r}finally{try{n||null==s.return||s.return()}finally{if(a)throw o}}return t}}},function(r,e){r.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(r,e){r.exports=function(r){return-1!==Function.toString.call(r).indexOf("[native code]")}},function(r,e,t){var n=t(12),a=t(28);function o(e,t,i){return a()?r.exports=o=Reflect.construct:r.exports=o=function(r,e,t){var a=[null];a.push.apply(a,e);var o=new(Function.bind.apply(r,a));return t&&n(o,t.prototype),o},o.apply(null,arguments)}r.exports=o},function(r,e){r.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(r){return!1}}},function(r,e,t){"use strict";t.r(e),t.d(e,"math",(function(){return y})),t.d(e,"concat",(function(){return or})),t.d(e,"array",(function(){return tr})),t.d(e,"asarray",(function(){return nr})),t.d(e,"NDArray",(function(){return ar})),t.d(e,"rand_normal",(function(){return fr})),t.d(e,"stack",(function(){return lr})),t.d(e,"tabulate",(function(){return hr})),t.d(e,"zip_elems",(function(){return $})),t.d(e,"dt",(function(){return n})),t.d(e,"geom",(function(){return a})),t.d(e,"integrate",(function(){return o})),t.d(e,"io",(function(){return i})),t.d(e,"iter",(function(){return s})),t.d(e,"la",(function(){return l})),t.d(e,"opt",(function(){return c})),t.d(e,"rand",(function(){return d})),t.d(e,"spatial",(function(){return w}));var n={};t.r(n),t.d(n,"Complex",(function(){return E})),t.d(n,"Complex128Array",(function(){return P})),t.d(n,"ARRAY_TYPES",(function(){return q})),t.d(n,"eps",(function(){return S})),t.d(n,"cast_scalar",(function(){return j})),t.d(n,"_check_dtype",(function(){return O})),t.d(n,"dtypeof",(function(){return R})),t.d(n,"super_dtype",(function(){return L})),t.d(n,"is_subdtype",(function(){return D}));var a={};t.r(a),t.d(a,"regular_simplex",(function(){return ur}));var o={};t.r(o),t.d(o,"odeint_rk4",(function(){return cr}));var i={};t.r(i),t.d(i,"IS_LITTLE_ENDIAN",(function(){return Gr})),t.d(i,"WHITESPACES",(function(){return Jr})),t.d(i,"b64_decode",(function(){return Er})),t.d(i,"b64_decode_gen",(function(){return _r})),t.d(i,"b64_encode",(function(){return xr})),t.d(i,"b64_encode_gen",(function(){return Ar})),t.d(i,"istr_parse",(function(){return Fr})),t.d(i,"istr_stringify",(function(){return Ir})),t.d(i,"istr_stringify_gen",(function(){return Pr})),t.d(i,"npy_serialize",(function(){return Rr})),t.d(i,"npy_serialize_gen",(function(){return Lr})),t.d(i,"npy_deserialize",(function(){return Dr}));var s={};t.r(s),t.d(s,"argmin",(function(){return Tr})),t.d(s,"argmax",(function(){return Xr})),t.d(s,"min",(function(){return zr})),t.d(s,"max",(function(){return Ur})),t.d(s,"linspace",(function(){return $r})),t.d(s,"range",(function(){return Zr})),t.d(s,"cartesian_prod",(function(){return re})),t.d(s,"enumerate",(function(){return ee})),t.d(s,"zip",(function(){return te})),t.d(s,"repeat",(function(){return ne}));var l={};t.r(l),t.d(l,"_bidiag_decomp_horiz",(function(){return ve})),t.d(l,"bidiag_decomp",(function(){return pe})),t.d(l,"cholesky_decomp",(function(){return Ne})),t.d(l,"cholesky_solve",(function(){return Fe})),t.d(l,"diag_mat",(function(){return Ie})),t.d(l,"diag",(function(){return Pe})),t.d(l,"det_tri",(function(){return Re})),t.d(l,"slogdet_tri",(function(){return Le})),t.d(l,"det",(function(){return De})),t.d(l,"slogdet",(function(){return Ge})),t.d(l,"eigen",(function(){return ft})),t.d(l,"eigenvals",(function(){return lt})),t.d(l,"eigen_balance_pre",(function(){return ht})),t.d(l,"eigen_balance_post",(function(){return ut})),t.d(l,"eye",(function(){return ct})),t.d(l,"hessenberg_decomp",(function(){return at})),t.d(l,"ldl_decomp",(function(){return wt})),t.d(l,"ldl_solve",(function(){return pt})),t.d(l,"lstsq",(function(){return Ft})),t.d(l,"lu_decomp",(function(){return It})),t.d(l,"lu_solve",(function(){return Pt})),t.d(l,"matmul2",(function(){return Ce})),t.d(l,"matmul",(function(){return Ve})),t.d(l,"norm",(function(){return he})),t.d(l,"permute_rows",(function(){return qt})),t.d(l,"permute_cols",(function(){return St})),t.d(l,"unpermute_rows",(function(){return jt})),t.d(l,"unpermute_cols",(function(){return Ot})),t.d(l,"pldlp_decomp",(function(){return Jt})),t.d(l,"pldlp_solve",(function(){return Yt})),t.d(l,"pldlp_l",(function(){return Tt})),t.d(l,"pldlp_d",(function(){return Xt})),t.d(l,"pldlp_p",(function(){return zt})),t.d(l,"qr_decomp",(function(){return Se})),t.d(l,"qr_decomp_full",(function(){return qe})),t.d(l,"qr_lstsq",(function(){return Oe})),t.d(l,"rand_ortho",(function(){return Ke})),t.d(l,"rank",(function(){return Qt})),t.d(l,"rrqr_decomp",(function(){return Ht})),t.d(l,"rrqr_decomp_full",(function(){return Wt})),t.d(l,"rrqr_rank",(function(){return $t})),t.d(l,"rrqr_lstsq",(function(){return rn})),t.d(l,"rrqr_solve",(function(){return Zt})),t.d(l,"srrqr_decomp_full",(function(){return tn})),t.d(l,"schur_eigenvals",(function(){return ot})),t.d(l,"schur_eigen",(function(){return it})),t.d(l,"schur_decomp",(function(){return st})),t.d(l,"SingularMatrixSolveError",(function(){return gt})),t.d(l,"solve",(function(){return nn})),t.d(l,"svd_decomp",(function(){return At})),t.d(l,"svd_rank",(function(){return Mt})),t.d(l,"svd_solve",(function(){return kt})),t.d(l,"svd_lstsq",(function(){return Nt})),t.d(l,"svd_dc",(function(){return At})),t.d(l,"svd_jac_2sided",(function(){return an})),t.d(l,"svd_jac_2sided_blocked",(function(){return on})),t.d(l,"svd_jac_classic",(function(){return sn})),t.d(l,"tril",(function(){return ge})),t.d(l,"triu",(function(){return ye})),t.d(l,"tril_solve",(function(){return Ae})),t.d(l,"triu_solve",(function(){return Me})),t.d(l,"urv_decomp_full",(function(){return ln})),t.d(l,"urv_lstsq",(function(){return hn}));var h={};t.r(h),t.d(h,"LineSearchError",(function(){return wn})),t.d(h,"LineSearchNoProgressError",(function(){return vn})),t.d(h,"LineSearchBisectionError",(function(){return pn})),t.d(h,"LineSearchBoundReachedError",(function(){return mn})),t.d(h,"more_thuente_abc",(function(){return Fn})),t.d(h,"more_thuente_u123",(function(){return Pn})),t.d(h,"strong_wolfe",(function(){return Ln}));var u={};t.r(u),t.d(u,"beale",(function(){return Dn})),t.d(u,"brown_badscale",(function(){return Gn})),t.d(u,"freudenstein_roth",(function(){return Jn})),t.d(u,"helical_valley",(function(){return Xn})),t.d(u,"JennrichSampson",(function(){return Un})),t.d(u,"powell_badscale",(function(){return Vn})),t.d(u,"Rastrigin",(function(){return Hn})),t.d(u,"Rosenbrock",(function(){return Zn}));var c={};t.r(c),t.d(c,"line_search",(function(){return h})),t.d(c,"test_fn",(function(){return u})),t.d(c,"min_dogleg_gen",(function(){return pa})),t.d(c,"lsq_dogleg_gen",(function(){return ma})),t.d(c,"tls_dogleg_gen",(function(){return ya})),t.d(c,"odr_dogleg_gen",(function(){return ba})),t.d(c,"fit_dogleg_gen",(function(){return Ea})),t.d(c,"fit_lin",(function(){return _a})),t.d(c,"min1d_gss",(function(){return Aa})),t.d(c,"min_lbfgs_gen",(function(){return Ia})),t.d(c,"lsq_lbfgs_gen",(function(){return Pa})),t.d(c,"fit_lbfgs_gen",(function(){return qa})),t.d(c,"min_lbfgsb_gen",(function(){return Ra})),t.d(c,"LineSearchError",(function(){return wn})),t.d(c,"LineSearchNoProgressError",(function(){return vn})),t.d(c,"LineSearchBisectionError",(function(){return pn})),t.d(c,"LineSearchBoundReachedError",(function(){return mn})),t.d(c,"more_thuente_abc",(function(){return Fn})),t.d(c,"more_thuente_u123",(function(){return Pn})),t.d(c,"strong_wolfe",(function(){return Ln})),t.d(c,"lsq_lm_gen",(function(){return Ga})),t.d(c,"tls_lm_gen",(function(){return Ta})),t.d(c,"odr_lm_gen",(function(){return Xa})),t.d(c,"fit_lm_gen",(function(){return za})),t.d(c,"num_grad",(function(){return Qa})),t.d(c,"num_grad_forward",(function(){return Ba})),t.d(c,"OptimizationError",(function(){return ea})),t.d(c,"OptimizationNoProgressError",(function(){return ta})),t.d(c,"root1d_bisect",(function(){return Yn})),t.d(c,"root1d_brent",(function(){return Ha})),t.d(c,"root1d_illinois",(function(){return $a}));var d={};t.r(d),t.d(d,"AleaRNG",(function(){return tt}));var w={};t.r(w),t.d(w,"KDTree",(function(){return io}));var v=t(3),p=t.n(v),m=t(4),g=t.n(m),y={nextUp:function(r){var e=Number.EPSILON,t=Number.MIN_VALUE,n=r*(r<0?1-e/2:1+e);if(!isFinite(r))throw new Error("Assertion failed!");if(!isFinite(n))throw new Error("Assertion failed!");n===r&&(n+=t);var a=r+(n-r)/2;r<a&&a<n&&(n=a);var o=(n+r)/2;return r<o&&o<n&&(n=o),0===n?-0:n},add:function(r,e){return r instanceof E?r.add(e):e instanceof E?e.add(r):r+e},sub:function(r,e){return r instanceof E?r.sub(e):e instanceof E?new E(r).sub(e):r-e},mul:function(r,e){return r instanceof E?r.mul(e):e instanceof E?e.mul(r):r*e},div:function(r,e){return r instanceof E?r.div(e):e instanceof E?new E(r).div(e):r/e},zero:function(r){return y.cast(0,r)},one:function(r){return y.cast(1,r)},neg:function(r){return r instanceof E?r.neg():-r},abs:function(r){return r instanceof E?r.abs():Math.abs(r)},sqrt:function(r){return r instanceof E?r.sqrt():r>=0?Math.sqrt(r):new E(r).sqrt()},exp:function(r){return r instanceof E?r.exp():Math.exp(r)},min:function(r,e){return Math.min(r,e)},max:function(r,e){return Math.max(r,e)},hypot:function(r,e){return Math.hypot(r,e)},atan2:function(r,e){return Math.atan2(r,e)},conj:function(r){return r instanceof E?r.conj():r},is_equal:function(r,e){return r instanceof E?r.equals(e):e instanceof E?e.equals(r):r==e},is_close:function(r,e){var t=1e-8+1e-5*y.max(y.abs(r),y.abs(e));return y.abs(y.sub(r,e))<=t}},b=y,E=function(){function r(e,t){if(p()(this,r),null==e&&(e=0),null==t&&(t=0),null==e.re&&null==e.im||(t=e.im||0,e=e.re||0),this.re=1*e,this.im=1*t,isNaN(e))throw new Error("Real value is NaN.");if(isNaN(t))throw new Error("Imaginary value is NaN.");Object.freeze(this)}return g()(r,[{key:"add",value:function(e,t){return null==e&&(e=0),null==t&&(t=0),null==e.re&&null==e.im||(t=e.im||0,e=e.re||0),new r(this.re+e,this.im+t)}},{key:"sub",value:function(e,t){return null==e&&(e=0),null==t&&(t=0),null==e.re&&null==e.im||(t=e.im||0,e=e.re||0),new r(this.re-e,this.im-t)}},{key:"mul",value:function(e,t){return null==e&&(e=0),null==t&&(t=0),null==e.re&&null==e.im||(t=e.im||0,e=e.re||0),new r(this.re*e-this.im*t,this.re*t+this.im*e)}},{key:"div",value:function(e,t){if(null==e&&(e=0),null==t&&(t=0),null==e.re&&null==e.im||(t=e.im||0,e=e.re||0),0==t)return new r(this.re/e,this.im/e);if(Math.abs(e)>=Math.abs(t)){var n=t/e;return new r((this.re+this.im*n)/(e+t*n),(this.im-this.re*n)/(e+t*n))}var a=e/t;return new r((this.re*a+this.im)/(e*a+t),(this.im*a-this.re)/(e*a+t))}},{key:"equals",value:function(r,e){return null==r&&(r=0),null==e&&(e=0),null==r.re&&null==r.im||(e=r.im||0,r=r.re||0),this.re==r&&this.im==e}},{key:"abs",value:function(){return Math.hypot(this.re,this.im)}},{key:"arg",value:function(){return Math.atan2(this.im,this.re)}},{key:"conj",value:function(){return new r(this.re,-this.im)}},{key:"toFixed",value:function(e){return new r(this.re.toFixed(e),this.im.toFixed(e))}},{key:"sqrt",value:function(){var e=this.abs();return new r(b.sqrt(b.mul(b.add(e,this.re),.5)),b.sqrt(b.mul(b.sub(e,this.re),.5)))}},{key:Symbol.for("nodejs.util.inspect.custom"),value:function(){return this.toString()}},{key:"toString",value:function(){return 0==this.im?this.re.toString():0==this.re?"".concat(this.im,"j"):this.im<0?"".concat(this.re," - ").concat(-this.im,"j"):"".concat(this.re," + ").concat(this.im,"j")}},{key:"valueOf",value:function(){return 0==this.im?this.re:this}}]),r}(),_=t(2),x=t.n(_),A=t(1),M=t.n(A),k=t(9),N=t.n(k);t(19);var F,I,P=(F=Float64Array,I={get:function(r,e){return"symbol"!==N()(e)&&e%1==0?r.get(e):r[e]},set:function(r,e,t){return"symbol"!==N()(e)&&e%1==0?(r.set(e,t),!0):(r[e]=t,!0)}},function(){function r(e,t,n){return p()(this,r),e%1==0?(n=e,this._array=new F(2*n)):(null!=n&&(n*=2),this._array=new F(e,t,n)),Object.seal(this),new Proxy(this,I)}return g()(r,null,[{key:"BYTES_PER_ELEMENT",get:function(){return 2*F.BYTES_PER_ELEMENT}},{key:"name",get:function(){return"Complex".concat(8*r.BYTES_PER_ELEMENT,"Array")}}]),g()(r,[{key:Symbol.iterator,value:M.a.mark((function r(){var e;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e=0;case 1:if(!(e<this.length)){r.next=7;break}return r.next=4,this[e];case 4:e++,r.next=1;break;case 7:case"end":return r.stop()}}),r,this)}))},{key:"keys",value:M.a.mark((function r(){var e;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e=0;case 1:if(!(e<this.length)){r.next=7;break}return r.next=4,e;case 4:e++,r.next=1;break;case 7:case"end":return r.stop()}}),r,this)}))},{key:"values",value:M.a.mark((function r(){return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.delegateYield(this[Symbol.iterator](),"t0",1);case 1:case"end":return r.stop()}}),r,this)}))},{key:"entries",value:M.a.mark((function r(){var e;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e=0;case 1:if(!(e<this.length)){r.next=7;break}return r.next=4,[e,this[e]];case 4:e++,r.next=1;break;case 7:case"end":return r.stop()}}),r,this)}))},{key:"forEach",value:function(r,e){for(var t=0;t<source.length;t++)r.call(e,source[t],t)}},{key:"map",value:function(e,t){return r.from(this,e,t)}},{key:"reduce",value:function(r,e){var t=0;if(null==e){if(0==this.length)throw new TypeError("TypeError: Reduce of empty array with no initial value.");e=this[t++]}for(;t<this.length;t++)e=r(e,this[t],t,this);return e}},{key:"slice",value:function(e,t){return null!=e&&(e*=2),null!=t&&(t*=2),new r(this._array.slice(e,t).buffer)}},{key:"subarray",value:function(e,t){null!=e&&(e*=2),null!=t&&(t*=2);var n=this._array.subarray(e,t);return new r(n.buffer,n.byteOffset,n.length/2)}},{key:"join",value:function(r){null==r&&(r=", ");for(var e="",t=0;t<this.length;t++)t>0&&(e+=r),e+=this[t].toString();return e}},{key:"fill",value:function(r,e,t){r instanceof E||(r=new E(r)),null==e&&(e=0),null==t&&(t=this.length),0>t&&(t+=this.length),0>e&&(e+=this.length);for(var n=this._array.length;(n-=2)>=0;)this._array[n+1]=r.im,this._array[n+0]=r.re;return this}},{key:"get",value:function(r){return new E(this._array[2*r+0],this._array[2*r+1])}},{key:"set",value:function(r,e){if(r*=2,"number"==typeof e||!isNaN(e))return this._array[r+0]=e,void(this._array[r+1]=isNaN(e)?NaN:0);"re"in e&&"im"in e||(e=new E(e)),this._array[r+0]=e.re,this._array[r+1]=e.im}},{key:Symbol.for("nodejs.util.inspect.custom"),value:function(r){return"Complex128Array "+util.inspect(Array.from(this),r)}},{key:"toString",value:function(r){return this.join(",")}},{key:"buffer",get:function(){return this._array.buffer}},{key:"byteOffset",get:function(){return this._array.byteOffset}},{key:"byteLength",get:function(){return this._array.byteLength}},{key:"length",get:function(){return this._array.length>>>1}},{key:Symbol.toStringTag,get:function(){throw new Error("not yet implemented.")}}],[{key:"from",value:function(e,t,n){if(e.hasOwnProperty("length")||(e=x()(e)),null==t){if(e instanceof r)return new r(F.from(e._array).buffer,0,e.length);if(e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array){for(var a=new F(2*e.length),o=e.length;o-- >0;)a[o<<1]=e[o];return new r(a.buffer,0,e.length)}}var i=new r(e.length);t=t||function(r){return r};for(var s=0;s<e.length;s++)i[s]=t.call(n,e[s],s);return i}},{key:"of",value:function(){for(var e=new r(arguments.length),t=0;t<arguments.length;t++)e[t]=t<0||arguments.length<=t?void 0:arguments[t];return e}}]),r}()),q={int32:Int32Array,float32:Float32Array,float64:Float64Array,complex128:P,object:Array};function S(r){switch(O(r),r){case"complex128":return new E(Number.EPSILON);case"float32":return 1.1920928955078125e-7;default:return Number.EPSILON}}function j(r,e){return"int32"===e?4294967295&r:"float32"===e?Math.fround(r):"complex128"===e?r instanceof E?r:new E(r):1*r}function O(r){if(!q.hasOwnProperty(r))throw new Error("Invalid dtype '"+r+"'. Must be one of {'"+Object.getOwnPropertyNames(q).join("', '")+"'}.")}function R(r){return r%1==0?r<=~(1<<31)&&r>=1<<31?"int32":"object":1*r==r?"float64":r instanceof E?"complex128":"object"}var L=function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return e.reduce((function(r,e){return O(r),O(e),"object"===r||"object"===e?"object":"complex128"===r||"complex128"===e?"complex128":"float64"===r||"float64"===e?"float64":"float32"===r||"float32"===e?"float32":"int32"}))};function D(r,e){O(r),O(e);var t={int32:0,float32:1,float64:2,complex128:3,object:4};return t[r]<=t[e]}var J=t(0),T=t.n(J),z=t(6),U=t.n(z),Y=t(7),Q=t.n(Y),B=t(5),C=t.n(B),V=t(8),W=t.n(V);function K(r,e){var t;if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(t=function(r,e){if(!r)return;if("string"==typeof r)return H(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);"Object"===t&&r.constructor&&(t=r.constructor.name);if("Map"===t||"Set"===t)return Array.from(r);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return H(r,e)}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){t=r[Symbol.iterator]()},n:function(){var r=t.next();return i=r.done,r},e:function(r){s=!0,o=r},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw o}}}}function H(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function $(r,e,t){if(null==t&&e instanceof Function&&(t=e,e=void 0),r instanceof Array||(r=x()(r)),r=r.map((function(r){return nr(r)})),null==e&&(e="object"),null==t){if("object"!==e)throw new Error('If zip_fn is undefined, dtype must be "object" or undefined.');var n=r.length;t=function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return e.slice(0,n)}}O(e);var a,o=r.reduce((function(r,e){return Math.max(r,e.ndim)}),0),i=Int32Array.from({length:o},(function(){return 1})),s=K(r);try{for(s.s();!(a=s.n()).done;)for(var f=a.value,l=o,h=f.ndim;l-- >0&&h-- >0;)if(1===i[l])i[l]=f.shape[h];else if(i[l]!=f.shape[h]&&1!=f.shape[h])throw new Error("Shapes are not broadcast-compatible.")}catch(r){s.e(r)}finally{s.f()}var u=new Int32Array(o),c=new q[e](i.reduce((function(r,e){return r*e}),1)),d=new Array(r.length),w=new Int32Array(r.length),v=new Int32Array(r.length),p=0;return function e(n){if(n!==o){for(u[n]=0;e(n+1),!(++u[n]>=i[n]);)for(var a=r.length;a-- >0;)r[a].shape[n-o+r[a].ndim]>1||(w[a]-=v[a]);for(var s=r.length;s-- >0;)v[s]*=r[s].shape[n-o+r[s].ndim]||1}else{v.fill(1);for(var f=r.length;f-- >0;)d[f]=r[f].data[w[f]++];c[p++]=t.apply(void 0,d.concat(x()(u)))}}(0),new ar(i,c)}function Z(r,e){var t;if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(t=function(r,e){if(!r)return;if("string"==typeof r)return rr(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);"Object"===t&&r.constructor&&(t=r.constructor.name);if("Map"===t||"Set"===t)return Array.from(r);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return rr(r,e)}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){t=r[Symbol.iterator]()},n:function(){var r=t.next();return i=r.done,r},e:function(r){s=!0,o=r},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw o}}}}function rr(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function er(r){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(r){return!1}}();return function(){var t,n=C()(r);if(e){var a=C()(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return Q()(this,t)}}function tr(r,e){var t=M.a.mark(a);if(null==e&&(e=r,r=void 0),("object"==N()(e)||"function"==typeof e)&&"shape"in e&&"data"in e){var n=e.data;return null==r?r=e.dtype:"float"===r&&(r=e.dtype.startsWith("float")&&q.hasOwnProperty(r)?e.dtype:"float64"),O(r),n=n instanceof q[r]?n.slice():q[r].from(n),new ar(e.shape,n)}function a(r){var e;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("object"!==N()(r)||!("length"in r)){t.next=11;break}if("number"==typeof(e=r.length)){t.next=4;break}throw new Error("Illegal argument(s).");case 4:if(0==e%1){t.next=6;break}throw new Error("Illegal argument(s).");case 6:if(0!==e){t.next=8;break}throw new Error("Illegal argument(s).");case 8:return t.next=10,e;case 10:return t.delegateYield(a(r[0]),"t0",11);case 11:case"end":return t.stop()}}),t)}a=Int32Array.from(a(e)),null==r?r=function r(e,t){if(e===a.length)return R(t);for(var n=a[e]-1,o=r(e+1,t[n]);n>=0;n--)o=L(o,r(e+1,t[n]));return o}(0,e):"float"===r&&(r="float64"),O(r);var o=new q[r](a.reduce((function(r,e){return r*e}),1)),i=0;return function r(e,t){if(e===a.length)o[i++]=t;else{if(t.length!==a[e])throw new Error("Nested array not axis-aligned.");for(var n=0;n<a[e];n++)r(e+1,t[n])}}(0,e),new ar(a,o)}function nr(r,e){if(null==e&&(e=r,r=void 0),null!=r&&"float"!==r&&!(r in q))throw new Error("asarray(dtype, arrayLike): Invalid dtype: '".concat(r,"'."));return e instanceof ar?null==r||r===e.dtype||"float"===r&&e.dtype.startsWith("float")?e:new ar(e.shape,q[r].from(e.data)):("float"===r&&(r="float64"),tr(r,e))}var ar=function(r){U()(e,r);er(e);function e(r,t){if(p()(this,e),!(r instanceof Int32Array))throw new Error("Shape must be Int32Array.");if(r.some((function(r){return r<1})))throw new Error("Invalid shape: ".concat(r,"."));if(t.length!=r.reduce((function(r,e){return r*e}),1))throw new Error("Shape [".concat(r,"] does not match array length of ").concat(t.length,"."));var n=function r(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.data[r._flat_idx(t)]};return Object.setPrototypeOf(n,e.prototype),Object.freeze(r.buffer),n.shape=r,n.data=t,Object.seal(n),Q()(void 0,n)}return g()(e,null,[{key:"name",get:function(){return"nd.Array"}}]),g()(e,[{key:"set",value:function(r,e){this.data[this._flat_idx(r)]=e}},{key:"modify",value:function(r,e){var t=this._flat_idx(r);this.data[t]=e.apply(void 0,[this.data[t]].concat(x()(r)))}},{key:"_flat_idx",value:function(r){var e=this.shape;if(r.length!=e.length)throw new Error("Multi-index [".concat(r,"] does not have expected length of ").concat(e.length,"."));for(var t=0,n=1,a=e.length;a-- >0;n*=e[a]){var o=r[a];if(o%1!=0)throw new Error("Multi-index [".concat(r,"] contains non-integer entries."));if(o<0&&(o+=e[a]),o<0||o>=e[a])throw new Error("Multi-index [".concat(r,"] out of bounds [").concat(e,"]."));t+=o*n}return t}},{key:Symbol.for("nodejs.util.inspect.custom"),value:function(r,e){return this.toString()}},{key:"toString",value:function(){var r=M.a.mark(f),e=M.a.mark(u),t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(r,e){return e.length,6};if(!(t instanceof Function)){var n=1*t;t=function(){return n}}var a=this.shape,o=this.data,i=new Int32Array(a.length);i[i.length-1]=1;for(var s=i.length;--s>0;)i[s-1]=i[s]*a[s];function f(e,n){var s,l,h,u,c,d,w;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=t(e,a),h=s-(l=s>>>1),a.length!==e){r.next=16;break}u=o[n],r.t0=u,r.next=null===r.t0?6:void 0===r.t0?9:12;break;case 6:return r.next=8,"null";case 8:return r.abrupt("break",14);case 9:return r.next=11,"undefined";case 11:return r.abrupt("break",14);case 12:return r.next=14,u.toString();case 14:r.next=37;break;case 16:if(!(a[e]>s+1)){r.next=31;break}c=0;case 18:if(!(c<h)){r.next=23;break}return r.delegateYield(f(e+1,n+c*i[e]),"t1",20);case 20:c++,r.next=18;break;case 23:d=a[e]-l;case 24:if(!(d<a[e])){r.next=29;break}return r.delegateYield(f(e+1,n+d*i[e]),"t2",26);case 26:d++,r.next=24;break;case 29:r.next=37;break;case 31:w=0;case 32:if(!(w<a[e])){r.next=37;break}return r.delegateYield(f(e+1,n+w*i[e]),"t3",34);case 34:w++,r.next=32;break;case 37:case"end":return r.stop()}}),r)}if(f=x()(f(0,0)),this.ndim>1){var l=f.reduce((function(r,e){return Math.max(r,e.length)}),0);f=f.map((function(r){return r.padStart(l)}))}var h=0;function u(r,n,o){var s,l,c,d,w,v,p,m,g;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.length!==n){e.next=4;break}return e.next=3,f[h++];case 3:return e.abrupt("return");case 4:return r+=" ",s="[ ",l=", ",c=" ]",n<a.length-1&&(l=",\n"+r,s="[",c="]"),e.next=9,s;case 9:if(d=t(n,a),v=d-(w=d>>>1),!(a[n]>d+1)){e.next=31;break}p=0;case 12:if(!(p<v)){e.next=19;break}return e.delegateYield(u(r,n+1,o+p*i[n]),"t0",14);case 14:return e.next=16,l;case 16:p++,e.next=12;break;case 19:return e.next=21,"...".concat(a[n]-d," more...");case 21:m=a[n]-w;case 22:if(!(m<a[n])){e.next=29;break}return e.next=25,l;case 25:return e.delegateYield(u(r,n+1,o+m*i[n]),"t1",26);case 26:m++,e.next=22;break;case 29:e.next=40;break;case 31:g=0;case 32:if(!(g<a[n])){e.next=40;break}if(!(g>0)){e.next=36;break}return e.next=36,l;case 36:return e.delegateYield(u(r,n+1,o+g*i[n]),"t2",37);case 37:g++,e.next=32;break;case 40:return e.next=42,c;case 42:case"end":return e.stop()}}),e)}return x()(u("",0,0)).join("")}},{key:"toNestedArray",value:function(){var r=this.data,e=this.shape,t=0;return function n(a){return a===e.length?r[t++]:Array.from({length:e[a]},(function(){return n(a+1)}))}(0)}},{key:Symbol.iterator,value:M.a.mark((function r(){var t,n,a;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t=this.shape.slice(1),n=t.reduce((function(r,e){return r*e}),1),a=0;case 2:if(!(a<this.data.length)){r.next=7;break}return r.next=5,new e(t,this.data.slice(a,a+=n));case 5:r.next=2;break;case 7:case"end":return r.stop()}}),r,this)}))},{key:"forEach",value:function(r){for(var t=this.shape[0],n=this.shape.slice(1),a=n.reduce((function(r,e){return r*e}),1),o=0,i=0;o<t;o++,i+=a)r(new e(n,this.data.slice(i,i+a)),o)}},{key:"elems",value:M.a.mark((function(){var r,e,t,n,a,o;return M.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=function(i){return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i!==e.length){r.next=5;break}return r.next=3,[n.slice(),t[a++]];case 3:r.next=11;break;case 5:n[i]=0;case 6:if(!(n[i]<e[i])){r.next=11;break}return r.delegateYield(o(i+1),"t0",8);case 8:n[i]++,r.next=6;break;case 11:case"end":return r.stop()}}),r)},r=M.a.mark(o),e=this.shape,t=this.data,n=new Int32Array(e.length),a=0,i.delegateYield(o(0),"t0",5);case 5:case"end":return i.stop()}}),o,this)}))},{key:"forElems",value:function(r){var e=this.shape,t=this.data,n=new Int32Array(e.length),a=0;!function o(i){if(i===e.length)r.apply(void 0,[t[a++]].concat(x()(n)));else for(n[i]=0;n[i]<e[i];n[i]++)o(i+1)}(0)}},{key:"valueOf",value:function(){return 0===this.shape.length?this.data[0]:this}},{key:"mapElems",value:function(r,t){if(null==t){if(null==r)return new e(this.shape,this.data.slice());r instanceof Function&&(t=r,r=void 0)}return null==t&&(t=function(r){return r}),$([this],r,t)}},{key:"transpose",value:function(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];t=x()(t);var a=Int32Array.from(this.shape),o=a.length,i=new Int32Array(o);o>0&&(i[o-1]=1);for(var s=o;--s>0;)i[s-1]=a[s]*i[s];if(0==t.length){if(o<=1)return this.sliceElems();a[o-2]=this.shape[o-1],a[o-1]=this.shape[o-2];var f=i[o-2];i[o-2]=i[o-1],i[o-1]=f}else{var l=new Set(t),h=i;if(i=new Int32Array(o),l.size!=t.length)throw new Error("Duplicate axes are not allowed.");for(var u=t.length;u-- >0;){var c=t[u];if(0>c||c>=o)throw new Error("Axis out of bounds.");a[u]=this.shape[c],i[u]=h[c]}for(var d=0,w=l.size;d<o;d++)l.has(d)||(a[w]=this.shape[d],i[w++]=h[d])}var v=this.data,p=new v.__proto__.constructor(v.length),m=v.length;function g(r,e){if(o>r)for(var t=a[r];t-- >0;e-=i[r])g(r+1,e);else p[--m]=v[e]}return g(0,m-1),new e(a,p)}},{key:"reshape",value:function(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];t=Int32Array.from(t);for(var a=this.data.length,o=1,i=-1,s=t.length;--s>=0;)if(t[s]<0){if(-1!==t[s])throw new Error("Invalid dimension: "+t[s]);if(-1!==i)throw new Error("At most on dimension may be -1.");i=s}else o*=t[s];if(-1!==i){if(0!=a%o)throw new Error("Shape cannot be inferred.");t[i]=a/o}return new e(t,this.data)}},{key:"reduceElems",value:function(r,t,n){if(null==n){if(null==t)return this.data.reduce(r);if("string"==typeof r)return this.data.reduce(t);n=t,t=void 0}if(null==t&&(t="object"),!D(this.dtype,t))throw new Error("New dtype must be a super-dtype.");var a=this.ndim;if("number"==typeof r&&(r=[r]),r instanceof e){if(!D(r.dtype,"int32"))throw new Error("Invalid dtype ".concat(r.dtype," for axes."));if(1!==r.ndim)throw new Error("Only 1D nd.Array allowed for axes.");r=r.data}r=new Set(M.a.mark((function e(){var t,n,o;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Z(r),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=12;break}if(0>(o=n.value)&&(o+=a),!(0>o||o>=a)){e.next=8;break}throw new Error("Reduction axis "+o+" out of bounds.");case 8:return e.next=10,+o;case 10:e.next=3;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),t.e(e.t0);case 17:return e.prev=17,t.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[1,14,17,20]])}))());var o=this.shape,i=o.filter((function(e,t){return!r.has(t)})),s=new q[t](i.reduce((function(r,e){return r*e}),1)),f=this.data,l=0,h=0;if(function e(t,a){if(o.length===t)s[l]=a?n(f[h++],s[l]):f[h++],++l;else if(r.has(t))for(var i=l,u=o[t];u-- >0;a=!0)l=i,e(t+1,a);else for(var c=o[t];c-- >0;)e(t+1,a)}(0,!1),l!=s.length)throw new Error([l,s.length]);if(h!=this.data.length)throw new Error([h,this.data.length]);return new e(i,s)}},{key:"sliceElems",value:function(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];for(var a=this.ndim,o=this.shape,i=0,s=0,f=0,l=0,h=t;l<h.length;l++){var u=h[l];if("..."===u)++i;else if("new"===u)0;else if("number"==typeof u){if(u%1!=0)throw new Error("Only integral indices allowed.");++s}else{var c=u.length;if("number"!=typeof c||c%1!=0||c>3||1==c)throw new Error("Illegal argument(s).");++f}}if(i>1)throw new Error("Highlander! There can be only one ... (ellipsis).");if(0==i&&t.push("..."),s+f>a)throw new Error("Cannot sliced more dimensions than available.");var d=0,w=[],v=Int32Array.from(M.a.mark((function r(){var e,n,i,l,h,u,c,v,p,m,g,y,b;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e=a,n=1,i=t.length;case 2:if(!(--i>=0)){r.next=54;break}l=t[i],r.t0=l,r.next="new"===r.t0?7:"..."===r.t0?11:21;break;case 7:return w.push(0),r.next=10,1;case 10:return r.abrupt("break",52);case 11:h=s+f;case 12:if(!(h<a)){r.next=20;break}return w.push(n),n*=o[--e],r.next=17,o[e];case 17:h++,r.next=12;break;case 20:return r.abrupt("break",52);case 21:if(--e,"number"!=typeof l){r.next=29;break}if(0>l&&(l+=o[e]),!(0>l||l>=o[e])){r.next=26;break}throw new Error("Index out of bounds.");case 26:d+=n*l,r.next=51;break;case 29:if(u=l,c=T()(u,3),v=c[0],p=void 0===v?void 0:v,m=c[1],g=void 0===m?void 0:m,y=c[2],b=void 0===y?1:y,g<0&&(g+=o[e]),p<0&&(p+=o[e]),!(0>p||p>=o[e])){r.next=34;break}throw new Error("Slice start out of bounds.");case 34:if(0!=b){r.next=36;break}throw new Error("Stride/step cannot be zero.");case 36:if(!(b<0)){r.next=43;break}if(null==p&&(p=o[e]-1),null==g&&(g=-1),!(-1>g||g>=o[e])){r.next=41;break}throw new Error("Slice end out of bounds.");case 41:r.next=47;break;case 43:if(null==p&&(p=0),null==g&&(g=o[e]),!(0>g||g>o[e])){r.next=47;break}throw new Error("Slice end out of bounds.");case 47:return w.push(n*b),d+=n*p,r.next=51,1+Math.trunc((-Math.sign(b)+g-p)/b);case 51:n*=o[e];case 52:r.next=2;break;case 54:case"end":return r.stop()}}),r)}))()),p=this.data,m=new q[this.dtype](v.reduce((function(r,e){return r*e}),1)),g=0;function y(r,e){if(0===r)m[g++]=p[e];else for(var t=v[--r];t-- >0;e+=w[r])y(r,e)}return y(v.length,d),v.reverse(),new e(v,m)}},{key:"ndim",get:function(){return this.shape.length}},{key:"dtype",get:function(){for(var r=0,e=Object.entries(q);r<e.length;r++){var t=T()(e[r],2),n=t[0],a=t[1];if(this.data instanceof a)return n}throw new Error("Data type could not determined.")}},{key:"T",get:function(){return 0==this.ndim?this.sliceElems():1==this.ndim?this.sliceElems([],"new"):this.transpose()}},{key:"H",get:function(){var r=this.T;return"object"!=this.dtype&&"complex128"!=this.dtype?r:r.mapElems(math.conj)}}]),e}(W()(Function));function or(r,e,t){if(null==t&&(null==e?(t=r,r=void 0):(t=e,e=void 0,"string"==typeof r&&(e=r,r=void 0))),t=Array.from(t,(function(r){return nr(e,r)})),null==r&&(r=0),null==e&&(e=L.apply(void 0,x()(t.map((function(r){return r.dtype}))))),0>r&&(r+=t[0].shape.length),0>r||r>=t[0].shape.length)throw new Error("Axis out of bounds.");for(var n=Int32Array.from(t[0].shape),a=function(e){var a=t[e].shape;if(n.length!=a.length)throw new Error("All shapes must have the same length.");if(!n.every((function(e,t){return n[t]===a[t]||r===t})))throw new Error("Shape along all axes but the concatentation axis must match.");n[r]+=a[r]},o=t.length;--o>0;)a(o);var i=n.slice(r+1).reduce((function(r,e){return r*e}),1),s=Int32Array.from(t,(function(r){return r.data.length})),f=new q[e](n.reduce((function(r,e){return r*e}),1)),l=f.length;return function e(a){if(a===r)for(var o=t.length;o-- >0;)for(var h=t[o].shape[a]*i;h-- >0;)f[--l]=t[o].data[--s[o]];else for(var u=n[a];u-- >0;)e(a+1)}(0),new ar(n,f)}var ir,sr=!0,fr=(ir=NaN,function(){if(sr&&(sr=!1,console.warn(new Error("nd.rand_normal is deprecated, use nd.rand.AleaRNG instead."))),!isNaN(ir)){var r=ir;return ir=NaN,r}var e,t,n;do{n=(e=2*Math.random()-1)*e+(t=2*Math.random()-1)*t}while(n>1||0==n);var a=Math.sqrt(-2*Math.log(n)/n);return ir=a*e,a*t});function lr(r,e,t){if(null==t&&(null==e?(t=r,r=void 0):(t=e,e=void 0,"string"==typeof r&&(e=r,r=void 0))),t=Array.from(t,(function(r){return nr(e,r)})),null==r&&(r=0),0>r&&(r+=t[0].shape.length+1),0>r||r>t[0].shape.length)throw new Error("Axis out of bounds.");return t=t.map((function(e){return e.reshape.apply(e,x()(e.shape.slice(0,r)).concat([1],x()(e.shape.slice(r))))})),or(r,e,t)}function hr(r,e,t){if(r=Int32Array.from(r,(function(e){if(e%1!=0)throw new Error("tabulate(shape, dtype='object', idx2val): Invalid shape [".concat(r,"]."));return e})),null==t&&(t=e,e=void 0),null==t)throw new Error("tabulate(shape, dtype='object', idx2val): idx2val missing.");null==e&&(e="object"),O(e);var n=new Int32Array(r.length),a=new q[e](r.reduce((function(r,e){return r*e}),1)),o=0;return function e(i){if(i===r.length)a[o++]=t.apply(void 0,x()(n));else for(n[i]=0;n[i]<r[i];n[i]++)e(i+1)}(0),new ar(r,a)}function ur(r,e){if(null==e)e=r,r="float64";else{if(!(r in q))throw new Error("regular_simplex(dtype,N): dtype '".concat(r,"' not supported."));if(r.startsWith("int"))throw new Error("regular_simplex(dtype,N): dtype must not be integral.")}if(e%1!=0)throw new Error("regular_simplex(N): N must be a valid integer.");if(!(0<e))throw new Error("regular_simplex(N): N must be greater than 0.");e|=0;for(var t=new q[r]((e+1)*e),n=Int32Array.of(e+1,e),a=1;a<e+1;a++){for(var o=0;o<a-1;o++)t[e*a+o]=t[e*(a-1)+o];t[e*a+(a-2)]/=a,t[e*a+(a-1)]=Math.sqrt((a+1)/(2*a))}return new ar(n,t)}function cr(r,e,t,n){var a=r(e=nr(e),t).mapElems((function(r){return r*n})),o=r($([e,a],(function(r,e){return r+e/2})),t+n/2).mapElems((function(r){return r*n})),i=r($([e,o],(function(r,e){return r+e/2})),t+n/2).mapElems((function(r){return r*n})),s=r($([e,i],(function(r,e){return r+e})),t+n).mapElems((function(r){return r*n}));return $([e,a,o,i,s],(function(r,e,t,n,a){return r+(e+2*(t+n)+a)/6}))}function dr(r,e){var t;if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(t=function(r,e){if(!r)return;if("string"==typeof r)return wr(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);"Object"===t&&r.constructor&&(t=r.constructor.name);if("Map"===t||"Set"===t)return Array.from(r);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return wr(r,e)}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){t=r[Symbol.iterator]()},n:function(){var r=t.next();return i=r.done,r},e:function(r){s=!0,o=r},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw o}}}}function wr(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}var vr=M.a.mark(_r),pr=M.a.mark(Ar),mr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",gr=Int32Array.from({length:256},(function(){return-2}));if(64!==mr.length)throw new Error("Assertion failed.");for(var yr=mr.length;yr-- >0;)gr[mr.charCodeAt(yr)]=yr;for(var br="\f\n\r\t\v ".length;br-- >0;)gr["\f\n\r\t\v ".charCodeAt(br)]=-1;function Er(r){return Uint8Array.from(_r(r))}function _r(r){var e,t,n,a,o,i,s;return M.a.wrap((function(f){for(;;)switch(f.prev=f.next){case 0:n=function(){console.warn("_b64_decode(b64_chars): Base64 sequence ended unexpectedly.")},t=function(){for(;;){var t=void 0,n=r.next();if(t=n.value,e=(e=n.done)||"="===t)return NaN;if("string"!=typeof t||1!==t.length)throw new Error("_b64_decode(b64_chars): Invalid token in character sequence: ".concat(t,"."));if(-1!==(t=gr[t.charCodeAt(0)])){if(!(t>=0))throw new Error("_b64_decode(b64_chars): Invalid base64 character '".concat(t,"'."));return t}}},r=r[Symbol.iterator]();case 3:if(a=t(),!e){f.next=7;break}return f.abrupt("return");case 7:if(o=t(),!e){f.next=10;break}return f.abrupt("return",n());case 10:return f.next=12,a<<2|o>>4;case 12:if(i=t(),!e){f.next=15;break}return f.abrupt("return");case 15:return f.next=17,(15&o)<<4|i>>2;case 17:if(s=t(),!e){f.next=20;break}return f.abrupt("return");case 20:return f.next=22,(3&i)<<6|63&s;case 22:f.next=3;break;case 24:case"end":return f.stop()}}),vr)}function xr(r){var e,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="",a=dr(Ar(r,t));try{for(a.s();!(e=a.n()).done;){var o=e.value;n+=o}}catch(r){a.e(r)}finally{a.f()}return n}function Ar(r){var e,t,n,a,o,i,s,f,l,h,u=arguments;return M.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(e=u.length>1&&void 0!==u[1]?u[1]:{},t=e.pad,n=void 0===t||t,a=e.linewidth,0<(o=void 0===a?128:a)){c.next=3;break}throw new Error("_b64_encode(bytes,{linewidth}): Invalid linewidth: ".concat(o,"."));case 3:i=r[Symbol.iterator](),r=M.a.mark((function r(){var e,t,n;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e=dr(i),r.prev=1,e.s();case 3:if((t=e.n()).done){r.next=12;break}if(n=t.value,0<=(n*=1)&&n<256){r.next=8;break}throw new Error("_b64_encode(bytes): Invalid token in byte sequence: ".concat(n));case 8:return r.next=10,n;case 10:r.next=3;break;case 12:r.next=17;break;case 14:r.prev=14,r.t0=r.catch(1),e.e(r.t0);case 17:return r.prev=17,e.f(),r.finish(17);case 20:case"end":return r.stop()}}),r,null,[[1,14,17,20]])}))(),s=0,f=dr(M.a.mark((function e(){var t,n,a,o,i;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0,a=r.next(),t=a.value,!a.done){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,t>>2;case 9:if(n=(3&t)<<4,o=r.next(),t=o.value,!o.done){e.next=17;break}return e.next=16,n;case 16:return e.abrupt("return");case 17:return e.next=19,t>>4|n;case 19:if(n=(15&t)<<2,i=r.next(),t=i.value,!i.done){e.next=27;break}return e.next=26,n;case 26:return e.abrupt("return");case 27:return e.next=29,t>>6|n;case 29:return e.next=31,63&t;case 31:e.next=0;break;case 33:case"end":return e.stop()}}),e)}))()),c.prev=8,f.s();case 10:if((l=f.n()).done){c.next=23;break}if("number"==typeof(h=l.value)){c.next=14;break}throw new Error("Assertion failed.");case 14:if(0<=h&&h<64){c.next=16;break}throw new Error("Assertion failed.");case 16:return c.next=18,mr[h];case 18:if(0!=++s%o){c.next=21;break}return c.next=21,"\n";case 21:c.next=10;break;case 23:c.next=28;break;case 25:c.prev=25,c.t0=c.catch(8),f.e(c.t0);case 28:return c.prev=28,f.f(),c.finish(28);case 31:if(!n){c.next=37;break}case 32:if(0==s++%4){c.next=37;break}return c.next=35,"=";case 35:c.next=32;break;case 37:case"end":return c.stop()}}),pr,null,[[8,25,28,31]])}var Mr=M.a.mark(Pr);function kr(r,e){var t;if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(t=function(r,e){if(!r)return;if("string"==typeof r)return Nr(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);"Object"===t&&r.constructor&&(t=r.constructor.name);if("Map"===t||"Set"===t)return Array.from(r);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Nr(r,e)}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){t=r[Symbol.iterator]()},n:function(){var r=t.next();return i=r.done,r},e:function(r){s=!0,o=r},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw o}}}}function Nr(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function Fr(r){r=r[Symbol.iterator]();for(var e=[];;){var t=r.next(),n=t.value;if(t.done)throw new Error("b64_parse(b64_chars): Invalid b64_chars.");if("["===n)break;e.push(n)}if(""===(e=e.join("").trim()))throw new Error("b64_parse(b64_chars): dtype=object not (yet) supported.");O(e);for(var a=[],o=[];;){var i=r.next(),s=i.value;if(i.done)throw new Error("b64_parse(b64_chars): Invalid b64_chars.");if("]"===s&&0===o.length)break;if("]"!==s&&","!==s)o.push(s);else{var f=o.join("");if(isNaN(f))throw new Error('b64_parse(b64_chars): Invalid shape entry: "'.concat(f,'".'));if(a.push(1*f),"]"===s)break;o=[]}}a=Int32Array.from(a),r=_r(r);for(var l=q[e],h=new Uint8Array(a.reduce((function(r,e){return r*e}),l.BYTES_PER_ELEMENT)),u=new Uint8Array(l.BYTES_PER_ELEMENT),c=0;c<h.length;){for(var d=0;d<u.length;d++){var w=r.next(),v=w.value;if(w.done)throw new Error("b64_parse(b64_chars): b64_chars too short.");u[d]=v}Gr||u.reverse();for(var p=0;p<u.length;p++,c++)h[c]=u[p]}return new ar(a,new l(h.buffer))}function Ir(r){var e,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="",a=kr(Pr(r,t));try{for(a.s();!(e=a.n()).done;){var o=e.value;n+=o}}catch(r){a.e(r)}finally{a.f()}return n}function Pr(r){var e,t,n=arguments;return M.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e=n.length>1&&void 0!==n[1]?n[1]:{},r=nr(r),t=r.data,"object"!==r.dtype){a.next=5;break}throw new Error("b64_format(A): A.dtype='".concat(r.dtype,"' not supported."));case 5:if(Gr){a.next=7;break}throw new Error("Big endianness not (yet) supported.");case 7:return a.delegateYield("".concat(r.dtype,"[").concat(r.shape.join(","),"]\n"),"t0",8);case 8:return a.delegateYield(Ar(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),e),"t1",9);case 9:case"end":return a.stop()}}),Mr)}function qr(r,e){var t;if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(t=function(r,e){if(!r)return;if("string"==typeof r)return Sr(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);"Object"===t&&r.constructor&&(t=r.constructor.name);if("Map"===t||"Set"===t)return Array.from(r);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Sr(r,e)}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){t=r[Symbol.iterator]()},n:function(){var r=t.next();return i=r.done,r},e:function(r){s=!0,o=r},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw o}}}}function Sr(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function jr(r){var e=function(){var e=!1,t=0,n=r[Symbol.iterator](),a=function(){var r=n.next(),a=r.value,o=r.done;if(++t,o){if(e)throw new Error("pyon_parse: Character sequence ended unexpectedly.");return e=!0,null}return a};return[a,function(){for(var r;;)switch(r=a()){default:return r;case"\f":case"\n":case"\r":case"\t":case"\v":case" ":}},function(r,e){var n=null==e?"Invalid character":"Expected ".concat(e,", but ");throw new Error("pyon_parse: ".concat(n," '").concat(r,"' encountered as ").concat(t,"-th character."))}]}(),t=T()(e,3),n=t[0],a=t[1],o=t[2];function i(){switch(s){default:o(s);case"{":return function(){var r={};if("{"!==s)throw new Error("Assertion failed.");for(;;){if("}"===(s=a()))return s=a(),r;var e=i();switch(":"!==s&&o(s,end),s=a(),r[e]=i(),s){default:o(s,",' or '}");case",":continue;case"}":return s=a(),r}}}();case'"':case"'":return function(){var r=s;switch(r){default:throw new Error("Assertion failed.");case"'":case'"':}for(var e="";;)switch(s=n()){case r:return s=a(),e;case"\\":switch(s=n()){case"u":for(var t=0,i=0;i<4;i++)switch(t<<=8,s=n()){default:o(s,"Hexadecimal digit");case"f":case"F":++t;case"e":case"E":++t;case"d":case"D":++t;case"c":case"C":++t;case"b":case"B":++t;case"a":case"A":++t;case"9":++t;case"8":++t;case"7":++t;case"6":++t;case"5":++t;case"4":++t;case"3":++t;case"2":++t;case"1":++t;case"0":++t}e+=String.fromCodePoint(t);continue;case"b":e+="\b";continue;case"f":e+="\f";continue;case"n":e+="\n";continue;case"r":e+="\r";continue;case"t":e+="\t";continue}default:e+=s}}();case"(":case"[":return function(){for(var r=function(){switch(s){case"(":return")";case"[":return"]";default:throw new Error("Assertion failed.")}}(),e=[];;){switch(s=a()){case r:return s=a(),e}switch(e.push(i()),s){default:o(s,",' or '".concat(r));case",":continue;case r:return s=a(),e}}}();case"T":return function(){if("T"!==s)throw new Error("Assertion failed.");var r,e=qr("rue");try{for(e.s();!(r=e.n()).done;){var t=r.value;s=n(),t!==s&&o(s,t)}}catch(r){e.e(r)}finally{e.f()}return s=a(),!0}();case"F":return function(){if("F"!==s)throw new Error("Assertion failed.");var r,e=qr("alse");try{for(e.s();!(r=e.n()).done;){var t=r.value;s=n(),t!==s&&o(s,t)}}catch(r){e.e(r)}finally{e.f()}return s=a(),!1}();case"N":return function(){if("N"!==s)throw new Error("Assertion failed.");var r,e=qr("one");try{for(e.s();!(r=e.n()).done;){var t=r.value;s=n(),t!==s&&o(s,t)}}catch(r){e.e(r)}finally{e.f()}return s=a(),null}();case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case".":case"8":case"+":case"9":case"-":return function(){var r="";r:for(;;s=n())switch(s){case"\f":case"\n":case"\r":case"\t":case"\v":case" ":s=a();default:break r;case"0":case"1":case"2":case"3":case"a":case"A":case"4":case"b":case"B":case"5":case"c":case"C":case"6":case"d":case"D":case"7":case"e":case"E":case".":case"8":case"f":case"F":case"+":case"9":case"e":case"E":case"-":r+=s}r=1*r.trim(),isNaN(r)&&o(r);return r}()}}var s=a();return i()}var Or=M.a.mark(Lr);function Rr(r){return Uint8Array.from(Lr(r))}function Lr(r){var e,t,n,a,o,i;return M.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:r=nr(r),e=function(){switch(r.dtype){default:throw new Error("nd_to_npy: A.dtype=".concat(r.dtype," not yet supported."));case"int32":return"i4";case"float32":return"f4";case"float64":return"f8";case"complex128":return"c16"}}(),t='{"descr": "'.concat(e=Gr?"<"+e:">"+e,'", "fortran_order": False, "shape": (').concat(r.shape).concat(r.ndim>0?",":"",")}"),n=0;case 5:if(!(n<"NUMPY".length)){s.next=11;break}return s.next=8,"NUMPY".codePointAt(n);case 8:n++,s.next=5;break;case 11:return s.next=13,1;case 13:return s.next=15,0;case 15:if(!((a=t.length+11+63>>>6<<6)>65535)){s.next=18;break}throw new Error("nd_to_npy: Header too large.");case 18:return s.next=20,a-10>>>0&255;case 20:return s.next=22,a-10>>>8&255;case 22:if(a%64==0){s.next=24;break}throw new Error("Assertion failed.");case 24:o=0;case 25:if(!(o<t.length)){s.next=31;break}return s.next=28,t.codePointAt(o);case 28:o++,s.next=25;break;case 31:i=t.length+11;case 32:if(!(i<a)){s.next=38;break}return s.next=35," ".codePointAt(0);case 35:i++,s.next=32;break;case 38:return s.next=40,"\n".codePointAt(0);case 40:return s.delegateYield(new Uint8Array(r.data.buffer,r.data.byteOffset,r.data.byteLength),"t0",41);case 41:case"end":return s.stop()}}),Or)}function Dr(r){var e,t,n=(t=r[Symbol.iterator](),function(){var r=t.next(),e=r.value,n=r.done;if(n)throw new Error("npy_to_nd: byte sequence ended unexpectedly.");return e});r=void 0;for(var a="";a.length<6;)a+=String.fromCodePoint(n());if("NUMPY"!==a)throw new Error("npy_to_nd: byte sequence does not start with 'NUMPY'.");var o="".concat(n(),".").concat(n());switch(o){default:throw new Error("npy_bytes: npy-file version ".concat(o," not supported."));case"1.0":case"2.0":}var i=function(){var r=1*n()+256*n();if("2.0"===o&&(r+=65536*n()+n()*(1<<24)),r<0)throw new Error("Assertion failed.");return jr(M.a.mark((function e(){return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r-- >0)){e.next=5;break}return e.next=3,String.fromCodePoint(n());case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e)}))())}(),s=function(){switch(i.descr[0]){default:throw new Error("npy_to_nd: dtype '".concat(i.descr,"' not yet supported."));case"<":return!0;case">":return!1}}(),f=function(){switch(i.descr.slice(1)){default:throw new Error("npy_to_nd: dtype '".concat(i.descr,"' not yet supported."));case"i4":return"int32";case"f4":return"float32";case"f8":return"float64";case"c16":return"complex128"}}(),l=q[f],h=Uint8Array.from({length:i.shape.reduce((function(r,e){return r*e}),l.BYTES_PER_ELEMENT)},n);if(s!==Gr)for(var u=l.BYTES_PER_ELEMENT>>>f.startsWith("complex"),c=0;c<h.length;c+=u)for(var d=c,w=c+u;d<--w;d++){var v=h[d];h[d]=h[w],h[w]=v}var p=Int32Array.from(i.shape);i.fortran_order&&p.reverse();var m=new ar(p,new l(h.buffer));return i.fortran_order&&m.ndim>1&&(m=(e=m).transpose.apply(e,x()(M.a.mark((function r(){var e;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e=m.ndim;case 1:if(!(e-- >0)){r.next=6;break}return r.next=4,e;case 4:r.next=1;break;case 6:case"end":return r.stop()}}),r)}))()))),m}var Gr=1===new Int16Array(Uint8Array.of(1,0).buffer)[0],Jr="\f\n\r\t\v ";function Tr(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(r,e){return(r>e)-(r<e)};if(!(e instanceof Function))throw new Error("argmin(seq,compare_fn): compare_fn must be a function.");Symbol.iterator in r?r=r[Symbol.iterator]():console.warn("argmin(seq,compare_fn): seq[Symbol.iterator] does not exist.");for(var t=function(){var e=r.next();if(e.done)throw new Error("argmin(seq,compare_fn): seq must be an iterable containing at least one item.");return e.value}(),n=0,a=1;;a++){var o=r.next();if(o.done)return n;e(t,o.value)>0&&(n=a,t=o.value)}}function Xr(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(r,e){return(r>e)-(r<e)};if(!(e instanceof Function))throw new Error("argmax(seq,compare_fn): compare_fn must be a function.");return Tr(r,(function(r,t){return-e(r,t)}))}function zr(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(r,e){return(r>e)-(r<e)};if(!(e instanceof Function))throw new Error("argmin(seq,compare_fn): compare_fn must be a function.");Symbol.iterator in r?r=r[Symbol.iterator]():console.warn("argmin(seq,compare_fn): seq[Symbol.iterator] does not exist.");for(var t=function(){var e=r.next();if(e.done)throw new Error("argmin(seq,compare_fn): seq must be an iterable containing at least one item.");return e.value}();;){var n=r.next();if(n.done)return t;e(t,n.value)>0&&(t=n.value)}}function Ur(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(r,e){return(r>e)-(r<e)};if(!(e instanceof Function))throw new Error("argmax(seq,compare_fn): compare_fn must be a function.");return zr(r,(function(r,t){return-e(r,t)}))}function Yr(r,e){var t;if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(t=function(r,e){if(!r)return;if("string"==typeof r)return Qr(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);"Object"===t&&r.constructor&&(t=r.constructor.name);if("Map"===t||"Set"===t)return Array.from(r);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Qr(r,e)}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){t=r[Symbol.iterator]()},n:function(){var r=t.next();return i=r.done,r},e:function(r){s=!0,o=r},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw o}}}}function Qr(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}var Br=M.a.mark($r),Cr=M.a.mark(Zr),Vr=M.a.mark(re),Wr=M.a.mark(ee),Kr=M.a.mark(te),Hr=M.a.mark(ne);function $r(r,e,t){var n,a;return M.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(t%1==0){o.next=2;break}throw new Error("linspace(start,end,num): num must be an integer greater than 1.");case 2:if(t>1){o.next=4;break}throw new Error("linspace(start,end,num): num must be an integer.greater than 1.");case 4:if(isFinite(r)){o.next=6;break}throw new Error("linspace(start,end,num): start must be a finite number.");case 6:if(isFinite(e)){o.next=8;break}throw new Error("linspace(start,end,num): end must be a finite number.");case 8:n=0;case 9:if(!(n<t)){o.next=16;break}return a=n/(t-1),o.next=13,r*(1-a)+a*e;case 13:n++,o.next=9;break;case 16:case"end":return o.stop()}}),Br)}function Zr(r,e){var t,n,a,o=arguments;return M.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(t=o.length>2&&void 0!==o[2]?o[2]:1,r%1==0){i.next=3;break}throw new Error("range(start, stop, step=1): start not a valid integer.");case 3:if(e%1==0){i.next=5;break}throw new Error("range(start, stop, step=1): stop not a valid integer.");case 5:if(t%1==0){i.next=7;break}throw new Error("range(start, stop, step=1): step not a valid integer.");case 7:if(0!==t){i.next=9;break}throw new Error("range(start, stop, step=1): step must not be 0.");case 9:if(!(0<t)){i.next=19;break}n=r;case 11:if(!(n<e)){i.next=17;break}return i.next=14,n;case 14:n+=t,i.next=11;break;case 17:i.next=26;break;case 19:a=r;case 20:if(!(a>e)){i.next=26;break}return i.next=23,a;case 23:a+=t,i.next=20;break;case 26:case"end":return i.stop()}}),Cr)}function re(){var r,e,t,n,a,o,i=arguments;return M.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:for(o=function(e){var n,i,s;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(e<t.length)){r.next=20;break}n=Yr(t[e]),r.prev=2,n.s();case 4:if((i=n.n()).done){r.next=10;break}return s=i.value,a[e]=s,r.delegateYield(o(e+1),"t0",8);case 8:r.next=4;break;case 10:r.next=15;break;case 12:r.prev=12,r.t1=r.catch(2),n.e(r.t1);case 15:return r.prev=15,n.f(),r.finish(15);case 18:r.next=22;break;case 20:return r.next=22,a.slice();case 22:case"end":return r.stop()}}),r,null,[[2,12,15,18]])},r=M.a.mark(o),e=i.length,t=new Array(e),n=0;n<e;n++)t[n]=i[n];return t=t.map((function(r){return r instanceof Array||r instanceof Float32Array||r instanceof Float64Array||r instanceof Int8Array||r instanceof Int16Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint16Array||r instanceof Uint32Array?r.slice():x()(r)})),a=new Array(t.length),s.delegateYield(o(0),"t0",6);case 6:case"end":return s.stop()}}),Vr)}function ee(r){var e,t,n,a;return M.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:e=0,t=Yr(r),o.prev=2,t.s();case 4:if((n=t.n()).done){o.next=10;break}return a=n.value,o.next=8,[e++,a];case 8:o.next=4;break;case 10:o.next=15;break;case 12:o.prev=12,o.t0=o.catch(2),t.e(o.t0);case 15:return o.prev=15,t.f(),o.finish(15);case 18:case"end":return o.stop()}}),Wr,null,[[2,12,15,18]])}function te(){var r,e,t,n,a,o,i,s,f=arguments;return M.a.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:for(r=f.length,e=new Array(r),t=0;t<r;t++)e[t]=f[t];if(0<e.length){l.next=3;break}throw new Error("zip(...seqs): seqs.length must be at least 1.");case 3:for(n=e.length,a=n;a-- >0;)e[a]=e[a][Symbol.iterator]();case 5:o=[],i=0;case 7:if(!(i<n)){l.next=15;break}if(!(s=e[i].next()).done){l.next=11;break}return l.abrupt("return");case 11:o.push(s.value);case 12:i++,l.next=7;break;case 15:return l.next=17,o;case 17:l.next=5;break;case 19:case"end":return l.stop()}}),Kr)}function ne(r,e){var t;return M.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0===e&&(e=r,r=1/0),r===1/0){n.next=6;break}if(r%1==0){n.next=4;break}throw new Error("repeat(n,seq): n must be a non-negative int or Infinity.");case 4:if(r>=0){n.next=6;break}throw new Error("repeat(n,seq): n must be a non-negative int or Infinity.");case 6:e=e instanceof Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array?e.slice():x()(e),t=r;case 8:if(!(t-- >0)){n.next=12;break}return n.delegateYield(e,"t0",10);case 10:n.next=8;break;case 12:case"end":return n.stop()}}),Hr)}function ae(r,e){var t=Math.max(Math.abs(r),Math.abs(e));if(0===t)return[1,0,0];r/=t,e/=t;var n=Math.sqrt(r*r+e*e);if(r/=n,e/=n,!(0<=(n*=t)))throw new Error("Assertion failed: "+n);return[r,e,n]}function oe(r,e,t,n,a,o){if(e%1!=0)throw new Error("Assertion failed.");if(t%1!=0)throw new Error("Assertion failed.");if(n%1!=0)throw new Error("Assertion failed.");if(!(0<=e))throw new Error("Assertion failed.");if(!(0<=t))throw new Error("Assertion failed.");if(!(0<=n))throw new Error("Assertion failed.");if(0!=r.length%1)throw new Error("Assertion failed.");if(!(t<r.length-e+1))throw new Error("Assertion failed.");if(!(n<r.length-e+1))throw new Error("Assertion failed.");if(!(Math.abs(Math.hypot(a,o)-1)<=1e-6))throw new Error("Assertion failed.");t|=0,n|=0,a=+a,o=+o;for(var i=0|(e|=0);i-- >0;){var s=r[t],f=r[n];r[t]=a*s+o*f,r[n]=a*f-o*s,t=t+1|0,n=n+1|0}}function ie(r,e,t,n,a,o){if(!(Math.abs(Math.hypot(a,o)-1)<=1e-6))throw new Error("Assertion failed.");t|=0,n|=0,a=+a,o=+o;for(var i=0|e;i-- >0;){var s=r[t],f=r[n];r[t]=a*s-o*f,r[n]=a*f+o*s,t=t+e|0,n=n+e|0}}function se(r,e){var t;if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(t=function(r,e){if(!r)return;if("string"==typeof r)return fe(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);"Object"===t&&r.constructor&&(t=r.constructor.name);if("Map"===t||"Set"===t)return Array.from(r);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return fe(r,e)}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){t=r[Symbol.iterator]()},n:function(){var r=t.next();return i=r.done,r},e:function(r){s=!0,o=r},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw o}}}}function fe(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}var le=function(){function r(){p()(this,r),this.sum=0,this.max=0,Object.seal(this)}return g()(r,[{key:"reset",value:function(){this.sum=this.max=0}},{key:"include",value:function(r){if(0!==(r=Math.abs(r))){if(this.max<r){var e=this.max/r;this.sum*=e*e,this.max=r}r/=this.max,this.sum+=r*r}}},{key:"resultIncl",value:function(r){r=Math.abs(r);var e=this.sum,t=this.max;if(0!==r){if(t<r){var n=t/r;e*=n*n,t=r}e+=(r/=t)*r}return isFinite(t)?Math.sqrt(e)*t:t}},{key:"result",get:function(){var r=this.max,e=this.sum;return isFinite(r)?Math.sqrt(e)*r:r}},{key:"resultSquare",get:function(){var r=this.max,e=this.sum;return isFinite(r)?e*r*r:r}}]),r}();function he(r){var e,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fro",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;switch(r=nr(r),t){case"fro":e=new le;break;default:throw new Error("norm(A,ord,axis): Unsupported ord: ".concat(t,"."))}if(null==n){var a,o=se(r.data);try{for(o.s();!(a=o.n()).done;){var i=a.value;e.include(i)}}catch(r){o.e(r)}finally{o.f()}return e.result}throw new Error("norm(A,ord,axis): axis argument not yet supported.")}function ue(r,e,t){for(var n=r;--n>0;)for(var a=n;a-- >0;){var o=t+r*n+a,i=t+r*a+n,s=e[o];e[o]=e[i],e[i]=s}}function ce(r){var e=r.shape.slice(-2),t=T()(e,2),n=t[0];if(n!=t[1])throw new Error("In-place transposition is only supported for square matrices.");r=r.data;for(var a=0;a<r.length;a+=n*n)ue(n,r,a)}function de(r,e,t,n,a,o,i){r|=0,e|=0,n|=0,i|=0;var s=new le;if(r<e)throw new Error("Assertion failed.");for(var f=e;f-- >0;)o[i+e*f+f]=1;for(var l=0;l<e;l++){for(var h=n+e*l+l,u=l;++u<r;){var c=n+e*u+l,d=t[c];if(0!==d){var w=ae(t[h],d),v=T()(w,3),p=v[0],m=v[1],g=v[2];0!==m&&(p<0&&(p*=-1,m*=-1,g*=-1),oe(t,e-1-l,h+1,c+1,p,m),t[h]=g),t[c]=m}}if(l<e-2){s.reset();for(var y=e;--y>l+1;)s.include(t[n+e*l+y]);if(0===s.max)continue;var b=s.resultIncl(t[h+1])*(t[h+1]>0?-1:1);s.include(t[h+1]-=b);for(var E=s.max,_=Math.sqrt(s.sum),x=l;++x<e;)t[n+e*l+x]=t[n+e*l+x]/E/_;for(var A=0;A<e;A++){for(var M=0,k=l;++k<e;)M+=o[i+e*A+k]*t[n+e*l+k];M*=2;for(var N=l;++N<e;)o[i+e*A+N]-=t[n+e*l+N]*M}for(var F=l;++F<r;){for(var I=0,P=l;++P<e;)I+=t[n+e*F+P]*t[n+e*l+P];I*=2;for(var q=l;++q<e;)t[n+e*F+q]-=t[n+e*l+q]*I}t[h+1]=b,t.fill(0,h+2,n+e*(l+1))}}ue(e,o,i);for(var S=e;--S>0;)a[i+e*S+S]=t[n+e*S+S],a[i+e*(S-1)+S]=t[n+e*(S-1)+S];a[i]=t[n];for(var j=0;j<e;j++)for(var O=j;O<e;O++)t[n+e*j+O]=+(j===O);for(var R=e;R-- >0;)for(var L=r;--L>R;){var D=t[n+e*L+R];if(0!==D)t[n+e*L+R]=0,oe(t,e-R,n+e*L+R,n+e*R+R,Math.sqrt((1+D)*(1-D)),D)}}function we(r,e,t,n,a){r|=0,a|=0;for(var o=new le,i=r;i-- >0;)e[a+r*i+i]=1;for(var s=r;s-- >0;)n[a+r*s+s]=1;for(var f=0;f<r-1;f++){for(var l=a+r*f+f,h=f;++h<r;){var u=a+r*h+f,c=t[u];if(0!==c){var d=ae(t[l],c),w=T()(d,3),v=w[0],p=w[1],m=w[2];t[u]=0,0!==p&&(t[l]=m,oe(t,r-1-f,l+1,u+1,v,p),oe(e,1+h,a+r*f,a+r*h,v,p))}}o.reset();for(var g=r;--g>f+1;)o.include(t[a+r*f+g]);if(0!==o.max){var y=o.resultIncl(t[l+1])*(t[l+1]>0?-1:1);o.include(t[l+1]-=y);for(var b=o.max,E=Math.sqrt(o.sum),_=f;++_<r;)t[a+r*f+_]=t[a+r*f+_]/b/E;for(var x=0;x<r;x++){for(var A=0,M=f;++M<r;)A+=n[a+r*x+M]*t[a+r*f+M];A*=2;for(var k=f;++k<r;)n[a+r*x+k]-=t[a+r*f+k]*A}for(var N=f;++N<r;){for(var F=0,I=f;++I<r;)F+=t[a+r*N+I]*t[a+r*f+I];F*=2;for(var P=f;++P<r;)t[a+r*N+P]-=t[a+r*f+P]*F}t[l+1]=y,t.fill(0,l+2,a+r*(f+1))}}ue(r,n,a),ue(r,e,a)}function ve(r,e,t,n,a,o,i,s){if(n|=0,o|=0,s=s+(e|=0)|0,!((r|=0)<=e))throw Error("Assertion failed.");for(var f=new le,l=r;l-- >0;)t[n+r*l+l]=1;for(var h=0;h<r&&h<e-1;h++){for(var u=s+e*h+h,c=h;++c<r;){var d=s+e*c+h,w=i[d];if(0!==w){var v=ae(i[u],w),p=T()(v,3),m=p[0],g=p[1],y=p[2];i[d]=0,0!==g&&(i[u]=y,oe(i,e-1-h,u+1,d+1,m,g),oe(t,1+c,n+r*h,n+r*c,m,g))}}var b=s+e*(h-1);f.reset();for(var E=e-1;;){var _=i[b+E]=i[s+e*h+E];if(--E<=h)break;f.include(_)}if(0!==f.max){var x=f.resultIncl(i[b+(h+1)])*(i[b+(h+1)]>0?-1:1);f.include(i[b+(h+1)]-=x);for(var A=f.max,M=Math.sqrt(f.sum),k=h;++k<e;)i[b+k]=i[b+k]/A/M;for(var N=h;++N<r;){for(var F=0,I=h;++I<e;)F+=i[s+e*N+I]*i[b+I];F*=2;for(var P=h;++P<e;)i[s+e*N+P]-=i[b+P]*F}i[u+1]=x}else i[b+(h+1)]=0}ue(r,t,n);for(var q=r;q-- >0;)a[o+(r+1)*q+(q+1)]=q<e-1?i[s+e*q+(q+1)]:0,a[o+(r+1)*q+q]=i[s+e*q+q];for(var S=Math.min(r,e-1);--S,i.fill(0,s+e*S,s+e*(S+1)),i[s+e*S+(S+1)]=1,!(S<0);)for(var j=s+e*(S-1),O=S;O<r;O++){for(var R=0,L=S;++L<e;)R+=i[s+e*O+L]*i[j+L];R*=2;for(var D=S;++D<e;)i[s+e*O+D]-=i[j+D]*R}}function pe(r){if((r=nr(r)).ndim<2)throw new Error("bidiag_decomp(A): A must be at least 2D.");if(r.dtype.startsWith("complex"))throw new Error("bidiag_decomp(A): complex A not yet supported.");var e="float32"===r.dtype?"float32":"float64",t=q[e],n=Int32Array.from(r.shape),a=Int32Array.from(n),o=Int32Array.from(n),i=r.shape.slice(-2),s=T()(i,2),f=s[0],l=s[1],h=r.data.length/(f*l)|0,u=0|Math.min(f,l),c=0|(f>=l?u:u+1);n[n.length-1]=u,a[a.length-2]=u,a[a.length-1]=c,o[o.length-2]=c;var d=function(){if(f===l){for(var e=t.from(r.data),n=new t(e.length),a=new t(e.length),o=0;o<e.length;o+=l*l)we(l,n,e,a,o);return[n,e,a]}if(f>l){var i=t.from(r.data);r=void 0;for(var s=new t(h*l*l),u=new t(h*l*l),c=0,d=0;d<s.length;c+=f*l,d+=l*l)de(f,l,i,c,s,u,d);return[i,s,u]}var w=new t(h*(f+1)*l);if(!(f<l))throw new Error("Assertion failed.");r=r.data;for(var v=0,p=l;p<w.length;p+=l)for(var m=p+f*l;p<m;v++,p++)w[p]=r[v];r=void 0;for(var g=new t(h*f*f),y=new t(h*f*(f+1)),b=0,E=0,_=0;E<y.length;b+=f*f,E+=f*(f+1),_+=(f+1)*l)ve(f,l,g,b,y,E,w,_);return[g,y,w]}(),w=T()(d,3),v=w[0],p=w[1],m=w[2];return[new ar(n,v),new ar(a,p),new ar(o,m)]}var me=function(){function r(){p()(this,r),this.sum=this.rst=0}return g()(r,[{key:"set",value:function(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(isNaN(r*=1))throw new Error("Assertion failed.");if(isNaN(e*=1))throw new Error("Assertion failed.");this.sum=r,this.rst=e}},{key:"add",value:function(r){var e=r-this.rst,t=this.sum+e;this.rst=t-this.sum-e,this.sum=t}}]),r}();function ge(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((r=nr(r)).ndim<2)throw new Error("Input must be at least 2D.");return r.mapElems(r.dtype,(function(r){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var o=n.slice(-2),i=T()(o,2),s=i[0],f=i[1];return s<f-e?0:r}))}function ye(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((r=nr(r)).ndim<2)throw new Error("Input must be at least 2D.");return r.mapElems(r.dtype,(function(r){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var o=n.slice(-2),i=T()(o,2),s=i[0],f=i[1];return s>f-e?0:r}))}function be(r,e,t,n,a,o,i){if(!(r<=e))throw new Error("Assertion failed.");if(r|=0,e|=0,t|=0,i|=0,!(0<=(a|=0)))throw new Error("Assertion failed.");if(!(0<=i))throw new Error("Assertion failed.");if(!(r*e<=n.length-a))throw new Error("Assertion failed.");if(!(r*t<=o.length-i))throw new Error("Assertion failed.");for(var s=0;s<r;s++){for(var f=0;f<s;f++)for(var l=0;l<t;l++)o[i+t*s+l]-=n[a+e*s+f]*o[i+t*f+l];for(var h=0;h<t;h++)o[i+t*s+h]/=n[a+e*s+s]}}function Ee(r,e,t,n,a,o,i){if(!(r<=e))throw new Error("Assertion failed.");if(r|=0,e|=0,t|=0,i|=0,!(0<=(a|=0)))throw new Error("Assertion failed.");if(!(0<=i))throw new Error("Assertion failed.");if(!(r*e<=n.length-a))throw new Error("Assertion failed.");if(!(r*t<=o.length-i))throw new Error("Assertion failed.");for(var s=r;s-- >0;)for(var f=t;f-- >0;){for(var l=r;--l>s;)o[i+t*s+f]-=n[a+e*s+l]*o[i+t*l+f];o[i+t*s+f]/=n[a+e*s+s]}}function _e(r,e,t,n,a,o,i){if(!(r<=e))throw new Error("Assertion failed.");if(r|=0,e|=0,t|=0,i|=0,!(0<=(a|=0)))throw new Error("Assertion failed.");if(!(0<=i))throw new Error("Assertion failed.");if(!(r*e<=n.length-a))throw new Error("Assertion failed.");if(!(r*t<=o.length-i))throw new Error("Assertion failed.");for(var s=r;s-- >0;){for(var f=t;f-- >0;)o[i+t*s+f]/=n[a+e*s+s];for(var l=s;l-- >0;)for(var h=t;h-- >0;)o[i+t*l+h]-=n[a+e*s+l]*o[i+t*s+h]}}function xe(r,e,t,n,a,o,i){if(!(r<=e))throw new Error("Assertion failed.");if(r|=0,e|=0,t|=0,i|=0,!(0<=(a|=0)))throw new Error("Assertion failed.");if(!(0<=i))throw new Error("Assertion failed.");if(!(r*e<=n.length-a))throw new Error("Assertion failed.");if(!(r*t<=o.length-i))throw new Error("Assertion failed.");for(var s=0;s<r;s++){for(var f=0;f<t;f++)o[i+t*s+f]/=n[a+e*s+s];for(var l=s;++l<r;)for(var h=0;h<t;h++)o[i+t*l+h]-=n[a+e*s+l]*o[i+t*s+h]}}function Ae(r,e){if((r=nr(r)).ndim<2)throw new Error("tril_solve(L,Y): L.ndim must be at least 2.");if((e=nr(e)).ndim<2)throw new Error("tril_solve(L,Y): Y.ndim must be at least 2.");var t=e.shape.slice(-2),n=T()(t,2),a=n[0],o=n[1];if(r.shape[r.ndim-2]!==a)throw new Error("tril_solve(L,Y): L and Y don't match.");if(r.shape[r.ndim-1]!==a)throw new Error("tril_solve(L,Y): Last two dimensions of L must be quadratic.");var i=Math.max(r.ndim,e.ndim),s=r.shape,f=e.shape,l=new Int32Array(i);l.fill(1,0,-2),l[i-2]=a,l[i-1]=o;for(var h=0,u=[s,f];h<u.length;h++)for(var c=u[h],d=i-2,w=c.length-2;d-- >0&&w-- >0;)if(1===l[d])l[d]=c[w];else if(l[d]!=c[w]&&1!=c[w])throw new Error("tril_solve(L,Y): L and Y not broadcast-compatible.");var v=[r,e].every((function(r){return"float32"===r.dtype}))?"float32":"float64";r=r.data,e=e.data;var p=new q[v](l.reduce((function(r,e){return r*e}))),m=0,g=1,y=0,b=1,E=0;return function t(n){if(n===i-2){g=a*a;for(var h=b=a*o;h-- >0;)p[E+h]=e[y+h];be(a,a,o,r,m,p,E),m+=g,y+=b,E+=b}else{for(var u=l[n];t(n+1),1!=u;u--)s[n-i+s.length]>1||(m-=g),f[n-i+f.length]>1||(y-=b);g*=s[n-i+s.length]||1,b*=f[n-i+f.length]||1}}(0),new ar(l,p)}function Me(r,e){if((r=nr(r)).ndim<2)throw new Error("triu_solve(U,Y): U.ndim must be at least 2.");if((e=nr(e)).ndim<2)throw new Error("triu_solve(U,Y): Y.ndim must be at least 2.");var t=e.shape.slice(-2),n=T()(t,2),a=n[0],o=n[1];if(r.shape[r.ndim-2]!==a)throw new Error("triu_solve(U,Y): U and Y don't match.");if(r.shape[r.ndim-1]!==a)throw new Error("triu_solve(U,Y): Last two dimensions of U must be quadratic.");var i=Math.max(r.ndim,e.ndim),s=r.shape,f=e.shape,l=new Int32Array(i);l.fill(1,0,-2),l[i-2]=a,l[i-1]=o;for(var h=0,u=[s,f];h<u.length;h++)for(var c=u[h],d=i-2,w=c.length-2;d-- >0&&w-- >0;)if(1===l[d])l[d]=c[w];else if(l[d]!=c[w]&&1!=c[w])throw new Error("triu_solve(U,Y): U and Y not broadcast-compatible.");var v=[r,e].every((function(r){return"float32"===r.dtype}))?"float32":"float64";r=r.data,e=e.data;var p=new q[v](l.reduce((function(r,e){return r*e}))),m=r.length,g=1,y=e.length,b=1,E=p.length;return function t(n){if(n===i-2){m-=g=a*a,y-=b=a*o,E-=b;for(var h=b;h-- >0;)p[E+h]=e[y+h];Ee(a,a,o,r,m,p,E)}else{for(var u=l[n];t(n+1),1!=u;u--)s[n-i+s.length]>1||(m+=g),f[n-i+f.length]>1||(y+=b);g*=s[n-i+s.length]||1,b*=f[n-i+f.length]||1}}(0),new ar(l,p)}function ke(r,e,t,n){if(!(r<=e))throw new Error("Assertion failed.");for(var a=new me,o=0;o<r;o++)for(var i=0;i<=o;i++){a.set(t[n+e*o+i]);for(var s=0;s<i;s++)a.add(-t[n+e*o+s]*t[n+e*i+s]);if(o>i)t[n+e*o+i]=a.sum/t[n+e*i+i];else if(t[n+e*o+o]=Math.sqrt(a.sum),isNaN(t[n+e*o+o]))throw new Error("Matrix contains NaNs or is (near) singular.")}}function Ne(r){var e="float32"===(r=nr(r)).dtype?"float32":"float64",t=r.shape,n=t.slice(-2),a=T()(n,2),o=a[0],i=a[1];r=r.data;var s=new q[e](r.length);if(o!=i)throw new Error("Last two dimensions must be quadratic.");for(var f=0;f<s.length;f+=o*o){for(var l=0;l<o;l++)for(var h=0;h<=l;h++)s[f+o*l+h]=r[f+o*l+h];ke(o,o,s,f)}return new ar(t,s)}function Fe(r,e){if(r=nr(r),e=nr(e),r.ndim<2)throw new Error("L must be at least 2D.");if(e.ndim<2)throw new Error("y must be at least 2D.");var t=r.shape.slice(-2),n=T()(t,2),a=n[0],o=n[1],i=e.shape.slice(-2),s=T()(i,2),f=s[0],l=s[1];if(a!=o)throw new Error("Last two dimensions of L must be quadratic.");if(f!=o)throw new Error("L and y don't match.");var h=Math.max(r.ndim,e.ndim),u=Int32Array.from({length:h},(function(){return 1}));u[h-2]=f,u[h-1]=l;for(var c=0,d=[r,e];c<d.length;c++)for(var w=d[c],v=h-2,p=w.ndim-2;v-- >0&&p-- >0;)if(1===u[v])u[v]=w.shape[p];else if(u[v]!=w.shape[p]&&1!=w.shape[p])throw new Error("Shapes are not broadcast-compatible.");var m="float32"===r.dtype&&"float32"===e.dtype?"float32":"float64",g=new q[m](u.reduce((function(r,e){return r*e}),1)),y=r.data,b=e.data,E=0,_=1,x=0,A=1,M=0;return function t(n){if(n===h-2){_=a*a,A=a*l;for(var o=0;o<A;o++)g[M+o]=b[x+o];return be(f,f,l,y,E,g,M),_e(f,f,l,y,E,g,M),E+=_,x+=A,void(M+=A)}for(var i=u[n];t(n+1),1!=i;i--)r.shape[n-h+r.ndim]>1||(E-=_),e.shape[n-h+e.ndim]>1||(x-=A);_*=r.shape[n-h+r.ndim]||1,A*=e.shape[n-h+e.ndim]||1}(0),new ar(u,g)}function Ie(r){if(r.ndim<1)throw new Error("diag_mat(diag): diag.ndim=".concat(r.ndim," is less than 1."));var e=(r=nr(r)).shape,t=e[e.length-1],n=r.data,a=q[r.dtype].from({length:e.reduce((function(r,e){return r*e}))*t},(function(){return 0}));if(r=void 0,e.length<1)throw new Error("diag_mat(diag): diag must be at least 1d.");if(t<=0)throw new Error("Assertion Failed!");for(var o=0,i=0;;){for(var s=o+t;a[i]=n[o],++o!==s;)i+=t+1;if(++i==a.length)break}return new ar(Int32Array.of.apply(Int32Array,x()(e).concat([t])),a)}function Pe(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(r.ndim<2)throw new Error("diag(A, offset): A.ndim=".concat(r.ndim," is less than 2."));var t=(r=nr(r)).shape.slice(-2),n=T()(t,2),a=n[0],o=n[1],i=r.shape.slice(0,-1),s=q[r.dtype];if(r=r.data,!(e>-a&&e<+o))throw new Error("diag(A, offset): offset=".concat(e," out of A.shape=[").concat(r.shape,"]."));var f=Math.min(a,a+e,o,o-e);i[i.length-1]=f;for(var l=new s(i.reduce((function(r,e){return r*e}))),h=Math.max(0,e,-e*o),u=0,c=0;c<r.length;u+=f,c+=a*o)for(var d=0;d<f;d++)l[u+d]=r[c+h+o*d+d];return new ar(i,l)}function qe(r){if((r=nr(r)).ndim<2)throw new Error("A must be at least 2D.");var e="float32"===r.dtype?"float32":"float64",t=q[e],n="float32"===e?16:8,a=r.shape,o=Int32Array.from(a),i=a.slice(-2),s=T()(i,2),f=s[0],l=s[1],h=t.from(r.data);r=void 0,o[o.length-1]=f;for(var u=new t(h.length/l*f),c=0,d=0;c<u.length;c+=f*f,d+=f*l){for(var w=0;w<f;w++)u[c+f*w+w]=1;for(var v=0;v<l;v+=n)for(var p=v;p<f;p+=n)for(var m=p;m<p+n&&m<f;m++)for(var g=v;g<v+n&&g<l&&g<m;g++){var y=d+l*m+g,b=h[y];if(0!==b){var E=d+l*g+g,_=ae(h[E],b),x=T()(_,3),A=x[0],M=x[1],k=x[2];h[y]=0,0!==M&&(h[E]=k,oe(h,l-1-g,E+1,y+1,A,M),oe(u,1+m,c+f*g,c+f*m,A,M))}}ue(f,u,c)}return[new ar(o,u),new ar(a,h)]}function Se(r){if((r=nr(r)).ndim<2)throw new Error("qr_decomp(A): A.ndim must be at least 2.");var e=q["float32"===r.dtype?"float32":"float64"],t=r.shape,n=Int32Array.from(t),a=t.slice(-2),o=T()(a,2),i=o[0],s=o[1];if(n[n.length-2]=s,i<=s)return qe(r);var f=e.from(r.data);r=void 0;for(var l=new e(f.length/i*s),h=0,u=0;u<f.length;u+=i*s,h+=s*s){for(var c=1;c<i;c++)for(var d=Math.min(c,s),w=0;w<d;w++){var v=u+s*c+w,p=f[v];if(0!==p){var m=u+s*w+w,g=ae(f[m],p),y=T()(g,3),b=y[0],E=y[1],_=y[2];0!==E&&(b<0&&(b*=-1,E*=-1,_*=-1),oe(f,s-1-w,m+1,v+1,b,E),f[m]=_),f[v]=E}}for(var x=0;x<s;x++)for(var A=x;A<s;A++)l[h+s*x+A]=f[u+s*x+A],f[u+s*x+A]=+(x===A);for(var M=i;--M>0;)for(var k=Math.min(M,s);k-- >0;){var N=f[u+s*M+k];if(0!==N)f[u+s*M+k]=0,oe(f,s-k,u+s*M+k,u+s*k+k,Math.sqrt((1-N)*(1+N)),N)}}return[new ar(t,f),new ar(n,l)]}function je(r,e,t,n,a,o,i){if(r%1!=0)throw new Error("Assertion failed.");if(e%1!=0)throw new Error("Assertion failed.");if(t%1!=0)throw new Error("Assertion failed.");if(a%1!=0)throw new Error("Assertion failed.");if(i%1!=0)throw new Error("Assertion failed.");if(n.length%1!=0)throw new Error("Assertion failed.");if(o.length%1!=0)throw new Error("Assertion failed.");if(!(0<=r))throw new Error("Assertion failed.");if(!(0<=e))throw new Error("Assertion failed.");if(!(0<=t))throw new Error("Assertion failed.");if(!(0<=a))throw new Error("Assertion failed.");if(!(0<=i))throw new Error("Assertion failed.");if(!(0<=n.length))throw new Error("Assertion failed.");if(!(0<=o.length))throw new Error("Assertion failed.");if(!(r*e<=n.length-a))throw new Error("Assertion failed.");if(!(r*t<=o.length-i))throw new Error("Assertion failed.");for(var s=1;s<r;s++)for(var f=0;f<e&&f<s;f++){var l=a+e*s+f,h=n[l];if(0!==h){var u=a+e*f+f,c=ae(n[u],h),d=T()(c,3),w=d[0],v=d[1],p=d[2];n[l]=0,0!==v&&(n[u]=p,oe(n,e-1-f,u+1,l+1,w,v),oe(o,t,i+t*f,i+t*s,w,v))}}}function Oe(r,e,t){if(null==t){t=e;var n=r,a=T()(n,2);r=a[0],e=a[1]}if((r=nr(r)).ndim<2)throw new Error("qr_lstsq(Q,R,y): Q.ndim must be at least 2.");if((e=nr(e)).ndim<2)throw new Error("qr_lstsq(Q,R,y): R.ndim must be at least 2.");if((t=nr(t)).ndim<2)throw new Error("qr_lstsq(Q,R,y): y.ndim must be at least 2.");var o=r.shape.slice(-2),i=T()(o,2),s=i[0],f=i[1],l=e.shape.slice(-1),h=T()(l,1)[0],u=t.shape.slice(-1),c=T()(u,1)[0],d=Math.min(f,h);if(s!=t.shape[t.ndim-2])throw new Error("qr_lstsq(Q,R,y): Q and y don't match.");if(f!=e.shape[e.ndim-2])throw new Error("qr_lstsq(Q,R,y): Q and R don't match.");if(h>s)throw new Error("qr_lstsq(Q,R,y): Under-determined systems not supported. Use rrqr instead.");var w=Math.max(r.ndim,e.ndim,t.ndim),v=Int32Array.from({length:w},(function(){return 1}));v[w-2]=h,v[w-1]=c;for(var p=0,m=[r,e,t];p<m.length;p++)for(var g=m[p],y=w-2,b=g.ndim-2;y-- >0&&b-- >0;)if(1===v[y])v[y]=g.shape[b];else if(v[y]!=g.shape[b]&&1!=g.shape[b])throw new Error("Q, R, y are not broadcast-compatible.");var E=new(0,q[[r,e,t].every((function(r){return"float32"===r.dtype}))?"float32":"float64"])(v.reduce((function(r,e){return r*e}),1)),_=r.data,x=e.data,A=t.data,M=0,k=1,N=0,F=1,I=0,P=1,S=0;return function n(a){if(a===w-2){k=s*f,F=f*h,P=s*c;for(var o=0;o<d;o++)for(var i=0;i<c;i++)for(var l=0;l<s;l++)E[S+o*c+i]+=_[M+l*f+o]*A[I+l*c+i];return Ee(d,h,c,x,N,E,S),M+=k,N+=F,I+=P,void(S+=h*c)}for(var u=v[a];n(a+1),1!=u;u--)r.shape[a-w+r.ndim]>1||(M-=k),e.shape[a-w+e.ndim]>1||(N-=F),t.shape[a-w+t.ndim]>1||(I-=P);k*=r.shape[a-w+r.ndim]||1,F*=e.shape[a-w+e.ndim]||1,P*=t.shape[a-w+t.ndim]||1}(0),new ar(v,E)}var Re=function(r){if((r=nr(r)).ndim<2)throw new Error("det_tri(a): a.shape=[".concat(r.shape,"]; a.ndim must be at least 2."));var e=r.shape,t=e.slice(-2),n=T()(t,2),a=n[0],o=n[1];if(a!==o)throw new Error("det_tri(a): a must be square matrices.");var i=q[r.dtype],s=r.data;r=void 0;for(var f=new i(s.length/(o*o)),l=0,h=0;l<f.length;l++){var u=h;h+=o*o;for(var c=1;u<h;u+=o+1)c*=s[u];f[l]=c}return new ar(e.slice(0,-2),f)},Le=function(r){if((r=nr(r)).ndim<2)throw new Error("det_tri(A): A.ndim must be at least 2.");var e=r.shape,t=e.slice(-2),n=T()(t,2),a=n[0],o=n[1];if(a!==o)throw new Error("det_tri(A): A must be square matrices.");for(var i=q["float32"===r.dtype?"float32":"float64"],s=new i((r=r.data).length/(o*o)),f=new i(s.length),l=0,h=0;l<f.length;l++){var u=h;h+=o*o;for(var c=1,d=0;u<h;u+=o+1)c*=Math.sign(r[u]),d+=Math.log(Math.abs(r[u]));s[l]=c,f[l]=d}var w=e.slice(0,-2);return[new ar(w,s),new ar(w,f)]},De=function(r){var e=Se(r),t=T()(e,2),n=(t[0],t[1]);return Re(n)},Ge=function(r){var e=Se(r),t=T()(e,2),n=(t[0],t[1]);return Le(n)},Je=function(){function r(e,t){p()(this,r),this.re=1*e,this.im=1*t}return g()(r,[{key:"abs",value:function(){return Math.hypot(this.re,this.im)}},{key:"/=",value:function(r,e){if(0===e)this.re/=r,this.im/=r;else{var t=this.re;if(Math.abs(r)>=Math.abs(e)){var n=e/r;this.re=(t+this.im*n)/(r+e*n),this.im=(this.im-t*n)/(r+e*n)}else{var a=r/e;this.re=(t*a+this.im)/(r*a+e),this.im=(this.im*a-t)/(r*a+e)}}}},{key:"= c0*c1",value:function(r,e,t,n){this.re=r*t-e*n,this.im=r*n+e*t}},{key:"-= c0*c1",value:function(r,e,t,n){this.re-=r*t-e*n,this.im-=r*n+e*t}},{key:Symbol.for("nodejs.util.inspect.custom"),value:function(){return this.toString()}},{key:"toString",value:function(){return 0==this.im?this.re.toString():0==this.re?"".concat(this.im,"j"):this.im<0?"".concat(this.re," - ").concat(-this.im,"j"):"".concat(this.re," + ").concat(this.im,"j")}}]),r}(),Te=M.a.mark((function r(){var e;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e=function(r){return new Function("A_shape","A","B_shape","B","C_shape","C","\n      const I = A_shape[A_shape.length-2],\n            K = A_shape[A_shape.length-1],\n            J = B_shape[B_shape.length-1]; \n      let\n        a = 0, aStride = 1,\n        b = 0, bStride = 1,\n        c = 0;\n\n      const loops = new Int32Array(C_shape.length-2);\n      for( let d=0; d >= 0; )\n        if( d === C_shape.length-2 ) {\n          aStride = I*K;\n          bStride = K*J;\n          for( const cEnd = c + I*J; c < cEnd; c += J, b -= bStride ) {\n          for( const aEnd = a + K  ; a < aEnd; c -= J, a++ ) {\n          for( const bEnd = b +   J; b < bEnd; c += 1, b++ ) {\n            ".concat(r,"\n          }}}\n          b += bStride;\n          d -= 1;\n        }\n        else\n        {\n          if( loops[d]++ > 0 ) {\n            if( loops[d] > C_shape[d] ) {\n              aStride *= A_shape[ d - C_shape.length + A_shape.length ] || 1;\n              bStride *= B_shape[ d - C_shape.length + B_shape.length ] || 1;\n              loops[d--] = 0;\n              continue;\n            }\n            if( ! (A_shape[ d - C_shape.length + A_shape.length ] > 1) ) a -= aStride;\n            if( ! (B_shape[ d - C_shape.length + B_shape.length ] > 1) ) b -= bStride;\n          }\n          ++d;\n        }\n    "))},r.next=3,e("C[c] += A[a]*B[b];");case 3:return r.next=5,e("\n    C[2*c+0] += A[a] * B[2*b+0];\n    C[2*c+1] += A[a] * B[2*b+1];\n  ");case 5:return r.next=7,e("\n    C[2*c+0] += B[b] * A[2*a+0];\n    C[2*c+1] += B[b] * A[2*a+1];\n  ");case 7:return r.next=9,e("\n    C[2*c+0] += B[2*b+0] * A[2*a+0]  -  B[2*b+1] * A[2*a+1];\n    C[2*c+1] += B[2*b+0] * A[2*a+1]  +  B[2*b+1] * A[2*a+0];\n  ");case 9:return r.next=11,e("C[c] = this.add(C[c], this.mul(A[a],B[b]));").bind(b);case 11:case"end":return r.stop()}}),r)}))(),Xe=T()(Te,5),ze=Xe[0],Ue=Xe[1],Ye=Xe[2],Qe=Xe[3],Be=Xe[4];function Ce(r,e){if(r=nr(r),e=nr(e),r.ndim<2)throw new Error("A must be at least 2D.");if(e.ndim<2)throw new Error("B must be at least 2D.");var t=r.shape.slice(-2),n=T()(t,2),a=n[0],o=n[1],i=e.shape[e.ndim-1];if(e.shape[e.ndim-2]!=o)throw new Error("The last dimension of A and the 2nd to last dimension of B do not match.");var s=Math.max(r.ndim,e.ndim),f=Int32Array.from({length:s},(function(){return 1}));f[s-2]=a,f[s-1]=i;for(var l=0,h=[r,e];l<h.length;l++)for(var u=h[l],c=s-2,d=u.ndim-2;c-- >0&&d-- >0;)if(1===f[c])f[c]=u.shape[d];else if(f[c]!=u.shape[d]&&1!=u.shape[d])throw new Error("Shapes are not broadcast-compatible.");var w=new(0,q[L(r.dtype,e.dtype)])(f.reduce((function(r,e){return r*e}),1));w instanceof Array&&w.fill(0);for(var v=0,p=0,m=[r,e];p<m.length;p++){switch(v*=3,m[p].dtype){default:v+=1;case"complex128":v+=1;case"int32":case"float32":case"float64":}}switch(v){case 0:ze(r.shape,r.data,e.shape,e.data,f,w);break;case 1:Ue(r.shape,r.data,e.shape,e.data._array,f,w._array);break;case 3:Ye(r.shape,r.data._array,e.shape,e.data,f,w._array);break;case 4:Qe(r.shape,r.data._array,e.shape,e.data._array,f,w._array);break;default:Be(r.shape,r.data,e.shape,e.data,f,w)}return new ar(f,w)}function Ve(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];if(1==(e=e.map((function(r){return nr(r)}))).length)return e[0];if(2==e.length)return Ce.apply(void 0,x()(e));function n(r,e){var t=r.slice(-2),n=T()(t,2),a=n[0],o=n[1],i=e[e.length-1];if(e[e.length-2]!=o)throw new Error("Shape mismatch.");var s=Math.max(r.length,e.length),f=Int32Array.from({length:s},(function(){return 1}));f[s-2]=a,f[s-1]=i;for(var l=0,h=[r,e];l<h.length;l++)for(var u=h[l],c=s-2,d=u.length-2;c-- >0&&d-- >0;)if(1===f[c])f[c]=u[d];else if(f[c]!=u[d]&&1!=u[d])throw new Error("Shapes are not broadcast-compatible.");return[f.reduce((function(r,e){return r*e}),1)*o,f]}for(var a=Array.from({length:e.length},(function(){return[]})),o=0;o<e.length;o++)a[o][o]=[0,e[o].shape];for(var i=2;i<=e.length;i++)for(var s=0;s<=e.length-i;s++){for(var f=1/0,l=void 0,h=1;h<i;h++){var u=T()(a[s][s+h-1],2),c=u[0],d=u[1],w=T()(a[s+h][s+i-1],2),v=w[0],p=w[1],m=n(d,p),g=T()(m,2),y=g[0],b=g[1];(y+=c+v)<f&&(f=y,l=b)}if(void 0===l)throw new Error("Integer overflow (too many FLOPs).");a[s][s+i-1]=[f,l]}function E(r,t){if(r==t)return e[r];for(var o,i=1/0,s=r;s<t;s++){var f=T()(a[r][s],2),l=f[0],h=f[1],u=T()(a[s+1][t],2),c=u[0],d=n(h,u[1]),w=T()(d,2),v=w[0];w[1];(v+=l+c)<i&&(i=v,o=s)}return Ce(E(r,o),E(o+1,t))}return E(0,e.length-1)}var We=!0;function Ke(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];if(We&&(We=!1,console.warn(new Error("nd.la.rand_ortho is deprecated, use nd.rand.AleaRNG instead."))),r in q||(t.unshift(r),r="float64"),!r.startsWith("float"))throw new Error("Unsupported dtype: '".concat(r,"'."));1===t.length&&t.push(t[0]);for(var a=t.length;a-- >0;)if(t[a]%1!=0||t[a]<1)throw new Error("shape[".concat(a,"] = ").concat(t[a]," not a positive integer."));for(var o=(t=Int32Array.from(t)).slice(-2),i=T()(o,2),s=i[0],f=i[1],l=Math.max(s,f),h=q[r],u=new h(t.reduce((function(r,e){return r*e}))),c=new h(l*l),d=new h(l),w=new h(l),v=new le,p=0;p<u.length;p+=s*f){for(var m=0;m<l;m++)for(var g=0;g<l;g++)c[l*m+g]=1*(m===g);w[0]=Math.random()<=.5?-1:1;for(var y=l;y-- >1;){v.reset();for(var b=0;;b++){var E=d[b]=fr();if(b>=y)break;v.include(E)}w[y]=d[y]>0?-1:1;var _=v.resultIncl(d[y])*w[y];if(0!==_){v.include(d[y]-=_);for(var x=v.max,A=Math.sqrt(v.sum),M=y;M>=0;M--)d[M]=d[M]/x/A;for(var k=l;k-- >0;){for(var N=0,F=y;F>=0;F--)N+=c[l*k+F]*d[F];N*=2;for(var I=y;I>=0;I--)c[l*k+I]-=d[I]*N}}}for(var P=0;P<l;P++)for(var S=0;S<l;S++)c[l*P+S]*=w[P];for(var j=0;j<s;j++)for(var O=0;O<f;O++)u[p+f*j+O]=c[l*j+O]}return new ar(t,u)}function He(r,e){if(0!=r%1)throw new Error("Assertion failed.");if(0!=e%1)throw new Error("Assertion failed.");if(!(r<e))throw new Error("Assertion failed.");return Math.floor(Math.random()*(e-r))+r}var $e=Math.pow(2,32),Ze=Math.pow(2,-32),rt=Math.pow(2,-53);function et(r,e){r=r.toString();for(var t=0;t<r.length;t++){var n=.02519603282416938*(e+=r.charCodeAt(t));n-=e=n>>>0,e=(n*=e)>>>0,e+=(n-=e)*$e}return e}var tt=function(){function r(e){if(p()(this,r),null==e)throw new Error("Assertion failed.");e=e.toString();var t=et(" ",4022871197),n=et(" ",t),a=et(" ",n),o=et(e,a),i=et(e,o),s=et(e,i);t>>>=0,t-=o>>>0,t*=Ze,t+=t<0,n>>>=0,n-=i>>>0,n*=Ze,n+=n<0,a>>>=0,a-=s>>>0,a*=Ze,a+=a<0,Object.assign(this,{s0:t,s1:n,s2:a,c:1,__nextNormal:NaN}),Object.seal(this)}return g()(r,[{key:"__next",value:function(){var r=2091639*this.s0+this.c*Ze;return this.s0=this.s1,this.s1=this.s2,this.s2=r-(this.c=0|r)}},{key:"bool",value:function(){return this.uniform()<0}},{key:"int",value:function(r,e){if(void 0===e&&(e=r,r=0),r%1!=0)throw new Error("AlreaRNG::int(from,until): from must be a valid int.");if(e%1!=0)throw new Error("AlreaRNG::int(from,until): until must be a valid int.");if(!(r<e))throw new Error("AlreaRNG::int(from,until): from must be less than until.");return Math.floor(this.uniform(r,e))}},{key:"shuffle",value:function(r,e,t){if(r.length%1!=0)throw new Error("AlreaRNG::normal(array,from=0,until=array.length): array must be Array-like.");if(!(r.length>=0))throw new Error("AlreaRNG::normal(array,from=0,until=array.length): array must be Array-like.");if(null==e&&(e=0),null==t&&(t=r.length),0!=e%1)throw new Error("AlreaRNG::normal(array,from=0,until=array.length): from must be int.");if(0!=t%1)throw new Error("AlreaRNG::normal(array,from=0,until=array.length): until must be int.");if(!(e>=0))throw new Error("AlreaRNG::normal(array,from=0,until=array.length): from must be non-negative.");if(!(e<=t))throw new Error("AlreaRNG::normal(array,from=0,until=array.length): from must not be greater than until.");if(!(r.length>=t))throw new Error("AlreaRNG::normal(array,from=0,until=array.length): until must not be greater than array.length.");for(var n=e;n<t-1;n++){var a=this.int(n,t),o=r[a];r[a]=r[n],r[n]=o}}},{key:"uniform",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(r*=1,!isFinite(r))throw new Error("Assertion failed.");if(e*=1,!isFinite(e))throw new Error("Assertion failed.");var t=this.__next()+(2097152*this.__next()|0)*rt;return r*(1-t)+t*e}},{key:"normal",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(r*=1,!isFinite(r))throw new Error("AlreaRNG::normal(mean,sigma): mean must be valid number.");if(e*=1,!isFinite(e))throw new Error("AlreaRNG::normal(mean,sigma): sigma must be valid number.");var t,n,a,o=this.__nextNormal;if(!isNaN(o))return this.__nextNormal=NaN,o*e+r;do{a=(t=this.uniform())*t+(n=this.uniform())*n}while(a>1||0==a);var i=Math.sqrt(-2*Math.log(a)/a);return this.__nextNormal=i*t,r+i*n*e}},{key:"ortho",value:function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];if(r in q||(t.unshift(r),r="float64"),t.length<1)throw new Error("AlreaRNG::orthogonal([dtype,] ...shape): shape.length must be at least 1.");1===t.length&&t.push(t[0]);for(var a=t.length;a-- >0;)if(t[a]%1!=0||t[a]<1)throw new Error("AlreaRNG::orthogonal([dtype,] ...shape): shape[".concat(a,"] = ").concat(t[a]," not a positive integer."));for(var o=(t=Int32Array.from(t)).subarray(-2),i=T()(o,2),s=i[0],f=i[1],l=Math.max(s,f),h=Math.min(s,f),u=q[r],c=new u(t.reduce((function(r,e){return r*e}))),d=new Float64Array(l*h),w=c.length;(w-=s*f)>=0;){for(var v=l;v-- >0;)for(var p=h;p-- >0;)d[h*v+p]=v!==p?0:this.bool()?-1:1;for(var m=0;m<l;m++)for(var g=this.normal(),y=m;++y<l;){var b=this.normal(),E=ae(g,b),_=T()(E,3),x=_[0],A=_[1],M=_[2];0!==A&&(g=M,oe(d,Math.min(y+1,h),h*m,h*y,x,A))}for(var k=l;k-- >0;)for(var N=h;N-- >0;)c[w+(s<f?f*N+k:f*k+N)]=d[h*k+N]}return new ar(t,c)}}]),r}();function nt(r,e,t,n){n|=0;for(var a=(r|=0)-1;a-- >0;)e[n+r*a+a]=1;for(var o=new le,i=n+r*(r-1),s=r;--s>1;){var f=n+r*s,l=f+(s-1);o.reset();for(var h=s-1;h-- >0;)o.include(t[f+h]);if(0!==o.max){var u=o.resultIncl(t[l])*(t[l]>0?-1:1);o.include(t[l]-=u);for(var c=o.max,d=Math.sqrt(o.sum),w=s;w-- >0;)t[f+w]=t[f+w]/c*Math.SQRT2/d;for(var v=s;v-- >0;){for(var p=0,m=s;m-- >0;)p+=t[n+r*v+m]*t[f+m];for(var g=s;g-- >0;)t[n+r*v+g]-=t[f+g]*p}e.fill(0,i,n+r*r);for(var y=s;y-- >0;)for(var b=r;b-- >0;)e[i+b]+=t[n+r*y+b]*t[f+y];for(var E=s;E-- >0;)for(var _=r;_-- >0;)t[n+r*E+_]-=t[f+E]*e[i+_];for(var x=r-1;x-- >0;){for(var A=0,M=s;M-- >0;)A+=e[n+r*x+M]*t[f+M];for(var k=s;k-- >0;)e[n+r*x+k]-=t[f+k]*A}t.fill(0,f,l),t[l]=u}}e.fill(0,i,n+r*r-1),e[n+r*r-1]=1}function at(r){if((r=nr(r)).ndim<2)throw new Error("hessenberg_decomp(A): A must at least be 2D.");r.dtype;var e=q["float32"===r.dtype?"float32":"float64"],t=r.shape,n=0|t[t.length-1];if(n!=t[t.length-2])throw new Error("hessenberg_decomp(A): A must be square.");var a=e.from(r.data);r=void 0;for(var o=new e(a.length),i=a.length;(i-=n*n)>=0;)nt(n,o,a,i);return[new ar(t,o),new ar(t,a)]}function ot(r){var e=(r=nr(r)).shape.slice(-1),t=T()(e,1)[0],n=r.shape.slice(0,-1),a=new q.complex128(r.data.length/t);if(r.shape[r.ndim-2]!=t)throw new Error("T is not square.");r=r.data;for(var o=0,i=function(e,n){return r[o+t*e+n]},s=0;o<r.length;o+=t*t,s+=t)for(var f=t-1;f>=0;f--){var l=f-1;if(0===f||0==i(f,l))a[s+f]=i(f,f);else{var h=i(l,l),u=i(l,f),c=i(f,l),d=i(f,f),w=y.sub(h,d),v=y.add(h,d),p=y.add(y.mul(w,w),y.mul(y.mul(4,u),c));if(p>=0)throw new Error("schur_eigenvals(T): T must not contain real eigenvalued 2x2 blocks.");var m=y.mul(.5,y.sqrt(p)),g=y.mul(.5,v);a[s+l]=y.add(g,m),a[s+f]=y.sub(g,m),f--}}return new ar(n,a)}function it(r,e){if(r=nr(r),e=nr(e),r.ndim!=e.ndim)throw new Error("Q.ndim != T.ndim.");for(var t=e.ndim;t-- >0;)if(r.shape[t]!=e.shape[t])throw new Error("Q.shape != T.shape.");var n=e.shape.slice(-1),a=T()(n,1)[0],o=e.shape,i=o.slice(0,-1);if(e.shape[e.ndim-2]!=a)throw new Error("Q is not square.");var s=q.complex128,f=s.from(e.data);e=void 0;var l=new s(f.length/a),h=f._array,u=(l._array,new s(a)),c=u._array,d=new s(a),w=d._array,v=u._array.subarray(0,a),p=d._array.subarray(a),m=new Je(NaN,NaN),g=new Je(NaN,NaN),b=new Je(NaN,NaN),E=NaN;function _(r,e,t){for(var n=Math.min(a,t+2),o=e._array,i=t;i-- >0;){for(var s=n;--s>i;){var f=o[2*s+0],l=h[2*(x+a*i+s)+0],u=o[2*s+1],c=h[2*(x+a*i+s)+1];o[2*i+0]-=f*l-u*c,o[2*i+1]-=f*c+u*l}if(0==i||0==A(i,i-1)){var d=h[2*(x+a*i+i)+0]-r.re,w=h[2*(x+a*i+i)+1]-r.im;g.re=o[2*i+0],g.im=o[2*i+1],Math.hypot(d,w)<=E?g.abs()<=E?(o[2*i+0]=0,o[2*i+1]=0):(o[2*i]=1,o.fill(0,2*i+1,2*n)):(g["/="](d,w),o[2*i+0]=g.re,o[2*i+1]=g.im)}else{for(var v=i-1,p=n;--p>i;){var y=o[2*p+0],_=h[2*(x+a*v+p)+0],M=o[2*p+1],k=h[2*(x+a*v+p)+1];o[2*v+0]-=y*_-M*k,o[2*v+1]-=y*k+M*_}var N=h[2*(x+a*v+v)+0]-r.re,F=h[2*(x+a*v+v)+1]-r.im,I=h[2*(x+a*i+i)+0]-r.re,P=h[2*(x+a*i+i)+1]-r.im,q=h[2*(x+a*v+i)+0],S=h[2*(x+a*v+i)+1],j=h[2*(x+a*i+v)+0],O=h[2*(x+a*i+v)+1];if(b["= c0*c1"](N,F,I,P),b["-= c0*c1"](q,S,j,O),0===b.re&&0===b.im)throw new Error("Assertion failed.");g["= c0*c1"](N,F,o[2*i+0],o[2*i+1]),g["-= c0*c1"](j,O,o[2*v+0],o[2*v+1]),g["/="](b.re,b.im),m["= c0*c1"](I,P,o[2*v+0],o[2*v+1]),m["-= c0*c1"](q,S,o[2*i+0],o[2*i+1]),m["/="](b.re,b.im),o[2*v+0]=m.re,o[2*v+1]=m.im,o[2*i+0]=g.re,o[2*i+1]=g.im,i--}}}for(var x=0,A=function(r,e){return f[x+a*r+e]},M=0;x<f.length;x+=a*a,M+=a){if(!((E=Math.sqrt(Number.EPSILON)*function(){for(var r=0,e=0,t=x+a*a,n=x;n<t;n++){var o=y.abs(f[n]);0!=o&&(o>e&&(r*=Math.pow(e/o,2),e=o),r+=Math.pow(o/e,2))}return Math.sqrt(r)*e}())>=0))throw new Error("Assertion failed.");for(var k=a-1;k>=0;k--){var N=k-1;if(0==k||0==A(k,N)){var F=A(k,k);l[M+k]=F,u.fill(0,0,k+2),u[k]=1,_(F,u,k);for(var I=Math.min(a,k+2);I-- >0;)h[2*(x+a*I+k)+0]=c[2*I+0],h[2*(x+a*I+k)+1]=c[2*I+1]}else{var P=A(N,N),S=A(N,k),j=A(k,N),O=A(k,k),R=y.sub(P,O),L=y.add(P,O),D=y.add(y.mul(R,R),y.mul(y.mul(4,S),j));if(D>=0)throw new Error("schur_eigenvals(T): T must not contain real eigenvalued 2x2 blocks.");var G=y.mul(.5,y.sqrt(D)),J=y.mul(.5,L),X=y.add(J,G),z=y.sub(J,G);c.fill(0,0,2*(k+1)),w.fill(0,0,2*(k+1)),y.abs(S)>=y.abs(j)?(u[N]=S,u[k]=y.sub(X,P),d[N]=S,d[k]=y.sub(z,P)):(u[k]=j,u[N]=y.sub(X,O),d[k]=j,d[N]=y.sub(z,O)),_(X,u,N),_(z,d,N);for(var U=k+1;U-- >0;)h[2*(x+a*U+N)+0]=c[2*U+0],h[2*(x+a*U+N)+1]=c[2*U+1],h[2*(x+a*U+k)+0]=w[2*U+0],h[2*(x+a*U+k)+1]=w[2*U+1];l[M+N]=X,l[M+k]=z,--k}}v.fill(0),p.fill(0);for(var Y=0;Y<a;Y++)for(var Q=0;Q<2*a;Q++){var B=Q>>>1,C=Math.abs(h[2*(x+a*Y)+Q]);if(C>0){if(C>p[B]){var V=p[B]/C;p[B]=C,v[B]*=V*V}var W=C/p[B];v[B]+=W*W}}for(var K=v,H=0;H<a;H++){var $=p[H];K[H]=isFinite($)?Math.sqrt(v[H])*$:$}for(var Z=0;Z<a;Z++)for(var rr=0;rr<a;rr++)f[x+a*Z+rr]=y.div(f[x+a*Z+rr],K[rr])}return[new ar(i,l),Ce(r,new ar(o,f))]}function st(r){(r=nr(r)).shape[r.ndim-1];var e=at(r),t=T()(e,2),n=t[0],a=t[1];return r=void 0,function(r,e){var t=r.shape[r.ndim-1],n=q[r.dtype],a=new n(t);if(r.shape[r.ndim-2]!=t)throw new Error("Q is not square.");if(r.ndim!=e.ndim)throw new Error("Q.ndim != H.ndim.");for(var o=r.ndim;o-- >0;)if(r.shape[o]!=e.shape[o])throw new Error("Q.shape != H.shape.");r=r.data,e=e.data;for(var i=Number.EPSILON,s=function r(o,s,f,l){for(var h=function(r,n){return e[l+t*r+n]},u=function(r){return!(Math.abs(h(r,r-1))>i*(Math.abs(h(r-1,r-1))+Math.abs(h(r,r))))&&(e[l+t*r+r-1]*=0,!0)},c=function(r,n,a,i){if(n<=r)throw new Error("Assertion failed.");for(var h=Math.max(0,r-1);h<f;h++){var u=e[l+t*r+h],c=e[l+t*n+h];e[l+t*r+h]=i*c+a*u,e[l+t*n+h]=a*c-i*u}for(var d=Math.min(f,n+2);d-- >0;){var w=e[l+t*d+r],v=e[l+t*d+n];e[l+t*d+r]=i*v+a*w,e[l+t*d+n]=a*v-i*w}for(var p=f;p-- >0;){var m=o[s+f*r+p],g=o[s+f*n+p];o[s+f*r+p]=i*g+a*m,o[s+f*n+p]=a*g-i*m}},d=function(i,h){if(h-i>f>>>1)throw new Error("Assertion failed.");var u=h-i;if(u<3)throw new Error("Assertion failed.");for(var c=new n(u*u),d=0;d<u;d++)c[u*d+d]=1;r(c,0,u,l+t*i+i);for(var w=0;w<u;w++)for(var v=0;v<w;v++){var p=c[u*w+v];c[u*w+v]=c[u*v+w],c[u*v+w]=p}for(var m=0;m<f;m++){a.fill(0,0,u);for(var g=0;g<u;g++)for(var y=0;y<u;y++)a[y]+=c[u*g+y]*o[s+f*(i+g)+m];for(var b=0;b<u;b++)o[s+f*(i+b)+m]=a[b]}for(var E=h;E<f;E++){a.fill(0,0,u);for(var _=0;_<u;_++)for(var x=0;x<u;x++)a[x]+=c[u*_+x]*e[l+t*(i+_)+E];for(var A=0;A<u;A++)e[l+t*(i+A)+E]=a[A]}for(var M=0;M<i;M++){a.fill(0,0,u);for(var k=0;k<u;k++)for(var N=0;N<u;N++)a[N]+=c[u*k+N]*e[l+t*M+(i+k)];for(var F=0;F<u;F++)e[l+t*M+(i+F)]=a[F]}},w=0,v=0,p=f,m=new tt("nd.la.schur_qrfrancis_inplace");;){for(var g=!1;!g;){if(p-v<3)return;if(p-v<f>>>4)return d(v,p);g=!1,u(v+1)?v+=1:u(p-1)?p-=1:u(v+2)?v+=2:u(p-2)?p-=2:g=!0;for(var y=v+p>>>1,b=v+2;g&&++b<p-2;)u(b)&&(g=!1,b>y?(d(b,p),p=b):(d(v,b),v=b));g||(w=0)}w+=1;var E=p-2,_=p-1,x=h(E,E)+h(_,_),A=h(E,E)*h(_,_)-h(E,_)*h(_,E);if(x*x>4*A){var M=x>=0?1:-1,k=.5*(x+M*Math.sqrt(x*x-4*A)),N=2*A/(x+M*Math.sqrt(x*x-4*A));Math.abs(h(_,_)-k)>Math.abs(h(_,_)-N)&&(k=N),x=2*k,A=k*k}if(w%16==0){if(w>1e9)throw new Error("Too many iterations for a single eigenvalue.");A=(x=Math.abs(h(_,E))+Math.abs(h(E,p-3)))*x,x*=m.uniform(1.25,1.75)}_=v+1;for(var F=v+2,I=h(E=v+0,E)*h(E,E)+h(E,_)*h(_,E)-x*h(E,E)+A,P=h(_,E)*(h(E,E)+h(_,_)-x),q=h(_,E)*h(F,_),S=2;S-- >0;_=F,P=q)if(0!=P){var j=ae(I,P),O=T()(j,3),R=O[0],L=O[1],D=O[2];c(E,_,R,L),I=D}for(var G=v;G<p-2;G++){E=G+1;var J=Math.min(p,G+4);for(_=G+2;_<J;_++){var X=h(E,G),z=h(_,G);if(0!==z){var U=ae(X,z),Y=T()(U,3),Q=Y[0],B=Y[1];Y[2];c(E,_,Q,B),e[l+t*_+G]*=0}}}}},f=0;f<r.length;f+=t*t){for(var l=0;l<t;l++)for(var h=0;h<l;h++){var u=r[f+t*l+h];r[f+t*l+h]=r[f+t*h+l],r[f+t*h+l]=u}s(r,f,t,f);for(var c=1;c<t;c++){var d=c-1;if(0!=e[f+t*c+d])if("continue"===function(){var n=e[f+t*d+d],a=e[f+t*d+c],o=e[f+t*c+d],i=e[f+t*c+c]-n,s=i*i+4*a*o;if(s<0)return"continue";for(var l=function(){if(0===a)return[0,1];var r=i+(i<0?-1:1)*Math.sqrt(s),e=2*a,t=Math.hypot(r,e),n=(e<0?-r:+r)/t;return[Math.abs(e)/t,n]}(),h=T()(l,2),u=h[0],w=h[1],v=d;v<t;v++){var p=e[f+t*d+v],m=e[f+t*c+v];e[f+t*d+v]=w*m+u*p,e[f+t*c+v]=u*m-w*p}for(var g=c+1;g-- >0;){var y=e[f+t*g+d],b=e[f+t*g+c];e[f+t*g+d]=w*b+u*y,e[f+t*g+c]=u*b-w*y}for(var E=t;E-- >0;){var _=r[f+t*d+E],x=r[f+t*c+E];r[f+t*d+E]=w*x+u*_,r[f+t*c+E]=u*x-w*_}e[f+t*c+d]*=0}())continue}for(var w=0;w<t;w++)for(var v=0;v<w;v++){var p=r[f+t*w+v];r[f+t*w+v]=r[f+t*v+w],r[f+t*v+w]=p}}}(n,a),[n,a]}function ft(r){var e=ht(r,2),t=T()(e,2),n=t[0],a=st(t[1]),o=T()(a,2),i=it(o[0],o[1]),s=T()(i,2),f=s[0],l=s[1];if(!l.dtype.startsWith("complex"))throw new Error("Assertion failed.");if(!n.dtype.startsWith("float"))throw new Error("Assertion failed.");for(var h=r.shape[r.ndim-1],u=new Float64Array(h),c=new Float64Array(h),d=l.data._array,w=n.data,v=0,p=0;p<d.length;v+=h,p+=2*h*h){u.fill(0),c.fill(0);for(var m=0;m<h;m++)for(var g=w[v+m],y=0;y<2*h;y++){var b=Math.abs(d[p+2*h*m+y]*=g);if(b>0){var E=y>>1;b>c[E]&&(u[E]*=Math.pow(c[E]/b,2),c[E]=b),u[E]+=Math.pow(b/c[E],2)}}for(var _=0;_<h;_++){var x=c[_];u[_]=isFinite(x)?Math.sqrt(u[_])*x:x}for(var A=0;A<h;A++)for(var M=0;M<2*h;M++)d[p+2*h*A+M]/=u[M>>1]}return[f,l]}function lt(r){var e=ht(r,2),t=T()(e,2),n=(t[0],st(t[1])),a=T()(n,2);a[0];return ot(a[1])}function ht(r,e){if(null==e&&(e=2),e>Number.MAX_VALUE)return function(r){var e=r.shape[r.ndim-1],t=q["float32"===r.dtype?"float32":"float64"],n=r.shape,a=n.slice(0,-1);if(r.shape[r.ndim-2]!=e)throw new Error("A is not square");r=t.from(r.data);var o=new t(r.length/e);o.fill(1);for(var i=r.length,s=o.length;i>0;){i-=e*e,s-=e;for(var f,l=!1;!l;)for(f=0,l=!0;f<e;f++){for(var h=0,u=0,c=0;c<e;c++)if(f!==c){var d=Math.abs(r[i+e*f+c]);u=Math.max(u,d);var w=Math.abs(r[i+e*c+f]);h=Math.max(h,w)}if(u*h!=0){var v=Math.max(h,u);if(0!=v){if(!isFinite(v))throw new Error("NaN encountered.");for(var p=1;u>=2*h;)h*=2,u/=2,p*=2;for(;h>=2*u;)h/=2,u*=2,p/=2;if(!(Math.max(h,u)>=v)){l=!1,o[s+f]*=p;for(var m=0;m<e;m++)r[i+e*f+m]/=p,r[i+e*m+f]*=p}}}}}return[new ar(a,o),new ar(n,r)]}(r);var t=r.shape[r.ndim-1],n=q["float32"===r.dtype?"float32":"float64"],a=r.shape,o=a.slice(0,-1);if(!(e>=1))throw new Error("Invalid norm p=".concat(e,";"));if(r.shape[r.ndim-2]!=t)throw new Error("A is not square");r=n.from(r.data);var i=new n(r.length/t),s=Math.pow(.95,1/e);i.fill(1);for(var f=r.length,l=i.length;f>0;){f-=t*t,l-=t;for(var h,u=!1;!u;)for(h=0,u=!0;h<t;h++){for(var c=0,d=0,w=0,v=0,p=0;p<t;p++)if(h!==p){var m=Math.abs(r[f+t*h+p]);if(m>0){if(m>v){var g=v/m;v=m,w*=Math.pow(g,e)}var y=m/v;w+=Math.pow(y,e)}var b=Math.abs(r[f+t*p+h]);if(b>0){if(b>d){var E=d/b;d=b,c*=Math.pow(E,e)}var _=b/d;c+=Math.pow(_,e)}}if((w=isFinite(w)?Math.pow(w,1/e)*v:w)*(c=isFinite(c)?Math.pow(c,1/e)*d:c)!=0){if(!isFinite(w*c))throw new Error("NaN encountered.");for(var x=c>=w?Math.pow(1+Math.pow(w/c,e),1/e)*c:Math.pow(1+Math.pow(c/w,e),1/e)*w,A=1;w>=2*c;)c*=2,w/=2,A*=2;for(;c>=2*w;)c/=2,w*=2,A/=2;if(!((c>=w?Math.pow(1+Math.pow(w/c,e),1/e)*c:Math.pow(1+Math.pow(c/w,e),1/e)*w)>=s*x)){u=!1,i[l+h]*=A;for(var M=0;M<t;M++)r[f+t*h+M]/=A,r[f+t*M+h]*=A}}}}return[new ar(o,i),new ar(a,r)]}function ut(r,e){if(e.ndim<2)throw new Error("eigen_balance_post(D,V): V.ndim must be at least 2.");var t=e.shape.slice(-2),n=T()(t,2),a=n[0],o=n[1];if(a!==o)throw new Error("eigen_balance_post(D,V): V must be square.");var i=q.float64,s=$([e,r.reshape.apply(r,x()(r.shape).concat([1]))],"complex128",b.mul);e=s.data;for(var f=new i(o),l=new i(o),h=0;h<e.length;h+=a*o){f.fill(0),l.fill(0);for(var u=0;u<o;u++)for(var c=0;c<o;c++){var d=b.abs(e[h+o*u+c]);d>0&&(d>l[c]&&(f[c]*=Math.pow(l[c]/d,2),l[c]=d),f[c]+=Math.pow(d/l[c],2))}for(var w=0;w<o;w++){var v=l[w];f[w]=isFinite(v)?Math.sqrt(f[w])*v:v}for(var p=0;p<o;p++)for(var m=0;m<o;m++)e[h+o*p+m]=b.div(e[h+o*p+m],f[m])}return s}function ct(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];var n=e[0]in q?e.shift():"float64";if(e.length<1)throw new Error("Size parameter missing.");1==e.length&&e.push(e[e.length-1]),e=Int32Array.from(e,(function(r){if(0!=r%1)throw new Error("eye(): Invalid shape [".concat(e,"]."));return r}));for(var a=new q[n](e.reduce((function(r,e){return r*e}))),o=e.slice(-2),i=T()(o,2),s=i[0],f=i[1],l=a.length;(l-=s*f)>=0;)for(var h=Math.min(s,f);h-- >0;)a[l+f*h+h]=1;var u=new ar(e,a);return u}function dt(r,e,t,n){if(!(r<=e))throw new Error("Assertion failed.");for(var a=0;a<r;a++){for(var o=0;o<a;o++)for(var i=t[n+e*a+o]*t[n+e*o+o],s=a;s<r;s++)t[n+e*s+a]-=t[n+e*s+o]*i;for(var f=a;++f<r;)t[n+e*f+a]/=t[n+e*a+a]}}function wt(r){r=nr(r);var e=q["float32"===r.dtype?"float32":"float64"],t=r.shape,n=t.slice(-2),a=T()(n,2),o=a[0],i=a[1];if(r=r.data,o!==i)throw new Error("Last two dimensions must be quadratic.");for(var s=new e(r.length),f=0;f<s.length;f+=o*o){for(var l=0;l<o;l++)for(var h=0;h<=l;h++)s[f+o*l+h]=r[f+o*l+h];dt(o,o,s,f)}return new ar(t,s)}function vt(r,e,t,n,a,o,i){if(0!=n.length%1)throw new Error("Assertion failed.");if(0!=o.length%1)throw new Error("Assertion failed.");if(0!=a%1)throw new Error("Assertion failed.");if(0!=i%1)throw new Error("Assertion failed.");if(0!=r%1)throw new Error("Assertion failed.");if(0!=e%1)throw new Error("Assertion failed.");if(0!=t%1)throw new Error("Assertion failed.");if(n.length-a<r*e)throw new Error("Assertion failed.");if(o.length-i<r*t)throw new Error("Assertion failed.");if(!(0<r))throw new Error("Assertion failed.");if(!(0<e))throw new Error("Assertion failed.");if(!(0<t))throw new Error("Assertion failed.");if(!(r<=e))throw new Error("Assertion failed.");for(var s=1;s<r;s++)for(var f=0;f<s;f++)for(var l=0;l<t;l++)o[i+t*s+l]-=n[a+e*s+f]*o[i+t*f+l];for(var h=0;h<r;h++)for(var u=0;u<t;u++)o[i+t*h+u]/=n[a+e*h+h];for(var c=r;c-- >1;)for(var d=c;d-- >0;)for(var w=t;w-- >0;)o[i+t*d+w]-=n[a+e*c+d]*o[i+t*c+w]}function pt(r,e){if(r=nr(r),e=nr(e),r.ndim<2)throw new Error("ldl_solve(LD,y): LD must be at least 2D.");if(e.ndim<2)throw new Error("ldl_solve(LD,y): y must be at least 2D.");var t=r.shape.slice(-2),n=T()(t,2),a=n[0],o=n[1],i=e.shape.slice(-2),s=T()(i,2),f=s[0],l=s[1];if(a!=o)throw new Error("ldl_solve(LD,y): Last two dimensions of LD must be quadratic.");if(f!=o)throw new Error("ldl_solve(LD,y): LD and y don't match.");var h=Math.max(r.ndim,e.ndim),u=Int32Array.from({length:h},(function(){return 1}));u[h-2]=f,u[h-1]=l;for(var c=0,d=[r,e];c<d.length;c++)for(var w=d[c],v=h-2,p=w.ndim-2;v-- >0&&p-- >0;)if(1===u[v])u[v]=w.shape[p];else if(u[v]!=w.shape[p]&&1!=w.shape[p])throw new Error("Shapes are not broadcast-compatible.");var m="float32"===r.dtype&&"float32"===e.dtype?"float32":"float64",g=new q[m](u.reduce((function(r,e){return r*e}),1)),y=r.data,b=e.data,E=0,_=1,x=0,A=1,M=0;return function t(n){if(n===h-2){_=a*a,A=a*l;for(var o=0;o<A;o++)g[M+o]=b[x+o];return vt(a,a,l,y,E,g,M),E+=_,x+=A,void(M+=A)}for(var i=u[n];t(n+1),1!=i;i--)r.shape[n-h+r.ndim]>1||(E-=_),e.shape[n-h+e.ndim]>1||(x-=A);_*=r.shape[n-h+r.ndim]||1,A*=e.shape[n-h+e.ndim]||1}(0),new ar(u,g)}function mt(r){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(r){return!1}}();return function(){var t,n=C()(r);if(e){var a=C()(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return Q()(this,t)}}var gt=function(r){U()(t,r);var e=mt(t);function t(r){var n;p()(this,t);for(var a=arguments.length,o=new Array(a>1?a-1:0),i=1;i<a;i++)o[i-1]=arguments[i];if(n=e.call.apply(e,[this].concat(o)),!(r instanceof ar))throw new Error("Assertion failed.");return n.x=r,n}return t}(W()(Error));function yt(r,e,t,n){var a=Math.atan2(t-e,n+r),o=Math.atan2(t+e,n-r),i=(a-o)/2,s=(a+o)/2,f=Math.cos(i),l=Math.sin(i),h=Math.cos(s),u=Math.sin(s);if(a=h*(l*t+f*r)-u*(l*n+f*e),o=u*(f*t-l*r)+h*(f*n-l*e),Math.abs(a)<Math.abs(o)){var c=[f,-l];l=c[0],f=c[1];var d=[u,-h];h=d[0],u=d[1],a=o}return a<0&&(h=-h,u=-u),[f,l,h,u]}function bt(r,e,t,n,a,o,i,s){r|=0,a|=0,i|=0;for(var f=0;f<r;f++)o[i+f]=t[r*f+f];Et(r,e,n,a,o,i,s)}function Et(r,e,t,n,a,o,i){n|=0,o|=0;for(var s=r|=0;s-- >0;){var f=a[o+s];if(f<0||Object.is(f,-0)){a[o+s]=-f;for(var l=0;l<r;l++)e[n+r*s+l]*=-1}}i.sort((function(r,e){return a[o+e]-a[o+r]}));for(var h=0;h<r;++h)for(var u=h;;){var c=i[u];if(i[u]=u,(u=c)<=h)break;for(var d=n+i[u]*r,w=n+u*r,v=0;v<r;v++){var p=e[d+v];e[d+v]=e[w+v],e[w+v]=p}for(var m=0;m<r;m++){var g=t[d+m];t[d+m]=t[w+m],t[w+m]=g}c=a[o+i[u]],a[o+i[u]]=a[o+u],a[o+u]=c}for(var y=0;y<r-1;y++)for(var b=y;++b<r;){var E=n+r*y+b,_=n+r*b+y,x=e[E];e[E]=e[_],e[_]=x}}function _t(r,e,t,n,a,o,i,s){if(e>r)throw new Error("Assertion failed.");if(1>=e)throw new Error("Assertion failed.");if(2===e)return function(r,e,t,n,a,o){r|=0,t|=0,o|=0;var i=ae(n[a|=0],n[a+1]),s=T()(i,3),f=s[0],l=s[1],h=s[2];0!==h?(n[a]=h,n[a+1]=NaN,n[o]=f,n[o+1]=-l,n[o+1*r]=l,n[o+1*r+1]=f):(n[o]=1,n[o+1*r+1]=1),e[t]=1}(r,t,n,a,o,i);if(3===e)return function(r,e,t,n,a,o){t|=0,o|=0;var i=(r|=0)-1|0,s=n[a|=0],f=n[a+1],l=n[a+2],h=n[a+3];if(0!==h){var u=ae(l,h),c=T()(u,3),d=c[0],w=c[1],v=c[2];if(n[o+1*r+1]=d,n[o+2*r+1]=w,l=v,h=-w*f,f*=d,0!==h){var p=ae(s,h),m=T()(p,3),g=m[0],y=m[1];s=m[2],n[o]=g,n[o+1*r]=y*-w,n[o+2*r]=y*d,n[o+2]=-y,n[o+1*r+2]=g*-w,n[o+2*r+2]=g*d}else n[o]=1,n[o+1*r+2]=-w,n[o+2*r+2]=d}else n[o]=1,n[o+1*r+1]=1,n[o+2*r+2]=1;var b=yt(s,f,0,l),E=T()(b,4),_=E[0],x=E[1],A=E[2],M=E[3];n[a+1]=NaN,n[a+3]=NaN,n[a]=_*s*A-(_*f+x*l)*M;var k=(l=(-x*f+_*l)*A-x*s*M)<0?-1:1;n[a+2]=k*l,e[t]=_,e[t+1]=-x*k,e[t+1*i]=x,e[t+1*i+1]=_*k,n[o+1]=M*n[o],n[o]*=A;var N=n[o+1*r]*A-n[o+1*r+1]*M;n[o+1*r+1]=n[o+1*r]*M+n[o+1*r+1]*A,n[o+1*r]=N;var F=n[o+2*r]*A-n[o+2*r+1]*M;n[o+2*r+1]=n[o+2*r]*M+n[o+2*r+1]*A,n[o+2*r]=F}(r,t,n,a,o,i);var f=r-1,l=e-1,h=e>>>1,u=h-1;if(s.length<f)throw new Error("Assertion failed: Integer work matrix I too small.");if(a.length<2*f)throw new Error("Assertion failed: Scalar work matrix F too small.");_t(r,h,t,n,a,o,i,s),_t(r,e-h,t,n+f*h+h,a,o+2*h,i+r*h+h,s),t[n+f*u+u]=1;for(var c=a[o+2*u],d=a[o+2*u+1],w=0;w<u;w++)a[o+2*w+1]=c*a[i+r*u+w];for(var v=h;v<l;v++)a[o+2*v+1]=d*a[i+r*h+v];var p=ae(c*a[i+r*u+u],d*a[i+r*h+l]),m=T()(p,3),g=m[0],y=m[1],b=m[2];if(a[o+2*u]=0,a[o+2*u+1]=b,0!==b){for(var E=0;E<h;E++)a[i+r*E+l]=a[i+r*E+u]*-y,a[i+r*E+u]*=g;for(var _=h;_<e;_++)a[i+r*_+u]=a[i+r*_+l]*y,a[i+r*_+l]*=g}s[l-1]=u;for(var x=0,A=h,M=0;M<l-1;M++)s[M]=A>=l||x<u&&a[o+2*x]>=a[o+2*A]?x++:A++;for(var k=0;k<l;k++){var N=s[k];a[2*k]=a[o+2*N],a[2*k+1]=a[o+2*N+1]}for(var F=0;F<l;F++)a[o+2*F]=a[2*F],a[o+2*F+1]=a[2*F+1];!function(r,e,t,n,a,o,i,s){n|=0,o|=0,i|=0;var f=(r|=0)-1|0,l=(e|=0)-1|0;if(s.length<3*f)throw new Error("Assertion failed: Integer work matrix I too small.");if(a.length<f*(f+2)+2*f+(f+1)*(f+1))throw new Error("Assertion failed: Scalar work matrix F too small.");var h=f*(f+2)-l,u=f*(f+2)-2*l,c=f*(f+2)-l*(l+2),d=2*l,w=l;if(e<2)throw new Error("Assertion failed.");if(0!==a[o+2*l-2])throw new Error("Assertion failed.");for(var v=1;v<l;v++)if(a[o+2*(v-1)]<a[o+2*v])throw new Error("Assertion failed.");for(var p=new le,m=function(){for(var r=0;r<l;r++)p.include(a[o+2*r+1]);for(var e=p.result,t=0;t<l;t++)p.include(a[o+2*t]);var n=p.result;return 0===n&&(n=1),[e/n,n]}(),g=T()(m,2),y=g[0],b=g[1],E=0;E<2*l;E++)a[o+E]/=b;for(var _=S(t instanceof Float32Array?"float32":"float64"),x=function(){for(var r=0,e=l-1,t=l-1;t-- >0;){var n=a[o+2*t],i=a[o+2*t+1],f=s[0+t];Math.abs(i)/_<=n?(a[h+r]=n,s[w+r]=f,++r):(--e,a[o+2*e]=n,a[o+2*e+1]=a[o+2*t+1],s[w+e]=f)}return r}(),A=0;A<x;A++)s[0+A]=s[w+A];for(var M=function(){for(var r=x,e=l-1,t=l-1;t-- >x;){var n=a[o+2*t],i=a[o+2*e],f=s[w+t],u=a[o+2*t+1],v=ae(a[o+2*e+1],u),p=T()(v,3),m=p[0],g=p[1],y=p[2];(n-i)/_<=n||!isFinite(Math.sqrt(l)/(n-i))?(a[c+2*r]=m,a[c+2*r+1]=g,a[o+2*e+1]=y,a[o+2*e]=a[h+r]=n,s[0+r]=f,s[d+r]=e,++r):(--e,a[o+2*e]=n,a[o+2*e+1]=a[o+2*t+1],s[0+e]=f)}return r}(),k=2*x;k<2*M;k++)a[o+k]=a[c+k],a[c+k]=0;for(var N=function(r){var e=a[o+2*r],t=M<r?a[o+2*r-2]:e+y;if(e>t)throw new Error("Assertion failed.");for(var n=function(){if(r>M){for(var n=(e+t)/2,i=1,s=M;s<l;s++){var f=a[o+2*s],h=a[o+2*s+1];i+=h/(f-n)*(h/(f+n))}if(!isFinite(i))throw new Error("Assertion failed.");if(i<0){var u=t;return e-=t,t=-Number.MIN_VALUE,u}}var c=e;return t-=e,e=+Number.MIN_VALUE,c}();;){var i=(e+t)/2;if(i===e||i===t){a[h+r]=i;break}for(var s=1,f=M;f<l;f++){var u=a[o+2*f],c=a[o+2*f+1];s+=c/(u-n-i)*(c/(u+n+i))}if(!isFinite(s))throw new Error("Assertion failed.");s<=0&&(e=i),s>=0&&(t=i)}},F=M;F<l;F++)N(F);0===Math.abs(a[o+2*l-1])&&(a[o+2*l-2]=0,a[o+2*l-1]=0,a[h+l-1]=0);for(var I=a[h+l-1],P=a[o+2*(l-1-(I<0))],q=M;q<l;q++){for(var j=a[o+2*q],O=(P-j+I)*(P+j+I),R=M;R<q;R++){var L=a[h+R],D=a[o+2*(R-(L<0))],G=a[o+2*R];O*=(D-j+L)/(G-j)*((D+j+L)/(G+j))}for(var J=q;J<l-1;J++){var X=a[h+J],z=a[o+2*(J-(X<0))],U=a[o+2*J+2];O*=(z-j+X)/(U-j)*((z+j+X)/(U+j))}a[o+2*q+1]=Math.sign(a[o+2*q+1])*Math.sqrt(O)}for(var Y=x-1,Q=M-1,B=M,C=0;C<l;C++){var V=-1/0,W=3;if(B<l){var K=a[h+B];W=2,V=K+a[o+2*(B-(K<0))]}if(Q>=x){var H=a[h+Q];H<V||(W=1,V=H)}if(Y>=0){var $=a[h+Y];$<V||(W=0,V=$)}switch(W){case 0:s[w+Y--]=C;continue;case 1:s[w+Q--]=C;continue;case 2:s[w+B++]=C;continue;default:throw new Error("Assertion failed.")}}for(var Z=M;Z<l;Z++){var rr=a[h+Z],er=a[o+2*(Z-(rr<0))];p.reset();for(var tr=M;tr<l-1;tr++){var nr=a[o+2*tr],ar=a[o+2*tr+1]/(nr-er-rr)*(nr/(nr+er+rr));p.include(a[c+l*Z+tr]=ar)}p.include(a[c+l*Z+l-1]=-1);var or=p.result;if(!(0<or))throw new Error("Assertion failed.");for(var ir=M;ir<l;ir++)a[c+l*Z+ir]/=or}for(var sr=M;sr<l;sr++)for(var fr=sr;++fr<l;){var lr=a[c+l*sr+fr];a[c+l*sr+fr]=a[c+l*fr+sr],a[c+l*fr+sr]=lr}if(x<M){for(var hr=x;hr<M;hr++)a.fill(0,c+l*hr+x,c+l*hr+l),a[c+l*hr+hr]=1;for(var ur=M;ur<l;ur++)a.fill(0,c+l*ur+x,c+l*ur+M);for(var cr=M;cr-- >x;){var dr=s[d+cr];if(dr<l-1){var wr=a[o+2*cr],vr=a[o+2*cr+1];oe(a,l-cr,c+l*cr+cr,c+l*dr+cr,wr,vr)}}}for(var pr=0;pr<l;pr++){a.fill(0,u+x,u+l);for(var mr=x;mr<l;mr++){var gr=t[n+f*pr+s[0+mr]];if(0!==gr)for(var yr=x;yr<l;yr++)a[u+yr]+=gr*a[c+l*mr+yr]}for(var br=0;br<x;br++){var Er=s[0+br];a[u+br]=t[n+f*pr+Er]}for(var _r=0;_r<l;_r++){t[n+f*pr+s[w+_r]]=a[u+_r]}}for(var xr=M;xr<l;xr++){var Ar=a[h+xr],Mr=a[o+2*(xr-(Ar<0))];p.reset();for(var kr=M;kr<l;kr++){var Nr=a[o+2*kr],Fr=a[o+2*kr+1]/(Nr-Mr-Ar)/(Nr+Mr+Ar);p.include(a[c+l*xr+kr]=Fr)}var Ir=p.result;if(!(0<Ir||xr===l-1))throw new Error("Assertion failed: "+Ir);for(var Pr=M;Pr<l;Pr++)a[c+l*xr+Pr]/=Ir}if(0===a[o+2*l-1]){for(var qr=M;qr<l-1;qr++)a[c+l*(l-1)+qr]=0;a[c+l*(l-1)+(l-1)]=1}for(var Sr=M;Sr<l;Sr++)for(var jr=Sr;++jr<l;){var Or=a[c+l*Sr+jr];a[c+l*Sr+jr]=a[c+l*jr+Sr],a[c+l*jr+Sr]=Or}if(x<M){for(var Rr=x;Rr<M;Rr++)a.fill(0,c+l*Rr+x,c+l*Rr+l),a[c+l*Rr+Rr]=1;for(var Lr=M;Lr<l;Lr++)a.fill(0,c+l*Lr+x,c+l*Lr+M);for(var Dr=M;Dr-- >x;){var Gr=s[d+Dr],Jr=a[o+2*Dr],Tr=a[o+2*Dr+1];oe(a,l-Dr,c+l*Dr+Dr,c+l*Gr+Dr,Jr,Tr)}}for(var Xr=0;Xr<e;Xr++){a.fill(0,u+x,u+l);for(var zr=x;zr<l;zr++){var Ur=a[i+r*Xr+s[0+zr]];if(0!==Ur)for(var Yr=x;Yr<l;Yr++)a[u+Yr]+=Ur*a[c+l*zr+Yr]}for(var Qr=0;Qr<x;Qr++){var Br=s[0+Qr];a[u+Qr]=a[i+r*Xr+Br]}for(var Cr=0;Cr<l;Cr++){var Vr=s[w+Cr];a[i+r*Xr+Vr]=a[u+Cr]}}for(var Wr=M;Wr<l;Wr++)a[h+Wr]+=a[o+2*(Wr-(a[h+Wr]<0))];for(var Kr=0;Kr<l;Kr++){var Hr=s[w+Kr];a[o+2*Hr]=a[h+Kr]*b,a[o+2*Hr+1]=NaN}}(r,e,t,n,a,o,i,s)}function xt(r,e,t,n,a,o,i,s,f,l){if(r>e)throw new Error("Assertion failed.");if(f.length<3*r)throw new Error("Assertion failed: Integer work matrix I too small.");if(l.length<r*(r+2)+2*r+(r+1)*(r+1)+(r+1)*e)throw new Error("Assertion failed: Scalar work matrix F too small.");var h=r*(r+2),u=h+2*r,c=u+(r+1)*(r+1);l.fill(0,u,c+e);for(var d=0;d<r;d++)for(var w=0;w<e;w++)l[c+e+e*d+w]=i[s+e*d+w];i.fill(0,s,s+r*e),ve(r,e,t,n,l,0,l,c);for(var v=0;v<r;v++)l[h+2*v]=l[(r+1)*v+v],l[h+2*v+1]=l[(r+1)*v+v+1];_t(r+1,r+1,i,s,l,h,u,f);for(var p=0;p<r;p++)a[o+p]=l[h+2*p];for(var m=0;m<r;m++){l.fill(0,0,r);for(var g=0;g<r;g++)for(var y=0;y<r;y++)l[y]+=t[n+r*m+g]*i[s+r*g+y];for(var b=0;b<r;b++)t[n+r*m+b]=l[b]}i.fill(0,s,s+r*r);for(var E=0;E<r+1;E++)for(var _=0;_<r;_++)for(var x=0;x<e;x++)i[s+e*_+x]+=l[u+(r+1)*E+_]*l[c+e*E+x]}function At(r){if((r=nr(r)).dtype.startsWith("complex"))throw new Error("svd_dc(A): A.dtype must be float.");var e=r.shape.slice(-2),t=T()(e,2),n=t[0],a=t[1];if(n>a){var o=At(r.T),i=T()(o,3),s=i[0],f=i[1],l=i[2];return ce(s),[l.T,f,s]}var h=r.shape,u=h.slice(),c=h.slice(0,-1);u[u.length-1]=n;var d="float32"===r.dtype?"float32":"float64",w=q[d],v=(r=r.data).length/(n*a),p=w.from(r);r=void 0;for(var m=new w(v*n*n),g=new w(v*n),y=new w(n*(n+2)+2*n+(n+1)*(n+1)+(n+1)*Math.max(1+n,a)),b=new Int32Array(3*n),E=0,_=0,x=0;_<g.length;E+=n*n,_+=n,x+=n*a)xt(n,a,m,E,g,_,p,x,b,y);return[new ar(u,m),new ar(c,g),new ar(h,p)]}function Mt(r){var e=(r=nr(r)).shape[r.ndim-1],t=r.shape.slice(0,-1),n=b.sqrt(S(r.dtype));r=r.data;for(var a=new q.int32(r.length/e),o=0;o<a.length;o++){var i=n*b.abs(r[e*o]);if(0!==a[o])throw new Error("Assertion failed.");for(;a[o]<e;a[o]++){var s=b.abs(r[e*o+a[o]]);if(!isFinite(s))throw new Error("svd_rank(): NaN or Infinity encountered.");if(s<=i)break}}return new ar(t,a)}function kt(r,e,t,n){if(null==n){if(null!=t)throw new Error("svd_lstsq(Q,R,P, y): Either 2 ([Q,R,P], y) or 4 arguments (Q,R,P, y) expected.");n=e;var a=r,o=T()(a,3);r=o[0],e=o[1],t=o[2]}if(r=nr(r),e=nr(e),t=nr(t),r.shape[r.ndim-2]!==t.shape[t.ndim-1])throw new Error("rrqr_solve(Q,R,P, y): System not square.");var i=Nt(r,e,t,n),s=b.sqrt(S(e.dtype)),f=e.shape[e.ndim-1];e=e.data;for(var l=0;l<e.length;l+=f)for(var h,u=s*b.abs(e[l]);h<f;h++){var c=b.abs(e[l+h]);if(!isFinite(c))throw new Error("svd_solve(): NaN or Infinity encountered.");if(c<=u)throw new gt(i)}return i}function Nt(r,e,t,n){if(null==n){if(null!=t)throw new Error("svd_lstsq(Q,R,P, y): Either 2 ([Q,R,P], y) or 4 arguments (Q,R,P, y) expected.");n=e;var a=r,o=T()(a,3);r=o[0],e=o[1],t=o[2]}if((r=nr(r)).ndim<2)throw new Error("svd_lstsq(U,sv,V, y): U.ndim must be at least 2.");if((e=nr(e)).ndim<1)throw new Error("svd_lstsq(U,sv,V, y): sv.ndim must be at least 1.");if((t=nr(t)).ndim<2)throw new Error("svd_lstsq(U,sv,V, y): V.ndim must be at least 2.");if((n=nr(n)).ndim<2)throw new Error("svd_lstsq(U,sv,V, y): y.ndim must be at least 2.");var i=r.shape.slice(-2),s=T()(i,2),f=s[0],l=s[1],h=t.shape.slice(-1),u=T()(h,1)[0],c=n.shape.slice(-1),d=T()(c,1)[0];if(f!==n.shape[n.ndim-2])throw new Error("svd_lstsq(U,sv,V, y): U and y don't match.");if(l!==e.shape[e.ndim-1])throw new Error("svd_lstsq(U,sv,V, y): U and sv don't match.");if(l!==t.shape[t.ndim-2])throw new Error("svd_lstsq(U,sv,V, y): V and sv don't match.");var w=Math.max(r.ndim,e.ndim+1,t.ndim,n.ndim),v=Int32Array.from({length:w},(function(){return 1}));v[w-2]=u,v[w-1]=d;for(var p=0,m=[r,t,n];p<m.length;p++)for(var g=m[p],y=w-2,E=g.ndim-2;y-- >0&&E-- >0;)if(1===v[y])v[y]=g.shape[E];else if(v[y]!=g.shape[E]&&1!=g.shape[E])throw new Error("svd_lstsq(U,sv,V, y): U,sv,V,y not broadcast-compatible.");for(var _=w-2,x=e.ndim-1;_-- >0&&x-- >0;)if(1===v[_])v[_]=e.shape[x];else if(v[_]!=e.shape[x]&&1!=e.shape[x])throw new Error("svd_lstsq(U,sv,V, y): U,sv,V,y not broadcast-compatible.");var A=b.sqrt(S(e.dtype)),M=q[[r,e,t,n].every((function(r){return"float32"===r.dtype}))?"float32":"float64"],k=new M(l*d),N=new M(v.reduce((function(r,e){return r*e}),1)),F=r.data,I=e.data,P=t.data,j=n.data,O=0,R=1,L=0,D=1,G=0,J=1,X=0,z=1,U=0;return function a(o){if(o===w-2){R=f*l,D=l,J=l*u,z=f*d;var i=function(){for(var r=A*b.abs(I[L]),e=0;e<l;e++){var t=b.abs(I[L+e]);if(!isFinite(t))throw new Error("svd_solve(): NaN or Infinity encountered.");if(t<=r)return e}return l}();k.fill(0);for(var s=0;s<f;s++)for(var h=0;h<i;h++)for(var c=0;c<d;c++)k[d*h+c]+=F[O+l*s+h]*j[X+d*s+c];for(var p=0;p<i;p++)for(var m=0;m<d;m++)k[d*p+m]/=I[L+p];for(var g=0;g<i;g++)for(var y=0;y<u;y++)for(var E=0;E<d;E++)N[U+d*y+E]+=P[G+u*g+y]*k[d*g+E];return O+=R,L+=D,G+=J,X+=z,void(U+=u*d)}for(var _=v[o];a(o+1),1!=_;_--)r.shape[o-w+r.ndim]>1||(O-=R),e.shape[o-w+1+e.ndim]>1||(L-=D),t.shape[o-w+t.ndim]>1||(G-=J),n.shape[o-w+n.ndim]>1||(X-=z);R*=r.shape[o-w+r.ndim]||1,D*=e.shape[o-w+1+e.ndim]||1,J*=t.shape[o-w+t.ndim]||1,z*=n.shape[o-w+n.ndim]||1}(0),new ar(v,N)}function Ft(r,e){var t=At(r),n=T()(t,3);return Nt(n[0],n[1],n[2],e)}function It(r){r=nr(r);var e=q["float32"===r.dtype?"float32":"float64"].from(r.data),t=r.shape.slice(-2),n=T()(t,2),a=n[0],o=n[1],i=new Int32Array(e.length/o);if(a!=o)throw new Error("Last two dimensions must be quadratic.");for(var s=0,f=0;s<e.length;s+=a*a,f+=a){for(var l=0;l<a;l++)i[f+l]=l;for(var h=0;h<a;h++){for(var u=s+h*a,c=h,d=h+1;d<a;d++)Math.abs(e[s+a*d+h])>Math.abs(e[s+a*c+h])&&(c=d);if(h!=c){var w=i[f+h];i[f+h]=i[f+c],i[f+c]=w;for(var v=s+c*a,p=0;p<a;p++){var m=e[u+p];e[u+p]=e[v+p],e[v+p]=m}}for(var g=h+1;g<a;g++){var y=s+g*a,b=e[y+h]/e[u+h];e[y+h]=b;for(var E=h+1;E<a;E++)e[y+E]-=b*e[u+E]}}}return[new ar(r.shape,e),new ar(r.shape.slice(0,-1),i)]}function Pt(r,e,t){if(null==t){t=e;var n=r,a=T()(n,2);r=a[0],e=a[1]}if((r=nr(r)).ndim<2)throw new Error("LU must be at least 2D.");if((e=nr(e)).ndim<1)throw new Error("P must be at least 1D.");if((t=nr(t)).ndim<2)throw new Error("y must be at least 2D.");var o=r.shape.slice(-2),i=T()(o,2),s=i[0],f=i[1],l=t.shape.slice(-2),h=T()(l,2),u=h[0],c=h[1];if(f!=s)throw new Error("Last two dimensions of LU must be quadratic.");if(f!=u)throw new Error("LU and y don't match.");if(f!=e.shape.slice(-1))throw new Error("LU and P don't match.");var d=Math.max(r.ndim,e.ndim+1,t.ndim),w=Int32Array.from({length:d},(function(){return 1}));w[d-2]=u,w[d-1]=c;for(var v=0,p=[r,t];v<p.length;v++)for(var m=p[v],g=d-2,y=m.ndim-2;g-- >0&&y-- >0;)if(1===w[g])w[g]=m.shape[y];else if(w[g]!=m.shape[y]&&1!=m.shape[y])throw new Error("LU and y are not broadcast-compatible.");for(var b=d-2,E=e.ndim-1;b-- >0&&E-- >0;)if(1===w[b])w[b]=e.shape[E];else if(w[b]!=e.shape[E]&&1!=e.shape[E])throw new Error("P is not broadcast-compatible.");var _=new(q[[r,e,t].every((function(r){return"float32"===r.dtype}))?"float32":"float64"])(w.reduce((function(r,e){return r*e}),1)),x=r.data,A=e.data,M=t.data,k=0,N=1,F=0,I=1,P=0,S=1,j=0;return function n(a){if(a===d-2){N=s*s,I=s,S=s*c;for(var o=0;o<u;o++)for(var i=j+c*o,f=P+c*A[F+o],l=0;l<c;l++)_[i+l]=M[f+l];for(var h=0;h<u;h++)for(var v=0;v<c;v++)for(var p=0;p<h;p++)_[j+h*c+v]-=x[k+s*h+p]*_[j+p*c+v];return Ee(u,u,c,x,k,_,j),k+=N,F+=I,P+=S,void(j+=S)}for(var m=w[a];n(a+1),1!=m;m--)r.shape[a-d+r.ndim]>1||(k-=N),e.shape[a-d+e.ndim+1]>1||(F-=I),t.shape[a-d+t.ndim]>1||(P-=S);N*=r.shape[a-d+r.ndim]||1,I*=e.shape[a-d+e.ndim+1]||1,S*=t.shape[a-d+t.ndim]||1}(0),new ar(w,_)}function qt(r,e){if((r=nr(r)).ndim<2)throw new Error("permute_rows(A,P): A.ndim must be at least 2.");if((e=nr(e)).ndim<1)throw new Error("permute_rows(A,P): P.ndim must be at least 1.");if("int32"!==e.dtype)throw new Error('permute_rows(A,P): P.dtype must be "int32".');var t=Math.max(r.ndim,e.ndim+1),n=Int32Array.from({length:t},(function(){return 1})),a=r.shape.slice(-2),o=T()(a,2),i=o[0],s=o[1];if(i!==e.shape[e.ndim-1])throw new Error("permute_rows(A,P): A.shape[-2] and P.shape[-1] must match.");for(var f=t,l=r.ndim;f-- >0&&l-- >0;)n[f]=r.shape[l];for(var h=t-2,u=e.ndim-1;h-- >0&&u-- >0;)if(1===n[h])n[h]=e.shape[u];else if(n[h]!=e.shape[u]&&1!=e.shape[u])throw new Error("permute_rows(A,P): A and P not broadcast-compatible.");var c=new q[r.dtype](n.reduce((function(r,e){return r*e}))),d=r.shape,w=r.ndim,v=e.shape,p=e.ndim;r=r.data,e=e.data;var m=0,g=-1,y=0,b=-1,E=0;return function a(o){if(o===t-2){for(var f=0;f<i;f++){var l=e[y+f];if(!(l>=0))throw new Error("permute_rows(A,P): P.contains invalid indices.");if(!(l<i))throw new Error("permute_rows(A,P): P.contains invalid indices.");for(var h=0;h<s;h++)c[E+s*f+h]=r[m+s*l+h]}return m+=g=i*s,y+=b=i,void(E+=g)}for(var u=n[o];a(o+1),1!==u;u--)d[o-t+w]>1||(m-=g),v[o-t+1+p]>1||(y-=b);g*=d[o-t+w]||1,b*=v[o-t+1+p]||1}(0),new ar(n,c)}function St(r,e){if((r=nr(r)).ndim<2)throw new Error("permute_cols(A,P): A.ndim must be at least 2.");if((e=nr(e)).ndim<1)throw new Error("permute_cols(A,P): P.ndim must be at least 1.");if("int32"!==e.dtype)throw new Error('permute_cols(A,P): P.dtype must be "int32".');var t=Math.max(r.ndim,e.ndim+1),n=Int32Array.from({length:t},(function(){return 1})),a=r.shape.slice(-2),o=T()(a,2),i=o[0],s=o[1];if(s!==e.shape[e.ndim-1])throw new Error("permute_cols(A,P): A.shape[-1] and P.shape[-1] must match.");for(var f=t,l=r.ndim;f-- >0&&l-- >0;)n[f]=r.shape[l];for(var h=t-2,u=e.ndim-1;h-- >0&&u-- >0;)if(1===n[h])n[h]=e.shape[u];else if(n[h]!=e.shape[u]&&1!=e.shape[u])throw new Error("permute_cols(A,P): A and P not broadcast-compatible.");var c=new q[r.dtype](n.reduce((function(r,e){return r*e}))),d=r.shape,w=r.ndim,v=e.shape,p=e.ndim;r=r.data,e=e.data;var m=0,g=-1,y=0,b=-1,E=0;return function a(o){if(o===t-2){for(var f=0;f<i;f++)for(var l=0;l<s;l++){var h=e[y+l];if(!(h>=0))throw new Error("permute_cols(A,P): P.contains invalid indices.");if(!(h<s))throw new Error("permute_cols(A,P): P.contains invalid indices.");c[E+s*f+l]=r[m+s*f+h]}return m+=g=i*s,y+=b=s,void(E+=g)}for(var u=n[o];a(o+1),1!==u;u--)d[o-t+w]>1||(m-=g),v[o-t+1+p]>1||(y-=b);g*=d[o-t+w]||1,b*=v[o-t+1+p]||1}(0),new ar(n,c)}function jt(r,e){if((r=nr(r)).ndim<2)throw new Error("unpermute_rows(A,P): A.ndim must be at least 2.");if((e=nr(e)).ndim<1)throw new Error("unpermute_rows(A,P): P.ndim must be at least 1.");if("int32"!==e.dtype)throw new Error('unpermute_rows(A,P): P.dtype must be "int32".');var t=Math.max(r.ndim,e.ndim+1),n=Int32Array.from({length:t},(function(){return 1})),a=r.shape.slice(-2),o=T()(a,2),i=o[0],s=o[1];if(i!==e.shape[e.ndim-1])throw new Error("unpermute_rows(A,P): A.shape[-2] and P.shape[-1] must match.");for(var f=t,l=r.ndim;f-- >0&&l-- >0;)n[f]=r.shape[l];for(var h=t-2,u=e.ndim-1;h-- >0&&u-- >0;)if(1===n[h])n[h]=e.shape[u];else if(n[h]!=e.shape[u]&&1!=e.shape[u])throw new Error("unpermute_rows(A,P): A and P not broadcast-compatible.");var c=new q[r.dtype](n.reduce((function(r,e){return r*e}))),d=r.shape,w=r.ndim,v=e.shape,p=e.ndim;r=r.data,e=e.data;var m=0,g=-1,y=0,b=-1,E=0;return function a(o){if(o===t-2){for(var f=0;f<i;f++){var l=e[y+f];if(!(l>=0))throw new Error("unpermute_rows(A,P): P.contains invalid indices.");if(!(l<i))throw new Error("unpermute_rows(A,P): P.contains invalid indices.");for(var h=0;h<s;h++)c[E+s*l+h]=r[m+s*f+h]}return m+=g=i*s,y+=b=i,void(E+=g)}for(var u=n[o];a(o+1),1!==u;u--)d[o-t+w]>1||(m-=g),v[o-t+1+p]>1||(y-=b);g*=d[o-t+w]||1,b*=v[o-t+1+p]||1}(0),new ar(n,c)}function Ot(r,e){if((r=nr(r)).ndim<2)throw new Error("unpermute_cols(A,P): A.ndim must be at least 2.");if((e=nr(e)).ndim<1)throw new Error("unpermute_cols(A,P): P.ndim must be at least 1.");if("int32"!==e.dtype)throw new Error('unpermute_cols(A,P): P.dtype must be "int32".');var t=Math.max(r.ndim,e.ndim+1),n=Int32Array.from({length:t},(function(){return 1})),a=r.shape.slice(-2),o=T()(a,2),i=o[0],s=o[1];if(s!==e.shape[e.ndim-1])throw new Error("unpermute_cols(A,P): A.shape[-1] and P.shape[-1] must match.");for(var f=t,l=r.ndim;f-- >0&&l-- >0;)n[f]=r.shape[l];for(var h=t-2,u=e.ndim-1;h-- >0&&u-- >0;)if(1===n[h])n[h]=e.shape[u];else if(n[h]!=e.shape[u]&&1!=e.shape[u])throw new Error("unpermute_cols(A,P): A and P not broadcast-compatible.");var c=new q[r.dtype](n.reduce((function(r,e){return r*e}))),d=r.shape,w=r.ndim,v=e.shape,p=e.ndim;r=r.data,e=e.data;var m=0,g=-1,y=0,b=-1,E=0;return function a(o){if(o===t-2){for(var f=0;f<i;f++)for(var l=0;l<s;l++){var h=e[y+l];if(!(h>=0))throw new Error("unpermute_cols(A,P): P.contains invalid indices.");if(!(h<s))throw new Error("unpermute_cols(A,P): P.contains invalid indices.");c[E+s*f+h]=r[m+s*f+l]}return m+=g=i*s,y+=b=s,void(E+=g)}for(var u=n[o];a(o+1),1!==u;u--)d[o-t+w]>1||(m-=g),v[o-t+1+p]>1||(y-=b);g*=d[o-t+w]||1,b*=v[o-t+1+p]||1}(0),new ar(n,c)}var Rt=function(r,e,t,n,a){if(0!=r%1)throw new Error("Assertion failed.");if(0!=e%1)throw new Error("Assertion failed.");if(0!=a%1)throw new Error("Assertion failed.");if(0!=n%1)throw new Error("Assertion failed.");if(0!=t.length%1)throw new Error("Assertion failed.");if(!(0<=r))throw new Error("Assertion failed.");if(!(r<=e))throw new Error("Assertion failed.");if(!(a>=0))throw new Error("Assertion failed.");if(!(a<r))throw new Error("Assertion failed.");for(var o=t[n+e*a+a],i=a;++i<r;)for(var s=t[n+e*i+a]/o,f=a;f++<i;)t[n+e*i+f]-=s*t[n+e*f+a];for(var l=a;++l<r;)t[n+e*l+a]/=o},Lt=function(r,e,t,n,a){if(0!=r%1)throw new Error("Assertion failed.");if(0!=e%1)throw new Error("Assertion failed.");if(0!=a%1)throw new Error("Assertion failed.");if(0!=n%1)throw new Error("Assertion failed.");if(0!=t.length%1)throw new Error("Assertion failed.");if(!(0<=r))throw new Error("Assertion failed.");if(!(r<=e))throw new Error("Assertion failed.");if(!(a>=0))throw new Error("Assertion failed.");if(!(a<r-1))throw new Error("Assertion failed.");for(var o=t[n+e*(a+1)+a],i=t[n+e*(a+1)+(a+1)]/o,s=t[n+e*a+a]/o,f=1/(i*s-1)/o,l=a+2;l<r;l++){for(var h=f*(i*t[n+e*l+a]-t[n+e*l+a+1]),u=f*(s*t[n+e*l+a+1]-t[n+e*l+a]),c=l;c<r;c++)t[n+e*c+l]-=t[n+e*c+a]*h+t[n+e*c+a+1]*u;t[n+e*l+a]=h,t[n+e*l+a+1]=u}},Dt=function(r,e,t,n,a,o,i,s){if(!(i<=s))throw new Error("Assertion failed: "+JSON.stringify({k:i,l:s}));if(!(r<=e))throw new Error("Assertion failed.");var f=a[o+i];a[o+i]=a[o+s],a[o+s]=f;for(var l=0;l<i;l++){var h=t[n+e*i+l];t[n+e*i+l]=t[n+e*s+l],t[n+e*s+l]=h}for(var u=i;++u<s;){var c=t[n+e*u+i];t[n+e*u+i]=t[n+e*s+u],t[n+e*s+u]=c}var d=t[n+e*i+i];t[n+e*i+i]=t[n+e*s+s],t[n+e*s+s]=d;for(var w=s;++w<r;){var v=t[n+e*w+i];t[n+e*w+i]=t[n+e*w+s],t[n+e*w+s]=v}};function Gt(r,e,t,n,a,o){if(!(r<=e))throw new Error("Assertion failed.");for(var i=0;i<r;i++)a[o+i]=i;for(var s=(Math.sqrt(17)+1)/8,f=0;f<r;f++){var l=!0;if(f<r-1){for(var h=void 0,u=-1/0,c=Math.abs(t[n+e*f+f]),d=f;++d<r;){var w=Math.abs(t[n+e*d+f]);u>=w||(u=w,h=d)}if(!(0<Math.max(u,c)))throw new Error("_pldlp_decomp(M,N, LD,LD_off, P,P_off): Zero column or NaN encountered.");if(c<s*u){for(var v=void 0,p=-1/0,m=f;m<h;m++){var g=Math.abs(t[n+e*h+m]);p>=g||(p=g,v=m)}for(var y=h;++y<r;){var b=Math.abs(t[n+e*y+h]);p>=b||(p=b,v=y)}if(h===v)throw new Error("Assertion failed.");if(c<s*u*(u/p))Math.abs(t[n+e*h+h])<s*p&&(l=!1,a[o+h]^=-1,++f),f!==h&&Dt(r,e,t,n,a,o,f,h)}}l?Rt(r,e,t,n,f):Lt(r,e,t,n,f-1)}}function Jt(r){r=nr(r);var e=q["float32"===r.dtype?"float32":"float64"],t=r.shape,n=t.slice(0,-1),a=t.slice(-2),o=T()(a,2),i=o[0],s=o[1];if(r=r.data,i!==s)throw new Error("Last two dimensions must be quadratic.");for(var f=new e(r.length),l=new Int32Array(r.length/i),h=0;h<f.length;h+=i*i){for(var u=0;u<i;u++)for(var c=0;c<=u;c++)f[h+i*u+c]=r[h+i*u+c];Gt(i,i,f,h,l,h/i)}return[new ar(t,f),new ar(n,l)]}function Tt(r,e){if(null==e){var t=r,n=T()(t,2);r=n[0],e=n[1]}if(r=nr(r),e=nr(e),r.ndim<2)throw new Error("pldlp_solve(LD,P,y): LD must be at least 2D.");if(e.ndim<1)throw new Error("pldlp_solve(LD,P,y): P must be at least 1D.");var a=r.shape[r.ndim-2];if(a!==r.shape[r.ndim-1])throw new Error("pldlp_solve(LD,P,y): LD must be square.");if(a!==e.shape[e.ndim-1])throw new Error("pldlp_solve(LD,P,y): LD and P shape mismatch.");var o=Math.max(r.ndim,e.ndim+1),i=Int32Array.from({length:o},(function(){return 1}));i[o-2]=a,i[o-1]=a;for(var s=0,f=[r.shape.slice(0,-2),e.shape.slice(0,-1)];s<f.length;s++)for(var l=f[s],h=o-2,u=l.length;h-- >0&&u-- >0;)if(1===i[h])i[h]=l[u];else if(i[h]!==l[u]&&1!==l[u])throw new Error("Shapes are not broadcast-compatible.");var c=[r,e].every((function(r){return"float32"===r.dtype}))?"float32":"float64",d=new(0,q[c])(i.reduce((function(r,e){return r*e}),1)),w=r.data,v=e.data,p=0,m=1,g=0,y=1,b=0;return function t(n){if(n===o-2){m=a*a,y=a;for(var s=0;s<a;s++){for(var f=s-(v[g+s]<0),l=0;l<f;l++)d[b+a*s+l]=w[p+a*s+l];d[b+a*s+s]=1}return p+=m,b+=m,void(g+=y)}for(var h=i[n];t(n+1),1!==h;h--)r.shape[n-o+r.ndim]>1||(p-=m),e.shape[n-o+e.ndim+1]>1||(g-=y);m*=r.shape[n-o+r.ndim]||1,y*=e.shape[n-o+e.ndim+1]||1}(0),new ar(i,d)}function Xt(r,e){if(null==e){var t=r,n=T()(t,2);r=n[0],e=n[1]}if(r=nr(r),e=nr(e),r.ndim<2)throw new Error("pldlp_solve(LD,P,y): LD must be at least 2D.");if(e.ndim<1)throw new Error("pldlp_solve(LD,P,y): P must be at least 1D.");var a=r.shape[r.ndim-2];if(a!==r.shape[r.ndim-1])throw new Error("pldlp_solve(LD,P,y): LD must be square.");if(a!==e.shape[e.ndim-1])throw new Error("pldlp_solve(LD,P,y): LD and P shape mismatch.");var o=Math.max(r.ndim,e.ndim+1),i=Int32Array.from({length:o},(function(){return 1}));i[o-2]=a,i[o-1]=a;for(var s=0,f=[r.shape.slice(0,-2),e.shape.slice(0,-1)];s<f.length;s++)for(var l=f[s],h=o-2,u=l.length;h-- >0&&u-- >0;)if(1===i[h])i[h]=l[u];else if(i[h]!==l[u]&&1!==l[u])throw new Error("Shapes are not broadcast-compatible.");var c=[r,e].every((function(r){return"float32"===r.dtype}))?"float32":"float64",d=new(0,q[c])(i.reduce((function(r,e){return r*e}),1)),w=r.data,v=e.data,p=0,m=1,g=0,y=1,b=0;return function t(n){if(n===o-2){m=a*a,y=a;for(var s=0;s<a;s++)d[b+a*s+s]=w[p+a*s+s],v[g+s]<0&&(d[b+a*s+s-1]=d[b+a*(s-1)+s]=w[p+a*s+s-1]);return p+=m,b+=m,void(g+=y)}for(var f=i[n];t(n+1),1!==f;f--)r.shape[n-o+r.ndim]>1||(p-=m),e.shape[n-o+e.ndim+1]>1||(g-=y);m*=r.shape[n-o+r.ndim]||1,y*=e.shape[n-o+e.ndim+1]||1}(0),new ar(i,d)}function zt(r,e){if(null==e){var t=r,n=T()(t,2);r=n[0],e=n[1]}if(r=nr(r),e=nr(e),r.ndim<2)throw new Error("pldlp_solve(LD,P,y): LD must be at least 2D.");if(e.ndim<1)throw new Error("pldlp_solve(LD,P,y): P must be at least 1D.");var a=r.shape[r.ndim-2];if(a!==r.shape[r.ndim-1])throw new Error("pldlp_solve(LD,P,y): LD must be square.");if(a!==e.shape[e.ndim-1])throw new Error("pldlp_solve(LD,P,y): LD and P shape mismatch.");for(var o=r.ndim-2,i=e.ndim-1;o-- >0&&i-- >0;)if(1!==e.shape[i]&&1!==r.shape[o]&&r.shape[o]!==e.shape[i])throw new Error("Shapes are not broadcast-compatible.");var s=e.shape;e=Int32Array.from(e.data),r=void 0;for(var f=new Uint8Array(a),l=e.length;(l-=a)>=0;){f.fill(!1);for(var h=a;h-- >0;){var u=e[l+h];if(u<0){if(!(0<h)||e[l+h-1]<0)throw new Error("pldlp_solve(LD,P,y): P is invalid.");u^=-1}if(!(u>=0))throw new Error("pldlp_solve(LD,P,y): P contains out-of-bounds indices.");if(!(u<a))throw new Error("pldlp_solve(LD,P,y): P contains out-of-bounds indices.");if(f[u])throw new Error("pldlp_solve(LD,P,y): P contains duplicate indices.");f[u]=!0,e[l+h]=u}if(f.some((function(r){return!r})))throw new Error("pldlp_solve(LD,P,y): P is invalid.")}return new ar(s,e)}function Ut(r,e,t,n,a,o,i,s,f,l){if(0!=n.length%1)throw new Error("Assertion failed.");if(0!=o.length%1)throw new Error("Assertion failed.");if(0!=s.length%1)throw new Error("Assertion failed.");if(0!=l.length%1)throw new Error("Assertion failed.");if(0!=a%1)throw new Error("Assertion failed.");if(0!=i%1)throw new Error("Assertion failed.");if(0!=f%1)throw new Error("Assertion failed.");if(0!=r%1)throw new Error("Assertion failed.");if(0!=e%1)throw new Error("Assertion failed.");if(0!=t%1)throw new Error("Assertion failed.");if(n.length-a<r*e)throw new Error("Assertion failed.");if(o.length-i<r)throw new Error("Assertion failed.");if(s.length-f<r*t)throw new Error("Assertion failed.");if(l.length<r*t)throw new Error("Assertion failed.");if(!(0<r))throw new Error("Assertion failed.");if(!(0<e))throw new Error("Assertion failed.");if(!(0<t))throw new Error("Assertion failed.");if(!(r<=e))throw new Error("Assertion failed.");for(var h=0;h<r;h++){var u=o[i+h];u^=-(u<0);for(var c=0;c<t;c++)l[t*h+c]=s[f+t*u+c]}for(var d=1;d<r;d++)for(var w=d-(o[i+d]<0),v=0;v<w;v++)for(var p=0;p<t;p++)l[t*d+p]-=n[a+e*d+v]*l[t*v+p];for(var m=0;m<r;m++)if(m<r-1&&o[i+m+1]<0){for(var g=n[a+e*(m+1)+m],y=n[a+e*(m+1)+m+1]/g,b=n[a+e*m+m]/g,E=1/(y*b-1)/g,_=0;_<t;_++){var x=l[t*m+_],A=l[t*(m+1)+_];l[t*m+_]=E*(y*x-A),l[t*(m+1)+_]=E*(b*A-x)}++m}else for(var M=0;M<t;M++)l[t*m+M]/=n[a+e*m+m];for(var k=r;k-- >1;)for(var N=k-(o[i+k]<0);N-- >0;)for(var F=t;F-- >0;)l[t*N+F]-=n[a+e*k+N]*l[t*k+F];for(var I=0;I<r;I++){var P=o[i+I];P^=-(P<0);for(var q=0;q<t;q++)s[f+t*P+q]=l[t*I+q]}}function Yt(r,e,t){if(null==t){if(null==e)throw new Error("Assertion failed.");t=e;var n=r,a=T()(n,2);r=a[0],e=a[1]}if(r=nr(r),e=nr(e),t=nr(t),r.ndim<2)throw new Error("pldlp_solve(LD,P,y): LD must be at least 2D.");if(e.ndim<1)throw new Error("pldlp_solve(LD,P,y): P must be at least 1D.");if(t.ndim<2)throw new Error("pldlp_solve(LD,P,y): y must be at least 2D.");var o=r.shape[r.ndim-2],i=t.shape[t.ndim-1];if(o!==r.shape[r.ndim-1])throw new Error("pldlp_solve(LD,P,y): LD must be square.");if(o!==e.shape[e.ndim-1])throw new Error("pldlp_solve(LD,P,y): LD and P shape mismatch.");if(o!==t.shape[t.ndim-2])throw new Error("pldlp_solve(LD,P,y): LD and y shape mismatch.");var s=Math.max(r.ndim,e.ndim+1,t.ndim),f=Int32Array.from({length:s},(function(){return 1}));f[s-2]=o,f[s-1]=i;for(var l=0,h=[r.shape.slice(0,-2),e.shape.slice(0,-1),t.shape.slice(0,-2)];l<h.length;l++)for(var u=h[l],c=s-2,d=u.length;c-- >0&&d-- >0;)if(1===f[c])f[c]=u[d];else if(f[c]!==u[d]&&1!==u[d])throw new Error("Shapes are not broadcast-compatible.");var w=[r,e,t].every((function(r){return"float32"===r.dtype}))?"float32":"float64",v=q[w],p=new v(o*i),m=new v(f.reduce((function(r,e){return r*e}),1)),g=r.data,y=e.data,b=t.data,E=0,_=1,x=0,A=1,M=0,k=1,N=0;return function n(a){if(a===s-2){_=o*o,A=o,k=o*i;for(var l=0;l<k;l++)m[N+l]=b[M+l];return Ut(o,o,i,g,E,y,x,m,N,p),E+=_,x+=A,M+=k,void(N+=k)}for(var h=f[a];n(a+1),1!==h;h--)r.shape[a-s+r.ndim]>1||(E-=_),e.shape[a-s+e.ndim+1]>1||(x-=A),t.shape[a-s+t.ndim]>1||(M-=k);_*=r.shape[a-s+r.ndim]||1,A*=e.shape[a-s+e.ndim+1]||1,k*=t.shape[a-s+t.ndim]||1}(0),new ar(f,m)}function Qt(r){var e=At(r),t=T()(e,3),n=(t[0],t[1]);t[2];return Mt(n)}function Bt(r,e,t,n){for(t|=0,n<<=1;n<r.length;n=n+2|0){var a=Math.abs(e[t+(n>>>1)]);if(0!==a){if(r[n]<a){var o=r[n]/a;r[n+1]*=o*o,r[n]=a}a/=r[n],r[n+1]+=a*a}}}function Ct(r,e){var t=r[e<<=1];return isFinite(t)?Math.sqrt(r[e+1])*t:t}function Vt(r,e,t,n,a){var o=Math.min(r,e);if(!(a.length>=o))throw new Error("Assertion failed.");for(var i=new le,s=o;s-- >0;){for(var f=e;f-- >s;)i.include(t[n+e*s+f]);if(a[s]=i.result,!isFinite(a[s]))throw new Error("Infinity or NaN encountered during rank estimation.")}for(var l=2*S(a instanceof Float32Array?"float32":"float64")*Math.max(r,e)*a[0],h=o;h>0&&a[h-1]<=l;)--h;return h}function Wt(r){if((r=nr(r)).ndim<2)throw new Error("A must be at least 2D.");var e=q["float32"===r.dtype?"float32":"float64"],t=r.shape,n=Int32Array.from(t),a=n.slice(0,-1),o=t.slice(-2),i=T()(o,2),s=i[0],f=i[1],l=Math.min(s,f);n[n.length-1]=s,a[a.length-1]=f;var h=e.from(r.data);r=void 0;for(var u=new Int32Array(h.length/s),c=new e(h.length/f*s),d=new e(f<<1),w=0,v=0,p=0;w<c.length;w+=s*s,v+=s*f,p+=f){for(var m=0;m<f;m++)u[p+m]=m;for(var g=0;g<s;g++)c[w+s*g+g]=1;for(var y=0;y<s;y++)Bt(d,h,v+f*y,0);for(var b=0;b<l;b++){for(var E=-1,_=-1/0,x=b;x<f;x++){var A=Ct(d,x);_<A&&(E=x,_=A)}if(E!==b){for(var M=0;M<s;M++){var k=v+f*M+b,N=v+f*M+E,F=h[k];h[k]=h[N],h[N]=F}var I=u[p+b];u[p+b]=u[p+E],u[p+E]=I}if(d.fill(0,b<<1),0===_)break;for(var P=v+f*b+b,S=b;++S<s;){var j=v+f*S+b,O=h[j];if(0!==O){var R=ae(h[P],O),L=T()(R,3),D=L[0],G=L[1],J=L[2];h[j]=0,0!==G&&(h[P]=J,oe(h,f-1-b,P+1,j+1,D,G),oe(c,1+S,w+s*b,w+s*S,D,G))}Bt(d,h,v+f*S,b+1)}h[P]=(h[P]<0||Object.is(-0,h[P])?-1:1)*_}ue(s,c,w)}return[new ar(n,c),new ar(t,h),new ar(a,u)]}function Kt(r,e,t,n,a,o,i,s,f,l){if(0!=r%1)throw new Error("Assertion failed.");if(0!=e%1)throw new Error("Assertion failed.");if(0!=t%1)throw new Error("Assertion failed.");if(0!=a%1)throw new Error("Assertion failed.");if(0!=i%1)throw new Error("Assertion failed.");if(0!=f%1)throw new Error("Assertion failed.");if(!(0<r))throw new Error("Assertion failed.");if(!(0<e))throw new Error("Assertion failed.");if(!(0<t))throw new Error("Assertion failed.");if(!(0<=a))throw new Error("Assertion failed.");if(!(0<=i))throw new Error("Assertion failed.");if(!(0<=f))throw new Error("Assertion failed.");if(!(r*e<=n.length-a))throw new Error("Assertion failed.");if(!(r*t<=o.length-i))throw new Error("Assertion failed.");if(!(e<=s.length-f))throw new Error("Assertion failed.");if(r|=0,e|=0,t|=0,a|=0,i|=0,f|=0,l.length!==e<<1)throw new Error("Assertion failed.");l.fill(0,0,e<<1);for(var h=0;h<r;h++)Bt(l,n,a+e*h,0);for(var u=Math.min(r,e),c=0;c<u;c++){for(var d=-1,w=-1/0,v=c;v<e;v++){var p=Ct(l,v);w<p&&(d=v,w=p)}if(d!==c){for(var m=0;m<r;m++){var g=a+e*m+c,y=a+e*m+d,b=n[g];n[g]=n[y],n[y]=b}var E=s[f+c];s[f+c]=s[f+d],s[f+d]=E}if(l.fill(0,c<<1),0===w)break;for(var _=a+e*c+c,x=c;++x<r;){var A=a+e*x+c,M=n[A];if(0!==M){var k=ae(n[_],M),N=T()(k,3),F=N[0],I=N[1],P=N[2];n[A]=0,0!==I&&(n[_]=P,oe(n,e-1-c,_+1,A+1,F,I),oe(o,t,i+t*c,i+t*x,F,I))}Bt(l,n,a+e*x,c+1)}n[_]=(n[_]<0||Object.is(-0,n[_])?-1:1)*w}}function Ht(r){if((r=nr(r)).ndim<2)throw new Error("A must be at least 2D.");var e=q["float32"===r.dtype?"float32":"float64"],t=r.shape,n=Int32Array.from(t),a=t.slice(0,-1),o=t.slice(-2),i=T()(o,2),s=i[0],f=i[1];if(n[n.length-2]=f,a[a.length-1]=f,s<=f)return Wt(r);var l=e.from(r.data);r=void 0;for(var h=new Int32Array(l.length/s),u=new e(l.length/s*f),c=new e(f<<1),d=0,w=0,v=0;d<l.length;d+=s*f,w+=f*f,v+=f){for(var p=0;p<f;p++)h[v+p]=p;for(var m=0;m<s;m++)Bt(c,l,d+f*m,0);for(var g=0;g<f;g++){for(var y=-1,b=-1/0,E=g;E<f;E++){var _=Ct(c,E);b<_&&(y=E,b=_)}if(y!==g){for(var x=0;x<s;x++){var A=d+f*x+g,M=d+f*x+y,k=l[A];l[A]=l[M],l[M]=k}var N=h[v+g];h[v+g]=h[v+y],h[v+y]=N}if(c.fill(0,g<<1),0===b)break;for(var F=d+f*g+g,I=g;++I<s;){var P=d+f*I+g,S=l[P];if(0!==S){var j=ae(l[F],S),O=T()(j,3),R=O[0],L=O[1],D=O[2];0!==L&&(R<0&&(R*=-1,L*=-1,D*=-1),oe(l,f-1-g,F+1,P+1,R,L),l[F]=D),l[P]=L}Bt(c,l,d+f*I,g+1)}l[F]=(l[F]<0||Object.is(l[F],-0)?-1:1)*b}for(var G=0;G<f;G++)for(var J=u[w+f*G+G],X=J<0||Object.is(J,-0)?-1:1,z=G;z<f;z++)u[w+f*G+z]=l[d+f*G+z]*X,l[d+f*G+z]=X*(G===z);for(var U=f;U-- >0;)for(var Y=s;--Y>U;){var Q=l[d+f*Y+U];if(0!==Q)l[d+f*Y+U]=0,oe(l,f-U,d+f*Y+U,d+f*U+U,Math.sqrt((1-Q)*(1+Q)),Q)}}return[new ar(t,l),new ar(n,u),new ar(a,h)]}function $t(r){var e=(r=nr(r)).shape.slice(-2),t=T()(e,2),n=t[0],a=t[1],o=r.shape.slice(0,-2);r=r.data;for(var i=new q.int32(r.length/n/a),s=new q["float32"===r.dtype?"float32":"float64"](Math.min(n,a)),f=0,l=0;f<i.length;f++,l+=n*a)i[f]=Vt(n,a,r,l,s);return new ar(o,i)}function Zt(r,e,t,n){if(null==n){if(null!=t)throw new Error("rrqr_lstsq(Q,R,P, y): Either 2 ([Q,R,P], y) or 4 arguments (Q,R,P, y) expected.");n=e;var a=r,o=T()(a,3);r=o[0],e=o[1],t=o[2]}r=nr(r),e=nr(e);var i=r.shape[r.ndim-2];if(i!==e.shape[e.ndim-1])throw new Error("rrqr_solve(Q,R,P, y): Q @ R not square.");for(var s=rn(r,e,t,n),f=new q["float32"===e.dtype?"float32":"float64"](i),l=0;l<e.data.length;l+=i*i){if(Vt(i,i,e.data,l,f)<i)throw new gt(s)}return s}function rn(r,e,t,n){if(null==n){if(null!=t)throw new Error("rrqr_lstsq(Q,R,P, y): Either 2 ([Q,R,P], y) or 4 arguments (Q,R,P, y) expected.");n=e;var a=r,o=T()(a,3);r=o[0],e=o[1],t=o[2]}if((r=nr(r)).ndim<2)throw new Error("rrqr_lstsq(Q,R,P, y): Q.ndim must be at least 2.");if((e=nr(e)).ndim<2)throw new Error("rrqr_lstsq(Q,R,P, y): R.ndim must be at least 2.");if((t=nr(t)).ndim<1)throw new Error("rrqr_lstsq(Q,R,P, y): P.ndim must be at least 1.");if((n=nr(n)).ndim<2)throw new Error("rrqr_lstsq(Q,R,P, y): y.ndim must be at least 2.");if("int32"!==t.dtype)throw new Error('rrqr_lstsq(Q,R,P, y): P.dtype must be "int32".');var i=r.shape.slice(-2),s=T()(i,2),f=s[0],l=s[1],h=e.shape.slice(-1),u=T()(h,1)[0],c=n.shape.slice(-1),d=T()(c,1)[0];if(f!=n.shape[n.ndim-2])throw new Error("rrqr_lstsq(Q,R,P,y): Q and y don't match.");if(l!=e.shape[e.ndim-2])throw new Error("rrqr_lstsq(Q,R,P,y): Q and R don't match.");if(u!=t.shape[t.ndim-1])throw new Error("rrqr_lstsq(Q,R,P,y): R and P don't match.");var w=Math.max(r.ndim,e.ndim,t.ndim+1,n.ndim),v=Int32Array.from({length:w},(function(){return 1}));v[w-2]=u,v[w-1]=d;for(var p=0,m=[r,e,n];p<m.length;p++)for(var g=m[p],y=w-2,b=g.ndim-2;y-- >0&&b-- >0;)if(1===v[y])v[y]=g.shape[b];else if(v[y]!=g.shape[b]&&1!=g.shape[b])throw new Error("rrqr_lstsq(Q,R,P,y): Q,R,P,y not broadcast-compatible.");for(var E=w-2,_=t.ndim-1;E-- >0&&_-- >0;)if(1===v[E])v[E]=t.shape[_];else if(v[E]!=t.shape[_]&&1!=t.shape[_])throw new Error("rrqr_lstsq(Q,R,P,y): Q,R,P,y not broadcast-compatible.");var x=q[[r,e,n].every((function(r){return"float32"===r.dtype}))?"float32":"float64"],A=new x(Math.min(l,u)),M=new Int32Array(u),k=new x(v.reduce((function(r,e){return r*e}),1)),N=r.data,F=e.data,I=t.data,P=n.data,S=0,j=1,O=0,R=1,L=0,D=1,G=0,J=1,X=0;return function a(o){if(o===w-2){j=f*l,R=l*u,D=u,J=f*d;for(var i=Vt(l,u,F,O,A),s=0;s<f;s++)for(var h=0;h<i;h++)for(var c=0;c<d;c++)k[X+h*d+c]+=N[S+s*l+h]*P[G+s*d+c];Ee(i,u,d,F,O,k,X);for(var p=u;p-- >0;)M[p]=I[L+p];for(var m=u;m-- >0;)for(var g=void 0;(g=M[m])!==m;){if(M[g]===g)throw new Error("rrqr_lstsq(Q,R,P,y): Invalid indices in P.");M[m]=M[g],M[g]=g;for(var y=d;y-- >0;){var b=k[X+d*m+y];k[X+d*m+y]=k[X+d*g+y],k[X+d*g+y]=b}}return S+=j,O+=R,L+=D,G+=J,void(X+=u*d)}for(var E=v[o];a(o+1),1!=E;E--)r.shape[o-w+r.ndim]>1||(S-=j),e.shape[o-w+e.ndim]>1||(O-=R),t.shape[o-w+1+t.ndim]>1||(L-=D),n.shape[o-w+n.ndim]>1||(G-=J);j*=r.shape[o-w+r.ndim]||1,R*=e.shape[o-w+e.ndim]||1,D*=t.shape[o-w+1+t.ndim]||1,J*=n.shape[o-w+n.ndim]||1}(0),new ar(v,k)}function en(r,e,t,n){t|=0,n<<=1;for(var a=0;a<n;a+=2){var o=Math.abs(e[t+(a>>>1)]);if(0!==o){if(r[a]<o){var i=r[a]/o;r[a+1]*=i*i,r[a]=o}o/=r[a],r[a+1]+=o*o}}}function tn(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((r=nr(r)).ndim<2)throw new Error("srrqr_decomp_full(A,opt): A must be at least 2D.");if(r.dtype.startsWith("complex"))throw new Error("srrqr_decomp_full(A,opt): Complex A not (yet) supported.");var t="float32"===r.dtype?"float32":"float64",n=q[t],a=r.shape,o=Int32Array.from(a),i=o.slice(0,-1),s=a.slice(0,-2),f=a.slice(-2),l=T()(f,2),h=l[0],u=l[1],c=Math.min(h,u);o[o.length-1]=h,i[i.length-1]=u;var d=n.from(r.data);r=void 0;for(var w=new Int32Array(d.length/u/h),v=new Int32Array(d.length/h),p=new n(d.length/u*h),m=new n(h*u),g=new n(h*u),y=new n(u<<1),b=new le,E=w.length;E-- >0;)w[E]=1024*Math.random()-1024;var _=NaN,x=NaN,A=!1,M=0,k=0,N=0,F=0,I=0,P=0,j=function(){var r=e,n=r.dtol,a=void 0===n?1.01:n,o=r.ztol,i=void 0===o?void 0:o;if(a instanceof ar)throw new Error("srrqr_decomp_full(A,opt): NDArray as opt.dtol not yet supported.");if(!(a>=1))throw new Error("srrqr_decomp_full(A,opt): Invalid opt.dtol: ".concat(a,". Must be >=1."));var s=Number(a);if(a=function(){return s},i instanceof ar)throw new Error("srrqr_decomp_full(A,opt): NDArray as opt.ztol not yet supported.");if(null==i){var f=Math.sqrt(S(t));i=function(r){var e=(r*=h*u)+h*u;for(b.reset();r<e;r++)b.include(d[r]);return f*b.result*Math.max(h,u)}}else{if(!(i>=0))throw new Error("srrqr_decomp_full(A,opt): invalid opt.ztol: ".concat(i,". Must be non-negative number."));var l=Number(i);i=function(){return l}}return[a,i]}(),O=T()(j,2),R=O[0],L=O[1];e=void 0;for(var D=function(r,e){var t=-d[k+u*e+e];r[e+e*h]=-1/t;for(var n=e;n-- >0;)r[n+e*h]/=t;for(var a=e;++a<u;)for(var o=0;o<=e;o++)r[o+a*h]+=r[o+e*h]*d[k+u*e+a]},G=function(r,e){for(var t=u;--t>e;){r[e+t*h]=0;for(var n=e;n-- >0;)r[n+t*h]-=r[n+e*h]*d[k+u*e+t]}r[e+e*h]=0;for(var a=-d[k+u*e+e],o=e;o-- >0;)r[o+e*h]*=a},J=function(r){for(var e=0;e<h;e++){var t=d[k+u*e+I];d[k+u*e+I]=d[k+u*e+r],d[k+u*e+r]=t}for(var n=0;n<I;n++){var a=g[n+I*h];g[n+I*h]=g[n+r*h],g[n+r*h]=a}for(var o=0;o<I;o++){var i=m[o+I*h];m[o+I*h]=m[o+r*h],m[o+r*h]=i}var s=v[N+I];v[N+I]=v[N+r],v[N+r]=s,y.fill(0);for(var f=I;++f<h;){var l=k+u*I+I,c=k+u*f+I,w=d[c];if(0!==w){var b=ae(d[l],w),E=T()(b,3),_=E[0],x=E[1],F=E[2];d[c]=0,0!==x&&(d[l]=F,oe(d,u-1-I,l+1,c+1,_,x),oe(p,A?h:f+1,M+h*I,M+h*f,_,x))}Bt(y,d,k+u*f,I+1)}},X=function(){for(var r=-1,e=-1/0,t=I;t<u;t++){var n=Ct(y,t);e<n&&(r=t,e=n)}J(r)},z=function(r,e){for(var t=0;t<u;t++)for(var n=0;n<I;n++)e[n+t*h]=r[n+t*h]},U=function(r,e,t){for(var n=e;n<u;n++){var a=r[e+n*h];if(n<t){for(var o=e;o<n;o++)r[o+n*h]=r[o+1+n*h];r[n+n*h]=0}else for(var i=e;i<t;i++)r[i+n*h]=r[i+1+n*h];r[t+n*h]=a}},Y=function(){y.fill(0);for(var r=I;r<h;r++)Bt(y,d,k+u*r,I)},Q=function(){b.reset();for(var r=I;r<u;r++)b.include(Ct(y,r));return b.result},B=function(r){r?(X(),D(m,I++),z(m,g),F=I):(z(g,m),I=F,Y());for(var e=F+P>>>1;I<e;){if(Q()<=_){if(P=I,F<I){z(g,m),I=F,Y(),e=F+P>>>1,r=!1;continue}break}r&&X(),D(m,I++),r||Y()}},C=0;M<p.length;M+=h*h,k+=h*u,N+=u,C+=1){b.reset();for(var V=h*u;V-- >0;)b.include(d[k+V]);var W=0===b.max?1:b.result;if(!isFinite(W))throw new Error("Assertion failed: "+W);if(!(0<W))throw new Error("Assertion failed: "+W);if(1!==W)for(var K=h*u;K-- >0;)d[k+K]/=W;for(var H=0;H<u;H++)v[N+H]=H;for(var $=0;$<h;$++)p[M+h*$+$]=1;if(g.fill(0),m.fill(0),x=R(C),_=L(C),!isFinite(x))throw new Error("Assertion failed. Invalid dtol: ".concat(x,"."));if(!isFinite(_))throw new Error("Assertion failed. Invalid ztol: ".concat(_,"."));if(!(1<=x))throw new Error("Assertion failed. Invalid dtol: ".concat(x,"."));if(!(0<=_))throw new Error("Assertion failed. Invalid ztol: ".concat(_,"."));F=I=0,P=c,A=!1,Y();r:for(;;){if(Q()<=_)if(P=I,F<I)B(!1);else if(I===u)break r;for(var Z=-1,rr=-1,er=-1/0,tr=0;tr<I;tr++)en(y,m,tr*h,tr+1);for(var or=0;or<I;or++)for(var ir=Ct(y,or),sr=I;sr<u;sr++){var fr=Ct(y,sr),lr=Math.hypot(m[or+sr*h],ir*fr);er<lr&&(er=lr,Z=or,rr=sr)}if(er>x){if(A=!0,Z<F){--F;for(var hr=0;hr<=F;hr++){for(var ur=d[k+u*hr+Z],cr=Math.max(Z,hr-1);cr<F;cr++)d[k+u*hr+cr]=d[k+u*hr+(cr+1)];d[k+u*hr+F]=ur}U(m,Z,F),U(g,Z,F);for(var dr=v[N+Z],wr=Z;wr<F;wr++)v[N+wr]=v[N+wr+1];v[N+F]=dr;for(var vr=Z;vr<F;vr++){var pr=k+u*vr+vr,mr=k+u*(vr+1)+vr,gr=d[mr];if(0!==gr){var yr=d[pr],br=ae(yr,gr),Er=T()(br,3),_r=Er[0],xr=Er[1],Ar=Er[2];d[mr]=0,0!==xr&&(d[pr]=Ar,oe(d,u-1-vr,pr+1,mr+1,_r,xr),oe(p,h,M+h*vr,M+h*(vr+1),_r,xr),oe(m,vr+1,h*vr,h*(vr+1),_r,xr),m[F+(vr+1)*h]=-xr*m[F+vr*h]+_r*m[F+(vr+1)*h],oe(g,vr+1,h*vr,h*(vr+1),_r,xr),g[F+(vr+1)*h]=-xr*g[F+vr*h]+_r*g[F+(vr+1)*h])}m[F+vr*h]=0,g[F+vr*h]=0}G(g,F),Z=F++}--I;for(var Mr=0;Mr<=I;Mr++){for(var kr=d[k+u*Mr+Z],Nr=Math.max(Z,Mr-1);Nr<I;Nr++)d[k+u*Mr+Nr]=d[k+u*Mr+(Nr+1)];d[k+u*Mr+I]=kr}U(m,Z,I);for(var Fr=0;Fr<F;Fr++)y[Fr]=g[Fr+Z*h];for(var Ir=Z;Ir<I;Ir++)for(var Pr=0;Pr<F;Pr++)g[Pr+Ir*h]=g[Pr+(Ir+1)*h];for(var qr=0;qr<F;qr++)g[qr+I*h]=y[qr];for(var Sr=v[N+Z],jr=Z;jr<I;jr++)v[N+jr]=v[N+jr+1];v[N+I]=Sr;for(var Or=Z;Or<I;Or++){var Rr=k+u*Or+Or,Lr=k+u*(Or+1)+Or,Dr=d[Lr];if(0!==Dr){var Gr=d[Rr],Jr=ae(Gr,Dr),Tr=T()(Jr,3),Xr=Tr[0],zr=Tr[1],Ur=Tr[2];d[Lr]=0,0!==zr&&(d[Rr]=Ur,oe(d,u-1-Or,Rr+1,Lr+1,Xr,zr),oe(p,h,M+h*Or,M+h*(Or+1),Xr,zr),oe(m,Or+1,h*Or,h*(Or+1),Xr,zr),m[I+(Or+1)*h]=-zr*m[I+Or*h]+Xr*m[I+(Or+1)*h])}m[I+Or*h]=0}G(m,I),J(rr),Z<F&&D(g,Z),D(m,I++)}else{if(F>=P)break r;B(!0)}}if(1!==W)for(var Yr=h*u;Yr-- >0;)d[k+Yr]*=W;w[C]=I,ue(h,p,M)}return[new ar(o,p),new ar(a,d),new ar(i,v),new ar(s,w)]}function nn(r,e){var t=Ht(r),n=T()(t,3);return Zt(n[0],n[1],n[2],e)}function an(r){if((r=nr(r)).dtype.startsWith("complex"))throw new Error("svd_jac_1sided(A): A.dtype must be float.");var e=r.shape,t=0|e[e.length-2],n=e[e.length-1];if(t>n){var a=Se(r),o=T()(a,2),i=o[0],s=an(o[1]),f=T()(s,3),l=f[0],h=f[1],u=f[2];return[Ce(i,l),h,u]}if(t<n){var c=Se(r.T),d=T()(c,2),w=d[0],v=an(d[1]),p=T()(v,3),m=p[0],g=p[1],y=p[2];return ce(y),[y,g,Ce(w,m).T]}var b="float32"===r.dtype?"float32":"float64",E=q[b],_=Math.pow(t*S(b),2),x="float32"===b?16:8,A=E.from(r.data);r=void 0;var M=new E(t*t),k=new E(A.length),N=new E(A.length/t),F=Int32Array.from({length:t},(function(r,e){return e}));if(1>t)throw new Error("Assertion failed.");if(1==t){for(var I=A.length;I-- >0;)A[I]<0?(A[I]*=-1,N[I]=-1):N[I]=1;return[new ar(e,N),new ar(e.slice(0,-1),A),new ar(e,k.fill(1))]}for(var P=0,j=0;j<N.length;P+=t*t,j+=t){for(var O=0;O<t;O++)for(var R=0;R<t;R++)M[t*O+R]=A[P+t*O+R],A[P+t*O+R]=+(O===R);for(var L=0;L<t;L++)for(var D=0;D<t;D++)k[P+t*L+D]=+(L===D);for(var G=!1;!G;){G=!0;for(var J=0;J<t;J+=x)for(var X=0;X<=J;X+=x)for(var z=J;z<J+x&&z<t;z++)for(var U=X;U<X+x&&U<z;U++){var Y=M[t*U+U],Q=M[t*U+z],B=M[t*z+U],C=M[t*z+z];if(Q*Q+B*B>Math.abs(Y*C)*_){G=!1;var V=yt(Y,Q,B,C),W=T()(V,4),K=W[0],H=W[1],$=W[2],Z=W[3];oe(M,t,t*U,t*z,K,H),ie(M,t,U,z,$,Z),M[t*U+z]=M[t*z+U]=0,oe(A,t,P+t*U,P+t*z,K,H),oe(k,t,P+t*U,P+t*z,$,-Z)}}}bt(t,A,M,k,P,N,j,F)}return[new ar(e,A),new ar(e.slice(0,-1),N),new ar(e,k)]}function on(r){if((r=nr(r)).dtype.startsWith("complex"))throw new Error("svd_jac_1sided(A): A.dtype must be float.");var e=r.shape,t=0|e[e.length-2],n=e[e.length-1];if(t>n){var a=Se(r),o=T()(a,2),i=o[0],s=on(o[1]),f=T()(s,3),l=f[0],h=f[1],u=f[2];return[Ce(i,l),h,u]}if(t<n){var c=Se(r.T),d=T()(c,2),w=d[0],v=on(d[1]),p=T()(v,3),m=p[0],g=p[1],y=p[2];return ce(y),[y,g,Ce(w,m).T]}var b="float32"===r.dtype?"float32":"float64",E=q[b],_=Math.pow(t*S(b),2),x=0|Math.ceil(t/4),A=E.from(r.data);r=void 0;var M=new E(x*x*4*4),k=new E(A.length),N=new E(A.length/t),F=Int32Array.from({length:t},(function(r,e){return e}));if(1>t)throw new Error("Assertion failed.");if(1==t){for(var I=A.length;I-- >0;)A[I]<0?(A[I]*=-1,N[I]=-1):N[I]=1;return[new ar(e,N),new ar(e.slice(0,-1),A),new ar(e,k.fill(1))]}for(var P=0,j=0;j<N.length;P+=t*t,j+=t){for(var O=0;O<t;O++)for(var R=0;R<t;R++){M[16*(x*(O/4|0)+(R/4|0))+O%4*4+R%4|0]=A[P+t*O+R],A[P+t*O+R]=+(O===R)}for(var L=0;L<t;L++)for(var D=0;D<t;D++)k[P+t*L+D]=+(L===D);for(var G=!1;!G;){G=!0;for(var J=x;J-- >0;)for(var X=J;X>=0;X--)for(var z=4;z-- >0;)for(var U=X===J?z:4;U-- >0;){var Y=M[16*(x*X+X)+4*U+U],Q=M[16*(x*X+J)+4*U+z],B=M[16*(x*J+X)+4*z+U],C=M[16*(x*J+J)+4*z+z];if(Q*Q+B*B>Math.abs(Y*C)*_){G=!1;for(var V=yt(Y,Q,B,C),W=T()(V,4),K=W[0],H=W[1],$=W[2],Z=W[3],rr=X*x*16+4*U,er=J*x*16+4*z,tr=rr+16*x;rr<tr;rr+=16,er+=16)for(var or=0;or<4;or++){var ir=K*M[or+rr]+H*M[or+er];M[or+er]=-H*M[or+rr]+K*M[or+er],M[or+rr]=ir}for(var sr=16*X+U+x*x*4*4,fr=16*J+z+x*x*4*4;(sr-=16*x)>=0;){fr-=16*x;for(var lr=16;(lr-=4)>=0;){var hr=M[sr+lr]*$+M[fr+lr]*-Z;M[fr+lr]=M[sr+lr]*Z+M[fr+lr]*$,M[sr+lr]=hr}}M[16*(x*X+J)+4*U+z]=M[16*(x*J+X)+4*z+U]=0;var ur=P+t*(4*X+U),cr=P+t*(4*J+z);oe(A,t,ur,cr,K,H),oe(k,t,ur,cr,$,-Z)}}}for(var dr=0;dr<t;dr++){var wr=16*(x+1)*(dr/4|0)+dr%4*5|0;N[j+dr]=M[wr]}Et(t,A,k,P,N,j,F)}return[new ar(e,A),new ar(e.slice(0,-1),N),new ar(e,k)]}function sn(r){if((r=nr(r)).dtype.startsWith("complex"))throw new Error("svd_jac_1sided(A): A.dtype must be float.");var e=r.shape,t=e[e.length-2],n=e[e.length-1];if(t>n){var a=Se(r),o=T()(a,2),i=o[0],s=sn(o[1]),f=T()(s,3),l=f[0],h=f[1],u=f[2];return[Ce(i,l),h,u]}if(t<n){var c=Se(r.T),d=T()(c,2),w=d[0],v=sn(d[1]),p=T()(v,3),m=p[0],g=p[1],y=p[2];return ce(y),[y,g,Ce(w,m).T]}var b="float32"===r.dtype?"float32":"float64",E=q[b],_=S(b)*t,x=E.from(r.data);r=void 0;var A=new E(t*t),k=new E(x.length),N=new E(x.length/t),F=(new E(t),Int32Array.from({length:t},(function(r,e){return e})));if(1>t)throw new Error("Assertion failed.");if(1===t){for(var I=x.length;I-- >0;)x[I]<0?(x[I]*=-1,N[I]=-1):N[I]=1;return[new ar(e,N),new ar(e.slice(0,-1),x),new ar(e,k.fill(1))]}for(var P=Int32Array.from(M.a.mark((function r(){var e;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e=t;case 1:if(!(e>1)){r.next=7;break}return e=e+1>>>1,r.next=5,e;case 5:r.next=1;break;case 7:case"end":return r.stop()}}),r)}))()),j=new E(P.reduce((function(r,e){return r+(e*e+e>>>1)}),0)),O=function(){for(var r=0,e=0,n=0,a=0,o=function(t,o){var s=function(r,e){return i=t,j[t+((r+=n)*r+r>>>1)+(e+=a)]},f=P[o];t-=f*f+f>>>1;var l=s(0,0);if(r=n,e=a,n+1<f){var h=s(1,0);h>l&&(l=h,r=n+1,e=a);var u=s(1,1);u>l&&(l=u,r=n+1,e=a+1)}if(n!=a){var c=s(0,1);c>l&&(l=c,r=n,e=a+1)}n=2*r,a=2*e,i=t},i=j.length,s=P.length;s-- >0;)o(i,s);var f=-1/0,l=function(r,e){var o=A[t*(r+=n)+(e+=a)],i=A[t*e+r];return o*o+i*i};if(n+1<t){var h=l(1,0);h>f&&(f=h,r=n+1,e=a)}if(a+1<t){var u=l(0,1);u>f&&(f=u,r=n,e=a+1)}if(n!=a){var c=l(0,0);if(c>f&&(f=c,r=n,e=a),n+1<t)l(1,1)>f&&(r=n+1,e=a+1)}return[e,r]},R=function(r){for(var e=r=r>>>1<<1;e<r+2&&e<t;e++)for(var n=e>>>1,a=n*n+n>>>1,o=0;o<r+1;o++){var i=A[t*e+o],s=A[t*o+e],f=e===o?-1/0:i*i+s*s,l=a+(o>>>1);j[l]=e%2||o%2?Math.max(j[l],f):f}for(var h=0,u=1;u<P.length;u++){var c=P[u-1],d=h;h+=c*c+c>>>1;for(var w=r=r>>>2<<1;w<r+2&&w<c;w++)for(var v=d+(w*w+w>>>1),p=w>>>1,m=h+(p*p+p>>>1),g=0;g<=w;g++){var y=m+(g>>>1),b=j[v+g];j[y]=w%2||g%2?Math.max(j[y],b):b}}},L=function(r){r=r>>>1<<1;for(var e=Math.min(r+2,t),n=r;n<t;n++)for(var a=n>>>1,o=a*a+a>>>1,i=r;i<e;i++){var s=A[t*n+i],f=A[t*i+n],l=n===i?-1/0:s*s+f*f,h=o+(i>>>1);j[h]=n%2||i%2?Math.max(j[h],l):l}for(var u=0,c=1;c<P.length;c++){r=r>>>2<<1;var d=P[c-1],w=Math.min(r+2,d),v=u;u+=d*d+d>>>1;for(var p=r;p<d;p++)for(var m=v+(p*p+p>>>1),g=p>>>1,y=u+(g*g+g>>>1),b=r;b<w&&b<=p;b++){var E=y+(b>>>1),_=j[m+b];j[E]=p%2||b%2?Math.max(j[E],_):_}}},D=0,G=0;G<N.length;D+=t*t,G+=t){for(var J=0;J<t;J++)for(var X=0;X<t;X++)A[t*J+X]=x[D+t*J+X],x[D+t*J+X]=+(J===X);for(var z=0;z<t;z++)for(var U=0;U<t;U++)k[D+t*z+U]=+(z===U);for(var Y=0;Y<t;Y+=2)R(Y);for(var Q=-1,B=-1;;){var C=O(),V=T()(C,2),W=V[0],K=V[1];if(W>=K)throw new Error("Assertion failed.");if(Q==K&&B==W)break;Q=K,B=W;var H=A[t*K+K],$=A[t*K+W],Z=A[t*W+K],rr=A[t*W+W];if(!(Math.max(Math.abs($),Math.abs(Z))>Math.sqrt(Math.abs(H*rr))*_))break;var er=yt(rr,Z,$,H),tr=T()(er,4),or=tr[0],ir=tr[1],sr=tr[2],fr=tr[3];oe(A,t,t*W,t*K,or,ir),ie(A,t,W,K,sr,fr),A[t*K+W]=0,A[t*W+K]=0,R(K),R(W),L(K),L(W),oe(x,t,D+t*W,D+t*K,or,ir),oe(k,t,D+t*W,D+t*K,sr,-fr)}bt(t,x,A,k,D,N,G,F)}return[new ar(e,x),new ar(e.slice(0,-1),N),new ar(e,k)]}function fn(r,e,t,n,a,o,i,s){if(0!=r%1)throw new Error("Assertion failed.");if(0!=e%1)throw new Error("Assertion failed.");if(0!=n%1)throw new Error("Assertion failed.");if(0!=o%1)throw new Error("Assertion failed.");for(var f=e;f-- >0;)for(var l=e;l-- >0;)if(0!==a[o+e*f+l])throw new Error("Assertion failed.");if(n|=0,o|=0,!((r|=0)<=(e|=0)))throw new Error("Assertion failed.");if(r===e)for(var h=e;h-- >0;){a[o+e*h+i[s+h]]=1}else{for(var u=e;u-- >0;)a[o+e*u+u]=1;for(var c=r;c-- >0;)for(var d=r;d<e;d++){var w=n+e*c+d,v=t[w];if(0!==v){var p=n+e*c+c,m=ae(t[p],v),g=T()(m,3),y=g[0],b=g[1],E=g[2];if(0!==b){for(var _=c;_-- >0;){var x=n+e*_+c,A=t[x],M=n+e*_+d,k=t[M];t[x]=k*b+A*y,t[M]=k*y-A*b}oe(a,1+d-c,o+e*c+c,o+e*d+c,y,b),t[p]=E}t[w]=0}}for(var N=0;N<e;++N)for(;;){var F=i[s+N];if(i[s+N]=i[s+F],i[s+F]=F,F<=N)break;for(var I=e;I-- >0;){var P=a[o+e*I+N];a[o+e*I+N]=a[o+e*I+F],a[o+e*I+F]=P}}}}function ln(r){var e=tn(r),t=T()(e,4),n=t[0],a=t[1],o=t[2],i=t[3];r=void 0;var s=a.shape.slice(-2),f=T()(s,2),l=f[0],h=f[1],u=a.shape.slice();u[u.length-2]=h,o=o.data;for(var c=i.data,d=a.data,w=new q[a.dtype](d.length/l*h),v=0,p=0,m=0,g=0;g<c.length;v+=l*h,p+=h*h,m+=h,g+=1){var y=c[g];if(y<h)for(var b=y;b<l;b++)for(var E=y;E<h;E++)d[v+h*b+E]=0;fn(y,h,d,v,w,p,o,m)}return[n,a,new ar(u,w),i]}function hn(r,e,t,n,a){if(null==a){if(null!=n||null!=t)throw new Error("urv_lstsq( U,R,V,ranks, Y ): Either 2 ([U,R,V,ranks], Y) or 5 arguments (U,R,V,ranks, Y) expected.");a=e;var o=r,i=T()(o,4);r=i[0],e=i[1],t=i[2],n=i[3]}if(!((r=nr(r)).ndim>=2))throw new Error("urv_lstsq(U,R,V, Y): U.ndim must be at least 2.");if(!((e=nr(e)).ndim>=2))throw new Error("urv_lstsq(U,R,V, Y): R.ndim must be at least 2.");if(!((t=nr(t)).ndim>=2))throw new Error("urv_lstsq(U,R,V, Y): V.ndim must be at least 2.");if(!((a=nr(a)).ndim>=2))throw new Error("urv_lstsq(U,R,V, Y): Y.ndim must be at least 2.");n=nr(n);var s=r.shape,f=e.shape,l=t.shape,h=a.shape,u=n.shape,c=[r,e,t,a].every((function(r){return"float32"===r.dtype}))?"float32":"float64",d=q[c],w=[r,e,t,a].reduce((function(r,e){var t=e.ndim;return Math.max(r,t)}),n.ndim+2),v=new Int32Array(w);v.fill(1);for(var p=0,m=[r,e,t,a];p<m.length;p++)for(var g=m[p],y=w-2,b=g.ndim-2;y-- >0&&b-- >0;)if(1===v[y])v[y]=g.shape[b];else if(v[y]!=g.shape[b]&&1!=g.shape[b])throw new Error("urv_lstsq( U,R,V,ranks, Y ): U,R,V,ranks, Y not broadcast-compatible.");for(var E=w-2,_=n.ndim;E-- >0&&_-- >0;)if(1===v[E])v[E]=n.shape[_];else if(v[E]!=n.shape[_]&&1!=n.shape[_])throw new Error("urv_lstsq( U,R,V,ranks, Y ): U,R,V,ranks, Y not broadcast-compatible.");var x=r.shape.slice(-2),A=T()(x,2),M=A[0],k=A[1],N=t.shape.slice(-2),F=T()(N,2),I=F[0],P=F[1],S=a.shape[a.ndim-1];if(e.shape[e.ndim-2]!==k)throw new Error("urv_lstsq( U,R,V,ranks, Y ): Matrix dimensions incompatible.");if(e.shape[e.ndim-1]!==I)throw new Error("urv_lstsq( U,R,V,ranks, Y ): Matrix dimensions incompatible.");if(a.shape[a.ndim-2]!==M)throw new Error("urv_lstsq( U,R,V,ranks, Y ): Matrix dimensions incompatible.");if(k!==I&&M<P){if(M!==k)throw new Error("Assertion failed.");if(I!==P)throw new Error("Assertion failed.")}if(!(M>=k))throw new Error("Assertion failed.");if(!(I<=P))throw new Error("Assertion failed.");v[w-2]=P,v[w-1]=S,n=n.data,r=r.data,e=e.data,t=t.data,a=a.data;var j=new d(v.reduce((function(r,e){return r*e}))),O=new d(M*S),R=r.length,L=1,D=e.length,G=1,J=t.length,X=1,z=a.length,U=1,Y=n.length,Q=1,B=j.length;return function o(i){if(i===w-2){R-=L=M*k,D-=G=k*I,J-=X=I*P,z-=U=M*S,B-=P*S,function(r,e,t,n,a,o,i,s,f,l,h,u,c,d,w,v,p){if(r%1!=0)throw new Error("Assertion failed.");if(e%1!=0)throw new Error("Assertion failed.");if(t%1!=0)throw new Error("Assertion failed.");if(n%1!=0)throw new Error("Assertion failed.");if(a%1!=0)throw new Error("Assertion failed.");if(o%1!=0)throw new Error("Assertion failed.");if(s%1!=0)throw new Error("Assertion failed.");if(l%1!=0)throw new Error("Assertion failed.");if(u%1!=0)throw new Error("Assertion failed.");if(d%1!=0)throw new Error("Assertion failed.");if(v%1!=0)throw new Error("Assertion failed.");if(!(0<=e))throw new Error("Assertion failed.");if(!(0<=t))throw new Error("Assertion failed.");if(!(0<=n))throw new Error("Assertion failed.");if(!(0<=a))throw new Error("Assertion failed.");if(!(0<=o))throw new Error("Assertion failed.");if(!(0<=s))throw new Error("Assertion failed.");if(!(0<=l))throw new Error("Assertion failed.");if(!(0<=u))throw new Error("Assertion failed.");if(!(0<=d))throw new Error("Assertion failed.");if(!(0<=v))throw new Error("Assertion failed.");if(!(s<=i.length-e*t))throw new Error("Assertion failed.");if(!(l<=f.length-t*n))throw new Error("Assertion failed.");if(!(u<=h.length-n*a))throw new Error("Assertion failed.");if(!(d<=c.length-a*o))throw new Error("Assertion failed.");if(!(v<=w.length-e*o))throw new Error("Assertion failed.");if(p.length<e*o)throw new Error("Assertion failed.");p.fill(0,0,e*o);for(var m=0;m<e;m++)for(var g=0;g<r;g++)for(var y=0;y<o;y++)p[o*g+y]+=i[s+t*m+g]*w[v+o*m+y];Ee(r,n,o,f,l,p,0);for(var b=0;b<r;b++)for(var E=0;E<a;E++)for(var _=0;_<o;_++)c[d+o*E+_]+=h[u+a*b+E]*p[o*b+_]}(n[Y-=Q=1],M,k,I,P,S,r,R,e,D,t,J,j,B,a,z,O)}else{for(var c=v[i];o(i+1),1!=c;c--)s[i-w+s.length]>1||(R+=L),f[i-w+f.length]>1||(D+=G),l[i-w+l.length]>1||(J+=X),h[i-w+h.length]>1||(z+=U),u[i-w+2+u.length]>1||(Y+=Q);L*=s[i-w+s.length]||1,G*=f[i-w+f.length]||1,X*=l[i-w+l.length]||1,U*=h[i-w+h.length]||1,Q*=u[i-w+2+u.length]||1}}(0),new ar(v,j)}var un=t(10),cn=t.n(un);function dn(r){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(r){return!1}}();return function(){var t,n=C()(r);if(e){var a=C()(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return Q()(this,t)}}var wn=function(r){U()(t,r);var e=dn(t);function t(){return p()(this,t),e.apply(this,arguments)}return t}(W()(Error)),vn=function(r){U()(t,r);var e=dn(t);function t(){return p()(this,t),e.apply(this,arguments)}return t}(wn),pn=function(r){U()(t,r);var e=dn(t);function t(r,n,a){var o;return p()(this,t),o=e.call(this),Object.assign(cn()(o),{x:r,f:n,g:a}),o}return t}(wn),mn=function(r){U()(t,r);var e=dn(t);function t(r,n,a){var o;return p()(this,t),o=e.call(this),Object.assign(cn()(o),{x:r,f:n,g:a}),o}return t}(wn),gn=Float64Array.of(NaN),yn=new Int32Array(gn.buffer);if(2!==yn.length)throw new Error("Assertion failed.");function bn(r){if(0===(r*=1))return+Number.MIN_VALUE;if(!(r<1/0))return r;gn[0]=r;var e=1-Gr,t=1*Gr;return r>0?(yn[t]+=-1===yn[e],yn[e]+=1):(yn[t]-=0===yn[e],yn[e]-=1),gn[0]}function En(r){if(0===(r*=1))return-Number.MIN_VALUE;if(!(r>-1/0))return r;gn[0]=r;var e=1-Gr,t=1*Gr;return r>0?(yn[t]-=0===yn[e],yn[e]-=1):(yn[t]+=-1===yn[e],yn[e]+=1),gn[0]}function _n(r,e){if(r*=1,e*=1,isNaN(r))throw new Error("mid(x,y): x must be number.");if(isNaN(e))throw new Error("mid(x,y): x must be number.");if(Math.sign(r)*e<0){var t=(r+e)/2;if(!(t<Math.max(r,e)))throw new Error("Assertion failed.");if(!(t>Math.min(r,e)))throw new Error("Assertion failed.");return t}var n=Math.abs(r)<=Math.abs(e)?[r,e]:[e,r],a=T()(n,2),o=a[0],i=o+.5*(a[1]-o);if(!(i<=Math.max(r,e)))throw new Error("Assertion failed.");if(!(i>=Math.min(r,e)))throw new Error("Assertion failed.");return i===e?r:i}function xn(r,e,t){if(isNaN(r))throw new Error("roots_quad_poly(a,b,c): a must be number.");if(isNaN(e))throw new Error("roots_quad_poly(a,b,c): b must be number.");if(isNaN(t))throw new Error("roots_quad_poly(a,b,c): c must be number.");if(0===t){var n=-r/e;return[n,n]}if(r/=t,0===(e/=t)){var a=Math.sqrt(-r);return[-a,+a]}if(0===r)return 0<=e?[-e,0]:[0,-e];e/=2*(t=Math.sqrt(Math.abs(r))*Math.sign(e));var o,i,s=1024*Number.EPSILON*64;if(0<r){if(e<1-s)throw new Error("Complex roots not yet supported: "+e);e<1&&(e=1),i=1/(o=-e-Math.sqrt((e+1)*(e-1)))}else i=-1/(o=-e-Math.sqrt(e*e+1));return(o*=t)<=(i*=t)?[o,i]:[i,o]}function An(r,e,t,n){if(r*=1,!isFinite(r))throw new Error("Assertion failed.");if(e*=1,!isFinite(e))throw new Error("Assertion failed.");if(t*=1,!isFinite(t))throw new Error("Assertion failed.");if(n*=1,!isFinite(n))throw new Error("Assertion failed.");var a=e-r,o=n-t;if(!(Math.sign(a)*o>0))throw new Error("Assertion failed: Bad curvature (i.e. no minimum).");return r-a/o*t}function Mn(r,e,t,n,a){if(r*=1,!isFinite(r))throw new Error("Assertion failed.");if(e*=1,!isFinite(e))throw new Error("Assertion failed.");if(t*=1,!isFinite(t))throw new Error("Assertion failed.");if(n*=1,!isFinite(n))throw new Error("Assertion failed.");if(a*=1,!isFinite(a))throw new Error("Assertion failed.");if(r===e)throw new Error("Assertion failed.");var o=e-r;return r+.5*o*a/(a-(n-t)/o)}function kn(r,e,t,n,a,o){if(r*=1,!isFinite(r))throw new Error("Assertion failed.");if(e*=1,!isFinite(e))throw new Error("Assertion failed.");if(t*=1,!isFinite(t))throw new Error("Assertion failed.");if(n*=1,!isFinite(n))throw new Error("Assertion failed.");if(a*=1,!isFinite(a))throw new Error("Assertion failed.");if(o*=1,!isFinite(o))throw new Error("Assertion failed.");if(r===e)throw new Error("Assertion failed.");var i=2*(3*(n-=t)/(e-=r)-o-2*a),s=(o-a-i)/e,f=xn(a*e,i,s),l=T()(f,2),h=l[0],u=l[1];return(Math.sign(e)*s<0?h:u)+r}var Nn=Object.freeze({fRed:.01,gRed:.9,growMin:Math.PI/3,growMax:Math.E-1.5,shrinkLeast:.1}),Fn=function(){for(var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0,t=Object.keys(r);e<t.length;e++){var n=t[e];n in Nn||console.warn('more_thuente_abc(opt): unknown parameter "'.concat(n,'" in opt.'))}var a=r=Object.assign({},Nn,r),o=a.fRed,i=a.gRed,s=a.growMin,f=a.growMax,l=a.shrinkLeast;if(i*=1,s*=1,f*=1,l*=1,!((o*=1)>0))throw new Error("more_thuente_abc(opt): opt.fRed must be positive.");if(!(o<i))throw new Error("more_thuente_abc(opt): opt.fRed must less than opt.gRed.");if(!(1>i))throw new Error("more_thuente_abc(opt): opt.gRed must less than 1.");if(!(1<s))throw new Error("more_thuente_abc(opt): opt.growMin must larger than 1.");if(!(f>=s))throw new Error("more_thuente_abc(opt): opt.growMax must not be less than opt.growMin.");if(o<.5||console.warn("more_thuente_abc(opt): opt.fRed should be less than 0.5 to work properly with (quasi-)Newton methods."),!(l>=0))throw new Error("more_thuente_abc(opt): opt.shrinkLeast must be non-negative.");if(!(l<=.5))throw new Error("more_thuente_abc(opt): opt.shrinkLeast must not be greater than 0.5.");var h=function(r){return function(e,t,n,a){var h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0;if(e=tr("float64",e),n=tr("float64",n),t*=1,!(a instanceof ar))throw new Error("Assertion failed.");var d=a.shape,w=T()(d,1),v=w[0];if(1!==e.ndim)throw new Error("more_thuente_abc()(fg)(X0,f0,G0): X0.ndim must be 1.");if(1!==n.ndim)throw new Error("more_thuente_abc()(fg)(X0,f0,G0): G0.ndim must be 1.");if(1!==a.ndim)throw new Error("more_thuente_abc()(fg)(X0,f0,G0): negDir.ndim must be 1.");if(e.shape[0]!==v)throw new Error("more_thuente_abc()(fg)(X0,f0,G0): negDir and X0 must have the same shape.");if(n.shape[0]!==v)throw new Error("more_thuente_abc()(fg)(X0,f0,G0): negDir and G0 must have the same shape.");if(isNaN(t))throw new Error("more_thuente_abc()(fg)(X0,f0,G0): f0 is NaN.");if(0!==h)throw new Error("more_thuente_abc()(fg)(X0,f0,G0, αMin,α0,αMax): αMin !== 0 not (yet) supported.");if(a=a.data,null==u&&(u=Math.min(1,c/2)),!(h<=u))throw new Error("more_thuente_abc()(fg)(X0,f0,G0, αMin,α0,αMax): αMin must not be greater than α0.");if(!(c>=u))throw new Error("more_thuente_abc()(fg)(X0,f0,G0, αMin,α0,αMax): αMax must not be less than α0.");if(0===c)throw new vn;var p=function(r){return r.data.reduce((function(r,e,t){return r-a[t]*e}),0)},m=function(t){var n=new ar(d,e.data.map((function(r,e){return r-t*a[e]}))),o=r(new ar(d,n.data.slice())),i=T()(o,2),s=i[0],f=i[1];if(s*=1,f=tr("float64",f),isNaN(s))throw new Error("more_thuente_abc()(fg)(X0,f0,G0): fg returned NaN.");if(1!==f.ndim)throw new Error("more_thuente_abc()(fg)(X0,f0,G0): fg returned gradient with invalid shape.");if(f.shape[0]!==v)throw new Error("more_thuente_abc()(fg)(X0,f0,G0): fg returned gradient with invalid shape.");return[n,s,f,p(f)]},g=p(n);if(0===g)throw new vn;if(0<g)throw new Error("more_thuente_abc: Initial projected gradient not negative.");var y=0,b=1/0,E=u,_=t,x=NaN,A=g,M=NaN;r:for(;;){if(!isFinite(E))throw new Error("Assertion failed: "+E);var k=m(E),N=T()(k,4),F=N[0],I=N[1],P=N[2],q=N[3];if(I-t<=o*E*g&&Math.abs(q)<=-i*g)return[F,I,P];if(I>_){b=E,x=I,M=q;break r}if(q>0){b=y,y=E,x=_,_=I,M=A,A=q;break r}if(!(E<c))throw new mn(F,I,P);if(!(E<Number.MAX_VALUE))throw new Error("more_thuente_abc: Infinity reached.");var S=void 0;S=A<q?An(y,E,A,q):E*s,S=Math.min(S,E*f),E<(S=Math.max(S,E*s))||(S=bn(E)),c>=S||(S=c),y=E,E=S,_=I,A=q}if(y===b)throw new wn("more_thuente_abc: bracketing failed.");for(var j=function(r,e,t){if(0===y)throw new vn("strongWolfeLineSearch(): no progress.");throw new pn(r,e,t)},O=1;;O++){var R=Math.min(y,b),L=Math.max(y,b),D=Math.max(bn(R),l*L+(1-l)*R),G=Math.min(En(L),l*R+(1-l)*L),J=y+(b-y)/2;if(.5!==l&&D<G&&isFinite(x)&&isFinite(M)){if(_<x){var X=kn(y,b,_,x,A,M),z=Mn(y,b,_,x,A);E=Math.abs(X-y)<Math.abs(z-y)?X:(X+z)/2}else if(Math.sign(A)*M<0){var U=kn(y,b,_,x,A,M),Y=An(y,b,A,M);E=Math.abs(Y-b)<=Math.abs(U-b)?U:Y}else E=Mn(y,b,_,x,A);D<=E?G>=E||(E=G):E=D}else E=J;var Q=m(E),B=T()(Q,4),C=B[0],V=B[1],W=B[2],K=B[3];if(V-t<=o*E*g&&Math.abs(K)<=-i*g)return[C,V,W];V>_?(b===E&&j(C,V,W),b=E,x=V,M=K):(Math.sign(b-y)*K>0&&(b=y,x=_,M=A),y===E&&j(C,V,W),y=E,_=V,A=K)}}};return Object.defineProperty(h,"name",{value:"more_thuente_abc(".concat(JSON.stringify(r),")"),writable:!1}),Object.assign(h,r),Object.freeze(h),h},In=Object.freeze({fRed:.01,gRed:.9,growMin:Math.PI/3,growMax:Math.E-1.5,shrinkLeast:.1}),Pn=function(){for(var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0,t=Object.keys(r);e<t.length;e++){var n=t[e];n in In||console.warn('more_thuente_u123(opt): unknown parameter "'.concat(n,'" in opt.'))}var a=r=Object.assign({},In,r),o=a.fRed,i=a.gRed,s=a.growMin,f=a.growMax,l=a.shrinkLeast;if(i*=1,s*=1,f*=1,l*=1,!((o*=1)>0))throw new Error("more_thuente_u123(opt): opt.fRed must be positive.");if(!(o<i))throw new Error("more_thuente_u123(opt): opt.fRed must less than opt.gRed.");if(!(1>i))throw new Error("more_thuente_u123(opt): opt.gRed must less than 1.");if(!(1<s))throw new Error("more_thuente_u123(opt): opt.growMin must larger than 1.");if(!(f>=s))throw new Error("more_thuente_u123(opt): opt.growMax must not be less than opt.growMin.");if(o<.5||console.warn("more_thuente_u123(opt): opt.fRed should be less than 0.5 to work properly with (quasi-)Newton methods."),!(l>=0))throw new Error("more_thuente_u123(opt): opt.shrinkLeast must be non-negative.");if(!(l<=.5))throw new Error("more_thuente_u123(opt): opt.shrinkLeast must not be greater than 0.5.");var h=function(r){return function(e,t,n,a){var h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0;if(e=tr("float64",e),n=tr("float64",n),t*=1,!(a instanceof ar))throw new Error("Assertion failed.");var d=a.shape,w=T()(d,1),v=w[0];if(1!==e.ndim)throw new Error("more_thuente_u123()(fg)(X0,f0,G0): X0.ndim must be 1.");if(1!==n.ndim)throw new Error("more_thuente_u123()(fg)(X0,f0,G0): G0.ndim must be 1.");if(1!==a.ndim)throw new Error("more_thuente_u123()(fg)(X0,f0,G0): negDir.ndim must be 1.");if(e.shape[0]!==v)throw new Error("more_thuente_u123()(fg)(X0,f0,G0): negDir and X0 must have the same shape.");if(n.shape[0]!==v)throw new Error("more_thuente_u123()(fg)(X0,f0,G0): negDir and G0 must have the same shape.");if(0!==h)throw new Error("more_thuente_u123()(fg)(X0,f0,G0, αMin,α0,αMax): αMin !== 0 not (yet) supported.");if(isNaN(t))throw new Error("more_thuente_u123()(fg)(X0,f0,G0): f0 is NaN.");if(e.data.some(isNaN))throw new Error("more_thuente_u123()(fg)(X0,f0,G0): X0 contains NaN.");if(n.data.some(isNaN))throw new Error("more_thuente_u123()(fg)(X0,f0,G0): G0 contains NaN.");if((a=a.data).some(isNaN))throw new Error("Assertion failed.");if(null==u&&(u=Math.min(1,c/2)),!(h<=u))throw new Error("more_thuente_u123()(fg)(X0,f0,G0, αMin,α0,αMax): αMin must not be greater than α0.");if(!(c>=u))throw new Error("more_thuente_u123()(fg)(X0,f0,G0, αMin,α0,αMax): αMax must not be less than α0.");if(0===c)throw new vn;var p=function(r){return r.data.reduce((function(r,e,t){return r-a[t]*e}),0)},m=function(t){var n=new ar(d,e.data.map((function(r,e){return r-t*a[e]}))),o=r(new ar(d,n.data.slice())),i=T()(o,2),s=i[0],f=i[1];if(s*=1,f=tr("float64",f),isNaN(s))throw new Error("more_thuente_u123()(fg)(X0,f0,G0): fg returned NaN.");if(1!==f.ndim)throw new Error("more_thuente_u123()(fg)(X0,f0,G0): fg returned gradient with invalid shape.");if(f.shape[0]!==v)throw new Error("more_thuente_u123()(fg)(X0,f0,G0): fg returned gradient with invalid shape.");return[n,s,f,p(f)]},g=p(n);if(0===g)throw new vn;if(0<g)throw new Error("more_thuente_u123: Initial projected gradient not negative.");var y=0,b=1/0,E=u,_=t,x=NaN,A=g,M=NaN;r:for(;;){if(!isFinite(E))throw new Error("Assertion failed.");var k=m(E),N=T()(k,4),F=N[0],I=N[1],P=N[2],q=N[3];if(I-t<=o*E*g&&Math.abs(q)<=-i*g)return[F,I,P];if(I-_>o*(E-y)*g){b=E,x=I,M=q;break r}if(q>0){b=y,y=E,x=_,_=I,M=A,A=q;break r}if(!(E<c))throw new mn(F,I,P);if(!(E<Number.MAX_VALUE))throw new Error("more_thuente_u123: Infinity reached.");var S=void 0;S=A<q?An(y,E,A,q):E*s,S=Math.min(S,E*f),E<(S=Math.max(S,E*s))||(S=bn(E)),c>=S||(S=c),y=E,E=S,_=I,A=q}if(y===b)throw new wn("more_thuente_u123: bracketing failed.");for(var j=function(r,e,t){if(0===y)throw new vn("strongWolfeLineSearch(): no progress.");throw new pn(r,e,t)},O=1;;O++){var R=Math.min(y,b),L=Math.max(y,b),D=Math.max(bn(R),l*L+(1-l)*R),G=Math.min(En(L),l*R+(1-l)*L),J=y+(b-y)/2;if(.5!==l&&D<G&&isFinite(x)&&isFinite(M)){if(_<x){var X=kn(y,b,_,x,A,M),z=Mn(y,b,_,x,A);E=Math.abs(X-y)<Math.abs(z-y)?X:(X+z)/2}else if(Math.sign(A)*M<0){var U=kn(y,b,_,x,A,M),Y=An(y,b,A,M);E=Math.abs(Y-b)<=Math.abs(U-b)?U:Y}else E=Mn(y,b,_,x,A);D<=E?G>=E||(E=G):E=D}else E=J;if(!(R<=E))throw new Error("Assertion failed.");if(!(L>=E))throw new Error("Assertion failed.");var Q=m(E),B=T()(Q,4),C=B[0],V=B[1],W=B[2],K=B[3];if(V-t<=o*E*g&&Math.abs(K)<=-i*g)return[C,V,W];V-_>o*(E-y)*g?(b===E&&j(C,V,W),b=E,x=V,M=K):(Math.sign(b-y)*K>0&&(b=y,x=_,M=A),y===E&&j(C,V,W),y=E,_=V,A=K)}}};return Object.defineProperty(h,"name",{value:"more_thuente_u123(".concat(JSON.stringify(r),")"),writable:!1}),Object.assign(h,r),Object.freeze(h),h},qn=t(11),Sn=t.n(qn),jn=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=r,t=e.fRed,n=void 0===t?.1:t,a=e.gRed,o=void 0===a?.9:a,i=e.grow,s=void 0===i?Math.PI/3:i,l=e.shrinkLeast,h=void 0===l?.2:l;if(r={fRed:n,gRed:o,grow:s,shrinkLeast:h},o*=1,s*=1,h*=1,!((n*=1)>0))throw new Error("albaali_fletcher(opt): opt.fRed must be positive.");if(!(n<o))throw new Error("albaali_fletcher(opt): opt.fRed must less than opt.gRed.");if(!(1>o))throw new Error("albaali_fletcher(opt): opt.gRed must less than 1.");if(!(1<s))throw new Error("albaali_fletcher(opt): opt.grow must larger than 1.");if(n<.5||console.warn("albaali_fletcher(opt): opt.fRed should be less than 0.5 to work properly with (quasi-)Newton methods."),!(h>=0))throw new Error("albaali_fletcher(opt): opt.shrinkLeast must be non-negative.");if(!(h<=.5))throw new Error("albaali_fletcher(opt): opt.shrinkLeast must not be greater than 0.5.");var u=1/h,c=u-1,d=function(r){return function(e,t,a,i){var l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0;if(e=tr("float64",e),a=tr("float64",a),t*=1,!(i instanceof ar))throw new Error("Assertion failed.");var w=i.shape,v=T()(w,1),p=v[0];if(1!==e.ndim)throw new Error("albaali_fletcher()(fg)(X0,f0,G0): X0.ndim must be 1.");if(1!==a.ndim)throw new Error("albaali_fletcher()(fg)(X0,f0,G0): G0.ndim must be 1.");if(1!==i.ndim)throw new Error("albaali_fletcher()(fg)(X0,f0,G0): negDir.ndim must be 1.");if(e.shape[0]!==p)throw new Error("albaali_fletcher()(fg)(X0,f0,G0): negDir and X0 must have the same shape.");if(a.shape[0]!==p)throw new Error("albaali_fletcher()(fg)(X0,f0,G0): negDir and G0 must have the same shape.");if(isNaN(t))throw new Error("albaali_fletcher()(fg)(X0,f0,G0): f0 is NaN.");if(0!==l)throw new Error("albaali_fletcher()(fg)(X0,f0,G0, αMin,α0,αMax): αMin !== 0 not (yet) supported.");if(i=i.data,null==h&&(h=Math.min(1,d/2)),!(l<=h))throw new Error("albaali_fletcher()(fg)(X0,f0,G0, αMin,α0,αMax): αMin !== 0 not (yet) supported.");if(!(d>=h))throw new Error("albaali_fletcher()(fg)(X0,f0,G0, αMin,α0,αMax): αMax must not be less than αMin.");if(0===d)throw new vn;var m=function(r){return r.data.reduce((function(r,e,t){return r-i[t]*e}),0)},g=function(t){var n=new ar(w,e.data.map((function(r,e){return r-t*i[e]}))),a=r(new ar(w,n.data.slice())),o=T()(a,2),s=o[0],f=o[1];if(s*=1,f=tr("float64",f),isNaN(s))throw new Error("more_thuente_u123()(fg)(X0,f0,G0): fg returned NaN.");if(1!==f.ndim)throw new Error("more_thuente_u123()(fg)(X0,f0,G0): fg returned gradient with invalid shape.");if(f.shape[0]!==p)throw new Error("more_thuente_u123()(fg)(X0,f0,G0): fg returned gradient with invalid shape.");return[n,s,f,m(f)]},y=m(a);if(0===y)throw new vn;if(0<y)throw new Error("albaali_fletcher: Initial projected gradient not negative.");var b=0,E=1/0,_=h,x=t,A=NaN,M=y,k=NaN;r:for(;;){if(!isFinite(_))throw new Error("Assertion failed.");var N=g(_),F=T()(N,4),I=F[0],P=F[1],q=F[2],S=F[3];if(P-t>n*_*y||0<b&&P>=x){E=_,A=P,k=S;break r}if(Math.abs(S)<=-o*y)return[I,P,q];if(S>=0){E=b,b=_,A=x,x=P,k=M,M=S;break r}if(!(_<d))throw new mn(I,P,q);if(!(_<E))throw new wn("albaali_fletcher: Strong Wolfe condition not satisfiable in range.");b=_,_=Math.min(Math.max(bn(_),_*s),d),x=P,M=S}if(b===E)throw new wn("albaali_fletcher: bracketing failed.");for(var j=function(){if(0===b)throw new vn("strongWolfeLineSearch(): no progress.");throw new pn(X,f,G)},O=1;;O++){var R=Math.min(b,E),L=Math.max(b,E),D=Math.max(bn(R),(L+c*R)/u),J=Math.min(En(L),(R+c*L)/u);if(2!==u&&D<J&&isFinite(A)&&isFinite(k)?D<=(_=Mn(b,E,x,A,M))?J>=_||(_=J):_=D:_=b+(E-b)/2,!(R<=_))throw new Error("Assertion failed.");if(!(L>=_))throw new Error("Assertion failed.");var z=g(_),U=T()(z,4),Y=U[0],Q=U[1],B=U[2],C=U[3];if(Q-t>n*_*y||Q>=x)E===_&&j(),E=_,A=Q,k=C;else{if(Math.abs(C)<=-o*y)return[Y,Q,B];Math.sign(E-b)*C>=0&&(E=b,A=x,k=M),b===_&&j(),b=_,x=Q,M=C}}}};return Object.defineProperty(d,"name",{value:"albaali_fletcher(".concat(JSON.stringify(r),")"),writable:!1}),Object.assign(d,r),Object.freeze(d),d};function On(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),t.push.apply(t,n)}return t}function Rn(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?On(Object(t),!0).forEach((function(e){Sn()(r,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):On(Object(t)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))}))}return r}var Ln=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r=Rn({},r);for(var e=0,t=["c1","fRed","c2","gRed","c3","grow"];e<t.length;e++){var n=T()(t[e],2),a=n[0],o=n[1];!(o in r)&&a in r&&(console.warn("strong_wolfe(opt): opt.".concat(a," is deprecated, use opt.").concat(o," instead.")),r[o]=r[a],delete r[a])}return jn(r)},Dn=function(r){if((r=nr(r)).ndim<1)throw new Error("beale(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("beale(x): x.shape[-1] must be 2.");for(var e=r.shape.slice(0,-1),t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length/2),n=(r=r.data).length,a=t.length;a-- >0;){var o=r[(n-=2)+0],i=r[n+1],s=1.5-o*(1-i),f=2.25-o*(1-i*i),l=2.625-o*(1-i*i*i);t[a]=s*s+f*f+l*l}return new ar(e,t)};Dn.nIn=2,Dn.nOut=3,Dn.minima=Dn.minima_global=Dn.roots=[[3,.5]],Dn.grad=function(r){if((r=nr(r)).ndim<1)throw new Error("beale.grad(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("beale.grad(x): x.shape[-1] must be 2.");for(var e=r.shape,t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length),n=(r=r.data).length;(n-=2)>=0;){var a=r[n+0],o=r[n+1],i=1.5-a*(1-o),s=2.25-a*(1-o*o),f=2.625-a*(1-o*o*o);t[n+0]=2*(i*(o-1)+s*(o*o-1)+f*(o*o*o-1)),t[n+1]=2*a*(1*i+o*(2*s+3*f*o))}return new ar(e,t)},Dn.hess=function(r){if((r=nr(r)).ndim<1)throw new Error("beale.hess(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("beale.hess(x): x.shape[-1] must be 2.");var e=Int32Array.of.apply(Int32Array,x()(r.shape).concat([2])),t=new("float32"===r.dtype?Float32Array:Float64Array)(2*r.data.length);r=r.data;for(var n=t.length,a=r.length;(a-=2)>=0;){n-=4;var o=r[a+0],i=r[a+1],s=2.25-o*(1-i*i),f=2.625-o*(1-i*i*i);t[n+0]=2*((1-i)*(1-i)+(1-i*i)*(1-i*i)+(1-i*i*i)*(1-i*i*i)),t[n+1]=t[n+2]=2*(1.5-2*(1-i)*o+4.5*i-4*(1-i*i)*o*i+7.875*i*i-6*(1-i*i*i)*o*i*i),t[n+3]=2*(1*o*o+4*o*o*i*i+2*s*o+9*o*o*i*i*i*i+6*f*o*i)}return new ar(e,t)},Dn.lsq=function(r){if((r=nr(r)).ndim<1)throw new Error("beale.lsq(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("beale.lsq(x): x.shape[-1] must be 2.");var e=r.shape.slice(),t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length/2*3);e[e.length-1]=3;for(var n=(r=r.data).length,a=t.length;(n-=2)>=0;){a-=3;var o=r[n+0],i=r[n+1];t[a+0]=1.5-o*(1-i),t[a+1]=2.25-o*(1-i*i),t[a+2]=2.625-o*(1-i*i*i)}return new ar(e,t)},Dn.lsq_jac=function(r){if((r=nr(r)).ndim<1)throw new Error("beale.lsq_jac(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("beale.lsq_jac(x): x.shape[-1] must be 2.");for(var e=Int32Array.of.apply(Int32Array,x()(r.shape.slice(0,-1)).concat([3,2])),t=new("float32"===r.dtype?Float32Array:Float64Array)(3*r.data.length),n=(r=r.data).length,a=t.length;(n-=2)>=0;){a-=6;var o=r[n+0],i=r[n+1];t[a+0]=i-1,t[a+1]=1*o,t[a+2]=i*i-1,t[a+3]=2*o*i,t[a+4]=i*i*i-1,t[a+5]=3*o*i*i}return new ar(e,t)},Object.freeze(Dn);var Gn=function(r){if((r=nr(r)).ndim<1)throw new Error("brown_badscale(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("brown_badscale(x): x.shape[-1] must be 2.");for(var e=r.shape.slice(0,-1),t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length/2),n=(r=r.data).length,a=t.length;a-- >0;){var o=r[(n-=2)+0],i=r[n+1],s=o-1e6,f=i-2e-6,l=o*i-2;t[a]=s*s+f*f+l*l}return new ar(e,t)};Gn.nIn=2,Gn.nOut=3,Gn.minima=Gn.minima_global=Gn.roots=[[1e6,2e-6]],Gn.grad=function(r){if((r=nr(r)).ndim<1)throw new Error("brown_badscale.grad(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("brown_badscale.grad(x): x.shape[-1] must be 2.");for(var e=r.shape,t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length),n=(r=r.data).length;(n-=2)>=0;){var a=r[n+0],o=r[n+1],i=a-1e6,s=o-2e-6,f=a*o-2;t[n+0]=2*(i+f*o),t[n+1]=2*(s+f*a)}return new ar(e,t)},Gn.hess=function(r){if((r=nr(r)).ndim<1)throw new Error("brown_badscale.hess(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("brown_badscale.hess(x): x.shape[-1] must be 2.");var e=Int32Array.of.apply(Int32Array,x()(r.shape).concat([2])),t=new("float32"===r.dtype?Float32Array:Float64Array)(2*r.data.length);r=r.data;for(var n=t.length,a=r.length;(a-=2)>=0;){n-=4;var o=r[a+0],i=r[a+1],s=o*i-2;t[n+0]=2*(1+i*i),t[n+1]=t[n+2]=2*(s+o*i),t[n+3]=2*(1+o*o)}return new ar(e,t)},Gn.lsq=function(r){if((r=nr(r)).ndim<1)throw new Error("brown_badscale.lsq(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("brown_badscale.lsq(x): x.shape[-1] must be 2.");var e=r.shape.slice(),t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length/2*3);e[e.length-1]=3;for(var n=(r=r.data).length,a=t.length;(n-=2)>=0;){a-=3;var o=r[n+0],i=r[n+1];t[a+0]=o-1e6,t[a+1]=i-2e-6,t[a+2]=o*i-2}return new ar(e,t)},Gn.lsq_jac=function(r){if((r=nr(r)).ndim<1)throw new Error("brown_badscale.lsq_jac(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("brown_badscale.lsq_jac(x): x.shape[-1] must be 2.");for(var e=Int32Array.of.apply(Int32Array,x()(r.shape.slice(0,-1)).concat([3,2])),t=new("float32"===r.dtype?Float32Array:Float64Array)(3*r.data.length),n=(r=r.data).length,a=t.length;(n-=2)>=0;){a-=6;var o=r[n+0],i=r[n+1];t[a+0]=1,t[a+1]=0,t[a+2]=0,t[a+3]=1,t[a+4]=i,t[a+5]=o}return new ar(e,t)},Object.freeze(Gn);var Jn=function(r){if((r=nr(r)).ndim<1)throw new Error("freudenstein_roth(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("freudenstein_roth(x): x.shape[-1] must be 2.");for(var e=r.shape.slice(0,-1),t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length/2),n=(r=r.data).length,a=t.length;a-- >0;){var o=r[(n-=2)+0],i=r[n+1],s=-13+o+((5-i)*i-2)*i,f=-29+o+((1+i)*i-14)*i;t[a]=s*s+f*f}return new ar(e,t)};Jn.nIn=Jn.nOut=2,Jn.roots=[[5,4]],Jn.minima_global=[[5,4]],Jn.minima=[[5,4],[(53-Math.sqrt(352))/3,(2-Math.sqrt(22))/3]],Jn.grad=function(r){if((r=nr(r)).ndim<1)throw new Error("freudenstein_roth.grad(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("freudenstein_roth.grad(x): x.shape[-1] must be 2.");for(var e=r.shape,t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length),n=(r=r.data).length;(n-=2)>=0;){var a=r[n+0],o=r[n+1];t[n+0]=4*a-84+(12*o-32)*o,t[n+1]=864-(32-24*o)*a+(24+((8+(12*o-40)*o)*o-240)*o)*o}return new ar(e,t)},Jn.hess=function(r){if((r=nr(r)).ndim<1)throw new Error("freudenstein_roth.hess(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("freudenstein_roth.hess(x): x.shape[-1] must be 2.");var e=Int32Array.of.apply(Int32Array,x()(r.shape).concat([2])),t=new("float32"===r.dtype?Float32Array:Float64Array)(2*r.data.length);r=r.data;for(var n=t.length,a=r.length;(a-=2)>=0;){n-=4;var o=r[a+0],i=r[a+1],s=-13+o+((5-i)*i-2)*i,f=-29+o+((1+i)*i-14)*i,l=(10-3*i)*i-2,h=(2+3*i)*i-14;t[n+0]=4,t[n+1]=t[n+2]=24*i-32,t[n+3]=s*(20-12*i)+2*l*l+f*(4+12*i)+2*h*h}return new ar(e,t)},Jn.lsq=function(r){if((r=nr(r)).ndim<1)throw new Error("freudenstein_roth.lsq(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("freudenstein_roth.lsq(x): x.shape[-1] must be 2.");for(var e=r.shape.slice(),t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length),n=(r=r.data).length;(n-=2)>=0;){var a=r[n+0],o=r[n+1];t[n+0]=-13+a+((5-o)*o-2)*o,t[n+1]=-29+a+((1+o)*o-14)*o}return new ar(e,t)},Jn.lsq_jac=function(r){if((r=nr(r)).ndim<1)throw new Error("freudenstein_roth.lsq_jac(x): x.ndim must be at least 1.");if(r.shape[r.ndim-1]<2)throw new Error("freudenstein_roth.lsq_jac(x): x.shape[-1] must be 2.");for(var e=2*(r.shape[r.ndim-1]-1),t=Int32Array.of.apply(Int32Array,x()(r.shape).concat([2])),n=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length*e),a=(r=r.data).length,o=n.length;(o-=4)>=0;){r[(a-=2)+0];var i=r[a+1];n[o+0]=1,n[o+1]=(10-3*i)*i-2,n[o+2]=1,n[o+3]=(2+3*i)*i-14}return new ar(t,n)},Object.freeze(Jn);var Tn=function(r,e){return Math.atan2(r*(e<0||Object.is(e,-0)?-1:1),Math.abs(e))},Xn=function(r){if((r=nr(r)).ndim<1)throw new Error("helical_valley(x): x.ndim must be at least 1.");if(3!==r.shape[r.ndim-1])throw new Error("helical_valley(x): x.shape[-1] must be 3.");for(var e=r.shape.slice(0,-1),t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length/3),n=(r=r.data).length,a=t.length;a-- >0;){var o=r[(n-=3)+0],i=r[n+1],s=r[n+2],f=10*s-50*(Tn(i,o)/Math.PI+(o<0)),l=10*Math.hypot(i,o)-10,h=s;t[a]=f*f+l*l+h*h}return new ar(e,t)};function zn(r){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(r){return!1}}();return function(){var t,n=C()(r);if(e){var a=C()(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return Q()(this,t)}}Xn.nIn=Xn.nOut=3,Xn.minima=Xn.minima_global=Xn.roots=[[1,0,0]],Xn.grad=function(r){if((r=nr(r)).ndim<1)throw new Error("helical_valley.grad(x): x.ndim must be at least 1.");if(3!==r.shape[r.ndim-1])throw new Error("helical_valley.grad(x): x.shape[-1] must be 3.");for(var e=r.shape,t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length),n=(r=r.data).length;(n-=3)>=0;){var a=r[n+0],o=r[n+1],i=r[n+2],s=10*i-50*(Tn(o,a)/Math.PI+(a<0));t[n+0]=100*(a*(2-2/Math.hypot(o,a))+o*s/(Math.PI*(o*o+a*a))),t[n+1]=100*(o*(2-2/Math.hypot(o,a))-a*s/(Math.PI*(o*o+a*a))),t[n+2]=20*s+2*i}return new ar(e,t)},Xn.hess=function(r){if((r=nr(r)).ndim<1)throw new Error("helical_valley.hess(x): x.ndim must be at least 1.");if(3!==r.shape[r.ndim-1])throw new Error("helical_valley.hess(x): x.shape[-1] must be 2.");var e=Int32Array.of.apply(Int32Array,x()(r.shape).concat([3])),t=new("float32"===r.dtype?Float32Array:Float64Array)(3*r.data.length);r=r.data;for(var n=t.length,a=r.length;(a-=3)>=0;){n-=9;var o=r[a+0],i=r[a+1],s=10*r[a+2]-50*(Tn(i,o)/Math.PI+(o<0)),f=o*o+i*i;t[n+0]=200*(1-i*i/Math.pow(f,1.5)+(25*i/Math.PI-o*s)*i/(Math.PI*f*f)),t[n+1]=100/Math.PI*s/f+200*o*i/Math.pow(f,1.5)-(5e3*o/Math.PI+200*i*s)*i/(Math.PI*f*f),t[n+2]=1e3/Math.PI*i/f,t[n+3]=t[n+1],t[n+4]=200*(1-o*o/Math.pow(f,1.5)+(25*o/Math.PI+i*s)*o/(Math.PI*f*f)),t[n+5]=-1e3/Math.PI*o/f,t[n+6]=t[n+2],t[n+7]=t[n+5],t[n+8]=202}return new ar(e,t)},Xn.lsq=function(r){if((r=nr(r)).ndim<1)throw new Error("helical_valley.lsq(x): x.ndim must be at least 1.");if(3!==r.shape[r.ndim-1])throw new Error("helical_valley.lsq(x): x.shape[-1] must be 3.");for(var e=r.shape.slice(),t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length),n=(r=r.data).length;(n-=3)>=0;){var a=r[n+0],o=r[n+1],i=r[n+2];t[n+0]=10*i-50*(Tn(o,a)/Math.PI+(a<0)),t[n+1]=10*Math.hypot(o,a)-10,t[n+2]=i}return new ar(e,t)},Xn.lsq_jac=function(r){if((r=nr(r)).ndim<1)throw new Error("helical_valley.lsq_jac(x): x.ndim must be at least 1.");if(3!==r.shape[r.ndim-1])throw new Error("helical_valley.lsq_jac(x): x.shape[-1] must be 3.");for(var e=Int32Array.of.apply(Int32Array,x()(r.shape).concat([3])),t=new("float32"===r.dtype?Float32Array:Float64Array)(3*r.data.length),n=(r=r.data).length,a=t.length;(n-=3)>=0;){a-=9;var o=r[n+0],i=r[n+1];t[a+0]=50/Math.PI*i/(i*i+o*o),t[a+1]=-50/Math.PI*o/(i*i+o*o),t[a+2]=10,t[a+3]=10*o/Math.hypot(i,o),t[a+4]=10*i/Math.hypot(i,o),t[a+5]=0,t[a+6]=0,t[a+7]=0,t[a+8]=1}return new ar(e,t)},Object.freeze(Xn);var Un=function(r){U()(t,r);var e=zn(t);function t(r){var n;if(p()(this,t),n=e.call(this),0!=r%1)throw new Error("new JennrichSampson(m): m not a valid integer.");if(!(1<r))throw new Error("new JennrichSampson(m): m must be greater than 1.");var a=function r(e){if((e=nr(e)).ndim<1)throw new Error("".concat(r.name,"(x): x.ndim must be at least 1."));if(2!==e.shape[e.ndim-1])throw new Error("".concat(r.name,"(x): x.shape[-1] must be 2."));var t=e.shape.slice(0,-1),n=new("float32"===e.dtype?Float32Array:Float64Array)(e.data.length/2);e=e.data;for(var a=r.nOut,o=e.length,i=n.length;i-- >0;){for(var s=e[(o-=2)+0],f=e[o+1],l=0,h=a;h-- >0;){var u=4+2*h-Math.exp((h+1)*s)-Math.exp((h+1)*f);l+=u*u}n[i]=l}return new ar(t,n)};return 10===r&&(a.minima_global=a.minima=[[.25782521321500884,.25782521321500884]]),a.roots=[],a.nOut=r,Object.defineProperty(a,"name",{value:"jennrich_sampson".concat(r,"d"),writable:!1}),Object.setPrototypeOf(a,t.prototype),Q()(n,Object.freeze(a))}return g()(t,[{key:"grad",value:function(r){if((r=nr(r)).ndim<1)throw new Error("".concat(this.name,".grad(x): x.ndim must be at least 1."));if(2!==r.shape[r.ndim-1])throw new Error("".concat(this.name,".grad(x): x.shape[-1] must be 2."));var e=r.shape,t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length);r=r.data;for(var n=this.nOut,a=r.length;a>=0;)for(var o=r[(a-=2)+0],i=r[a+1],s=n;s-- >0;){var f=4+2*s-Math.exp((s+1)*o)-Math.exp((s+1)*i);t[a+0]-=2*f*(s+1)*Math.exp((s+1)*o),t[a+1]-=2*f*(s+1)*Math.exp((s+1)*i)}return new ar(e,t)}},{key:"hess",value:function(r){if((r=nr(r)).ndim<1)throw new Error("".concat(this.name,".hess(x): x.ndim must be at least 1."));if(2!==r.shape[r.ndim-1])throw new Error("".concat(this.name,".hess(x): x.shape[-1] must be 2."));var e=Int32Array.of.apply(Int32Array,x()(r.shape).concat([2])),t=new("float32"===r.dtype?Float32Array:Float64Array)(2*r.data.length);r=r.data;for(var n=this.nOut,a=t.length,o=r.length;(o-=2)>=0;){a-=4;for(var i=r[o+0],s=r[o+1],f=n;f-- >0;){var l=4+2*f-Math.exp((f+1)*i)-Math.exp((f+1)*s);t[a+0]+=2*(f+1)*(f+1)*(Math.exp((f+1)*i*2)-l*Math.exp((f+1)*i)),t[a+3]+=2*(f+1)*(f+1)*(Math.exp((f+1)*s*2)-l*Math.exp((f+1)*s)),t[a+1]+=2*(f+1)*(f+1)*Math.exp((f+1)*(i+s))}t[a+2]=t[a+1]}return new ar(e,t)}},{key:"lsq",value:function(r){if((r=nr(r)).ndim<1)throw new Error("".concat(this.name,".lsq(x): x.ndim must be at least 1."));if(2!==r.shape[r.ndim-1])throw new Error("".concat(this.name,".lsq(x): x.shape[-1] must be 2."));var e=this.nOut,t=r.shape.slice(),n=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length/2*e);t[t.length-1]=e;for(var a=(r=r.data).length,o=n.length;(o-=e)>=0;)for(var i=r[(a-=2)+0],s=r[a+1],f=e;f-- >0;)n[o+f]=4+2*f-Math.exp((f+1)*i)-Math.exp((f+1)*s);return new ar(t,n)}},{key:"lsq_jac",value:function(r){r=nr(r);var e=this.nOut;if(r.ndim<1)throw new Error("".concat(this.name,".lsq_jac(x): x.ndim must be at least 1."));if(2!==r.shape[r.ndim-1])throw new Error("".concat(this.name,".lsq_jac(x): x.shape[-1] must be 2."));for(var t=Int32Array.of.apply(Int32Array,x()(r.shape.slice(0,-1)).concat([e,2])),n=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length*e),a=(r=r.data).length,o=n.length;(o-=2*e)>=0;)for(var i=r[(a-=2)+0],s=r[a+1],f=e;f-- >0;)n[o+2*f+0]=-(f+1)*Math.exp((f+1)*i),n[o+2*f+1]=-(f+1)*Math.exp((f+1)*s);return new ar(t,n)}},{key:"nIn",get:function(){return 2}}]),t}(W()(Function));function Yn(r,e,t){if(e*=1,t*=1,isNaN(e))throw new Error("root1d_bisect(F,x1,x2): x1 must be a number.");if(isNaN(t))throw new Error("root1d_bisect(F,x1,x2): x2 must be a number.");if(!(r instanceof Function))throw new Error("root1d_bisect(F,x1,x2): F must be a function.");var n=r(e),a=r(t);if(0===n)return e;if(0===a)return t;if(n>a){var o=[a,n];n=o[0],a=o[1];var i=[t,e];e=i[0],t=i[1]}if(!(n<0))throw new Error("root1d_bisect(F,x1,x2): F(x1) and F(x2) must have opposite signs.");if(!(a>0))throw new Error("root1d_bisect(F,x1,x2): F(x1) and F(x2) must have opposite signs.");for(;;){var s=_n(e,t),f=r(s);if(0===f)return s;if(e===s)break;if(isNaN(f))throw new Error("NaN encountered.");f<0&&(e=s,n=f),f>0&&(t=s,a=f)}return Math.abs(n)<=Math.abs(a)?e:t}var Qn,Bn,Cn,Vn=function(r){if((r=nr(r)).ndim<1)throw new Error("powell_badscale(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("powell_badscale(x): x.shape[-1] must be 2.");for(var e=r.shape.slice(0,-1),t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length/2),n=(r=r.data).length,a=t.length;a-- >0;){var o=r[(n-=2)+0],i=r[n+1],s=1e4*o*i-1,f=Math.exp(-o)+Math.exp(-i)-1.0001;t[a]=s*s+f*f}return new ar(e,t)};function Wn(r){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(r){return!1}}();return function(){var t,n=C()(r);if(e){var a=C()(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return Q()(this,t)}}Vn.nIn=Vn.nOut=2,Vn.minima_global=Vn.roots=[[Qn=10981593296998175e-21,Bn=9.106146739866524],[Bn,Qn]],Vn.minima=(Cn=Yn((function(r){return 1e4*(1e4*r*r-1)*r+Math.exp(-r)*(1e-4-Math.expm1(-r)-Math.exp(-r))}),-.02,-5e-4),[].concat(x()(Vn.minima_global),[[Cn,Cn]])),Vn.grad=function(r){if((r=nr(r)).ndim<1)throw new Error("powell_badscale.grad(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("powell_badscale.grad(x): x.shape[-1] must be 2.");for(var e=r.shape,t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length),n=(r=r.data).length;(n-=2)>=0;){var a=r[n+0],o=r[n+1],i=1e4*a*o-1,s=Math.exp(-a)+Math.exp(-o)-1.0001;t[n+0]=2*(1e4*i*o-s*Math.exp(-a)),t[n+1]=2*(1e4*i*a-s*Math.exp(-o))}return new ar(e,t)},Vn.hess=function(r){if((r=nr(r)).ndim<1)throw new Error("powell_badscale.hess(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("powell_badscale.hess(x): x.shape[-1] must be 2.");var e=Int32Array.of.apply(Int32Array,x()(r.shape).concat([2])),t=new("float32"===r.dtype?Float32Array:Float64Array)(2*r.data.length);r=r.data;for(var n=t.length,a=r.length;(a-=2)>=0;){n-=4;var o=r[a+0],i=r[a+1],s=1e4*o*i-1,f=Math.exp(-o)+Math.exp(-i)-1.0001;t[n+0]=2*(1e8*i*i+f*Math.exp(-o)+Math.exp(-2*o)),t[n+1]=t[n+2]=2*(1e4*s+1e8*o*i+Math.exp(-o-i)),t[n+3]=2*(1e8*o*o+f*Math.exp(-i)+Math.exp(-2*i))}return new ar(e,t)},Vn.lsq=function(r){if((r=nr(r)).ndim<1)throw new Error("powell_badscale.lsq(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("powell_badscale.lsq(x): x.shape[-1] must be 2.");for(var e=r.shape.slice(),t=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length),n=(r=r.data).length;(n-=2)>=0;){var a=r[n+0],o=r[n+1];t[n+0]=1e4*a*o-1,t[n+1]=Math.exp(-a)+Math.exp(-o)-1.0001}return new ar(e,t)},Vn.lsq_jac=function(r){if((r=nr(r)).ndim<1)throw new Error("powell_badscale.lsq_jac(x): x.ndim must be at least 1.");if(2!==r.shape[r.ndim-1])throw new Error("powell_badscale.lsq_jac(x): x.shape[-1] must be 2.");for(var e=Int32Array.of.apply(Int32Array,x()(r.shape).concat([2])),t=new("float32"===r.dtype?Float32Array:Float64Array)(2*r.data.length),n=(r=r.data).length,a=t.length;(a-=4)>=0;){var o=r[(n-=2)+0],i=r[n+1];t[a+0]=1e4*i,t[a+1]=1e4*o,t[a+2]=-Math.exp(-o),t[a+3]=-Math.exp(-i)}return new ar(e,t)},Object.freeze(Vn);var Kn=function(){for(var r=function(r){return r+10*Math.PI*Math.sin(2*Math.PI*r)},e=[],t=1;t<32;t++){if(!(r(t-.25)<0))throw new Error("Assertion failed.");if(!(r(t+.25)>0))throw new Error("Assertion failed.");e.push(Yn(r,t-.25,t+.25))}return Object.freeze(e),e}(),Hn=function(r){U()(t,r);var e=Wn(t);function t(r){var n;if(p()(this,t),n=e.call(this),0!=r%1)throw new Error("new Rastrigin(n): n not a valid integer.");if(!(0<r))throw new Error("new Rastrigin(n): n must be positive.");var a=function r(e){e=nr(e);var t=r.nIn;if(e.ndim<1)throw new Error("".concat(r.name,"(x): x.ndim must be at least 1."));if(e.shape[e.ndim-1]!==t)throw new Error("".concat(r.name,"(x): x.shape[-1] must be ").concat(t,"."));for(var n=e.shape.slice(0,-1),a=new("float32"===e.dtype?Float32Array:Float64Array)(e.data.length/t),o=(e=e.data).length,i=a.length;i-- >0;){o-=t;for(var s=t;s-- >0;){var f=e[o+s];a[i]+=f*f+10*(1-Math.cos(2*Math.PI*f))}}return new ar(n,a)};return a.nIn=r,a.roots=a.minima_global=[Array.from({length:r},(function(){return 0}))],a.minima=Sn()({},Symbol.iterator,M.a.mark((function e(){var t,n,a,o,i,s;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Array.from({length:r},(function(){return 0}));case 2:n=[0],a=0;case 4:if(!(a<Kn.length)){e.next=20;break}o=Kn[a],t=n,n=[-o].concat(x()(t),[+o]),i=Array.from({length:r},(function(){return n})),s=0;case 10:if(!(s<r)){e.next=17;break}return i[s]=[-o,+o],e.delegateYield(re.apply(void 0,x()(i)),"t0",13);case 13:i[s]=t;case 14:s++,e.next=10;break;case 17:a++,e.next=4;break;case 20:case"end":return e.stop()}}),e)}))),Object.defineProperty(a,"name",{value:"rastrigin".concat(r,"d"),writable:!1}),Object.setPrototypeOf(a,t.prototype),Q()(n,Object.freeze(a))}return g()(t,[{key:"grad",value:function(r){r=nr(r);var e=this.nIn;if(r.ndim<1)throw new Error("".concat(this.name,".grad(x): x.ndim must be at least 1."));if(r.shape[r.ndim-1]!==e)throw new Error("".concat(this.name,".grad(x): x.shape[-1] must be ").concat(e,"."));for(var t=r.shape,n=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length),a=(r=r.data).length;a>=0;){a-=e;for(var o=e;o-- >0;){var i=r[a+o];n[a+o]=2*i+20*Math.PI*Math.sin(2*Math.PI*i)}}return new ar(t,n)}},{key:"hess",value:function(r){r=nr(r);var e=this.nIn;if(r.ndim<1)throw new Error("".concat(this.name,".hess(x): x.ndim must be at least 1."));if(r.shape[r.ndim-1]!==e)throw new Error("".concat(this.name,".hess(x): x.shape[-1] must be ").concat(e,"."));var t=Int32Array.of.apply(Int32Array,x()(r.shape).concat([e])),n=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length*e);r=r.data;for(var a=n.length,o=r.length;(o-=e)>=0;){a-=e*e;for(var i=e;i-- >0;){var s=r[o+i];n[a+e*i+i]+=2+Math.PI*Math.PI*40*Math.cos(2*Math.PI*s)}}return new ar(t,n)}},{key:"lsq",value:function(r){r=nr(r);var e=this.nIn;if(r.ndim<1)throw new Error("".concat(this.name,".lsq(x): x.ndim must be at least 1."));if(r.shape[r.ndim-1]!==e)throw new Error("".concat(this.name,".lsq(x): x.shape[-1] must be ").concat(e,"."));for(var t=r.shape,n=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length),a=(r=r.data).length,o=n.length;(o-=e)>=0;){a-=e;for(var i=e;i-- >0;){var s=r[a+i];n[o+i]=Math.sqrt(s*s+10*(1-Math.cos(2*Math.PI*s)))}}return new ar(t,n)}},{key:"lsq_jac",value:function(r){r=nr(r);var e=this.nIn;if(r.ndim<1)throw new Error("".concat(this.name,".lsq_jac(x): x.ndim must be at least 1."));if(r.shape[r.ndim-1]!==e)throw new Error("".concat(this.name,".lsq_jac(x): x.shape[-1] must be ").concat(e,"."));for(var t=Int32Array.of.apply(Int32Array,x()(r.shape).concat([e])),n=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length*e),a=(r=r.data).length,o=n.length;(o-=e*e)>=0;){a-=e;for(var i=e;i-- >0;){var s=r[a+i],f=Math.sqrt(s*s+10*(1-Math.cos(2*Math.PI*s)));0!==f&&(n[o+e*i+i]=(s+10*Math.PI*Math.sin(2*Math.PI*s))/f)}}return new ar(t,n)}},{key:"nOut",get:function(){return this.nIn}}]),t}(W()(Function));function $n(r){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(r){return!1}}();return function(){var t,n=C()(r);if(e){var a=C()(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return Q()(this,t)}}var Zn=function(r){U()(t,r);var e=$n(t);function t(r){var n;if(p()(this,t),n=e.call(this),0!=r%1)throw new Error("new Rosenbrock(n): n not a valid integer.");if(!(1<r))throw new Error("new Rosenbrock(n): n must be greater than 1.");var a=function r(e){e=nr(e);var t=r.nIn;if(e.ndim<1)throw new Error("".concat(r.name,"(x): x.ndim must be at least 1."));if(e.shape[e.ndim-1]!==t)throw new Error("".concat(r.name,"(x): x.shape[-1] must be ").concat(t,"."));for(var n=e.shape.slice(0,-1),a=new("float32"===e.dtype?Float32Array:Float64Array)(e.data.length/t),o=(e=e.data).length,i=a.length;i-- >0;){o-=t;for(var s=t-1;s-- >0;){var f=e[o+s+1],l=e[o+s],h=f-l*l,u=1-l;a[i]+=100*h*h+u*u}}return new ar(n,a)};return 2==r?a.minima=[[1,1]]:3==r&&(a.minima=[[1,1,1]]),r<=7&&(a.roots=[Array.from({length:r},(function(){return 1}))]),r<=7&&(a.minima_global=[Array.from({length:r},(function(){return 1}))]),a.nIn=r,Object.defineProperty(a,"name",{value:"rosenbrock".concat(r,"d"),writable:!1}),Object.setPrototypeOf(a,t.prototype),Q()(n,Object.freeze(a))}return g()(t,[{key:"grad",value:function(r){r=nr(r);var e=this.nIn;if(r.ndim<1)throw new Error("".concat(this.name,".grad(x): x.ndim must be at least 1."));if(r.shape[r.ndim-1]!==e)throw new Error("".concat(this.name,".grad(x): x.shape[-1] must be ").concat(e,"."));for(var t=r.shape,n=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length),a=(r=r.data).length;a>=0;){a-=e;for(var o=e;o-- >0;){var i=r[a+o-1],s=r[a+o],f=r[a+o+1];o<e-1&&(n[a+o]=400*(s*s-f)*s-2*(1-s)),0<o&&(n[a+o]+=200*(s-i*i))}}return new ar(t,n)}},{key:"hess",value:function(r){r=nr(r);var e=this.nIn;if(r.ndim<1)throw new Error("".concat(this.name,".hess(x): x.ndim must be at least 1."));if(r.shape[r.ndim-1]!==e)throw new Error("".concat(this.name,".hess(x): x.shape[-1] must be ").concat(e,"."));var t=Int32Array.of.apply(Int32Array,x()(r.shape).concat([e])),n=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length*e);r=r.data;for(var a=n.length,o=r.length;(o-=e)>=0;){a-=e*e;for(var i=e;i-- >0;)if(0<i&&(n[a+e*i+i]=200,n[a+e*(i-1)+i]=n[a+e*i+(i-1)]=-400*r[o+i-1]),i<e-1){var s=r[o+i];n[a+e*i+i]-=400*r[o+i+1]-1200*s*s-2}}return new ar(t,n)}},{key:"lsq",value:function(r){r=nr(r);var e=this.nIn,t=this.nOut;if(r.ndim<1)throw new Error("".concat(this.name,".lsq(x): x.ndim must be at least 1."));if(r.shape[r.ndim-1]!==e)throw new Error("".concat(this.name,".lsq(x): x.shape[-1] must be ").concat(e,"."));var n=r.shape.slice(),a=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length/e*t);n[n.length-1]=t;for(var o=(r=r.data).length,i=a.length;(i-=t)>=0;){o-=e;for(var s=e-1;s-- >0;){var f=r[o+s+1],l=r[o+s],h=f-l*l,u=1-l;a[i+2*s+0]=10*h,a[i+2*s+1]=u}}return new ar(n,a)}},{key:"lsq_jac",value:function(r){r=nr(r);var e=this.nIn,t=this.nOut;if(r.ndim<1)throw new Error("".concat(this.name,".lsq_jac(x): x.ndim must be at least 1."));if(r.shape[r.ndim-1]!==e)throw new Error("".concat(this.name,".lsq_jac(x): x.shape[-1] must be ").concat(e,"."));for(var n=Int32Array.of.apply(Int32Array,x()(r.shape.slice(0,-1)).concat([t,e])),a=new("float32"===r.dtype?Float32Array:Float64Array)(r.data.length*t),o=(r=r.data).length,i=a.length;(i-=t*e)>=0;){o-=e;for(var s=e-1;s-- >0;){var f=s+1,l=(r[o+f],r[o+s]);a[i+e*(2*s+0)+s]+=-20*l,a[i+e*(2*s+0)+f]+=10,a[i+e*(2*s+1)+s]-=1}}return new ar(n,a)}},{key:"nOut",get:function(){return 2*this.nIn-2}}]),t}(W()(Function));function ra(r){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(r){return!1}}();return function(){var t,n=C()(r);if(e){var a=C()(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return Q()(this,t)}}var ea=function(r){U()(t,r);var e=ra(t);function t(){return p()(this,t),e.apply(this,arguments)}return t}(W()(Error)),ta=function(r){U()(t,r);var e=ra(t);function t(){return p()(this,t),e.apply(this,arguments)}return t}(ea),na=M.a.mark(aa);function aa(r){var e,t,n,a,o,i,s,f,l,h=arguments;return M.a.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:if(e=h.length>1&&void 0!==h[1]?h[1]:function(r,e){return(r>e)-(r<e)},r.length%1==0){u.next=3;break}throw new Error("Assertion failed.");case 3:if(r.length>=0){u.next=5;break}throw new Error("Assertion failed.");case 5:if(e instanceof Function){u.next=7;break}throw new Error("Assertion failed.");case 7:for(t=0,n=r.length,a=function(t,n){return e(r[t],r[n])<0},o=function(e,t){var n=r[e];r[e]=r[t],r[t]=n},i=function(r){return n-1-(n-2-r>>1)},s=function(r){return n-2-(n-1-r<<1)},f=function r(e){var n=s(e);n>t?(a(n,n-1)||--n,a(n,e)&&(o(n,e),r(n))):n===t&&a(n,e)&&o(n,e)},l=i(0);l<n;l++)f(l);case 13:if(!(t<n)){u.next=20;break}return o(t,n-1),u.next=17,r[t++];case 17:f(n-1),u.next=13;break;case 20:case"end":return u.stop()}}),na)}function oa(r,e){var t;if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(t=function(r,e){if(!r)return;if("string"==typeof r)return ia(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);"Object"===t&&r.constructor&&(t=r.constructor.name);if("Map"===t||"Set"===t)return Array.from(r);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ia(r,e)}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){t=r[Symbol.iterator]()},n:function(){var r=t.next();return i=r.done,r},e:function(r){s=!0,o=r},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw o}}}}function ia(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}var sa=function(r,e){if(r.length%1!=0)throw new Error("Assertion failed.");if(e.length%1!=0)throw new Error("Assertion failed.");if(r.length!==e.length)throw new Error("Assertion failed.");for(var t=0,n=r.length;n-- >0;)t+=r[n]*e[n];return t},fa=function(){function r(e,t){if(p()(this,r),e%1!=0)throw new Error("Assertion failed.");if(t%1!=0)throw new Error("Assertion failed.");if(!(0<e))throw new Error("Assertion failed.");if(!(0<t))throw new Error("Assertion failed.");this.m=0,this.M=0|e,this.N=0|t,this._scale=1,this.dX=new Float64Array(e*t),this.dG=new Float64Array(e*t),this.dXdX=new Float64Array(e*e),this.dXdG=new Float64Array(e*e),this.dGdG=new Float64Array(e*e),this.D=new Float64Array(e),this._J=new Float64Array(e*e),this._J_invalid=!0,this.travels=new Float64Array(t),this.Bdx=new Float64Array(2*e),this.Bg=new Float64Array(2*e),this.Bei=new Float64Array(2*e),this.M_WAAW=new Float64Array(4*e*e),this.P=new Int32Array(2*e)}return g()(r,[{key:"forget",value:function(r){var e=this.m,t=this.M,n=this.N,a=this.dX,o=this.dXdX,i=this.dG,s=this.dXdG,f=this.dGdG,l=this.D;if(e>t)throw new Error("Assertion failed.");if(r%1!=0)throw new Error("Assertion failed.");if(!(r>0))throw new Error("Assertion failed.");if(!(r<=e))throw new Error("Assertion failed.");for(var h=0,u=[a,i];h<u.length;h++)for(var c=u[h],d=r;d<e;d++)for(var w=0;w<n;w++)c[n*(d-r)+w]=c[n*d+w];for(var v=0,p=[o,s,f];v<p.length;v++)for(var m=p[v],g=r;g<e;g++)for(var y=r;y<e;y++)m[t*(g-r)+(y-r)]=m[t*g+y];for(var b=r;b<e;b++)l[b-r]=l[b];this.m=e-r,this._J_invalid=!0}},{key:"update",value:function(r,e){var t=this.M,n=this.N,a=this.dX,o=this.dXdX,i=this.dG,s=this.dXdG,f=this.dGdG,l=this.D;if(n!==r.length)throw new Error("Assertion failed.");if(n!==e.length)throw new Error("Assertion failed.");this.m>=t&&this.forget(1),this.m++;var h=this.m,u=h-1;if(h>t)throw new Error("Assertion failed.");for(var c=0;c<n;c++)a[n*u+c]=r[c];for(var d=0;d<n;d++)i[n*u+d]=e[d];for(var w=0;w<h;w++){for(var v=0,p=0;p<n;p++)v+=a[n*u+p]*a[n*w+p];o[t*u+w]=o[t*w+u]=v}for(var m=0;m<h;m++){s[t*u+m]=0;for(var g=0;g<n;g++)s[t*u+m]+=a[n*u+g]*i[n*m+g];s[t*m+u]=0;for(var y=0;y<n;y++)s[t*m+u]+=a[n*m+y]*i[n*u+y]}l[u]=Math.sqrt(s[t*u+u]);for(var b=0;b<h;b++){for(var E=0,_=0;_<n;_++)E+=i[n*u+_]*i[n*b+_];f[t*u+b]=f[t*b+u]=E}this._J_invalid=!0}},{key:"_compute_Bv",value:function(r,e){var t=this.m,n=this.M,a=this.N,o=this.dG,i=this.dXdG,s=this.dX,f=this.J,l=this.D,h=this.scale;if(r.length!==2*n)throw new Error("Assertion failed.");if(e.length!==a)throw new Error("Assertion failed.");for(var u=2*t;u-- >t;)r[u]*=-1;_e(t,n,1,f,0,r,t);for(var c=0;c<t;c++)r[c]/=l[c];for(var d=1;d<t;d++)for(var w=0;w<d;w++)r[w]+=i[n*d+w]*r[t+d]/i[n*w+w];for(var v=a;v-- >0;)for(var p=t;p-- >0;)e[v]+=s[a*p+v]*r[t+p]*h;for(var m=a;m-- >0;)for(var g=t;g-- >0;)e[m]+=o[a*g+m]*r[g]}},{key:"compute_Bv",value:function(r,e){var t=this.N,n=this.scale,a=this.Bg;if(r.length!==t)throw new Error("Assertion failed.");this.compute_bv(r,a);for(var o=t;o-- >0;)e[o]=r[o]*n;this._compute_Bv(a,e)}},{key:"compute_bv",value:function(r,e){var t=this.m,n=this.M,a=this.N,o=this.dG,i=this.dXdG,s=this.dX,f=this.J,l=this.D,h=this.scale;if(r.length!==a)throw new Error("Assertion failed.");if(e.length!==2*n)throw new Error("Assertion failed.");e.fill(0,0,2*t);for(var u=0;u<t;u++)for(var c=0;c<a;c++)e[u]+=o[a*u+c]*r[c];for(var d=1;d<t;d++)for(var w=0;w<d;w++)e[t+d]+=i[n*d+w]*e[w]/i[n*w+w];for(var v=0;v<t;v++)e[v]/=l[v];for(var p=0;p<t;p++)for(var m=0;m<a;m++)e[t+p]+=s[a*p+m]*r[m]*h;be(t,n,1,f,0,e,t)}},{key:"compute_be",value:function(r,e){var t=this.m,n=this.M,a=this.N,o=this.dG,i=this.dXdG,s=this.dX,f=this.J,l=this.D,h=this.scale;if(r%1!=0)throw new Error("Assertion failed.");if(!((r|=0)>=0))throw new Error("Assertion failed.");if(!(r<a))throw new Error("Assertion failed.");if(e.length!==2*n)throw new Error("Assertion failed.");e.fill(0,0,2*t);for(var u=0;u<t;u++)e[u]+=o[a*u+r];for(var c=1;c<t;c++)for(var d=0;d<c;d++)e[t+c]+=i[n*c+d]*e[d]/i[n*d+d];for(var w=0;w<t;w++)e[w]/=l[w];for(var v=0;v<t;v++)e[t+v]+=s[a*v+r]*h;be(t,n,1,f,0,e,t)}},{key:"compute_ubbv",value:function(r,e,t){var n=this.m,a=this.M;if(e*=this.scale,isNaN(e))throw new Error("Assertion failed.");if(r.length!==2*a)throw new Error("Assertion failed.");if(t.length!==2*a)throw new Error("Assertion failed.");for(var o=0,i=2*n;i-- >n;)o-=r[i]*t[i];for(var s=n;s-- >0;)o+=r[s]*t[s];return o+e}},{key:"compute_cauchyGeneralized",value:function(r,e,t,n){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=this.m,i=this.N,s=this.Bg,f=this.Bdx,l=this.Bei,h=this.scale,u=this.travels;if(r.length!==i)throw new Error("Assertion failed.");if(e.length!==i)throw new Error("Assertion failed.");if(t.length!==2*i)throw new Error("Assertion failed.");if(n.length!==i)throw new Error("Assertion failed.");if(!n.slice().sort((function(r,e){return r-e})).every((function(r,e){return r===e})))throw new Error("Assertion failed.");for(var c=i;c-- >0;){if(!(e[c]>=t[2*c+0]))throw new Error("Assertion failed.");if(!(e[c]<=t[2*c+1]))throw new Error("Assertion failed.")}for(var d=i;d-- >0;)if(0===r[d])u[d]=1/0;else{var w=t[2*d+(r[d]<0)];if(u[d]=(e[d]-w)/r[d],!(0<=u[d]))throw new Error("Assertion failed: "+u[d]);for(var v=0;Math.sign(r[d])*(e[d]-u[d]*r[d]-w)<0;){if(++v>2)throw new Error("Assertion failed.");u[d]=En(u[d])}if(r[d]<0&&e[d]-u[d]*r[d]>w)throw new Error("Assertion failed.");if(r[d]>0&&e[d]-u[d]*r[d]<w)throw new Error("Assertion failed.")}var p=0,m=0;this.compute_bv(r,s),f.fill(0,0,2*o);var g,y=sa(r,r),b=this.compute_ubbv(s,y,s),E=0,_=aa(n,(function(e,t){var n=u[e],a=u[t];return n<a?-1:n>a?1:Math.abs(r[t])-Math.abs(r[e])})),x=oa(_);try{r:for(x.s();!(g=x.n()).done;){var A=g.value;if(0===r[A]){var M,k=oa(n.subarray(m));try{for(k.s();!(M=k.n()).done;){var N=M.value;if(!(Number.MAX_VALUE<u[N]))throw new Error("Assertion failed.");if(0!==r[N])throw new Error("Assertion failed.")}}catch(r){k.e(r)}finally{k.f()}break r}var F=t[2*A+(r[A]<0)],I=u[A]-p;if(!(0<=I))throw new Error("Assertion failed.");if(0!==I){var P=Math.min(I,y/b);if(!(a||P>=I))break r;if(0<P){for(var q=2*o;q-- >0;)f[q]-=P*s[q];p+=P}if(a&&!(P>=I))break r;p=u[A],this.compute_be(A,l);var S=this.compute_ubbv(l,-p*r[A],f),j=this.compute_ubbv(l,1,l),O=this.compute_ubbv(l,r[A],s);y-=r[A]*(r[A]+S)+I*b,b+=r[A]*(r[A]*j-2*O);for(var R=2*o;R-- >0;)s[R]-=r[A]*l[R];E+=r[A]*r[A]*p*(p*h/2-1),e[A]=F,r[A]*=1-p*h,++m}else e[A]=F,p=u[A],++m}}catch(r){x.e(r)}finally{x.f()}var L,D=oa(n.subarray(m));try{for(D.s();!(L=D.n()).done;){var G=L.value;if(E+=r[G]*r[G]*p*(p*h/2-1),e[G]-=p*r[G],r[G]*=1-p*h,!(e[G]>=t[2*G+0]))throw new Error("Assertion failed.");if(!(e[G]<=t[2*G+1]))throw new Error("Assertion failed.")}}catch(r){D.e(r)}finally{D.f()}return E+=.5*this.compute_ubbv(f,0,f),this._compute_Bv(f,r),[m,E]}},{key:"compute_subspace_Hv",value:function(r,e,t,n){var a=this.m,o=this.M,i=this.N,s=this.dX,f=this.dXdG,l=this.dG,h=this.dGdG,u=this.M_WAAW,c=this.Bei,d=this.scale;if(!(t instanceof Int32Array))throw new Error("Assertion failed.");if(r.length!==i)throw new Error("Assertion failed.");if(e.length!==i)throw new Error("Assertion failed.");if(t.length!==i)throw new Error("Assertion failed.");if(n%1!=0)throw new Error("Assertion failed.");if(!(n>=0))throw new Error("Assertion failed.");if(!(n<=i))throw new Error("Assertion failed.");if(!t.slice().sort((function(r,e){return r-e})).every((function(r,e){return r===e})))throw new Error("Assertion failed.");for(var w=t.subarray(n),v=0;v<a;v++){var p,m=0,g=oa(w);try{for(g.s();!(p=g.n()).done;){var y=p.value;m+=l[i*v+y]*r[y]}}catch(r){g.e(r)}finally{g.f()}c[v]=m/d}for(var b=0;b<a;b++){var E,_=0,x=oa(w);try{for(x.s();!(E=x.n()).done;){var A=E.value;_+=s[i*b+A]*r[A]}}catch(r){x.e(r)}finally{x.f()}c[a+b]=_}if(0<n){for(var M=t.subarray(0,n),k=0;k<a;k++)for(var N=0;N<=k;N++){var F,I=0,P=oa(M);try{for(P.s();!(F=P.n()).done;){var q=F.value;I+=l[i*k+q]*l[i*N+q]}}catch(r){P.e(r)}finally{P.f()}u[2*a*k+N]=I}for(var S=0;S<a;S++)for(var j=0;j<a;j++){var O,R=0,L=oa(M);try{for(L.s();!(O=L.n()).done;){var D=O.value;R+=s[i*S+D]*l[i*j+D]}}catch(r){L.e(r)}finally{L.f()}u[2*a*(a+S)+j]=R}for(var G=0;G<a;G++)for(var J=0;J<=G;J++){var T,X=0,z=oa(M);try{for(z.s();!(T=z.n()).done;){var U=T.value;X+=s[i*G+U]*s[i*J+U]}}catch(r){z.e(r)}finally{z.f()}u[2*a*(a+G)+(a+J)]=X*d}}else for(var Y=0;Y<2*a;Y++)for(var Q=0;Q<=Y;Q++)u[2*a*Y+Q]=0;for(var B=0;B<a;B++)for(var C=0;C<=B;C++)u[2*a*B+C]-=h[o*B+C],u[2*a*B+C]/=d;for(var V=0;V<a;V++)u[2*a*V+V]-=f[o*V+V];for(var W=0;W<a;W++)for(var K=W;K<a;K++)u[2*a*(a+W)+K]-=f[o*W+K];if(0<a){var H=this.Bdx,$=this.P;Gt(2*a,2*a,u,0,$,0),Ut(2*a,2*a,1,u,0,$,0,c,0,H)}e.fill(0,0,i);for(var Z=0;Z<a;Z++){var rr,er=oa(w);try{for(er.s();!(rr=er.n()).done;){var tr=rr.value;e[tr]+=l[i*Z+tr]*c[Z]}}catch(r){er.e(r)}finally{er.f()}}var nr,ar=oa(w);try{for(ar.s();!(nr=ar.n()).done;){e[nr.value]/=d}}catch(r){ar.e(r)}finally{ar.f()}for(var or=0;or<a;or++){var ir,sr=oa(w);try{for(sr.s();!(ir=sr.n()).done;){var fr=ir.value;e[fr]+=s[i*or+fr]*c[a+or]}}catch(r){sr.e(r)}finally{sr.f()}}var lr,hr=oa(w);try{for(hr.s();!(lr=hr.n()).done;){var ur=lr.value;e[ur]+=r[ur]/d}}catch(r){hr.e(r)}finally{hr.f()}}},{key:"compute_Hv",value:function(r,e){var t=this.m,n=this.M,a=this.N,o=this.dX,i=this.dXdG,s=this.dG,f=this.dGdG,l=this.M_WAAW,h=this.Bei,u=this.scale;if(r.length!==a)throw new Error("Assertion failed.");if(e.length!==a)throw new Error("Assertion failed.");for(var c=0;c<t;c++){for(var d=0,w=0;w<a;w++)d+=s[a*c+w]*r[w];h[c]=d/u}for(var v=0;v<t;v++){for(var p=0,m=0;m<a;m++)p+=o[a*v+m]*r[m];h[t+v]=p}for(var g=0;g<2*t;g++)for(var y=0;y<=g;y++)l[2*t*g+y]=0;for(var b=0;b<t;b++)for(var E=0;E<=b;E++)l[2*t*b+E]-=f[n*b+E],l[2*t*b+E]/=u;for(var _=0;_<t;_++)l[2*t*_+_]-=i[n*_+_];for(var x=0;x<t;x++)for(var A=x;A<t;A++)l[2*t*(t+x)+A]-=i[n*x+A];if(0<t){var M=this.Bdx,k=this.P;Gt(2*t,2*t,l,0,k,0),Ut(2*t,2*t,1,l,0,k,0,h,0,M)}e.fill(0,0,a);for(var N=0;N<t;N++)for(var F=0;F<a;F++)e[F]+=s[a*N+F]*h[N];for(var I=0;I<a;I++)e[I]/=u;for(var P=0;P<t;P++)for(var q=0;q<a;q++)e[q]+=o[a*P+q]*h[t+P];for(var S=0;S<a;S++)e[S]+=r[S]/u}},{key:"J",get:function(){var r=this.m,e=this.M,t=(this.N,this.dXdX),n=this.dXdG,a=this.scale,o=this._J;if(this._J_invalid){this._J_invalid=!1;for(var i=0;i<r;i++)for(var s=0;s<=i;s++)o[e*i+s]=a*t[e*i+s];for(var f=0;f<r;f++)for(var l=0;l<=f;l++)for(var h=0;h<l;h++)o[e*f+l]+=n[e*f+h]/n[e*h+h]*n[e*l+h];ke(r,e,o,0)}return o}},{key:"scale",get:function(){return this._scale},set:function(r){if(r*=1,isNaN(r))throw new Error("Assertion failed.");if(!(0<r))throw new Error("Assertion failed.");this._scale!==r&&(this._scale=r,this._J_invalid=!0)}}]),r}(),la=function(r,e){if(r.length%1!=0)throw new Error("Assertion failed.");if(e.length%1!=0)throw new Error("Assertion failed.");if(r.length!==e.length)throw new Error("Assertion failed.");for(var t=0,n=r.length;n-- >0;)t+=r[n]*e[n];return t},ha=function(){function r(e,t,n){var a=n.updateTol,o=n.historySize,i=n.scaleInit;if(p()(this,r),!(e instanceof Function))throw new Error("new TrustRegionSolverLBFGS(fg, x0, updateTol): fg must be Function.");if(!(0<(i*=1)))throw new Error("TrustRegionSolverLBFGS(fg,x0,opt): opt.scaleInit must be greater than 0.");if(!isFinite(i))throw new Error("TrustRegionSolverLBFGS(fg,x0,opt): opt.scaleInit must be greater than 0.");if(this.fg=e,this.report_x=t=tr("float64",t),1!==t.ndim)throw new Error("new TrustRegionSolverLBFGS(fg, x0, updateTol): x0.ndim must be 1.");var s=e(new ar(t.shape,t.data.slice())),f=T()(s,2),l=f[0],h=f[1];if(this.report_loss=l*=1,this.report_loss_grad=h=tr("float64",h),isNaN(l))throw new Error("new TrustRegionSolverLBFGS(fg, x0, updateTol): fg must have signature float[N] => [float,float[N]].");if(1!==h.ndim)throw new Error("new TrustRegionSolverLBFGS(fg, x0, updateTol): fg must have signature float[N] => [float,float[N]].");var u=T()(t.shape,1)[0];if(h.shape[0]!==u)throw new Error("new TrustRegionSolverLBFGS(fg, x0, updateTol): fg must have signature float[N] => [float,float[N]].");this.M=o,this.N=u,this.scaleInit=i=1/i,this.lbfgs=new fa(o,u),this.lbfgs.scale=i,this.D=new Float64Array(u),this.D.fill(Math.sqrt(i)),this.X0=Float64Array.from(t),this.G0=Float64Array.from(h),this.last_X=Float64Array.from(t),this.last_G=Float64Array.from(h),this.dg=new Float64Array(u),this.loss=l,this.bv=new Float64Array(2*o),this.newton_dX=new Float64Array(u),this.updateTol=a,this._report_state=1,Object.seal(this)}return g()(r,[{key:"wiggle",value:function(){var r=this.lbfgs,e=r.m;if(0===e)throw new ta("Too many unsuccessfull iterations.");if(!(0<e))throw new Error("Assertion failed.");r.forget(r.m+1>>>1)}},{key:"report",value:function(){if(1!==this._report_state)throw new Error("TrustRegionSolverLSQ::report: can only be called once after each makeConsideredMove() but not directly after considerMove(dX).");this._report_state=2;var r=[this.report_x,this.report_loss,this.report_loss_grad];return this.report_x=this.report_loss_grad=null,this.report_loss=NaN,r}},{key:"considerMove",value:function(r){var e=this.N,t=this.D,n=this.updateTol,a=this.lbfgs,o=this.loss,i=this.bv,s=this.X0,f=this.G0,l=this.dg,h=this.last_X,u=this.last_G;this.scaleSharpness;if(this._report_state=3,e!==r.length)throw new Error("Assertion failed.");for(var c=Int32Array.of(e),d=new Float64Array(e),w=e;w-- >0;)d[w]=s[w]+r[w];var v=this.fg(new ar(c,d.slice())),p=T()(v,2),m=p[0],g=p[1];if(m*=1,g=tr("float64",g),isNaN(m))throw new Error("Assertion failed.");if(1!==g.ndim)throw new Error("Assertion failed.");if(g.shape[0]!==e)throw new Error("Assertion failed.");this.report_x=new ar(c,d),this.report_loss=m,this.report_loss_grad=g,g=g.data;for(var y=e;y-- >0;)d[y]-=s[y];for(var b=o,E=e;E-- >0;)b+=f[E]*d[E];a.compute_bv(d,i),b+=.5*a.compute_ubbv(i,la(d,d),i);for(var _=d,x=e;x-- >0;)l[x]=g[x]-u[x];for(var A=e;A-- >0;)_[A]=s[A]+r[A],_[A]-=h[A];var M=l.reduce((function(r,e){return Math.max(r,Math.abs(e))}),0);if(0<M){for(var k=0,N=0,F=e;F-- >0;){var I=_[F]/M,P=l[F]/M;k+=P*P,N+=I*P}if(1<=k){if(!isFinite(N))throw new Error("Assertion failed.");if(n*k<N){a.update(_,l),a.scale=k/N;for(var q=e;q-- >0;){a.compute_be(q,i);var S=a.compute_ubbv(i,1,i);if(!(0<S))throw new Error("Assertion failed: LBFGS model not positive definite.");t[q]=Math.max(t[q],Math.sqrt(S))}for(var j=e;j-- >0;)h[j]=s[j]+r[j];for(var O=e;O-- >0;)u[O]=g[O]}}}for(var R=e;R-- >0;)d[R]=s[R]+r[R];return[b,this.report_loss]}},{key:"makeConsideredMove",value:function(){if(3!==this._report_state)throw new Error("Assertion failed.");this._report_state=1,this.loss=this.report_loss;for(var r=this.N,e=this.X0,t=this.G0,n=this.report_x.data,a=this.report_loss_grad.data,o=r;o-- >0;)e[o]=n[o];for(var i=r;i-- >0;)t[i]=a[i]}},{key:"scaledNorm",value:function(r){var e=this.N,t=this.D;if(r.length!==e)throw new Error("Assertion failed.");for(var n=new le,a=e;a-- >0;)n.include(t[a]*r[a]);return n.result}},{key:"cauchyTravel",value:function(){for(var r=this.N,e=this.lbfgs,t=this.G0,n=this.bv,a=0,o=r;o-- >0;)a+=t[o]*t[o];e.compute_bv(t,n);var i=e.compute_ubbv(n,la(t,t),n);if(isNaN(i))throw new Error("Assertion failed: "+i);return 0===a?0:0===i?-1/0:-a/i}},{key:"computeNewton",value:function(){var r=this.N,e=this.lbfgs,t=this.G0,n=this.newton_dX;if(e.compute_Hv(t,n),n.some(isNaN))throw new Error("Assertion failed.");for(var a=r;a-- >0;)n[a]*=-1}}]),r}(),ua=function(){function r(e,t){if(p()(this,r),!(e instanceof Function))throw new Error("new TrustRegionSolverLSQ(fJ, x0): fJ must be Function.");if(this.fJ=e,this.report_x=t=tr("float64",t),1!==t.ndim)throw new Error("new TrustRegionSolverLSQ(fJ, x0): x0.ndim must be 1.");var n=e(new ar(t.shape,t.data.slice())),a=T()(n,2),o=a[0],i=a[1];if(this.report_f=o=tr("float64",o),this.report_J=i=tr("float64",i),1!==o.ndim)throw new Error("new TrustRegionSolverLSQ(fJ, x0): fJ(x) returned [f,J] with f.ndim !== 1.");if(2!==i.ndim)throw new Error("new TrustRegionSolverLSQ(fJ, x0): fJ(x) returned [f,J] with J.ndim !== 2.");var s=T()(i.shape,2),f=s[0],l=s[1];if(o.shape[0]!==f)throw new Error("new TrustRegionSolverLSQ(fJ, x0): fJ(x) returned [f,J] where J.shape[0] did not match f.shape[0].");if(t.shape[0]!==l)throw new Error("new TrustRegionSolverLSQ(fJ, x0): fJ(x) returned [f,J] where J.shape[1] did not match x0.shape[0].");this.loss=this.report_loss=NaN,this.report_loss_grad=null,this.M=f,this.N=l;var h=Math.min(f,l),u=Math.max(f,l+1);this.D=new Float64Array(l),this.X0=new Float64Array(1*l),this.F0=new Float64Array(1*f),this.J0=new Float64Array(f*l),this.G0=new Float64Array(l),this.tmp=new Float64Array(2*l),this.TMP=new Float64Array(u*l),this.newton_P=new Int32Array(l),this.newton_Q=new Int32Array(l),this.newton_R=new Float64Array(h*h),this.newton_V=new Float64Array(l*l),this.newton_UF=new Float64Array(1*f),this.newton_dX=new Float64Array(1*l),this.regularized_R0=new Float64Array(h*l),this.regularized_QF=new Float64Array(1*u),this.regularized_dX=new Float64Array(1*l),this.rank=-1,this._report_state=3,Object.seal(this),this._considerMove_computeLoss(),this.makeConsideredMove()}return g()(r,[{key:"wiggle",value:function(){throw new ta("Too many unsuccessfull iterations.")}},{key:"_considerMove_computeLoss",value:function(){for(var r=this.M,e=this.N,t=this.report_f.data,n=this.report_J.data,a=0,o=r;o-- >0;){var i=t[o];a+=i*i/r}for(var s=new Float64Array(e),f=r;f-- >0;)for(var l=e;l-- >0;)s[l]+=n[e*f+l]*t[f]/r*2;this.report_loss=a,this.report_loss_grad=new ar(Int32Array.of(e),s)}},{key:"scaledNorm",value:function(r){var e=this.N,t=this.D;if(r.length!==e)throw new Error("Assertion failed.");for(var n=new le,a=e;a-- >0;)n.include(t[a]*r[a]);return n.result}},{key:"cauchyTravel",value:function(){for(var r=this.M,e=this.N,t=this.J0,n=this.G0,a=0,o=0,i=e;i-- >0;)a+=n[i]*n[i];for(var s=r;s-- >0;){for(var f=0,l=e;l-- >0;)f+=t[e*s+l]*n[l];o+=f*f}return 0===a?0:0===o?-1/0:-a/o}},{key:"report",value:function(){if(1!==this._report_state)throw new Error("TrustRegionSolverLSQ::report: can only be called once after each makeConsideredMove() but not directly after considerMove(dX).");this._report_state=2;var r=[this.report_x,this.report_loss,this.report_loss_grad,this.report_f,this.report_J];return this.report_x=this.report_f=this.report_J=this.report_loss_grad=null,this.report_loss=NaN,r}},{key:"considerMove",value:function(r){var e=this.M,t=this.N,n=this.X0,a=this.F0,o=this.J0;if(this._report_state=3,t!==r.length)throw new Error("Assertion failed.");for(var i=Int32Array.of(t),s=new Float64Array(t),f=t;f-- >0;)s[f]=n[f]+r[f];var l=this.fJ(new ar(i,s.slice())),h=T()(l,2),u=h[0],c=h[1];if(u=tr("float64",u),c=tr("float64",c),1!==u.ndim)throw new Error("Assertion failed.");if(2!==c.ndim)throw new Error("Assertion failed.");if(u.shape[0]!==e)throw new Error("Assertion failed.");if(c.shape[0]!==e)throw new Error("Assertion failed.");if(c.shape[1]!==t)throw new Error("Assertion failed.");this.report_x=new ar(i,s),this.report_f=u,this.report_J=c,this._considerMove_computeLoss();for(var d=0,w=e;w-- >0;){for(var v=0,p=t;p-- >0;)v+=o[t*w+p]*(s[p]-n[p]);d+=(v+=a[w])*v/e}return[d,this.report_loss]}},{key:"makeConsideredMove",value:function(){if(3!==this._report_state)throw new Error("Assertion failed.");this._report_state=1,this.rank=-1,this.loss=this.report_loss;for(var r=this.M,e=this.N,t=this.D,n=this.tmp,a=this.X0,o=this.F0,i=this.J0,s=this.G0,f=this.report_f.data,l=this.report_J.data,h=this.report_x.data,u=e;u-- >0;)a[u]=h[u];for(var c=r;c-- >0;)o[c]=f[c];for(var d=r*e;d-- >0;)i[d]=l[d];s.fill(0);for(var w=r;w-- >0;)for(var v=e;v-- >0;)s[v]+=i[e*w+v]*o[w];if(n.length!==2*e)throw new Error("Assertion failed.");n.fill(0);for(var p=0;p<r;p++)Bt(n,i,e*p,0);for(var m=0;m<e;m++)t[m]=Math.max(t[m],Ct(n,m))}},{key:"computeNewton",value:function(){if(!(0<=this.rank)){for(var r=this.M,e=this.N,t=this.D,n=this.J0,a=this.F0,o=this.tmp,i=this.TMP,s=this.newton_P,f=this.newton_Q,l=this.newton_V,h=this.newton_dX,u=this.newton_UF,c=Math.min(r,e),d=e;d-- >0;)s[d]=d;for(var w=r*e;w-- >0;)i[w]=n[w];for(var v=r;v-- >0;)u[v]=a[v];Kt(r,e,1,i,0,u,0,s,0,o);for(var p=this.regularized_R0,m=c*e;m-- >0;)p[m]=i[m];var g=this.rank=Vt(r,e,i,0,o);if(g<e){for(var y=e;y-- >0;){var b=t[s[y]];if(0!==b)for(var E=g;E-- >0;)i[e*E+y]/=b}for(var _=e;_-- >0;)f[_]=s[_];l.fill(0),fn(g,e,i,0,l,0,f,0);for(var x=g;x-- >0;)o[x]=-u[x];for(var A=this.newton_R,M=g;M-- >0;)for(var k=g;k-- >0;)A[c*M+k]=i[e*M+k];Ee(g,c,1,A,0,o,0),h.fill(0);for(var N=g;N-- >0;)for(var F=e;F-- >0;)h[F]+=l[e*N+F]*o[N];for(var I=e;I-- >0;){var P=t[I];0!==P&&(h[I]/=P)}}else{for(var q=e;q-- >0;)o[q]=-u[q];Ee(e,e,1,i,0,o,0);for(var S=e;S-- >0;)h[s[S]]=o[S]}}}},{key:"computeNewtonRegularized",value:function(r){this.computeNewton();var e=this.M,t=this.N,n=this.D,a=this.rank,o=this.tmp,i=this.TMP,s=this.newton_P,f=this.newton_UF,l=this.newton_R,h=this.newton_V,u=this.newton_dX,c=this.regularized_R0,d=this.regularized_dX,w=this.regularized_QF,v=Math.min(e,t);if(0===r){for(var p=t;p-- >0;)d[p]=u[p];if(a<t){var m=this.scaledNorm(d);if(0===m)return[0,0];o.fill(0,0,a);for(var g=a;g-- >0;)for(var y=t;y-- >0;)o[g]+=h[t*g+y]*n[y]*d[y];xe(a,v,1,l,0,o,0);for(var b=0,E=a;E-- >0;){var _=o[E];b+=_*_}return[m,b/=-m]}}if(!(0<=r))throw new Error("TrustRegionSolverLSQ.prototype.computeMinRegularized(λ): λ must be non-negative.");for(var x=a*t;x-- >0;)i[x]=c[x];if(0!==r){for(var A=a;A-- >0;)w[A]=-f[A];i.fill(0,a*t,(t+1)*t),w.fill(0,a,t+1);for(var M=Math.sqrt(r),k=t;k-- >0;){var N=n[s[k]];if(0===N?N=1:N*=M,!(N>0))throw new Error("TrustRegionSolverLSQ.prototype.computeMinRegularized(λ): λ too small (caused underflow).");if(a<=k)i[t*k+k]=N;else{i[t*t+k]=N,w[t]=0;for(var F=k;F<t;F++){var I=t*F+F,P=t*t+F,q=i[P];if(0!==q){var S=ae(i[I],q),j=T()(S,3),O=j[0],R=j[1],L=j[2];i[P]=0,0!==R&&(i[I]=L,oe(i,t-1-F,I+1,P+1,O,R),oe(w,1,F,t,O,R))}}}}for(var D=t;D-- >0;)o[D]=w[D];Ee(t,t,1,i,0,o,0);for(var G=t;G-- >0;)d[s[G]]=o[G]}else if(a!==t)throw new Error("Assertion failed.");var J=this.scaledNorm(d);if(0===J)return[0,0];for(var X=t;X-- >0;){var z=s[X];o[X]=d[z]*n[z]*n[z]}xe(t,t,1,i,0,o,0);for(var U=0,Y=t;Y-- >0;){var Q=o[Y];U+=Q*Q}return[J,U/=-J]}}]),r}();function ca(r){var e=function e(t,n,a,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!(a instanceof Function))throw new Error("".concat(f,"(x,y, fgg,p0): fgg must be function."));t=tr("float64",t),n=tr("float64",n),o=nr("float64",o);var s="dx0"in i?tr("float64",i.dx0):t.mapElems("float64",(function(){return 0})),f=e.name;if(1!==o.ndim)throw new Error("".concat(f,"(x,y, fgg,p0): p0.ndim must be 1."));if(1!==t.ndim&&2!==t.ndim)throw new Error("".concat(f,"(x,y, fgg,p0): x.ndim must be 1 or 2."));if(1!==n.ndim&&2!==n.ndim)throw new Error("".concat(f,"(x,y, fgg,p0): y.ndim must be 1 or 2."));if(t.ndim!==s.ndim)throw new Error("".concat(f,"(x,y, fgg,p0, opt): opt.dx0 and x must have same ndim."));var l=T()(t.shape,2),h=l[0],u=l[1],c=void 0===u?1:u,d=T()(n.shape,2),w=d[0],v=d[1],p=void 0===v?1:v,m=T()(o.shape,1),g=m[0];if(2==t.ndim&&c!==s.shape[1])throw new Error("".concat(f,"(x,y, fgg,p0, opt): opt.dx0 and x must have same shape."));if(h!==s.shape[0])throw new Error("".concat(f,"(x,y, fgg,p0, opt): opt.dx0 and x must have same shape."));if(h!==w)throw new Error("".concat(f,"(x,y, fgg,p0, opt): x.shape[0] must equal y.shape[0]."));var y=t.ndim,b=n.ndim,E=t.shape.slice(1),_=new Float64Array(h*p),A=new Float64Array(h*p*g),M=new Float64Array(h*p*c),k=new ar(n.shape,_),N=new ar(Int32Array.of.apply(Int32Array,x()(n.shape).concat([g])),A),F=new ar(Int32Array.of.apply(Int32Array,x()(n.shape).concat(x()(t.shape.subarray(1)))),M);t=t.data,n=n.data;var I=function(r,e){if(!r.dtype.startsWith("float"))throw new Error("Assertion failed.");if(!e.dtype.startsWith("float"))throw new Error("Assertion failed.");if(1!==r.ndim)throw new Error("Assertion failed.");if(r.shape[0]!==g)throw new Error("Assertion failed.");if(y!==e.ndim)throw new Error("Assertion failed.");if(1!==y&&e.shape[1]!==c)throw new Error("Assertion failed.");if(e.shape[0]!==h)throw new Error("Assertion failed.");var o=a(r);e=e.data;for(var i=0;i<h;i++){for(var s=e.slice(c*i,c*(i+1)),f=c;f-- >0;)s[f]+=t[c*i+f];var l=o(new ar(E,s)),u=T()(l,3),d=u[0],w=u[1],v=u[2];if(d=nr("float",d),w=nr("float",w),v=nr("float",v),d.ndim!==b-1)throw new Error("Assertion failed.");if(w.ndim!==b)throw new Error("Assertion failed.");if(v.ndim!==b-2+y)throw new Error("Assertion failed.");if(1!==b){if(d.shape[0]!==p)throw new Error("Assertion failed.");if(w.shape[0]!==p)throw new Error("Assertion failed.");if(v.shape[0]!==p)throw new Error("Assertion failed.")}if(1!==y&&v.shape[b-1]!==c)throw new Error("Assertion failed.");if(w.shape[b-1]!==g)throw new Error("Assertion failed.");d=d.data,w=w.data,v=v.data;for(var m=p;m-- >0;)_[p*i+m]=d[m]-n[p*i+m];for(var x=g*p;x-- >0;)A[g*p*i+x]=w[x];for(var I=c*p;I-- >0;)M[c*p*i+I]=v[I]}return[k,N,F]};return r(new da(I,o,s),i)};return Object.defineProperty(e,"name",{value:"odr".concat(r.name,"_gen")}),e}var da=function(){function r(e,t,n){if(p()(this,r),!(e instanceof Function))throw new Error("Assertion failed.");if(t=tr("float64",t),n=tr("float64",n),1!==t.ndim)throw new Error("Assertion failed.");if(1!==n.ndim&&2!==n.ndim)throw new Error("Assertion failed.");var a=T()(n.shape,2),o=a[0],i=a[1],s=void 0===i?1:i,f=T()(t.shape,1)[0],l=e(new ar(t.shape,t.data.slice()),new ar(n.shape,n.data.slice())),h=T()(l,3),u=h[0],c=h[1],d=h[2];if(u=tr("float64",u),c=tr("float64",c),d=tr("float64",d),1!==u.ndim&&2!==u.ndim)throw new Error("Assertion failed.");if(c.ndim!==u.ndim+1)throw new Error("Assertion failed.");if(d.ndim!==u.ndim+n.ndim-1)throw new Error("Assertion failed.");var w=T()(u.shape,2),v=w[0],m=w[1],g=void 0===m?1:m;if(o!==v)throw new Error("Assertion failed.");if(c.shape[0]!==o)throw new Error("Assertion failed.");if(d.shape[0]!==o)throw new Error("Assertion failed.");if(2===u.ndim){if(c.shape[1]!==g)throw new Error("Assertion failed.");if(d.shape[1]!==g)throw new Error("Assertion failed.")}if(2===n.ndim&&d.shape[u.ndim]!==s)throw new Error("Assertion failed.");if(c.shape[u.ndim]!==f)throw new Error("Assertion failed.");var y=o*s+o*g,b=o*s+f,E=Math.min(s,g),_=Math.min(o*s+f+1,o*g),x=new Float64Array(o*s),A=new Float64Array(o*g*s),M=new Float64Array(o*g*f),k=new Float64Array(b),N=new Float64Array(b),F=new Float64Array(y),I=new Float64Array(b),P=new Float64Array(E*(E+3)>>>1),q=g<=s?A:new Float64Array(o*s*s+s),S=g<=s?M:new Float64Array(_*f),j=g<=s?F.subarray(o*s):new Float64Array(_),O=new Float64Array(o*s),R=new Float64Array(o*E*s),L=new Float64Array(_*f),D=new Int32Array(f),G=new Float64Array(b),J=new Float64Array(o*s),X=new Float64Array(o*E*s),z=new Float64Array(Math.max(_,f+1)*f),U=new Int32Array(f),Y=new Float64Array(b),Q=new Float64Array(Math.max(o*s+_,b+1)),B=new Float64Array(2*f),C=x.slice(),V=d.data,W=c.data;C.fill(1),Object.assign(this,{MX:o,NX:s,NY:g,NP:f,M:y,N:b,loss:0,rank:-1,_report_state:2,fgg:e,report_p:t,report_dx:n,report_loss:NaN,report_dloss_dp:null,report_dloss_ddx:null,report_dy:u,p_shape:t.shape,x_shape:n.shape,y_shape:u.shape,QF:Q,J11:x,J21:A,J22:M,tmp:P,prepared_QF:j,prepared_J21:q,prepared_J22:S,prepared:!1,newton_R11:O,newton_R21:R,newton_R22:L,newton_P:D,newton_dX:G,regularized_R11:J,regularized_R21:X,regularized_R22:z,regularized_P:U,regularized_dX:Y,_consider_J11:C,_consider_J21:V,_consider_J22:W,D:k,norm:B,X0:N,F0:F,G0:I}),Object.seal(this),this._considerMove_computeLoss(),this.makeConsideredMove()}return g()(r,[{key:"_considerMove_computeLoss",value:function(){var r=this.M,e=this.MX,t=this.NX,n=this.NY,a=this.NP,o=this.x_shape,i=this.p_shape,s=this._consider_J11,f=this._consider_J21,l=this._consider_J22;this._report_state=3;for(var h=new Float64Array(a),u=new Float64Array(e*t),c=this.report_dx.data,d=this.report_dy.data,w=e*n;w-- >0;)for(var v=a;v-- >0;)h[v]+=d[w]*l[a*w+v]/r*2;for(var p=e;p-- >0;)for(var m=t;m-- >0;)u[t*p+m]=s[t*p+m]*c[t*p+m]/r*2;for(var g=e;g-- >0;)for(var y=n;y-- >0;)for(var b=t;b-- >0;)u[t*g+b]+=f[t*(n*g+y)+b]*d[n*g+y]/r*2;for(var E=0,_=e*t;_-- >0;){var x=c[_];E+=x*x/r}for(var A=e*n;A-- >0;){var M=d[A];E+=M*M/r}this.report_dloss_dp=new ar(i,h),this.report_dloss_ddx=new ar(o,u),this.report_loss=E}},{key:"considerMove",value:function(r){var e=this.M,t=this.N,n=this.MX,a=this.NX,o=this.NY,i=this.NP,s=this.x_shape,f=this.y_shape,l=this.p_shape,h=this._consider_J11,u=this._consider_J21,c=this._consider_J22,d=this.J11,w=this.J21,v=this.J22,p=this.F0,m=this.X0,g=this.fgg;if(r.length!==t)throw new Error("Assertion failed.");var y=new Float64Array(i),b=new Float64Array(n*a);this.report_p=new ar(l,y),this.report_dx=new ar(s,b);for(var E=i;E-- >0;){var _=n*a+E;y[E]=m[_]+r[_]}for(var x=n*a;x-- >0;)b[x]=m[x]+r[x];var A=g(new ar(l,y.slice()),new ar(s,b.slice())),M=T()(A,3),k=M[0],N=M[1],F=M[2];if(k=tr("float64",k),N=nr("float64",N),F=nr("float64",F),k.ndim!==f.length)throw new Error("Assertion failed.");if(N.ndim!==f.length+1)throw new Error("Assertion failed.");if(F.ndim!==f.length+s.length-1)throw new Error("Assertion failed.");if(k.shape[0]!==n)throw new Error("Assertion failed.");if(N.shape[0]!==n)throw new Error("Assertion failed.");if(F.shape[0]!==n)throw new Error("Assertion failed.");if(N.shape[f.length]!==i)throw new Error("Assertion failed.");if(2===s.length&&F.shape[f.length]!==a)throw new Error("Assertion failed.");if(2===f.length){if(k.shape[1]!==o)throw new Error("Assertion failed.");if(N.shape[1]!==o)throw new Error("Assertion failed.");if(F.shape[1]!==o)throw new Error("Assertion failed.")}this.report_dy=k,F=F.data,N=N.data;for(var I=n*o*a;I-- >0;)u[I]=F[I];for(var P=n*o*i;P-- >0;)c[P]=N[P];h.fill(1),this._considerMove_computeLoss();for(var q=0,S=n*a;S-- >0;){var j=p[S]+d[S]*(b[S]-m[S]);q+=j*j/e}for(var O=n;O-- >0;)for(var R=o;R-- >0;){for(var L=p[n*a+o*O+R],D=a;D-- >0;)L+=w[a*(o*O+R)+D]*(b[a*O+D]-m[a*O+D]);for(var G=i;G-- >0;)L+=v[i*(o*O+R)+G]*(y[G]-m[n*a+G]);q+=L*L/e}return[q,this.report_loss]}},{key:"makeConsideredMove",value:function(){if(3!==this._report_state)throw new Error("Assertion failed.");this._report_state=1,this.loss=this.report_loss,this.rank=-1,this.prepared=!1;for(var r=this.MX,e=this.NX,t=this.NY,n=this.NP,a=this._consider_J11,o=this.J11,i=this._consider_J21,s=this.J21,f=this._consider_J22,l=this.J22,h=this.D,u=this.X0,c=this.F0,d=this.G0,w=r*e;w-- >0;)o[w]=a[w];for(var v=r*t*e;v-- >0;)s[v]=i[v];for(var p=r*t*n;p-- >0;)l[p]=f[p];for(var m=this.report_p.data,g=this.report_dx.data,y=this.report_dy.data,b=n;b-- >0;)u[r*e+b]=m[b];for(var E=r*e;E-- >0;)u[E]=g[E];for(var _=r*t;_-- >0;)c[r*e+_]=y[_];for(var x=r*e;x-- >0;)c[x]=u[x];for(var A=r*e;A-- >0;)d[A]=o[A]*c[A];for(var M=r;M-- >0;)for(var k=t;k-- >0;)for(var N=e;N-- >0;)d[e*M+N]+=s[e*(t*M+k)+N]*c[r*e+t*M+k];d.fill(0,r*e,r*e+n);for(var F=r*t;F-- >0;)for(var I=n;I-- >0;)d[r*e+I]+=l[n*F+I]*c[r*e+F];for(var P=new le,q=r;q-- >0;)for(var S=e;S-- >0;){P.reset(),P.include(o[e*q+S]);for(var j=t;j-- >0;)P.include(s[e*(t*q+j)+S]);var O=e*q+S;h[O]=Math.max(h[O],P.result)}for(var R=n;R-- >0;){P.reset();for(var L=r*t;L-- >0;)P.include(l[n*L+R]);var D=r*e+R;h[D]=Math.max(h[D],P.result)}}},{key:"cauchyTravel",value:function(){for(var r=this.N,e=this.MX,t=this.NX,n=this.NY,a=this.NP,o=this.J11,i=this.J21,s=this.J22,f=this.G0,l=0,h=0,u=r;u-- >0;)l+=f[u]*f[u];for(var c=e;c-- >0;)for(var d=n;d-- >0;){for(var w=0,v=a;v-- >0;)w+=s[a*(n*c+d)+v]*f[e*t+v];for(var p=t;p-- >0;)w+=i[t*(n*c+d)+p]*f[t*c+p];h+=w*w}for(var m=e*t;m-- >0;){var g=o[m]*f[m];h+=g*g}return 0===l?0:0===h?-1/0:-l/h}},{key:"report",value:function(){if(1!==this._report_state)throw new Error("TrustRegionSolverLSQ::report: can only be called once after each makeConsideredMove() but not directly after considerMove(dX).");this._report_state=2;var r=[this.report_p,this.report_dx,this.report_loss,this.report_dloss_dp,this.report_dloss_ddx,this.report_dy];return this.report_p=this.report_dx=this.report_dy=this.report_dloss_dp=this.report_dloss_ddx=null,this.report_loss=NaN,r}},{key:"wiggle",value:function(){throw new ta("Too many unsuccessfull iterations.")}},{key:"__DEBUG_J",value:function(r,e){if(r%1!=0)throw new Error("Assertion failed.");if(e%1!=0)throw new Error("Assertion failed.");if(e|=0,!(0<=(r|=0)))throw new Error("Assertion failed.");if(!(0<=e))throw new Error("Assertion failed.");var t=this.M,n=this.N,a=this.MX,o=this.NX,i=this.NY,s=this.NP,f=this.J11,l=this.J21,h=this.J22;if(!(r<t))throw new Error("Assertion failed.");if(!(e<n))throw new Error("Assertion failed.");if(r<a*o)return r===e?f[r]:0;if(r-=a*o,e<a*o){var u=r/i|0;return u!==(e/o|0)?0:l[o*(i*u+(r%=i))+(e%=o)]}return h[s*r+(e-=a*o)]}},{key:"scaledNorm",value:function(r){var e=this.N,t=this.D;if(r.length!==e)throw new Error("Assertion failed.");for(var n=new le,a=e;a-- >0;)n.include(t[a]*r[a]);return n.result}},{key:"_qr_decomp",value:function(r,e,t,n,a){var o=this.MX,i=this.NX,s=this.NY,f=this.NP,l=this.norm,h=this.tmp,u=this.prepared_J21,c=this.prepared_J22,d=Math.min(i,s),w=Math.min(o*s,o*i+f);if(!(n instanceof Int32Array))throw new Error("Assertion failed.");if(n.length!==f)throw new Error("Assertion failed.");if(r.length!==o*i)throw new Error("Assertion failed.");if(e.length!==o*d*i)throw new Error("Assertion failed.");if(t.length!==(f+1)*f&&t.length!==Math.min(o*s,o*i+f+1)*f)throw new Error("Assertion failed: "+JSON.stringify({len:t.length,MX:o,NX:i,NP:f}));if(1===d)for(var v=0;v<o;v++){for(var p=1,m=0;m<i;m++){var g=i*v+m,y=ae(r[g],u[g]*p),b=T()(y,3),E=b[0],_=b[1],x=b[2];if(0===x)throw new Error("Assertion failed: Sparse part of J must not be singular.");e[g]=p*_,0!==_&&(p*=E,r[g]=x,oe(a,1,g,o*i+v,E,_))}for(var A=0;A<f;A++)t[f*v+A]=p*c[f*v+A]}else for(var M=0;M<o;M++){h.fill(0,d,d*(d+3)>>>1);for(var k=d;k>0;k--)h[d-1+(k*(k+1)>>>1)]=1;for(var N=0;N<i;N++){h.fill(0,0,d);for(var F=r[i*M+N],I=0;I<d;I++){for(var P=d+(I*(I+1)>>>1),q=0,S=-1;S++<I;)q+=h[P+S]*u[i*(d*M+S)+N];if(0!==q){var j=ae(F,q),O=T()(j,3),R=O[0],L=O[1];F=O[2],0!==L&&(oe(h,I+1,0,P,R,L),oe(a,1,i*M+N,o*i+d*M+I,R,L))}}r[i*M+N]=F;for(var D=0;D<d;D++)e[i*(d*M+D)+N]=h[D]}t.fill(0,f*d*M,f*d*(M+1));for(var G=0;G<d;G++)for(var J=d+(G*(G+1)>>>1),X=0;X<=G;X++)for(var z=0;z<f;z++)t[f*(d*M+G)+z]+=h[J+X]*c[f*(d*M+X)+z]}for(var U=o*d*f;U<w*f;U++)t[U]=c[U];for(var Y=f;Y-- >0;)n[Y]=Y;Kt(w,f,1,t,0,a,o*i,n,0,l);var Q=Vt(w,f,t,0,l);return t.fill(0,f*Q,f*Math.min(w,f)),Q}},{key:"_qr_solve",value:function(r,e,t,n,a,o){var i=this.MX,s=this.NX,f=this.NY,l=this.NP,h=this.prepared_J21,u=this.prepared_J22,c=this.D,d=this.tmp,w=this.norm,v=Math.min(s,f);if(!(n instanceof Int32Array))throw new Error("Assertion failed.");if(n.length!==l)throw new Error("Assertion failed.");if(r.length!==i*s)throw new Error("Assertion failed.");if(e.length!==i*v*s)throw new Error("Assertion failed.");if(!(t.length>=i*v*l))throw new Error("Assertion failed.");if(0!=a%1)throw new Error("Assertion failed.");if(!(0<=a))throw new Error("Assertion failed.");if(!(l>=a))throw new Error("Assertion failed.");if(Ee(a|=0,l,1,t,0,o,i*s),a!=l)for(var p=0;p<a;p++)for(var m=a;m<l;m++){var g=t[l*p+m];if(0!==g)oe(o,1,i*s+m,i*s+p,Math.sqrt(1-g*g),g)}for(var y=l;y-- >0;)w[n[y]]=o[i*s+y];for(var b=l;b-- >0;)o[i*s+b]=w[b];if(a!==l)for(var E=l;E-- >0;){var _=c[i*s+E];0!==_&&(o[i*s+E]/=_)}for(var x=i;x-- >0;)for(var A=v;A-- >0;){for(var M=0,k=l;k-- >0;)M+=u[l*(v*x+A)+k]*o[i*s+k];for(var N=s;N-- >0;)o[s*x+N]-=M*e[s*(v*x+A)+N]}for(var F=i;F-- >0;){d.fill(0,0,v);for(var I=s;I-- >0;){for(var P=s*F+I,q=v;q-- >0;)o[P]-=e[s*(v*F+q)+I]*d[q];o[P]/=r[P];for(var S=v;S-- >0;)d[S]+=h[s*(v*F+S)+I]*o[P]}}}},{key:"_rt_solve",value:function(r,e,t,n,a,o){var i=this.MX,s=this.NX,f=this.NY,l=this.NP,h=this.prepared_J21,u=this.prepared_J22,c=this.D,d=this.tmp,w=this.norm,v=Math.min(s,f);if(!(n instanceof Int32Array))throw new Error("Assertion failed.");if(n.length!==l)throw new Error("Assertion failed.");if(r.length!==i*s)throw new Error("Assertion failed.");if(e.length!==i*v*s)throw new Error("Assertion failed.");if(!(t.length>=i*l))throw new Error("Assertion failed.");if(!(o.length>=i*s+l))throw new Error("Assertion failed.");if(0!=a%1)throw new Error("Assertion failed.");if(!(0<=a))throw new Error("Assertion failed.");if(!(l>=a))throw new Error("Assertion failed.");a|=0,w.fill(0,0,l);for(var p=0;p<i;p++){d.fill(0,0,v);for(var m=0;m<s;m++){for(var g=s*p+m,y=0;y<v;y++)o[g]-=h[s*(v*p+y)+m]*d[y];o[g]/=r[g];for(var b=0;b<v;b++)d[b]+=e[s*(v*p+b)+m]*o[g]}for(var E=0;E<v;E++)for(var _=0;_<l;_++)w[_]+=d[E]*u[l*(v*p+E)+n[_]]}if(a<l){for(var x=l;x-- >0;){var A=c[i*s+n[x]];0!==A&&(w[x]/=A)}for(var M=a;M-- >0;)for(var k=l;k-- >a;){var N=t[l*M+k];if(0!==N)oe(w,1,M,k,Math.sqrt(1-N*N),N)}}for(var F=a;F-- >0;)o[i*s+F]-=w[F];xe(a,l,1,t,0,o,i*s)}},{key:"prepare",value:function(){var r=this.MX,e=this.NX,t=this.NY,n=this.NP,a=this.prepared_J21,o=this.prepared_J22,i=this.prepared_QF,s=this.J21,f=this.J22,l=this.F0;if(this.prepared=this.prepared||e>=t,!this.prepared){if(this.prepared=!0,a.length!==r*e*e+e)throw new Error("Assertion failed.");if(o.length!==Math.min(r*t,r*e+n+1)*n)throw new Error("Assertion failed.");if(i.length!==Math.min(r*t,r*e+n+1))throw new Error("Assertion failed.");for(var h=-1,u=0;u<r;u++){for(var c=e*e*u,d=n*e*u,w=e*u,v=0;v<e*e;v++)a[c+v]=s[e*t*u+v];for(var p=0;p<e*n;p++)o[d+p]=f[n*t*u+p];for(var m=0;m<e;m++)i[w+m]=l[r*e+t*u+m];for(var g=1;g<e;g++)for(var y=0;y<g;y++){var b=c+e*g+y,E=a[b];if(0!==E){var _=c+e*y+y,x=ae(a[_],E),A=T()(x,3),M=A[0],k=A[1],N=A[2];a[b]=0,0!==k&&(a[_]=N,oe(a,e-1-y,_+1,b+1,M,k),oe(o,n,d+y*n,d+g*n,M,k),oe(i,1,w+y,w+g,M,k))}}for(var F=e;F<t;F++){++h===n&&je(n,n,1,o,r*e*n,i,r*e),h=Math.min(h,n);for(var I=0;I<e;I++)a[c+e*e+I]=s[e*t*u+e*F+I];for(var P=0;P<n;P++)o[(r*e+h)*n+P]=f[n*t*u+n*F+P];i[r*e+h]=l[r*e+t*u+F];for(var q=0;q<e;q++){var S=c+e*e+q,j=a[S];if(0!==j){var O=c+e*q+q,R=ae(a[O],j),L=T()(R,3),D=L[0],G=L[1],J=L[2];a[S]=0,0!==G&&(a[O]=J,oe(a,e-1-q,O+1,S+1,D,G),oe(o,n,d+n*q,(r*e+h)*n,D,G),oe(i,1,w+q,r*e+h,D,G))}}if(!(h<=n))throw new Error("Assertion failed.");if(h===n)for(var X=0;X<n;X++){var z=r*e*n+n*h+X,U=o[z];if(0!==U){var Y=r*e*n+n*X+X,Q=ae(o[Y],U),B=T()(Q,3),C=B[0],V=B[1],W=B[2];o[z]=0,0!==V&&(o[Y]=W,oe(o,n-1-X,Y+1,z+1,C,V),oe(i,1,r*e+X,r*e+h,C,V))}}}}}}},{key:"computeNewton",value:function(){var r=this.MX,e=this.NX,t=this.NY,n=this.NP,a=this.QF,o=this.J11,i=this.prepared_QF,s=this.newton_R11,f=this.newton_R21,l=this.newton_R22,h=this.newton_P,u=this.newton_dX,c=this.F0,d=this.D;if(!(this.rank>=0)){if(-1!==this.rank)throw new Error("Assertion failed.");this.prepare();for(var w=Math.min(r*t,r*e+n),v=r*e;v-- >0;)s[v]=o[v];for(var p=w;p-- >0;)a[r*e+p]=i[p];for(var m=r*e;m-- >0;)a[m]=c[m];var g=this._qr_decomp(s,f,l,h,a);this.rank=g+r*e;for(var y=r*e+g;y-- >0;)u[y]=-a[y];if(g!==n){u.fill(0,r*e+g,r*e+n);for(var b=n;b-- >0;){var E=d[r*e+h[b]];if(0!==E)for(var _=g;_-- >0;)l[n*_+b]/=E}for(var x=g;x-- >0;)for(var A=n*x+x,M=n;M-- >g;){var k=n*x+M,N=l[k];if(0!==N){var F=ae(l[A],N),I=T()(F,3),P=I[0],q=I[1],S=I[2];if(0!==q){P<0&&(P*=-1,q*=-1,S*=-1);for(var j=x;j-- >0;){var O=l[n*j+x],R=l[n*j+M];l[n*j+x]=R*q+P*O,l[n*j+M]=R*P-q*O}l[A]=S}l[k]=q}}}this._qr_solve(s,f,l,h,g,u)}}},{key:"computeNewtonRegularized",value:function(r){if(!((r*=1)>=0))throw new Error("Assertion failed.");var e=this.N,t=this.MX,n=this.NX,a=this.NY,o=this.NP,i=this.regularized_R11,s=this.J11,f=this.regularized_R21,l=this.regularized_R22,h=this.regularized_P,u=this.regularized_dX,c=this.D,d=this.QF,w=this.F0,v=this.prepared_QF,p=d,m=Math.min(t*a,t*n+o);if(l.length!==Math.max(Math.min(t*a,t*n+o+1),o+1)*o)throw new Error("Assertion failed.");if(d.length!==Math.max(Math.min(t*a,t*n+o+1),o+1)+t*n)throw new Error("Assertion failed.");if(0===r){this.computeNewton();for(var g=this.newton_R11,y=this.newton_R21,b=this.newton_R22,E=this.newton_P,_=this.newton_dX,x=this.rank,A=e;A-- >0;)u[A]=_[A];var M=this.scaledNorm(u);if(0===M)return[0,0];var k=x-t*n;if(x<e){for(var N=o;N-- >0;){var F=t*n+E[N];p[t*n+N]=u[F]*c[F]}for(var I=k;I-- >0;)for(var P=o;P-- >k;){var q=b[o*I+P];if(0!==q)oe(p,1,t*n+I,t*n+P,Math.sqrt(1-q*q),q)}}else for(var S=o;S-- >0;){var j=t*n+E[S];p[t*n+S]=u[j]*c[j]*c[j]}for(var O=t*n;O-- >0;)p[O]=u[O]*c[O]*c[O];this._rt_solve(g,y,b,E,k,p);for(var R=0,L=x;L-- >0;){var D=p[L];R+=D*D}return[M,R/=-M]}this.prepare();for(var G=t*n;G-- >0;)i[G]=s[G];for(var J=m;J-- >0;)d[t*n+J]=v[J];for(var X=t*n;X-- >0;)d[X]=w[X];for(var z=Math.sqrt(r),U=t*n;U-- >0;){var Y=c[U]*z;if(!(Y>0))throw new Error("Assertion failed.");var Q=ae(i[U],Y),B=T()(Q,3),C=B[0],V=(B[1],B[2]);i[U]=V,d[U]*=C}var W=this._qr_decomp(i,f,l,h,d),K=o*o;l.fill(0,m*o,(o+1)*o);for(var H=o;H-- >0;){var $=c[t*n+h[H]];if(0===$?$=1:$*=z,!($>0))throw new Error("Assertion failed.");if(W<=H)l[o*H+H]=$,d[t*n+H]=0;else{l[K+H]=$,d[e]=0;for(var Z=H;Z<o;Z++){var rr=o*Z+Z,er=K+Z,tr=ae(l[rr],l[er]),nr=T()(tr,3),ar=nr[0],or=nr[1],ir=nr[2];l[er]=0,0!==or&&(l[rr]=ir,oe(l,o-Z-1,rr+1,er+1,ar,or),oe(d,1,t*n+Z,e,ar,or))}}}for(var sr=e;sr-- >0;)u[sr]=-d[sr];this._qr_solve(i,f,l,h,o,u);var fr=this.scaledNorm(u);if(0===fr)return[0,0];for(var lr=o;lr-- >0;){var hr=t*n+h[lr];p[t*n+lr]=u[hr]*c[hr]*c[hr]}for(var ur=t*n;ur-- >0;)p[ur]=u[ur]*c[ur]*c[ur];this._rt_solve(i,f,l,h,o,p);for(var cr=0,dr=e;dr-- >0;){var wr=p[dr];cr+=wr*wr}return[fr,cr/=-fr]}},{key:"__DEBUG_RVD",get:function(){var r=this.M,e=this.N,t=this.MX,n=this.NX,a=this.NY,o=this.NP,i=this.newton_R11,s=this.newton_R21,f=this.newton_R22,l=this.newton_P,h=this.prepared_J21,u=this.prepared_J22;if(!(0<=this.rank))throw new Error("Assertion failed.");var c=Math.min(n,a),d=this.rank-t*n,w=new Float64Array(r*e),v=new Float64Array(e*e),p=new Float64Array(1*e);p.fill(1);for(var m=0;m<t*n;m++)v[e*m+m]=1;for(var g=0;g<o;g++)v[e*(t*n+g)+(t*n+l[g])]=1;for(var y=0;y<t*n;y++)w[e*y+y]=i[y];for(var b=0;b<t;b++)for(var E=0;E<n;E++)for(var _=1+E;_<n;_++)for(var x=0;x<c;x++)w[e*(n*b+E)+(n*b+_)]+=s[n*(c*b+x)+E]*h[n*(c*b+x)+_];for(var A=0;A<t;A++)for(var M=0;M<n;M++)for(var k=0;k<o;k++)for(var N=0;N<c;N++)w[e*(n*A+M)+(n*t+k)]+=s[n*(c*A+N)+M]*u[o*(c*A+N)+l[k]];for(var F=0;F<d;F++)for(var I=0;I<d;I++)w[e*(t*n+F)+(t*n+I)]=f[o*F+I];if(d!==o){for(var P=t*n+o;P-- >t*n;)p[P]=this.D[P]||1;for(var q=o;q-- >0;){var S=this.D[t*n+l[q]];if(0!==S)for(var j=t*n;j-- >0;)w[e*j+(t*n+q)]/=S}for(var O=d;O-- >0;)for(var R=o;R-- >d;){var L=f[o*O+R];if(0!==L)for(var D=Math.sqrt(1-L*L),G=t*n;G-- >0;){var J=e*G+(t*n+O),T=e*G+(t*n+R),X=w[J],z=w[T];w[J]=z*L+D*X,w[T]=z*D-L*X}}for(var U=t*n;U-- >0;)for(var Y=t*n+o;Y-- >t*n+d;)w[e*U+Y]=0;for(var Q=d;Q-- >0;)for(var B=o;B-- >d;){var C=f[o*Q+B];if(0!==C)oe(v,e,e*(t*n+Q),e*(t*n+B),Math.sqrt(1-C*C),C)}}return[new ar(Int32Array.of(r,e),w),new ar(Int32Array.of(e,e),v),new ar(Int32Array.of(1,e),p)]}}]),r}(),wa=M.a.mark(ga),va=M.a.mark(Ea);function pa(r,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=t.updateTol,a=void 0===n?1e-14:n,o=t.historySize,i=void 0===o?8:o,s=t.scaleInit,f=void 0===s?.01:s;return ga(new ha(r,e,{updateTol:a,historySize:i,scaleInit:f}),t)}var ma=function(r,e,t){return ga(new ua(r,e),t)};function ga(r){var e,t,n,a,o,i,s,f,l,h,u,c,d,w,v,p,m,g,y,b,E,_,A,k,N,F,I,P,q,S,j,O,R,L,D,G,J,X,z,U,Y,Q,B,C,V,W,K,H,$,Z,rr,er,tr,nr,ar,or,ir,sr=arguments;return M.a.wrap((function(M){for(;;)switch(M.prev=M.next){case 0:if(e=sr.length>1&&void 0!==sr[1]?sr[1]:{},t=e.r0,n=void 0===t?1.1:t,a=e.rMin,o=void 0===a?0:a,i=e.rMax,s=void 0===i?1/0:i,f=e.rNewton,l=void 0===f?2:f,h=e.shrinkLower,u=void 0===h?.05:h,c=e.shrinkUpper,d=void 0===c?.95:c,w=e.grow,v=void 0===w?1.4142135623730951:w,p=e.expectGainMin,m=void 0===p?.25:p,g=e.expectGainMax,y=void 0===g?.75:g,b=e.stuckLimit,E=void 0===b?64:b,0<n){M.next=3;break}throw new Error("dogleg_gen(fJ, x0, opt): opt.r0 must be positive number.");case 3:if(0<=o){M.next=5;break}throw new Error("dogleg_gen(fJ, x0, opt): opt.rMin must be non-negative.");case 5:if(o<=s){M.next=7;break}throw new Error("dogleg_gen(fJ, x0, opt): opt.rMin must not be greater than opt.rMax.");case 7:if(o<=n){M.next=9;break}throw new Error("dogleg_gen(fJ, x0, opt): opt.r0 must not be less than opt.rMin.");case 9:if(s>=n){M.next=11;break}throw new Error("dogleg_gen(fJ, x0, opt): opt.r0 must not be greater than opt.rMax.");case 11:if(1<l){M.next=13;break}throw new Error("dogleg_gen(fJ, x0, opt): opt.rGN must be greater than 1.");case 13:if(0<u){M.next=15;break}throw new Error("dogleg_gen(fJ, x0, opt): opt.shrinkLower must be positive number.");case 15:if(u<=d){M.next=17;break}throw new Error("dogleg_gen(fJ, x0, opt): opt.shrinkLower must not be greater than opt.shrinkUpper.");case 17:if(d<1){M.next=19;break}throw new Error("dogleg_gen(fJ, x0, opt): opt.shrinkUpper must be less than 1.");case 19:if(1<v){M.next=21;break}throw new Error("dogleg_gen(fJ, x0, opt): opt.grow must be number greater than 1.");case 21:if(0<m){M.next=23;break}throw new Error("dogleg_gen(fJ, x0, opt): opt.expectGainMin must be positive number.");case 23:if(m<y){M.next=25;break}throw new Error("dogleg_gen(fJ, x0, opt): opt.expectGainMin must be less than expectGainMax.");case 25:if(y<1||console.warn("dogleg_gen(fJ, x0, opt): opt.expectGainMax should be less than 1."),0==E%1){M.next=28;break}throw new Error("dogleg_gen(fJ, x0, opt): opt.stuckLimit must be an integer.");case 28:if(0<=E){M.next=30;break}throw new Error("dogleg_gen(fJ, x0, opt): opt.stuckLimit must not be negative.");case 30:_=r.N,A=r.D,k=r.newton_dX,N=r.G0,F=new Float64Array(_),I=r.scaledNorm(N),P=r.cauchyTravel(),q=n*-I*P,S=r.loss,j=0;case 32:if(P<=0){M.next=34;break}throw new Error("Assertion failed.");case 34:if(0!==j){M.next=37;break}return M.next=37,r.report();case 37:for(O=Math.max(-q/I,P),R=_;R-- >0;)F[R]=O*N[R];if(L=!1,!(-I*P<q)){M.next=52;break}for(r.computeNewton(),D=0,G=0,J=0,X=_;X-- >0;)z=A[X],U=z*F[X],Y=z*(k[X]-F[X]),D+=U*U,G+=U*Y,J+=Y*Y;if(0<=(Q=xn(D-=q*q,G*=2,J)[1])){M.next=50;break}throw new Error("Assertion failed.");case 50:for(Q>1&&(Q=1,L=!0),B=_;B-- >0;)C=k[B]-F[B],F[B]+=C*Q;case 52:if(L){M.next=57;break}if(Math.abs(r.scaledNorm(F)-q)<=1e-5*q+1e-8){M.next=55;break}throw new Error("Assertion failed: "+JSON.stringify({cp:P,err:Math.abs(r.scaledNorm(F)-q),D:x()(A),G:x()(N),dX:x()(F)}));case 55:M.next=59;break;case 57:if(r.scaledNorm(F)<=1.00001*q){M.next=59;break}throw new Error("Assertion failed.");case 59:if(V=r.considerMove(F),W=T()(V,2),K=W[0],H=W[1],$=function(){return 1},!((rr=S-H)<(Z=S-K)*m)){M.next=74;break}for(er=0,tr=_;tr-- >0;)er+=F[tr]*N[tr];if((nr=er/(2*er+S-H))>=u||(nr=u),nr<=d||(nr=d),(ar=Math.max(o*$(),q*nr))!==q||S>H){M.next=71;break}throw new ta;case 71:q=ar,M.next=75;break;case 74:L?(or=r.scaledNorm(F),ir=$(),q=Math.max(o*ir,Math.min(s*ir,l*or))):(rr>Z*y||0===rr)&&(q=Math.min(s*$(),Math.max(bn(q),q*v)));case 75:S>H?(S=H,r.makeConsideredMove(),j=0):++j>E&&r.wiggle(),I=r.scaledNorm(N),P=r.cauchyTravel();case 78:M.next=32;break;case 80:case"end":return M.stop()}}),wa)}var ya=function(r,e,t,n){return ga(new da(r,e,t),n)},ba=ca(ga);function Ea(r,e,t,n,a){var o,i,s,f,l,h,u,c,d,w,v;return M.a.wrap((function(p){for(;;)switch(p.prev=p.next){case 0:if(t instanceof Function){p.next=2;break}throw new Error("fit_dogleg_gen(x,y, fg, p0): fg must be a function.");case 2:if(r=tr(r),e=tr("float64",e),n=tr("float64",n),o=Float64Array,2===r.ndim){p.next=8;break}throw new Error("fit_dogleg_gen(x,y, fg, p0): x.ndim must be 2.");case 8:if(1===e.ndim){p.next=10;break}throw new Error("fit_dogleg_gen(x,y, fg, p0): y.ndim must be 1.");case 10:if(1===n.ndim){p.next=12;break}throw new Error("fit_dogleg_gen(x,y, fg, p0): p0.ndim must be 1.");case 12:if(i=T()(n.shape,1),s=i[0],f=T()(r.shape,2),l=f[0],h=f[1],u=Int32Array.of(h),l==e.shape[0]){p.next=15;break}throw new Error("fit_dogleg_gen(x,y, fg, p0): x.shape[0] must be equal to y.shape[0].");case 15:return r=r.data.slice(),e=e.data,Object.freeze(r.buffer),r=Array.from({length:l},(function(e,t){return Object.freeze(new ar(u,r.subarray(h*t,h*t+1)))})),Object.freeze(r),c=new o(l),d=new o(l*s),w=[new ar(Int32Array.of(l),c),new ar(Int32Array.of(l,s),d)],v=function(n){var a=t(n);if(!(a instanceof Function))throw new Error;for(var o=l;o-- >0;){var i=a(r[o]),f=T()(i,2),h=f[0],u=f[1];if(h=nr(h),u=nr(u),0!==h.ndim)throw new Error("fit_dogleg_gen(x,y, fg, p0): fg must have signature float[nParams] => float[nDim] => [float, float[nParams]].");if(1!==u.ndim)throw new Error("fit_dogleg_gen(x,y, fg, p0): fg must have signature float[nParams] => float[nDim] => [float, float[nParams]].");if(u.shape[0]!==s)throw new Error("fit_dogleg_gen(x,y, fg, p0): fg must have signature float[nParams] => float[nDim] => [float, float[nParams]].");if(h=h.data[0],u=u.data,isNaN(h))throw new Error("fit_dogleg_gen(x,y, fg, p0): NaN encountered.");if(u.some(isNaN))throw new Error("fit_dogleg_gen(x,y, fg, p0): NaN encountered.");c[o]=h-e[o];for(var v=s;v-- >0;)d[s*o+v]=u[v]}return w},p.delegateYield(ma(v,n,a),"t0",23);case 23:case"end":return p.stop()}}),va)}function _a(r,e,t,n){if(null==n)n=t,t=0;else if(null==t)t=0;else if(!(0<=t&&t<1/0))throw new Error("fit_lin(x,y, regularization, funcs): Invalid regularization: ".concat(t,"."));if(n=x()(n),r=nr("float64",r),1!==(e=nr("float64",e)).ndim)throw new Error("fit_lin(x,y, (regularization,) funcs): y.ndim must be 1.");var a=e.shape[0],o=n.length;r.ndim;if(1!==r.ndim&&2!==r.ndim)throw new Error("fit_lin(x,y, (regularization,) funcs): x.ndim must be 1 or 2.");if(r.shape[0]!==e.shape[0])throw new Error("fit_lin(x,y, (regularization,) funcs): x.shape[0] and y.shape[0] must equal.");if(1===r.ndim)r=r.data;else{var i=r.shape.slice(1),s=T()(i,1)[0];r=r.data.slice(),Object.freeze(r.buffer),r=Array.from({length:a},(function(e,t){return Object.freeze(new ar(i,r.subarray(s*t,s*(t+1))))}))}var f=Int32Array.of((0!==t)*o+a,o),l=new Float64Array(f[0]*f[1]);if(0!==t){t=Math.sqrt(t);for(var h=o;h-- >0;)l[a*o+o*h+h]=t}for(var u=a;u-- >0;)for(var c=o;c-- >0;)l[o*u+c]=n[c](r[u]);if(0!==t){e=e.data;for(var d=new Float64Array(a+o),w=a;w-- >0;)d[w]=e[w];e=new ar(Int32Array.of(a+o,1),d)}else e=new ar(Int32Array.of(a,1),e.data);var v=Ft(l=new ar(f,l),e).data,p=function r(e){var t=r.coeffs,n=r.funcs;if(t.length!==n.length)throw new Error("Assertion failed.");for(var a=0,o=t.length;o-- >0;)a+=t[o]*n[o](e);return a};return p.coeffs=v,p.funcs=n,p}var xa=1.5-Math.sqrt(5/4);function Aa(r,e,t){if(e>t)throw new Error("opt1d_golden(F,x_min,x_max): x_max must not be less than x_min.");for(var n=e,a=t,o=n+(a-n)*xa,i=r(o);;){var s=a-(a-n)*xa;if(s===a)return(a+n)/2;var f=r(s);i<f?(a=n,n=s):(n=o,o=s,i=f)}}var Ma=function(){function r(e,t){p()(this,r),this.dXdG=new Float64Array(e),this.dX=new Float64Array(e*t),this.dG=new Float64Array(e*t),this.tmp=new Float64Array(e),Object.assign(this,{M:e,N:t}),this.m=0,this.off=0,Object.seal(this)}return g()(r,[{key:"update",value:function(r,e){var t=this.M,n=this.N,a=this.dG,o=this.dXdG,i=this.dX;if(r.length!==n)throw new Error("Assertion failed.");if(e.length!==n)throw new Error("Assertion failed.");for(var s=0,f=n;f-- >0;)s+=r[f]*e[f];if(!(0<s))throw new vn;this.m===t?this.off=(this.off+1)%t:this.m++;var l=(this.off+this.m-1)%t;o[l]=s;for(var h=n;h-- >0;)i[n*l+h]=r[h];for(var u=n;u-- >0;)a[n*l+u]=e[u]}},{key:"forget",value:function(r){if(0!=r%1)throw new Error("Assertion failed.");if(!(r>=0))throw new Error("Assertion failed.");if(!(r<=this.m))throw new Error("Assertion failed.");this.off=(this.off+r)%this.M,this.m-=r}},{key:"compute_Hv_phase1",value:function(r){var e=this.M,t=this.N,n=this.dG,a=this.m,o=this.dXdG,i=this.dX,s=this.off,f=this.tmp;if(r.length!==t)throw new Error("Assertion failed.");for(var l=a;l-- >0;){var h=s+l;h-=(h>=e)*e;for(var u=0,c=t;c-- >0;)u+=i[t*h+c]*r[c];f[h]=u/=o[h];for(var d=t;d-- >0;)r[d]-=u*n[t*h+d]}}},{key:"compute_Hv_phase2",value:function(r){var e=this.M,t=this.N,n=this.dG,a=this.m,o=this.dXdG,i=this.dX,s=this.off,f=this.tmp;if(r.length!==t)throw new Error("Assertion failed.");for(var l=0;l<a;l++){var h=s+l;h-=(h>=e)*e;for(var u=0,c=t;c-- >0;)u+=n[t*h+c]*r[c];u/=o[h];for(var d=t;d-- >0;)r[d]+=(f[h]-u)*i[t*h+d]}}}]),r}(),ka=M.a.mark(Ia),Na=M.a.mark(Pa),Fa=M.a.mark(qa);function Ia(r,e){var t,n,a,o,i,s,f,l,h,u,c,d,w,v,p,m,g,y,b,E,_,x,A,k=arguments;return M.a.wrap((function(M){for(;;)switch(M.prev=M.next){case 0:if(t=k.length>2&&void 0!==k[2]?k[2]:{},n=t.historySize,a=void 0===n?8:n,o=t.lineSearch,i=void 0===o?Fn():o,s=t.updateTol,f=void 0===s?1e-14:s,l=t.negDir0,h=void 0===l?function(r){return r}:l,u=t.scaling,c=void 0===u?function(){var r=1024;return{update:function(e,t){if(1!==e.ndim)throw new Error("Assertion failed.");if(1!==t.ndim)throw new Error("Assertion failed.");if(e=e.data,t=t.data,e.length!==t.length)throw new Error("Assertion failed.");for(var n=t.reduce((function(r,e){return Math.max(r,Math.abs(e))}),0),a=0,o=0,i=t.length;i-- >0;){var s=t[i]/n;a+=s*s,o+=e[i]/n*s}if(r=a/o,!isFinite(r))throw new Error("Assertion failed.")},apply:function(e){if(1!==e.ndim)throw new Error("Assertion failed.");for(var t=e.data,n=t.length;n-- >0;)t[n]/=r;return e}}}():u,a%1==0){M.next=3;break}throw new Error("min_lbfgs_gen(fg, x0, opt): opt.historySize must be an integer.");case 3:if(a>0){M.next=5;break}throw new Error("min_lbfgs_gen(fg, x0, opt): opt.historySize must be positive.");case 5:if(d=tr("float64",e),e=void 0,1===d.ndim){M.next=9;break}throw new Error("min_lbfgs_gen(fg, x0, opt): x0.ndim must be 1.");case 9:if(w=T()(d.shape,1),v=w[0],p=d.shape,m=r(d),g=T()(m,2),y=g[0],b=tr("float64",b=g[1]),y*=1,!isNaN(y)){M.next=15;break}throw new Error("min_lbfgs_gen(fg, x0, opt): fg must return [float,float[]].");case 15:if(1===b.ndim){M.next=17;break}throw new Error("min_lbfgs_gen(fg, x0, opt): fg must return [float,float[]].");case 17:if(b.shape[0]===v){M.next=19;break}throw new Error("min_lbfgs_gen(fg, x0, opt): fg must return [float,float[]].");case 19:i=i(r),E=new Ma(a,v),_=new Float64Array(v),x=new Float64Array(v),A=function(){var r,e,t,n=Float64Array.from(b.data);E.compute_Hv_phase1(n),n=tr("float64",n=h(new ar(p,n))),n=tr("float64",n=c.apply(n)),E.compute_Hv_phase2(n.data);var a=!0;try{var o=i(new ar(p,d.data.slice()),y,new ar(p,b.data.slice()),n),s=T()(o,3);r=s[0],e=s[1],t=s[2]}catch(n){if(!(n instanceof pn))throw n;r=n.x,e=n.f,t=n.g,a=!1}if(r=tr("float64",r),t=tr("float64",t),e*=1,1!==r.ndim)throw new Error("Assertion failed.");if(1!==t.ndim)throw new Error("Assertion failed.");if(r.shape[0]!==v)throw new Error("Assertion failed.");if(t.shape[0]!==v)throw new Error("Assertion failed.");if(isNaN(e))throw new Error("Assertion failed.");for(var l=v;l-- >0;)x[l]=t.data[l]-b.data[l];for(var u=v;u-- >0;)_[u]=r.data[u]-d.data[u];if(_.every((function(r){return 0===r})))throw new vn;(a=a||function(){for(var r=x.reduce((function(r,e){return Math.max(r,Math.abs(e))}),0),e=0,t=0,n=x.length;n-- >0;){var a=x[n]/r;e+=a*a,t+=_[n]/r*a}return f*e<t}())&&(E.update(_,x),c.update(new ar(p,_.slice()),new ar(p,x.slice()))),d=r,y=e,b=t};case 23:if(d instanceof ar){M.next=25;break}throw new Error("Assertion failed.");case 25:if(b instanceof ar){M.next=27;break}throw new Error("Assertion failed.");case 27:if(!isNaN(y)){M.next=29;break}throw new Error("Assertion#5 failed.");case 29:if(1===d.ndim){M.next=31;break}throw new Error("Assertion#4 failed.");case 31:if(1===b.ndim){M.next=33;break}throw new Error("Assertion#6 failed.");case 33:if(d.shape[0]===v){M.next=35;break}throw new Error("Assertion#7 failed.");case 35:if(b.shape[0]===v){M.next=37;break}throw new Error("Assertion#8 failed.");case 37:return M.next=39,[new ar(p,d.data.slice()),y,new ar(p,b.data.slice())];case 39:return M.prev=39,A(),M.abrupt("break",53);case 44:if(M.prev=44,M.t0=M.catch(39),!(M.t0 instanceof wn&&E.m>0)){M.next=50;break}E.forget(E.m+1>>>1),M.next=51;break;case 50:throw M.t0;case 51:M.next=39;break;case 53:M.next=23;break;case 55:case"end":return M.stop()}}),ka,null,[[39,44]])}function Pa(r,e){var t,n,a,o,i,s,f,l,h,u,c,d,w,v,p,m,g,y,b,E,_,x,A,k,N,F,I,P,q,S,j,O=arguments;return M.a.wrap((function(M){for(;;)switch(M.prev=M.next){case 0:if(t=O.length>2&&void 0!==O[2]?O[2]:{},n=t.historySize,a=void 0===n?8:n,o=t.lineSearch,i=void 0===o?Fn():o,s=t.updateTol,f=void 0===s?1e-13:s,a%1==0){M.next=3;break}throw new Error("min_lbfgs_gen(fg, x0, opt): opt.historySize must be an integer.");case 3:if(a>0){M.next=5;break}throw new Error("min_lbfgs_gen(fg, x0, opt): opt.historySize must be positive.");case 5:if(l=tr("float64",e),e=void 0,1===l.ndim){M.next=9;break}throw new Error("min_lbfgs_gen(fg, x0, opt): x0.ndim must be 1.");case 9:if(h=r(l),u=T()(h,2),c=u[0],d=u[1],c=tr("float64",c),d=tr("float64",d),1===c.ndim){M.next=14;break}throw new Error("lsq_lbfgs_gen(fg, x0: float[L], opt): fg must return [float[K],float[K,L]].");case 14:if(2===d.ndim){M.next=16;break}throw new Error("lsq_lbfgs_gen(fg, x0: float[L], opt): fg must return [float[K],float[K,L]].");case 16:if(w=T()(d.shape,2),v=w[0],p=w[1],m=l.shape,g=c.shape,y=d.shape,Int32Array.of(),c.shape[0]===v){M.next=19;break}throw new Error("lsq_lbfgs_gen(fg, x0: float[L], opt): fg must return [float[K],float[K,L]].");case 19:if(l.shape[0]===p){M.next=21;break}throw new Error("lsq_lbfgs_gen(fg, x0: float[L], opt): fg must return [float[K],float[K,L]].");case 21:r=function(){var e=r;return function(r){r=new ar(m,r.data);var t=e(r),n=T()(t,2),a=n[0],o=n[1];if(a=tr("float64",a),o=tr("float64",o),a.data.some(isNaN))throw new Error("Assertion failed.");if(o.data.some(isNaN))throw new Error("Assertion failed.");if(1!==a.ndim)throw new Error("lsq_lbfgs_gen(fg, x0: float[L], opt): fJ(x: float[L]) must return [float[K],float[K,L]].");if(2!==o.ndim)throw new Error("lsq_lbfgs_gen(fg, x0: float[L], opt): fJ(x: float[L]) must return [float[K],float[K,L]].");if(a.shape[0]!==v)throw new Error("lsq_lbfgs_gen(fg, x0: float[L], opt): fJ(x: float[L]) must return [float[K],float[K,L]].");if(o.shape[0]!==v)throw new Error("lsq_lbfgs_gen(fg, x0: float[L], opt): fJ(x: float[L]) must return [float[K],float[K,L]].");if(o.shape[1]!==p)throw new Error("lsq_lbfgs_gen(fg, x0: float[L], opt): fJ(x: float[L]) must return [float[K],float[K,L]].");return[a,o]}}(),b=function(r,e){for(var t=r.data,n=e.data,a=0,o=new Float64Array(p),i=v;i-- >0;)a+=t[i]*t[i]/v;for(var s=v;s-- >0;)for(var f=p;f-- >0;)o[f]+=2*t[s]*n[p*s+f]/v;return[a,new ar(m,o)]},i=i((function(e){if(E=tr("float64",e),e=void 0,1!==E.ndim)throw new Error("Assertion failed.");if(E.shape[0]!==p)throw new Error("Assertion failed.");var t=r(E),n=T()(t,2);return _=n[0],x=n[1],b(_,x)})),A=function(r){for(var e=S.data,t=d.data,n=0,a=p;a-- >0;)n+=e[a]*r[a];if(0<n){for(var o=0,i=v;i-- >0;){for(var s=0,f=p;f-- >0;)s+=t[p*i+f]*r[f];o+=s*s*2/v}if(!(0<o))throw new Error("Assertion failed.");n/=o;for(var l=p;l-- >0;)r[l]*=n}},k=new Float64Array(p),N=new Float64Array(p),F=new Ma(a,p),I=b(c,d),P=T()(I,2),q=P[0],S=P[1],j=function(){var e=Float64Array.from(S.data);F.compute_Hv_phase1(e),A(e),F.compute_Hv_phase2(e);var t,n,a,o=!0;try{var s=i(new ar(m,l.data.slice()),q,new ar(m,S.data.slice()),new ar(m,e)),h=T()(s,3);t=h[0],n=h[1],a=h[2]}catch(r){if(!(r instanceof pn))throw r;t=r.x,n=r.f,a=r.g,o=!1}if(l=tr("float64",l),q*=1,S=tr("float64",S),1!==l.ndim)throw new Error("Assertion failed.");if(1!==S.ndim)throw new Error("Assertion failed.");if(l.shape[0]!==p)throw new Error("Assertion failed.");if(S.shape[0]!==p)throw new Error("Assertion failed.");if(isNaN(q))throw new Error("Assertion failed.");var u=_,w=x;if(E.data.some((function(r,e){return r!==t.data[e]}))){var v=r(t),g=T()(v,2);u=g[0],w=g[1]}for(var y=p;y-- >0;)k[y]=t.data[y]-l.data[y];for(var b=p;b-- >0;)N[b]=a.data[b]-S.data[b];if(k.every((function(r){return 0===r})))throw new vn;(o=o||function(){for(var r=N.reduce((function(r,e){return Math.max(r,Math.abs(e))}),0),e=0,t=0,n=N.length;n-- >0;){var a=N[n]/r;e+=a*a,t+=k[n]/r*a}return f*e<t}())&&F.update(k,N),l=t,q=n,S=a,c=u,d=w};case 28:return M.next=30,[new ar(m,l.data.slice()),q,new ar(m,S.data.slice()),new ar(g,c.data.slice()),new ar(y,d.data.slice())];case 30:return M.prev=30,j(),M.abrupt("break",44);case 35:if(M.prev=35,M.t0=M.catch(30),!(M.t0 instanceof wn&&F.m>0)){M.next=41;break}F.forget(F.m+1>>>1),M.next=42;break;case 41:throw M.t0;case 42:M.next=30;break;case 44:M.next=28;break;case 46:case"end":return M.stop()}}),Na,null,[[30,35]])}function qa(r,e,t,n,a){var o,i,s,f,l,h,u,c,d,w,v;return M.a.wrap((function(p){for(;;)switch(p.prev=p.next){case 0:if(t instanceof Function){p.next=2;break}throw new Error("fit_lbfgs_gen(x,y, fg, p0): fg must be a function.");case 2:if(r=tr(r),e=tr("float64",e),n=tr("float64",n),o=Float64Array,2===r.ndim){p.next=8;break}throw new Error("fit_lbfgs_gen(x,y, fg, p0): x.ndim must be 2.");case 8:if(1===e.ndim){p.next=10;break}throw new Error("fit_lbfgs_gen(x,y, fg, p0): y.ndim must be 1.");case 10:if(1===n.ndim){p.next=12;break}throw new Error("fit_lbfgs_gen(x,y, fg, p0): p0.ndim must be 1.");case 12:if(i=T()(n.shape,1),s=i[0],f=T()(r.shape,2),l=f[0],h=f[1],u=Int32Array.of(h),l==e.shape[0]){p.next=15;break}throw new Error("fit_lbfgs_gen(x,y, fg, p0): x.shape[0] must be equal to y.shape[0].");case 15:return r=r.data.slice(),e=e.data,Object.freeze(r.buffer),r=Array.from({length:l},(function(e,t){return Object.freeze(new ar(u,r.subarray(h*t,h*t+1)))})),Object.freeze(r),c=new o(l),d=new o(l*s),w=[new ar(Int32Array.of(l),c),new ar(Int32Array.of(l,s),d)],v=function(n){var a=t(n);if(!(a instanceof Function))throw new Error;for(var o=l;o-- >0;){var i=a(r[o]),f=T()(i,2),h=f[0],u=f[1];if(h=nr(h),u=nr(u),0!==h.ndim)throw new Error("fit_lbfgs_gen(x,y, fg, p0): fg must have signature float[nParams] => float[nDim] => [float, float[nParams]].");if(1!==u.ndim)throw new Error("fit_lbfgs_gen(x,y, fg, p0): fg must have signature float[nParams] => float[nDim] => [float, float[nParams]].");if(u.shape[0]!==s)throw new Error("fit_lbfgs_gen(x,y, fg, p0): fg must have signature float[nParams] => float[nDim] => [float, float[nParams]].");if(h=h.data[0],u=u.data,isNaN(h))throw new Error("fit_lbfgs_gen(x,y, fg, p0): NaN encountered.");if(u.some(isNaN))throw new Error("fit_lbfgs_gen(x,y, fg, p0): NaN encountered.");c[o]=h-e[o];for(var v=s;v-- >0;)d[s*o+v]=u[v]}return w},p.delegateYield(Pa(v,n,a),"t0",23);case 23:case"end":return p.stop()}}),Fa)}var Sa=M.a.mark(Ra);function ja(r,e){var t;if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(t=function(r,e){if(!r)return;if("string"==typeof r)return Oa(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);"Object"===t&&r.constructor&&(t=r.constructor.name);if("Map"===t||"Set"===t)return Array.from(r);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Oa(r,e)}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){t=r[Symbol.iterator]()},n:function(){var r=t.next();return i=r.done,r},e:function(r){s=!0,o=r},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw o}}}}function Oa(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function Ra(r,e,t){var n,a,o,i,s,f,l,h,u,c,d,w,v,p,m,g,y,b,E,_,x,A,k,N,F=arguments;return M.a.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(n=F.length>3&&void 0!==F[3]?F[3]:{},a=n.historySize,o=void 0===a?8:a,i=n.lineSearch,s=void 0===i?Pn({fRed:.001,gRed:.8}):i,f=n.updateTol,l=void 0===f?1e-14:f,h=n.scaleInit,u=void 0===h?.001:h,o%1==0){I.next=3;break}throw new Error("min_lbfgsb_gen(fg, x0, opt): opt.historySize must be an integer.");case 3:if(o>0){I.next=5;break}throw new Error("min_lbfgsb_gen(fg, x0, opt): opt.historySize must be positive.");case 5:if(r instanceof Function){I.next=7;break}throw new Error("min_lbfgsb_gen(fg,x0,bounds): fg must be a function.");case 7:if(e=tr("float64",e),t=nr(t),c=T()(e.shape,1),d=c[0],w=e.shape,1===e.ndim){I.next=12;break}throw new Error("min_lbfgsb_gen(fg,x0,bounds): x0.ndim must be 1.");case 12:if(2===t.ndim){I.next=14;break}throw new Error("min_lbfgsb_gen(fg,x0,bounds): bounds.ndim must be 2.");case 14:if(t.shape[0]===d){I.next=16;break}throw new Error("min_lbfgsb_gen(fg,x0,bounds): bounds.shape[0] must be x0.shape[0].");case 16:if(2===t.shape[1]){I.next=18;break}throw new Error("min_lbfgsb_gen(fg,x0,bounds): bounds.shape[1] must be 2.");case 18:if(u*=1,0<=(l*=1)){I.next=22;break}throw new Error("min_lbfgsb_gen(fg,x0,bounds,opt): opt.updateTol most be non-negative.");case 22:if(0<u){I.next=24;break}throw new Error("min_lbfgsb_gen(fg,x0,bounds,opt): opt.scaleInit most be greater than 0.");case 24:t=t.data,l*=1,v=t.length;case 27:if(!((v-=2)>=0)){I.next=32;break}if(t[v+0]<=t[v+1]){I.next=30;break}throw new Error("Assertion failed.");case 30:I.next=27;break;case 32:if(p=e,e=void 0,m=r(p),g=T()(m,2),y=g[0],b=g[1],y*=1,b=tr("float64",b),isFinite(y)){I.next=39;break}throw new Error("min_lbfgsb_gen(fg, x0, bounds): fg must return [float,float[]].");case 39:if(b.dtype.startsWith("float")){I.next=41;break}throw new Error("min_lbfgsb_gen(fg, x0, bounds): fg must return [float,float[]].");case 41:s=s(r),(E=new fa(o,d)).scale=1/u,_=Int32Array.from({length:d},(function(r,e){return e})),x=new Float64Array(d),A=new Float64Array(d),k=function(){var e=b.data.slice(),n=p.data.slice(),a=new Float64Array(d),o=E.compute_cauchyGeneralized(e,n,t,_,!1),i=T()(o,2),f=i[0],h=i[1];if(E.compute_subspace_Hv(e,a,_,f),!_.subarray(0,f).every((function(r){return 0===a[r]})))throw new Error("Assertion failed.");var u,c,v,m=function(){var r,e=1/0,o=ja(_.subarray(f));try{for(o.s();!(r=o.n()).done;){var i=r.value;if(0!==a[i]){var s=t[2*i+(a[i]<0)],l=(n[i]-s)/a[i];if(!(0<=l))throw new Error("Assertion failed: "+l);for(var h=0;Math.sign(a[i])*(n[i]-l*a[i]-s)<0;){if(++h>2)throw new Error("Assertion failed.");l=En(l)}if(a[i]<0&&n[i]-l*a[i]>s)throw new Error("Assertion failed.");if(a[i]>0&&n[i]-l*a[i]<s)throw new Error("Assertion failed.");e=Math.min(e,l)}}}catch(r){o.e(r)}finally{o.f()}return e}();try{var g=s(new ar(w,n.slice()),y+h,new ar(w,e),new ar(w,a),void 0,void 0,m),M=T()(g,3);u=M[0],c=M[1],v=M[2]}catch(e){if(e instanceof mn||e instanceof pn)u=e.x,c=e.f,v=e.g;else{if(!(e instanceof vn&&h<0))throw e;u=new ar(w,n);var k=r(new ar(w,n.slice())),N=T()(k,2);c=N[0],v=N[1]}}c*=1,u=tr("float64",u),v=tr("float64",v);for(var F=d;F-- >0;)x[F]=u.data[F]-p.data[F];for(var I=d;I-- >0;)A[I]=v.data[I]-b.data[I];if(x.every((function(r){return 0===r})))throw new vn;for(var P=A.reduce((function(r,e){return Math.max(r,Math.abs(e))}),0),q=0,S=0,j=A.length;j-- >0;){var O=x[j]/P,R=A[j]/P;q+=R*R,S+=O*R}l*q<S&&(E.update(x,A),E.scale=q/S),p=u,y=c,b=v},N=M.a.mark((function r(){var e;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(p instanceof ar){r.next=2;break}throw new Error("Assertion failed.");case 2:if(b instanceof ar){r.next=4;break}throw new Error("Assertion failed.");case 4:if(p.shape[0]===d){r.next=6;break}throw new Error("Assertion#7 failed.");case 6:if(b.shape[0]===d){r.next=8;break}throw new Error("Assertion#8 failed.");case 8:if(1===p.ndim){r.next=10;break}throw new Error("Assertion#4 failed.");case 10:if(1===b.ndim){r.next=12;break}throw new Error("Assertion#6 failed.");case 12:if(!isNaN(y)){r.next=14;break}throw new Error("Assertion#5 failed.");case 14:return e=b.data.slice(),p.data.forEach((function(r,n){var a=t.subarray(2*n,2+2*n),o=T()(a,2),i=o[0],s=o[1],f=e[n];(0<f&&r===i||0>f&&r===s)&&(e[n]=0)})),r.next=18,[new ar(w,p.data.slice()),y,new ar(w,e),new ar(w,b.data.slice())];case 18:return r.prev=18,k(),r.abrupt("break",32);case 23:if(r.prev=23,r.t0=r.catch(18),!(r.t0 instanceof wn&&E.m>0)){r.next=29;break}E.forget(E.m+1>>>1),r.next=30;break;case 29:throw r.t0;case 30:r.next=18;break;case 32:case"end":return r.stop()}}),r,null,[[18,23]])}));case 47:return I.delegateYield(N(),"t0",48);case 48:I.next=47;break;case 50:case"end":return I.stop()}}),Sa)}var La=M.a.mark(Ja),Da=M.a.mark(za),Ga=function(r,e,t){return Ja(new ua(r,e),t)};function Ja(r){var e,t,n,a,o,i,s,f,l,h,u,c,d,w,v,p,m,g,y,b,E,_,x,A,k,N,F,I,P,q,S,j,O,R,L,D,G,J,X,z,U,Y,Q,B,C,V,W,K,H,$,Z,rr,er,tr,nr,ar,or,ir,sr,fr=arguments;return M.a.wrap((function(M){for(;;)switch(M.prev=M.next){case 0:if(e=fr.length>1&&void 0!==fr[1]?fr[1]:{},t=e.r0,n=void 0===t?1.1:t,a=e.rMin,o=void 0===a?0:a,i=e.rMax,s=void 0===i?1/0:i,f=e.rNewton,l=void 0===f?2:f,h=e.rTol,u=void 0===h?.05:h,c=e.lmLower,d=void 0===c?.001:c,w=e.shrinkLower,v=void 0===w?.05:w,p=e.shrinkUpper,m=void 0===p?.95:p,g=e.grow,y=void 0===g?1.4142135623730951:g,b=e.expectGainMin,E=void 0===b?.25:b,_=e.expectGainMax,x=void 0===_?.75:_,A=e.stuckLimit,k=void 0===A?64:A,0<=d){M.next=3;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.lmLower must be within [0,1).");case 3:if(d<1){M.next=5;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.lmLower must be within [0,1).");case 5:if(1>u){M.next=7;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.rTol must be less than 1.");case 7:if(0<u){M.next=9;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.rTol must be positive number.");case 9:if(0<n){M.next=11;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.r0 must be positive number.");case 11:if(0<=o){M.next=13;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.rMin must be non-negative.");case 13:if(o<=s){M.next=15;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.rMin must not be greater than opt.rMax.");case 15:if(o<=n){M.next=17;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.r0 must not be less than opt.rMin.");case 17:if(s>=n){M.next=19;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.r0 must not be greater than opt.rMax.");case 19:if(1/(1+u)<l){M.next=21;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.rGN must be greater than 1/(1+rTol).");case 21:if(0<v){M.next=23;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.shrinkLower must be positive number.");case 23:if(v<=m){M.next=25;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.shrinkLower must not be greater than opt.shrinkUpper.");case 25:if(m<1){M.next=27;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.shrinkUpper must be less than 1.");case 27:if(1<y){M.next=29;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.grow must be number greater than 1.");case 29:if(0<E){M.next=31;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.expectGainMin must be positive number.");case 31:if(E<x){M.next=33;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.expectGainMin must be less than expectGainMax.");case 33:if(x<1||console.warn("lsq_lm_gen(fJ, x0, opt): opt.expectGainMax should be less than 1."),0==k%1){M.next=36;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.stuckLimit must be an integer.");case 36:if(0<=k){M.next=38;break}throw new Error("lsq_lm_gen(fJ, x0, opt): opt.stuckLimit must not be negative.");case 38:N=r.N,F=r.D,I=r.regularized_dX,P=r.G0,q=new le,S=-n*r.cauchyTravel()*r.scaledNorm(P),j=r.loss,O=0;case 40:if(0!==O){M.next=43;break}return M.next=43,r.report();case 43:if(R=r.computeNewtonRegularized(0),L=T()(R,2),D=L[0],G=L[1],isFinite(D)){M.next=46;break}throw new Error("Assertion failed.");case 46:if(J=D<=S*(1+u)){M.next=85;break}for(q.reset(),X=N;X-- >0;)z=F[X],U=P[X],0!==z&&(U/=z),q.include(U);if(D-=S,isFinite(D)){M.next=53;break}throw new Error("Assertion failed.");case 53:if(0<D){M.next=55;break}throw new Error("Assertion failed.");case 55:if(0>G){M.next=57;break}throw new Error("Assertion failed.");case 57:Y=-D/G,Q=q.result/S,B=0,C=-1;case 59:if(!(64<++C)){M.next=61;break}throw new Error("Assertion failed.");case 61:if(Y>=0){M.next=63;break}throw new Error("Assertion failed.");case 63:if(0<=Q){M.next=65;break}throw new Error("Assertion failed.");case 65:if(Y<Q){M.next=67;break}throw new Error("Assertion failed.");case 67:if(Y<B&&B<Q||(B=Math.max(d*Q,Math.sqrt(Y*Q))),Y<B&&B<Q){M.next=70;break}throw new Error("Assertion failed.");case 70:if(V=r.computeNewtonRegularized(B),W=T()(V,2),D=W[0],G=W[1],isFinite(D)){M.next=76;break}throw new Error("Assertion failed.");case 76:if(!(Math.abs(S-D)<=S*u)){M.next=78;break}return M.abrupt("break",83);case 78:D<S&&(Q=B),Y=Math.max(Y,B+(S-D)/G),B+=(S-D)/G*(D/S);case 81:M.next=59;break;case 83:if(Math.abs(r.scaledNorm(I)-S)<=S*u){M.next=85;break}throw new Error("Assertion failed.");case 85:if(r.scaledNorm(I)<=S*(1+u)){M.next=87;break}throw new Error("Assertion failed.");case 87:if(K=r.considerMove(I),H=T()(K,2),$=H[0],Z=H[1],rr=function(){return 1},!((tr=j-Z)<(er=j-$)*E)){M.next=103;break}for(nr=0,ar=N;ar-- >0;)nr+=I[ar]*P[ar];if((or=(nr*=2)/(2*nr+j-Z))>=v||(or=v),or<=m||(or=m),(ir=Math.max(o*rr(),S*or))!==S||j>Z){M.next=100;break}throw new ta;case 100:S=ir,M.next=104;break;case 103:J?(sr=rr(),S=Math.max(sr*o,Math.min(sr*s,l*D))):(tr>er*x||0===tr)&&(S=Math.min(s*rr(),Math.max(bn(S),S*y)));case 104:if(!(j>Z)){M.next=110;break}j=Z,r.makeConsideredMove(),O=0,M.next=112;break;case 110:if(!(++O>k)){M.next=112;break}throw new ta("Too many unsuccessfull iterations.");case 112:M.next=40;break;case 114:case"end":return M.stop()}}),La)}var Ta=function(r,e,t,n){return Ja(new da(r,e,t),n)},Xa=ca(Ja);function za(r,e,t,n,a){var o,i,s,f,l,h,u,c,d,w,v;return M.a.wrap((function(p){for(;;)switch(p.prev=p.next){case 0:if(t instanceof Function){p.next=2;break}throw new Error("fit_lm_gen(x,y, fg, p0): fg must be a function.");case 2:if(r=nr(r),e=nr("float64",e),n=nr("float64",n),o=Float64Array,2===r.ndim){p.next=8;break}throw new Error("fit_lm_gen(x,y, fg, p0): x.ndim must be 2.");case 8:if(1===e.ndim){p.next=10;break}throw new Error("fit_lm_gen(x,y, fg, p0): y.ndim must be 1.");case 10:if(1===n.ndim){p.next=12;break}throw new Error("fit_lm_gen(x,y, fg, p0): p0.ndim must be 1.");case 12:if(i=T()(n.shape,1),s=i[0],f=T()(r.shape,2),l=f[0],h=f[1],u=Int32Array.of(h),l==e.shape[0]){p.next=15;break}throw new Error("fit_lm_gen(x,y, fg, p0): x.shape[0] must be equal to y.shape[0].");case 15:return r=r.data.slice(),e=e.data,Object.freeze(r.buffer),r=Array.from({length:l},(function(e,t){return Object.freeze(new ar(u,r.subarray(h*t,h*t+1)))})),Object.freeze(r),c=new o(l),d=new o(l*s),w=[new ar(Int32Array.of(l),c),new ar(Int32Array.of(l,s),d)],v=function(n){var a=t(n);if(!(a instanceof Function))throw new Error;for(var o=l;o-- >0;){var i=a(r[o]),f=T()(i,2),h=f[0],u=f[1];if(h=nr(h),u=nr(u),0!==h.ndim)throw new Error("fit_lm_gen(x,y, fg, p0): fg must have signature float[nParams] => float[nDim] => [float, float[nParams]].");if(1!==u.ndim)throw new Error("fit_lm_gen(x,y, fg, p0): fg must have signature float[nParams] => float[nDim] => [float, float[nParams]].");if(u.shape[0]!==s)throw new Error("fit_lm_gen(x,y, fg, p0): fg must have signature float[nParams] => float[nDim] => [float, float[nParams]].");if(h=h.data[0],u=u.data,isNaN(h))throw new Error("fit_lm_gen(x,y, fg, p0): NaN encountered.");if(u.some(isNaN))throw new Error("fit_lm_gen(x,y, fg, p0): NaN encountered.");c[o]=h-e[o];for(var v=s;v-- >0;)d[s*o+v]=u[v]}return w},p.delegateYield(Ga(v,n,a),"t0",23);case 23:case"end":return p.stop()}}),Da)}var Ua=Float64Array.of(2,1,-1,-2),Ya=Float64Array.of(-1,8,-8,1),Qa=function(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=e.h_rel,n=void 0===t?void 0:t,a=e.h_abs,o=void 0===a?void 0:a;return function(e){var t="float32"===(e=tr("float",e)).dtype?"float32":"float64",a=q[t],i=e.shape;e=e.data;var s=null,f=null,l=null!=n?n:Math.pow(S(t),1/3),h=null!=o?o:Math.pow(S(t),1/3),u=Math.max(Math.abs(e[0])*l,h),c=function(){var t=new ar(i,a.from(e));return t.data[0]+=u*Ua[0],r(t)}();if("number"==typeof c){f=i,(s=new Float64Array(e.length))[0]=c*Ya[0];r:for(var d=0,w=1;;w=0){for(;w<Ua.length;w++){var v=new ar(i,a.from(e));v.data[d]+=u*Ua[w],c=r(v),s[d]+=c*Ya[w]}if(s[d]/=12*u,!(++d<e.length))break r;u=Math.max(Math.abs(e[d])*l,h)}}else{var p=(c=tr("float",c)).shape,m=(c=c.data).length,g=e.length;f=Int32Array.of.apply(Int32Array,x()(p).concat(x()(i))),s=new Float64Array(c.length*e.length);for(var y=0;y<m;y++)s[g*y]=c[y]*Ya[0];r:for(var b=0,E=1;;E=0){for(;E<Ua.length;E++){var _=new ar(i,a.from(e));if(_.data[b]+=u*Ua[E],(c=tr("float",r(_))).ndim!==p.length)throw new Error("num_grad(f)(x): return shape of f must be consistent.");for(var A=p.length;A-- >0;)if(c.shape[A]!==p[A])throw new Error("num_grad(f)(x): return shape of f must be consistent.");c=c.data;for(var M=0;M<m;M++)s[g*M+b]+=c[M]*Ya[E]}for(var k=0;k<m;k++)s[g*k+b]/=12*u;if(!(++b<g))break r;u=Math.max(Math.abs(e[b])*l,h)}}return new ar(f,s)}},Ba=function(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=e.h_rel,n=void 0===t?void 0:t,a=e.h_abs,o=void 0===a?void 0:a;return function(e){var t="float32"===(e=tr(e)).dtype?"float32":"float64",a=q[t],i=e.shape,s=new a((e=e.data).length),f=null!=n?n:Math.pow(S(t),1/3),l=null!=o?o:Math.pow(S(t),1/3),h=r(new ar(i,e.slice()));s.fill(-1.5*h);for(var u=e.length;u-- >0;){for(var c=Math.max(Math.abs(e[u])*f,l),d=0,w=[[1*c,2],[2*c,-.5]];d<w.length;d++){var v=T()(w[d],2),p=v[0],m=v[1],g=new ar(i,a.from(e));g.data[u]+=p,s[u]+=r(g)*m}s[u]/=c}return new ar(i,s)}},Ca=function(r,e){return Math.min(r,e)},Va=function(r,e){return Math.max(r,e)},Wa=function(r){return Math.abs(r)},Ka=function(r){return Math.sign(r)};function Ha(r,e,t){if(e*=1,t*=1,isNaN(e))throw new Error("root1d_bisect(F,a,b): a must be a number.");if(isNaN(t))throw new Error("root1d_bisect(F,a,b): b must be a number.");if(!(r instanceof Function))throw new Error("root1d_bisect(F,a,b): F must be a function.");var n=r(e),a=r(t);if(!(Ka(n)*a<=0))throw new Error("root1d_falsi(F,a,b): F(a) and F(b) must have opposite signs.");r:for(;;){var o=e,i=n,s=t-e,f=s;do{Wa(i)<Wa(a)&&(e=t,t=o,o=e,n=a,a=i,i=n);var l=bn(Ca(t,o)),h=En(Va(t,o));if(h<l||0===a)break r;var u=o-t;if(Wa(f)<Number.EPSILON*Wa(t)||Wa(n)<=Wa(a))f=s=u/2;else{var c=void 0,d=void 0,w=a/n;if(e===o)c=u*w,d=1-w;else{var v=a/i;c=w*(u*(d=n/i)*(d-v)-(t-e)*(v-1)),d=(d-1)*(v-1)*(w-1)}c<=0?c=-c:d=-d,w=f,f=s,4*c>=3*u*d||c>=Wa(.5*w*d)?f=s=u/2:s=c/d}e=t,n=a,(t+=s)>=l||(t=l),t<=h||(t=h),a=r(t)}while(Ka(a)*i<=0)}return t}function $a(r,e,t){if(e*=1,t*=1,isNaN(e))throw new Error("root1d_falsi(F,x1,x2): x1 must be a number.");if(isNaN(t))throw new Error("root1d_falsi(F,x1,x2): x2 must be a number.");if(!(r instanceof Function))throw new Error("root1d_falsi(F,x1,x2): F must be a function.");var n=r(e),a=r(t),o=n;if(0===n)return e;if(0===a)return t;if(!(Math.sign(n)*a<0))throw new Error("root1d_falsi(F,x1,x2): F(x1) and F(x2) must have opposite signs.");for(;;){var i=bn(Math.min(e,t)),s=En(Math.max(e,t));if(s<i)break;var f=(e*a-t*n)/(a-n);f>=i||(f=i),f<=s||(f=s);var l=r(f);if(0===l)return f;if(isNaN(l))throw new Error("NaN encountered.");if(Math.sign(a)*l<0)e=t,t=f,n=a,a=l,o=n;else{var h=1-l/a/(1-l/n);h>0||(h=.5),n*=h,t=f,a=l}}return Math.abs(o)<=Math.abs(a)?e:t}var Za=new Set([Array,Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray,P].map((function(r){return r.prototype}))),ro=function(){function r(){p()(this,r),this._heap=[],Object.seal(this)}return g()(r,[{key:"add",value:function(r){if(!("key"in r))throw new Error("Assertion failed.");var e=this._heap;e.push(r);for(var t=e.length-1;;){var n=(t-1)/8|0;if(0===t||r.key>=e[n].key)break;e[t]=e[n],t=n}e[t]=r}},{key:"popMin",value:function(){var r=this._heap,e=r[0],t=r.pop();if(0<r.length)for(var n=0;;){var a=n;r[n]=t;for(var o=1+8*n,i=Math.min(o+8,r.length);o<i;o++)r[o].key<r[n].key&&(n=o);if(n===a)break;r[a]=r[n]}return e}},{key:"size",get:function(){return this._heap.length}},{key:"min",get:function(){return this._heap[0]}}]),r}(),eo=function(r,e){var t=r.length;if(t!==e.length)throw new Error("Assertion failed.");for(var n=new le,a=t;a-- >0;)n.include(r[a]-e[a]);return n.result},to=function r(e,t,n,a){p()(this,r),Object.assign(this,{axis:e,threshold:t,c0:n,c1:a}),Object.seal(this)},no=function r(e){p()(this,r),this.point=e,Object.seal(this)},ao=function r(e,t,n){p()(this,r),this.key=e,this.nearest=n,Object.assign(this,t),Object.seal(this)},oo=function r(e,t){p()(this,r),this.key=e,this.point=t.point,Object.seal(this)},io=function(){function r(e){p()(this,r);var t=(e=x()(e))[0].length;if(e.some((function(r){return r.length!==t})))throw new Error("new KDTree(points): points must be iterable of (typed) arrays of same length (NDArrays are not yet supported).");if(e.some((function(r){return e=r,!Za.has(Object.getPrototypeOf(e));var e})))throw new Error("new KDTree(points): points must be iterable of (typed) arrays of same length (NDArrays are not yet supported).");var n=function(r,t){var n=e[r];e[r]=e[t],e[t]=n};this.root=function r(a,o,i){if(1==i-o)return new no(e[o]);for(;;){for(var s=e[He(o,i)][a],f=o,l=o,h=o;h<i;h++){var u=e[h][a];u<=s&&(n(h,l),u<s&&n(f++,l),l++)}var c=o+i>>>1;c=Math.max(c,f),c=Math.min(c,l);var d=(a+1)%t;return new to(a,s,r(d,o,c),r(d,c,i))}}(0,0,e.length),Object.seal(this)}return g()(r,[{key:"nearest_gen",value:M.a.mark((function r(e){var t,n,a,o,i,s,f,l,h,u;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t=new ro,(n=function(r,n){return t.add(n instanceof to?new ao(eo(e,r),n,r):new oo(eo(e,n.point),n))})(e,this.root);case 3:if(!(t.size>0)){r.next=18;break}if(!((a=t.popMin())instanceof ao)){r.next=14;break}o=a.nearest,i=a.axis,s=a.threshold,f=a.c0,l=a.c1,h=o,u=o,o[i]>s&&((h=h.slice())[i]=s),o[i]<s&&((u=u.slice())[i]=s),n(h,f),n(u,l),r.next=16;break;case 14:return r.next=16,a.point;case 16:r.next=3;break;case 18:case"end":return r.stop()}}),r,this)}))}]),r}()}])}));