/* ND.JS v0.5.0
 *
 * ND.JS is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * ND.JS is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with ND.JS. If not, see <http://www.gnu.org/licenses/>.
 */
 !function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.nd=e():r.nd=e()}(this,function(){return function(r){var e={};function t(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return r[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}return t.m=r,t.c=e,t.d=function(r,e,n){t.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:n})},t.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,e){if(1&e&&(r=t(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var a in r)t.d(n,a,function(e){return r[e]}.bind(null,a));return n},t.n=function(r){var e=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(e,"a",e),e},t.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},t.p="",t(t.s=27)}([function(r,e,t){var n=t(21),a=t(22),o=t(23);r.exports=function(r,e){return n(r)||a(r,e)||o()}},function(r,e,t){r.exports=t(14)},function(r,e,t){var n=t(11),a=t(12),o=t(13);r.exports=function(r){return n(r)||a(r)||o()}},function(r,e){r.exports=function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}},function(r,e){function t(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}r.exports=function(r,e,n){return e&&t(r.prototype,e),n&&t(r,n),r}},function(r,e){function t(r){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(r)}function n(e){return"function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?r.exports=n=function(r){return t(r)}:r.exports=n=function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":t(r)},n(e)}r.exports=n},function(r,e,t){var n=t(5),a=t(24);r.exports=function(r,e){return!e||"object"!==n(e)&&"function"!=typeof e?a(r):e}},function(r,e,t){var n=t(10);r.exports=function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),e&&n(r,e)}},function(r,e,t){var n=t(9),a=t(10),o=t(25),i=t(26);function f(e){var t="function"==typeof Map?new Map:void 0;return r.exports=f=function(r){if(null===r||!o(r))return r;if("function"!=typeof r)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(r))return t.get(r);t.set(r,e)}function e(){return i(r,arguments,n(this).constructor)}return e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a(e,r)},f(e)}r.exports=f},function(r,e){function t(e){return r.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},t(e)}r.exports=t},function(r,e){function t(e,n){return r.exports=t=Object.setPrototypeOf||function(r,e){return r.__proto__=e,r},t(e,n)}r.exports=t},function(r,e){r.exports=function(r){if(Array.isArray(r)){for(var e=0,t=new Array(r.length);e<r.length;e++)t[e]=r[e];return t}}},function(r,e){r.exports=function(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}},function(r,e){r.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(r,e,t){var n=function(){return this||"object"==typeof self&&self}()||Function("return this")(),a=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,o=a&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,r.exports=t(15),a)n.regeneratorRuntime=o;else try{delete n.regeneratorRuntime}catch(r){n.regeneratorRuntime=void 0}},function(r,e){!function(e){"use strict";var t,n=Object.prototype,a=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",f=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag",s="object"==typeof r,c=e.regeneratorRuntime;if(c)s&&(r.exports=c);else{(c=e.regeneratorRuntime=s?r.exports:{}).wrap=g;var l="suspendedStart",h="suspendedYield",v="executing",d="completed",p={},w={};w[i]=function(){return this};var m=Object.getPrototypeOf,y=m&&m(m(N([])));y&&y!==n&&a.call(y,i)&&(w=y);var b=M.prototype=x.prototype=Object.create(w);A.prototype=b.constructor=M,M.constructor=A,M[u]=A.displayName="GeneratorFunction",c.isGeneratorFunction=function(r){var e="function"==typeof r&&r.constructor;return!!e&&(e===A||"GeneratorFunction"===(e.displayName||e.name))},c.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,M):(r.__proto__=M,u in r||(r[u]="GeneratorFunction")),r.prototype=Object.create(b),r},c.awrap=function(r){return{__await:r}},q(S.prototype),S.prototype[f]=function(){return this},c.AsyncIterator=S,c.async=function(r,e,t,n){var a=new S(g(r,e,t,n));return c.isGeneratorFunction(e)?a:a.next().then(function(r){return r.done?r.value:a.next()})},q(b),b[u]="Generator",b[i]=function(){return this},b.toString=function(){return"[object Generator]"},c.keys=function(r){var e=[];for(var t in r)e.push(t);return e.reverse(),function t(){for(;e.length;){var n=e.pop();if(n in r)return t.value=n,t.done=!1,t}return t.done=!0,t}},c.values=N,k.prototype={constructor:k,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!r)for(var e in this)"t"===e.charAt(0)&&a.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=t)},stop:function(){this.done=!0;var r=this.tryEntries[0].completion;if("throw"===r.type)throw r.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var e=this;function n(n,a){return f.type="throw",f.arg=r,e.next=n,a&&(e.method="next",e.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],f=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),s=a.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(r,e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===r||"continue"===r)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=r,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(i)},complete:function(r,e){if("throw"===r.type)throw r.arg;return"break"===r.type||"continue"===r.type?this.next=r.arg:"return"===r.type?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):"normal"===r.type&&e&&(this.next=e),p},finish:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===r)return this.complete(t.completion,t.afterLoc),O(t),p}},catch:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===r){var n=t.completion;if("throw"===n.type){var a=n.arg;O(t)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(r,e,n){return this.delegate={iterator:N(r),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=t),p}}}function g(r,e,t,n){var a=e&&e.prototype instanceof x?e:x,o=Object.create(a.prototype),i=new k(n||[]);return o._invoke=function(r,e,t){var n=l;return function(a,o){if(n===v)throw new Error("Generator is already running");if(n===d){if("throw"===a)throw o;return L()}for(t.method=a,t.arg=o;;){var i=t.delegate;if(i){var f=P(i,t);if(f){if(f===p)continue;return f}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if(n===l)throw n=d,t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);n=v;var u=E(r,e,t);if("normal"===u.type){if(n=t.done?d:h,u.arg===p)continue;return{value:u.arg,done:t.done}}"throw"===u.type&&(n=d,t.method="throw",t.arg=u.arg)}}}(r,t,i),o}function E(r,e,t){try{return{type:"normal",arg:r.call(e,t)}}catch(r){return{type:"throw",arg:r}}}function x(){}function A(){}function M(){}function q(r){["next","throw","return"].forEach(function(e){r[e]=function(r){return this._invoke(e,r)}})}function S(r){var e;this._invoke=function(t,n){function o(){return new Promise(function(e,o){!function e(t,n,o,i){var f=E(r[t],r,n);if("throw"!==f.type){var u=f.arg,s=u.value;return s&&"object"==typeof s&&a.call(s,"__await")?Promise.resolve(s.__await).then(function(r){e("next",r,o,i)},function(r){e("throw",r,o,i)}):Promise.resolve(s).then(function(r){u.value=r,o(u)},function(r){return e("throw",r,o,i)})}i(f.arg)}(t,n,e,o)})}return e=e?e.then(o,o):o()}}function P(r,e){var n=r.iterator[e.method];if(n===t){if(e.delegate=null,"throw"===e.method){if(r.iterator.return&&(e.method="return",e.arg=t,P(r,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=E(n,r.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,p;var o=a.arg;return o?o.done?(e[r.resultName]=o.value,e.next=r.nextLoc,"return"!==e.method&&(e.method="next",e.arg=t),e.delegate=null,p):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function I(r){var e={tryLoc:r[0]};1 in r&&(e.catchLoc=r[1]),2 in r&&(e.finallyLoc=r[2],e.afterLoc=r[3]),this.tryEntries.push(e)}function O(r){var e=r.completion||{};e.type="normal",delete e.arg,r.completion=e}function k(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(I,this),this.reset(!0)}function N(r){if(r){var e=r[i];if(e)return e.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var n=-1,o=function e(){for(;++n<r.length;)if(a.call(r,n))return e.value=r[n],e.done=!1,e;return e.value=t,e.done=!0,e};return o.next=o}}return{next:L}}function L(){return{value:t,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(r,e,t){(function(r,n){var a=/%[sdj%]/g;e.format=function(r){if(!m(r)){for(var e=[],t=0;t<arguments.length;t++)e.push(f(arguments[t]));return e.join(" ")}t=1;for(var n=arguments,o=n.length,i=String(r).replace(a,function(r){if("%%"===r)return"%";if(t>=o)return r;switch(r){case"%s":return String(n[t++]);case"%d":return Number(n[t++]);case"%j":try{return JSON.stringify(n[t++])}catch(r){return"[Circular]"}default:return r}}),u=n[t];t<o;u=n[++t])p(u)||!g(u)?i+=" "+u:i+=" "+f(u);return i},e.deprecate=function(t,a){if(y(r.process))return function(){return e.deprecate(t,a).apply(this,arguments)};if(!0===n.noDeprecation)return t;var o=!1;return function(){if(!o){if(n.throwDeprecation)throw new Error(a);n.traceDeprecation?console.trace(a):console.error(a),o=!0}return t.apply(this,arguments)}};var o,i={};function f(r,t){var n={seen:[],stylize:s};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),d(t)?n.showHidden=t:t&&e._extend(n,t),y(n.showHidden)&&(n.showHidden=!1),y(n.depth)&&(n.depth=2),y(n.colors)&&(n.colors=!1),y(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=u),c(n,r,n.depth)}function u(r,e){var t=f.styles[e];return t?"["+f.colors[t][0]+"m"+r+"["+f.colors[t][1]+"m":r}function s(r,e){return r}function c(r,t,n){if(r.customInspect&&t&&A(t.inspect)&&t.inspect!==e.inspect&&(!t.constructor||t.constructor.prototype!==t)){var a=t.inspect(n,r);return m(a)||(a=c(r,a,n)),a}var o=function(r,e){if(y(e))return r.stylize("undefined","undefined");if(m(e)){var t="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return r.stylize(t,"string")}if(w(e))return r.stylize(""+e,"number");if(d(e))return r.stylize(""+e,"boolean");if(p(e))return r.stylize("null","null")}(r,t);if(o)return o;var i=Object.keys(t),f=function(r){var e={};return r.forEach(function(r,t){e[r]=!0}),e}(i);if(r.showHidden&&(i=Object.getOwnPropertyNames(t)),x(t)&&(i.indexOf("message")>=0||i.indexOf("description")>=0))return l(t);if(0===i.length){if(A(t)){var u=t.name?": "+t.name:"";return r.stylize("[Function"+u+"]","special")}if(b(t))return r.stylize(RegExp.prototype.toString.call(t),"regexp");if(E(t))return r.stylize(Date.prototype.toString.call(t),"date");if(x(t))return l(t)}var s,g="",M=!1,q=["{","}"];(v(t)&&(M=!0,q=["[","]"]),A(t))&&(g=" [Function"+(t.name?": "+t.name:"")+"]");return b(t)&&(g=" "+RegExp.prototype.toString.call(t)),E(t)&&(g=" "+Date.prototype.toUTCString.call(t)),x(t)&&(g=" "+l(t)),0!==i.length||M&&0!=t.length?n<0?b(t)?r.stylize(RegExp.prototype.toString.call(t),"regexp"):r.stylize("[Object]","special"):(r.seen.push(t),s=M?function(r,e,t,n,a){for(var o=[],i=0,f=e.length;i<f;++i)P(e,String(i))?o.push(h(r,e,t,n,String(i),!0)):o.push("");return a.forEach(function(a){a.match(/^\d+$/)||o.push(h(r,e,t,n,a,!0))}),o}(r,t,n,f,i):i.map(function(e){return h(r,t,n,f,e,M)}),r.seen.pop(),function(r,e,t){if(r.reduce(function(r,e){return 0,e.indexOf("\n")>=0&&0,r+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return t[0]+(""===e?"":e+"\n ")+" "+r.join(",\n  ")+" "+t[1];return t[0]+e+" "+r.join(", ")+" "+t[1]}(s,g,q)):q[0]+g+q[1]}function l(r){return"["+Error.prototype.toString.call(r)+"]"}function h(r,e,t,n,a,o){var i,f,u;if((u=Object.getOwnPropertyDescriptor(e,a)||{value:e[a]}).get?f=u.set?r.stylize("[Getter/Setter]","special"):r.stylize("[Getter]","special"):u.set&&(f=r.stylize("[Setter]","special")),P(n,a)||(i="["+a+"]"),f||(r.seen.indexOf(u.value)<0?(f=p(t)?c(r,u.value,null):c(r,u.value,t-1)).indexOf("\n")>-1&&(f=o?f.split("\n").map(function(r){return"  "+r}).join("\n").substr(2):"\n"+f.split("\n").map(function(r){return"   "+r}).join("\n")):f=r.stylize("[Circular]","special")),y(i)){if(o&&a.match(/^\d+$/))return f;(i=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(i=i.substr(1,i.length-2),i=r.stylize(i,"name")):(i=i.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),i=r.stylize(i,"string"))}return i+": "+f}function v(r){return Array.isArray(r)}function d(r){return"boolean"==typeof r}function p(r){return null===r}function w(r){return"number"==typeof r}function m(r){return"string"==typeof r}function y(r){return void 0===r}function b(r){return g(r)&&"[object RegExp]"===M(r)}function g(r){return"object"==typeof r&&null!==r}function E(r){return g(r)&&"[object Date]"===M(r)}function x(r){return g(r)&&("[object Error]"===M(r)||r instanceof Error)}function A(r){return"function"==typeof r}function M(r){return Object.prototype.toString.call(r)}function q(r){return r<10?"0"+r.toString(10):r.toString(10)}e.debuglog=function(r){if(y(o)&&(o=n.env.NODE_DEBUG||""),r=r.toUpperCase(),!i[r])if(new RegExp("\\b"+r+"\\b","i").test(o)){var t=n.pid;i[r]=function(){var n=e.format.apply(e,arguments);console.error("%s %d: %s",r,t,n)}}else i[r]=function(){};return i[r]},e.inspect=f,f.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},f.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=v,e.isBoolean=d,e.isNull=p,e.isNullOrUndefined=function(r){return null==r},e.isNumber=w,e.isString=m,e.isSymbol=function(r){return"symbol"==typeof r},e.isUndefined=y,e.isRegExp=b,e.isObject=g,e.isDate=E,e.isError=x,e.isFunction=A,e.isPrimitive=function(r){return null===r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||"symbol"==typeof r||void 0===r},e.isBuffer=t(19);var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function P(r,e){return Object.prototype.hasOwnProperty.call(r,e)}e.log=function(){var r,t;console.log("%s - %s",(r=new Date,t=[q(r.getHours()),q(r.getMinutes()),q(r.getSeconds())].join(":"),[r.getDate(),S[r.getMonth()],t].join(" ")),e.format.apply(e,arguments))},e.inherits=t(20),e._extend=function(r,e){if(!e||!g(e))return r;for(var t=Object.keys(e),n=t.length;n--;)r[t[n]]=e[t[n]];return r}}).call(this,t(17),t(18))},function(r,e){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch(r){"object"==typeof window&&(t=window)}r.exports=t},function(r,e){var t,n,a=r.exports={};function o(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function f(r){if(t===setTimeout)return setTimeout(r,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(r,0);try{return t(r,0)}catch(e){try{return t.call(null,r,0)}catch(e){return t.call(this,r,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(r){t=o}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(r){n=i}}();var u,s=[],c=!1,l=-1;function h(){c&&u&&(c=!1,u.length?s=u.concat(s):l=-1,s.length&&v())}function v(){if(!c){var r=f(h);c=!0;for(var e=s.length;e;){for(u=s,s=[];++l<e;)u&&u[l].run();l=-1,e=s.length}u=null,c=!1,function(r){if(n===clearTimeout)return clearTimeout(r);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(r);try{n(r)}catch(e){try{return n.call(null,r)}catch(e){return n.call(this,r)}}}(r)}}function d(r,e){this.fun=r,this.array=e}function p(){}a.nextTick=function(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];s.push(new d(r,e)),1!==s.length||c||f(v)},d.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=p,a.addListener=p,a.once=p,a.off=p,a.removeListener=p,a.removeAllListeners=p,a.emit=p,a.prependListener=p,a.prependOnceListener=p,a.listeners=function(r){return[]},a.binding=function(r){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(r){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(r,e){r.exports=function(r){return r&&"object"==typeof r&&"function"==typeof r.copy&&"function"==typeof r.fill&&"function"==typeof r.readUInt8}},function(r,e){"function"==typeof Object.create?r.exports=function(r,e){r.super_=e,r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}})}:r.exports=function(r,e){r.super_=e;var t=function(){};t.prototype=e.prototype,r.prototype=new t,r.prototype.constructor=r}},function(r,e){r.exports=function(r){if(Array.isArray(r))return r}},function(r,e){r.exports=function(r,e){var t=[],n=!0,a=!1,o=void 0;try{for(var i,f=r[Symbol.iterator]();!(n=(i=f.next()).done)&&(t.push(i.value),!e||t.length!==e);n=!0);}catch(r){a=!0,o=r}finally{try{n||null==f.return||f.return()}finally{if(a)throw o}}return t}},function(r,e){r.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(r,e){r.exports=function(r){if(void 0===r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}},function(r,e){r.exports=function(r){return-1!==Function.toString.call(r).indexOf("[native code]")}},function(r,e,t){var n=t(10);function a(e,t,o){return!function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(r){return!1}}()?r.exports=a=function(r,e,t){var a=[null];a.push.apply(a,e);var o=new(Function.bind.apply(r,a));return t&&n(o,t.prototype),o}:r.exports=a=Reflect.construct,a.apply(null,arguments)}r.exports=a},function(r,e,t){"use strict";t.r(e);var n={};t.r(n),t.d(n,"ARRAY_TYPES",function(){return M}),t.d(n,"eps",function(){return q}),t.d(n,"_check_dtype",function(){return S}),t.d(n,"dtypeof",function(){return P}),t.d(n,"super_dtype",function(){return I}),t.d(n,"is_subdtype",function(){return O}),t.d(n,"Complex",function(){return d}),t.d(n,"Complex128Array",function(){return A});var a={};t.r(a),t.d(a,"strong_wolfe",function(){return K}),t.d(a,"LineSearchError",function(){return V}),t.d(a,"LineSearchNoProgressError",function(){return Z});var o={};t.r(o),t.d(o,"line_search",function(){return a}),t.d(o,"num_grad",function(){return _}),t.d(o,"root1d_bisect",function(){return j}),t.d(o,"min_lbfgs_gen",function(){return tr});var i={};t.r(i),t.d(i,"rrqr_decomp",function(){return Hr}),t.d(i,"rrqr_decomp_full",function(){return Jr}),t.d(i,"rrqr_rank",function(){return Xr}),t.d(i,"rrqr_lstsq",function(){return $r}),t.d(i,"rrqr_solve",function(){return Wr}),t.d(i,"bidiag_decomp",function(){return nr}),t.d(i,"cholesky_decomp",function(){return ar}),t.d(i,"cholesky_solve",function(){return or}),t.d(i,"diag_mat",function(){return ir}),t.d(i,"diag",function(){return fr}),t.d(i,"eigen",function(){return Er}),t.d(i,"eigen_balance_pre",function(){return xr}),t.d(i,"eigen_balance_post",function(){return Ar}),t.d(i,"eye",function(){return Mr}),t.d(i,"hessenberg_decomp",function(){return ur}),t.d(i,"lstsq",function(){return Fr}),t.d(i,"lu_decomp",function(){return Tr}),t.d(i,"lu_solve",function(){return Ur}),t.d(i,"matmul2",function(){return wr}),t.d(i,"matmul",function(){return mr}),t.d(i,"permute_rows",function(){return zr}),t.d(i,"permute_cols",function(){return Cr}),t.d(i,"unpermute_rows",function(){return Br}),t.d(i,"unpermute_cols",function(){return Yr}),t.d(i,"qr_decomp_full",function(){return Sr}),t.d(i,"qr_decomp",function(){return Pr}),t.d(i,"qr_lstsq",function(){return Ir}),t.d(i,"rank",function(){return Dr}),t.d(i,"schur_eigenvals",function(){return yr}),t.d(i,"schur_eigen",function(){return br}),t.d(i,"schur_decomp",function(){return gr}),t.d(i,"SingularMatrixSolveError",function(){return qr}),t.d(i,"solve",function(){return Vr}),t.d(i,"svd_decomp",function(){return Or}),t.d(i,"svd_rank",function(){return kr}),t.d(i,"svd_solve",function(){return Nr}),t.d(i,"svd_lstsq",function(){return Lr}),t.d(i,"svd_jac_1sided",function(){return Zr}),t.d(i,"svd_jac_classic",function(){return Or}),t.d(i,"tril",function(){return Kr}),t.d(i,"triu",function(){return Rr}),t.d(i,"tril_solve",function(){return Qr}),t.d(i,"triu_solve",function(){return _r});var f={};t.r(f),t.d(f,"IS_LITTLE_ENDIAN",function(){return ce}),t.d(f,"WHITESPACES",function(){return le}),t.d(f,"b64_decode",function(){return oe}),t.d(f,"b64_encode",function(){return ie}),t.d(f,"istr_to_nd",function(){return ue}),t.d(f,"nd_to_istr",function(){return se});var u=t(3),s=t.n(u),c=t(4),l=t.n(c),h={nextUp:function(r){var e=Number.EPSILON,t=Number.MIN_VALUE,n=r*(r<0?1-e/2:1+e);if(!isFinite(r))throw new Error("Assertion failed!");if(!isFinite(n))throw new Error("Assertion failed!");n===r&&(n+=t);var a=r+(n-r)/2;r<a&&a<n&&(n=a);var o=(n+r)/2;return r<o&&o<n&&(n=o),0===n?-0:n},add:function(r,e){return r instanceof d?r.add(e):e instanceof d?e.add(r):r+e},sub:function(r,e){return r instanceof d?r.sub(e):e instanceof d?new d(r).sub(e):r-e},mul:function(r,e){return r instanceof d?r.mul(e):e instanceof d?e.mul(r):r*e},div:function(r,e){return r instanceof d?r.div(e):e instanceof d?new d(r).div(e):r/e},cast:function(r,e){return"int32"===e?4294967295&r:"float32"===e?Math.fround(r):"complex128"===e?r instanceof d?r:new d(r):r},zero:function(r){return h.cast(0,r)},one:function(r){return h.cast(1,r)},neg:function(r){return r instanceof d?r.neg():-r},abs:function(r){return r instanceof d?r.abs():Math.abs(r)},sqrt:function(r){return r instanceof d?r.sqrt():r>=0?Math.sqrt(r):new d(r).sqrt()},exp:function(r){return r instanceof d?r.exp():Math.exp(r)},min:function(r,e){return Math.min(r,e)},max:function(r,e){return Math.max(r,e)},hypot:function(r,e){return Math.hypot(r,e)},atan2:function(r,e){return Math.atan2(r,e)},conj:function(r){return r instanceof d?r.conj():r},is_equal:function(r,e){return r instanceof d?r.equals(e):e instanceof d?e.equals(r):r==e},is_close:function(r,e){var t=1e-8+1e-5*h.max(h.abs(r),h.abs(e));return h.abs(h.sub(r,e))<=t}},v=h,d=function(){function r(e,t){if(s()(this,r),null==e&&(e=0),null==t&&(t=0),null==e.re&&null==e.im||(t=e.im||0,e=e.re||0),this.re=1*e,this.im=1*t,isNaN(e))throw new Error("Real value is NaN.");if(isNaN(t))throw new Error("Imaginary value is NaN.");Object.seal(this)}return l()(r,[{key:"add",value:function(e,t){return null==e&&(e=0),null==t&&(t=0),null==e.re&&null==e.im||(t=e.im||0,e=e.re||0),new r(this.re+e,this.im+t)}},{key:"sub",value:function(e,t){return null==e&&(e=0),null==t&&(t=0),null==e.re&&null==e.im||(t=e.im||0,e=e.re||0),new r(this.re-e,this.im-t)}},{key:"mul",value:function(e,t){return null==e&&(e=0),null==t&&(t=0),null==e.re&&null==e.im||(t=e.im||0,e=e.re||0),new r(this.re*e-this.im*t,this.re*t+this.im*e)}},{key:"div",value:function(e,t){if(null==e&&(e=0),null==t&&(t=0),null==e.re&&null==e.im||(t=e.im||0,e=e.re||0),0==t)return new r(this.re/e,this.im/e);if(Math.abs(e)>=Math.abs(t)){var n=t/e;return new r((this.re+this.im*n)/(e+t*n),(this.im-this.re*n)/(e+t*n))}var a=e/t;return new r((this.re*a+this.im)/(e*a+t),(this.im*a-this.re)/(e*a+t))}},{key:"equals",value:function(r,e){return null==r&&(r=0),null==e&&(e=0),null==r.re&&null==r.im||(e=r.im||0,r=r.re||0),this.re==r&&this.im==e}},{key:"abs",value:function(){return Math.hypot(this.re,this.im)}},{key:"arg",value:function(){return Math.atan2(this.im,this.re)}},{key:"conj",value:function(){return new r(this.re,-this.im)}},{key:"toFixed",value:function(e){return new r(this.re.toFixed(e),this.im.toFixed(e))}},{key:"sqrt",value:function(){var e=this.abs();return new r(v.sqrt(v.mul(v.add(e,this.re),.5)),v.sqrt(v.mul(v.sub(e,this.re),.5)))}},{key:Symbol.for("nodejs.util.inspect.custom"),value:function(){return this.toString()}},{key:"toString",value:function(){return 0==this.im?this.re.toString():0==this.re?"".concat(this.im,"j"):this.im<0?"".concat(this.re," - ").concat(-this.im,"j"):"".concat(this.re," + ").concat(this.im,"j")}},{key:"valueOf",value:function(){return 0==this.im?this.re:this}}]),r}(),p=t(2),w=t.n(p),m=t(1),y=t.n(m),b=t(5),g=t.n(b);t(16);var E,x,A=(E=Float64Array,x={get:function(r,e){return"symbol"!==g()(e)&&e%1==0?r.get(e):r[e]},set:function(r,e,t){return"symbol"!==g()(e)&&e%1==0?(r.set(e,t),!0):(r[e]=t,!0)}},function(){function r(e,t,n){return s()(this,r),e%1==0?(n=e,this._array=new E(2*n)):(null!=n&&(n*=2),this._array=new E(e,t,n)),new Proxy(this,x)}return l()(r,null,[{key:"BYTES_PER_ELEMENT",get:function(){return 2*E.BYTES_PER_ELEMENT}},{key:"name",get:function(){return"Complex".concat(8*r.BYTES_PER_ELEMENT,"Array")}}]),l()(r,[{key:Symbol.iterator,value:y.a.mark(function r(){var e;return y.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:e=0;case 1:if(!(e<this.length)){r.next=7;break}return r.next=4,this[e];case 4:e++,r.next=1;break;case 7:case"end":return r.stop()}},r,this)})},{key:"keys",value:y.a.mark(function r(){var e;return y.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:e=0;case 1:if(!(e<this.length)){r.next=7;break}return r.next=4,e;case 4:e++,r.next=1;break;case 7:case"end":return r.stop()}},r,this)})},{key:"values",value:y.a.mark(function r(){return y.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.delegateYield(this[Symbol.iterator](),"t0",1);case 1:case"end":return r.stop()}},r,this)})},{key:"entries",value:y.a.mark(function r(){var e;return y.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:e=0;case 1:if(!(e<this.length)){r.next=7;break}return r.next=4,[e,this[e]];case 4:e++,r.next=1;break;case 7:case"end":return r.stop()}},r,this)})},{key:"forEach",value:function(r,e){for(var t=0;t<source.length;t++)r.call(e,source[t],t)}},{key:"map",value:function(e,t){return r.from(this,e,t)}},{key:"reduce",value:function(r,e){var t=0;if(null==e){if(0==this.length)throw new TypeError("TypeError: Reduce of empty array with no initial value.");e=this[t++]}for(;t<this.length;t++)e=r(e,this[t],t,this);return e}},{key:"slice",value:function(e,t){return null!=e&&(e*=2),null!=t&&(t*=2),new r(this._array.slice(e,t).buffer)}},{key:"subarray",value:function(e,t){null!=e&&(e*=2),null!=t&&(t*=2);var n=this._array.subarray(e,t);return new r(n.buffer,n.byteOffset,n.length/2)}},{key:"join",value:function(r){null==r&&(r=", ");for(var e="",t=0;t<this.length;t++)t>0&&(e+=r),e+=this[t].toString();return e}},{key:"fill",value:function(r,e,t){r instanceof d||(r=new d(r)),null==e&&(e=0),null==t&&(t=this.length),0>t&&(t+=this.length),0>e&&(e+=this.length);for(var n=e;n<t;n++)this[n]=r;return this}},{key:"get",value:function(r){return Object.freeze(new d(this._array[2*r+0],this._array[2*r+1]))}},{key:"set",value:function(r,e){if(r*=2,"number"==typeof e||!isNaN(e))return this._array[r+0]=e,void(this._array[r+1]=isNaN(e)?NaN:0);"re"in e&&"im"in e||(e=new d(e)),this._array[r+0]=e.re,this._array[r+1]=e.im}},{key:Symbol.for("nodejs.util.inspect.custom"),value:function(r){return"Complex128Array "+util.inspect(Array.from(this),r)}},{key:"toString",value:function(r){return this.join(",")}},{key:"buffer",get:function(){return this._array.buffer}},{key:"byteOffset",get:function(){return this._array.byteOffset}},{key:"byteLength",get:function(){return this._array.byteLength}},{key:"length",get:function(){return this._array.length>>>1}},{key:Symbol.toStringTag,get:function(){throw new Error("not yet implemented.")}}],[{key:"from",value:function(e,t,n){e.hasOwnProperty("length")||(e=w()(e));var a=new r(e.length);t=t||function(r){return r};for(var o=0;o<e.length;o++)a[o]=t.call(n,e[o],o);return a}},{key:"of",value:function(){for(var e=new r(arguments.length),t=0;t<arguments.length;t++)e[t]=t<0||arguments.length<=t?void 0:arguments[t];return e}}]),r}()),M={int32:Int32Array,float32:Float32Array,float64:Float64Array,complex128:A,object:Array};function q(r){switch(S(r),r){case"complex128":return new d(Number.EPSILON);case"float32":return 1.1920928955078125e-7;default:return Number.EPSILON}}function S(r){if(!M.hasOwnProperty(r))throw new Error("Invalid dtype '"+r+"'. Must be one of {'"+Object.getOwnPropertyNames(nd.dtypes).join("', '")+"'}.")}function P(r){return r%1==0?r<=~(1<<31)&&r>=1<<31?"int32":"object":1*r==r?"float64":r instanceof d?"complex128":"object"}var I=function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return e.reduce(function(r,e){return S(r),S(e),"object"===r||"object"===e?"object":"complex128"===r||"complex128"===e?"complex128":"float64"===r||"float64"===e?"float64":"float32"===r||"float32"===e?"float32":"int32"})};function O(r,e){S(r),S(e);var t={int32:0,float32:1,float64:2,complex128:3,object:4};return t[r]<=t[e]}var k=t(0),N=t.n(k),L=t(6),F=t.n(L),T=t(7),U=t.n(T),z=t(8),C=t.n(z);function B(r,e,t){if(null==t&&e instanceof Function&&(t=e,e=void 0),r instanceof Array||(r=w()(r)),r=r.map(D),null==e&&(e="object"),null==t){if("object"!==e)throw new Error('If zip_fn is undefined, dtype must be "object" or undefined.');var n=r.length;t=function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return e.slice(0,n)}}S(e);var a=r.reduce(function(r,e){return Math.max(r,e.ndim)},0),o=Int32Array.from({length:a},function(){return 1}),i=!0,f=!1,u=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0)for(var l=s.value,h=a,v=l.ndim;h-- >0&&v-- >0;)if(1===o[h])o[h]=l.shape[v];else if(o[h]!=l.shape[v]&&1!=l.shape[v])throw new Error("Shapes are not broadcast-compatible.")}catch(r){f=!0,u=r}finally{try{i||null==c.return||c.return()}finally{if(f)throw u}}var d=new Int32Array(a),p=new M[e](o.reduce(function(r,e){return r*e},1)),m=new Array(r.length),y=new Int32Array(r.length),b=new Int32Array(r.length),g=0;return function e(n){if(n!==a){for(d[n]=0;e(n+1),!(++d[n]>=o[n]);)for(var i=r.length;i-- >0;)r[i].shape[n-a+r[i].ndim]>1||(y[i]-=b[i]);for(var f=r.length;f-- >0;)b[f]*=r[f].shape[n-a+r[f].ndim]||1}else{b.fill(1);for(var u=r.length;u-- >0;)m[u]=r[u].data[y[u]++];p[g++]=t.apply(void 0,m.concat(w()(d)))}}(0),new G(o,p)}function Y(r,e){var t=y.a.mark(a);if(null==e&&(e=r,r=void 0),"object"==g()(e)&&"shape"in e&&"data"in e){var n=e.data;return null==r||n instanceof M[r]||(n=M[r].from(n)),new G(e.shape,n.slice())}function a(r){var e;return y.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!("object"===g()(r)&&"length"in r)){t.next=7;break}if("number"==typeof(e=r.length)&&e%1==0&&0!==e){t.next=4;break}throw"Illegal argument(s).";case 4:return t.next=6,e;case 6:return t.delegateYield(a(r[0]),"t0",7);case 7:case"end":return t.stop()}},t,this)}a=Int32Array.from(a(e)),null==r&&(r=function r(e,t){if(e===a.length)return P(t);for(var n=a[e]-1,o=r(e+1,t[n]);n>=0;n--)o=I(o,r(e+1,t[n]));return o}(0,e)),S(r);var o=new M[r](a.reduce(function(r,e){return r*e},1)),i=0;return function r(e,t){if(e===a.length)o[i++]=t;else{if(t.length!==a[e])throw new Error("Nested array not axis-aligned.");for(var n=0;n<a[e];n++)r(e+1,t[n])}}(0,e),new G(a,o)}function D(r){return r instanceof G?r:Y(r)}var G=function(r){function e(r,t){if(s()(this,e),!(r instanceof Int32Array))throw new Error("Shape must be Int32Array.");if(r.some(function(r){return r<1}))throw new Error("Invalid shape: ".concat(r,"."));if(t.length!=r.reduce(function(r,e){return r*e},1))throw new Error("Shape [".concat(r,"] does not match array length of ").concat(t.length,"."));var n=function r(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.data[r._flat_idx(t)]};return Object.setPrototypeOf(n,e.prototype),Object.freeze(r.buffer),n.shape=r,n.data=t,F()(void 0,n)}return U()(e,r),l()(e,null,[{key:"name",get:function(){return"nd.Array"}}]),l()(e,[{key:"set",value:function(r,e){this.data[this._flat_idx(r)]=e}},{key:"modify",value:function(r,e){var t=this._flat_idx(r);this.data[t]=e.apply(void 0,[this.data[t]].concat(w()(r)))}},{key:"_flat_idx",value:function(r){var e=this.shape;if(r.length!=e.length)throw new Error("Multi-index [".concat(r,"] does not have expected length of ").concat(e.length,"."));for(var t=0,n=1,a=e.length;a-- >0;n*=e[a]){var o=r[a];if(o%1!=0)throw new Error("Multi-index [".concat(r,"] contains non-integer entries."));if(o<0&&(o+=e[a]),o<0||o>=e[a])throw new Error("Multi-index [".concat(r,"] out of bounds [").concat(e,"]."));t+=o*n}return t}},{key:Symbol.for("nodejs.util.inspect.custom"),value:function(r,e){return this.toString()}},{key:"toString",value:function(){var r=y.a.mark(u),e=y.a.mark(l),t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(r,e){return e.length,6};if(!(t instanceof Function)){var n=1*t;t=function(){return n}}var a=this.shape,o=this.data,i=new Int32Array(a.length);i[i.length-1]=1;for(var f=i.length;--f>0;)i[f-1]=i[f]*a[f];function u(e,n){var f,s,c,l,h,v,d;return y.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(f=t(e,a),c=f-(s=f>>>1),a.length!==e){r.next=16;break}l=o[n],r.t0=l,r.next=null===r.t0?6:void 0===r.t0?9:12;break;case 6:return r.next=8,"null";case 8:return r.abrupt("break",14);case 9:return r.next=11,"undefined";case 11:return r.abrupt("break",14);case 12:return r.next=14,l.toString();case 14:r.next=37;break;case 16:if(!(a[e]>f+1)){r.next=31;break}h=0;case 18:if(!(h<c)){r.next=23;break}return r.delegateYield(u(e+1,n+h*i[e]),"t1",20);case 20:h++,r.next=18;break;case 23:v=a[e]-s;case 24:if(!(v<a[e])){r.next=29;break}return r.delegateYield(u(e+1,n+v*i[e]),"t2",26);case 26:v++,r.next=24;break;case 29:r.next=37;break;case 31:d=0;case 32:if(!(d<a[e])){r.next=37;break}return r.delegateYield(u(e+1,n+d*i[e]),"t3",34);case 34:d++,r.next=32;break;case 37:case"end":return r.stop()}},r,this)}if(u=w()(u(0,0)),this.ndim>1){var s=u.reduce(function(r,e){return Math.max(r,e.length)},0);u=u.map(function(r){return r.padStart(s)})}var c=0;function l(r,n,o){var f,s,h,v,d,p,w,m,b;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.length!==n){e.next=4;break}return e.next=3,u[c++];case 3:return e.abrupt("return");case 4:return r+=" ",f="[ ",s=", ",h=" ]",n<a.length-1&&(s=",\n"+r,f="[",h="]"),e.next=9,f;case 9:if(v=t(n,a),p=v-(d=v>>>1),!(a[n]>v+1)){e.next=31;break}w=0;case 12:if(!(w<p)){e.next=19;break}return e.delegateYield(l(r,n+1,o+w*i[n]),"t0",14);case 14:return e.next=16,s;case 16:w++,e.next=12;break;case 19:return e.next=21,"...".concat(a[n]-v," more...");case 21:m=a[n]-d;case 22:if(!(m<a[n])){e.next=29;break}return e.next=25,s;case 25:return e.delegateYield(l(r,n+1,o+m*i[n]),"t1",26);case 26:m++,e.next=22;break;case 29:e.next=40;break;case 31:b=0;case 32:if(!(b<a[n])){e.next=40;break}if(!(b>0)){e.next=36;break}return e.next=36,s;case 36:return e.delegateYield(l(r,n+1,o+b*i[n]),"t2",37);case 37:b++,e.next=32;break;case 40:return e.next=42,h;case 42:case"end":return e.stop()}},e,this)}return w()(l("",0,0)).join("")}},{key:Symbol.iterator,value:y.a.mark(function r(){var t,n,a;return y.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t=this.shape.slice(1),n=t.reduce(function(r,e){return r*e},1),a=0;case 2:if(!(a<this.data.length)){r.next=7;break}return r.next=5,new e(t,this.data.slice(a,a+=n));case 5:r.next=2;break;case 7:case"end":return r.stop()}},r,this)})},{key:"forEach",value:function(r){for(var t=this.shape[0],n=this.shape.slice(1),a=n.reduce(function(r,e){return r*e},1),o=0,i=0;o<t;o++,i+=a)r(new e(n,this.data.slice(i,i+a)),o)}},{key:"elems",value:y.a.mark(function(){var r,e,t,n,a,o;return y.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return o=function(i){return y.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i!==e.length){r.next=5;break}return r.next=3,[n.slice(),t[a++]];case 3:r.next=11;break;case 5:n[i]=0;case 6:if(!(n[i]<e[i])){r.next=11;break}return r.delegateYield(o(i+1),"t0",8);case 8:n[i]++,r.next=6;break;case 11:case"end":return r.stop()}},r,this)},r=y.a.mark(o),e=this.shape,t=this.data,n=new Int32Array(e.length),a=0,i.delegateYield(o(0),"t0",5);case 5:case"end":return i.stop()}},o,this)})},{key:"forElems",value:function(r){var e=this.shape,t=this.data,n=new Int32Array(e.length),a=0;!function o(i){if(i===e.length)r.apply(void 0,[t[a++]].concat(w()(n)));else for(n[i]=0;n[i]<e[i];n[i]++)o(i+1)}(0)}},{key:"valueOf",value:function(){return 0===this.shape.length?this.data[0]:this}},{key:"mapElems",value:function(r,e){return null==e&&r instanceof Function&&(e=r,r=void 0),null==e&&(e=function(r){return r}),B([this],r,e)}},{key:"transpose",value:function(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];t=w()(t);var a=Int32Array.from(this.shape),o=a.length,i=new Int32Array(o);o>0&&(i[o-1]=1);for(var f=o;--f>0;)i[f-1]=a[f]*i[f];if(0==t.length){if(o<=1)return this.sliceElems();a[o-2]=this.shape[o-1],a[o-1]=this.shape[o-2];var u=i[o-2];i[o-2]=i[o-1],i[o-1]=u}else{var s=new Set(t),c=i;if(i=new Int32Array(o),s.size!=t.length)throw new Error("Duplicate axes are not allowed.");for(var l=t.length;l-- >0;){var h=t[l];if(0>h||h>=o)throw new Error("Axis out of bounds.");a[l]=this.shape[h],i[l]=c[h]}for(var v=0,d=s.size;v<o;v++)s.has(v)||(a[d]=this.shape[v],i[d++]=c[v])}var p=this.data,m=new p.__proto__.constructor(p.length),y=p.length;return function r(e,t){if(o>e)for(var n=a[e];n-- >0;t-=i[e])r(e+1,t);else m[--y]=p[t]}(0,y-1),new e(a,m)}},{key:"reshape",value:function(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];t=Int32Array.from(t);for(var a=this.data.length,o=1,i=-1,f=t.length;--f>=0;)if(t[f]<0){if(-1!==t[f])throw new Error("Invalid dimension: "+t[f]);if(-1!==i)throw new Error("At most on dimension may be -1.");i=f}else o*=t[f];if(-1!==i){if(0!=a%o)throw new Error("Shape cannot be inferred.");t[i]=a/o}return new e(t,this.data)}},{key:"reduceElems",value:function(r,t,n){if(null==n){if(null==t)return this.data.reduce(r);if("string"==typeof r)return this.data.reduce(t);n=t,t=void 0}if(null==t&&(t="object"),!O(this.dtype,t))throw new Error("New dtype must be a super-dtype.");var a=this.ndim;if("number"==typeof r&&(r=[r]),r instanceof e){if(!O(r.dtype,"int32"))throw new Error("Invalid dtype ".concat(r.dtype," for axes."));if(1!==r.ndim)throw new Error("Only 1D nd.Array allowed for axes.");r=r.data}r=new Set(y.a.mark(function e(){var t,n,o,i,f,u;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,o=void 0,e.prev=3,i=r[Symbol.iterator]();case 5:if(t=(f=i.next()).done){e.next=15;break}if(0>(u=f.value)&&(u+=a),!(0>u||u>=a)){e.next=10;break}throw new Error("Reduction axis "+u+" out of bounds.");case 10:return e.next=12,+u;case 12:t=!0,e.next=5;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(3),n=!0,o=e.t0;case 21:e.prev=21,e.prev=22,t||null==i.return||i.return();case 24:if(e.prev=24,!n){e.next=27;break}throw o;case 27:return e.finish(24);case 28:return e.finish(21);case 29:case"end":return e.stop()}},e,this,[[3,17,21,29],[22,,24,28]])})());var o=this.shape,i=o.filter(function(e,t){return!r.has(t)}),f=new M[t](i.reduce(function(r,e){return r*e},1)),u=this.data,s=0,c=0;if(function e(t,a){if(o.length===t)f[s]=a?n(u[c++],f[s]):u[c++],++s;else if(r.has(t))for(var i=s,l=o[t];l-- >0;a=!0)s=i,e(t+1,a);else for(var h=o[t];h-- >0;)e(t+1,a)}(0,!1),s!=f.length)throw new Error([s,f.length]);if(c!=this.data.length)throw new Error([c,this.data.length]);return new e(i,f)}},{key:"sliceElems",value:function(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];for(var a=this.ndim,o=this.shape,i=0,f=0,u=0,s=0;s<t.length;s++){var c=t[s];if("..."===c)++i;else if("new"===c)0;else if("number"==typeof c){if(c%1!=0)throw new Error("Only integral indices allowed.");++f}else{var l=c.length;if("number"!=typeof l||l%1!=0||l>3||1==l)throw new Error("Illegal argument(s).");++u}}if(i>1)throw new Error("Highlander! There can be only one ... (ellipsis).");if(0==i&&t.push("..."),f+u>a)throw new Error("Cannot sliced more dimensions than available.");var h=0,v=[],d=Int32Array.from(y.a.mark(function r(){var e,n,i,s,c,l,d,p,w,m,b,g,E;return y.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:e=a,n=1,i=t.length;case 2:if(!(--i>=0)){r.next=54;break}s=t[i],r.t0=s,r.next="new"===r.t0?7:"..."===r.t0?11:21;break;case 7:return v.push(0),r.next=10,1;case 10:return r.abrupt("break",52);case 11:c=f+u;case 12:if(!(c<a)){r.next=20;break}return v.push(n),n*=o[--e],r.next=17,o[e];case 17:c++,r.next=12;break;case 20:return r.abrupt("break",52);case 21:if(--e,"number"!=typeof s){r.next=29;break}if(0>s&&(s+=o[e]),!(0>s||s>=o[e])){r.next=26;break}throw new Error("Index out of bounds.");case 26:h+=n*s,r.next=51;break;case 29:if(l=s,d=N()(l,3),p=d[0],w=void 0===p?void 0:p,m=d[1],b=void 0===m?void 0:m,g=d[2],E=void 0===g?1:g,b<0&&(b+=o[e]),w<0&&(w+=o[e]),!(0>w||w>=o[e])){r.next=34;break}throw new Error("Slice start out of bounds.");case 34:if(0!=E){r.next=36;break}throw new Error("Stride/step cannot be zero.");case 36:if(!(E<0)){r.next=43;break}if(null==w&&(w=o[e]-1),null==b&&(b=-1),!(-1>b||b>=o[e])){r.next=41;break}throw new Error("Slice end out of bounds.");case 41:r.next=47;break;case 43:if(null==w&&(w=0),null==b&&(b=o[e]),!(0>b||b>o[e])){r.next=47;break}throw new Error("Slice end out of bounds.");case 47:return v.push(n*E),h+=n*w,r.next=51,1+Math.trunc((-Math.sign(E)+b-w)/E);case 51:n*=o[e];case 52:r.next=2;break;case 54:case"end":return r.stop()}},r,this)})()),p=this.data,w=new M[this.dtype](d.reduce(function(r,e){return r*e},1)),m=0;return function r(e,t){if(0===e)w[m++]=p[t];else for(var n=d[--e];n-- >0;t+=v[e])r(e,t)}(d.length,h),d.reverse(),new e(d,w)}},{key:"ndim",get:function(){return this.shape.length}},{key:"dtype",get:function(){for(var r=Object.entries(M),e=0;e<r.length;e++){var t=N()(r[e],2),n=t[0],a=t[1];if(this.data instanceof a)return n}throw new Error("Data type could not determined.")}},{key:"T",get:function(){return 0==this.ndim?this.sliceElems():1==this.ndim?this.sliceElems([],"new"):this.transpose()}},{key:"H",get:function(){var r=this.T;return"object"!=this.dtype&&"complex128"!=this.dtype?r:r.mapElems(math.conj)}}]),e}(C()(Function));function J(r,e,t){if(r=Int32Array.from(r,function(e){if(e%1!=0)throw new Error("tabulate(shape, dtype='object', idx2val): Invalid shape [".concat(r,"]."));return e}),null==t&&(t=e,e=void 0),null==t)throw new Error("tabulate(shape, dtype='object', idx2val): idx2val missing.");null==e&&(e="object"),S(e);var n=new Int32Array(r.length),a=new M[e](r.reduce(function(r,e){return r*e},1)),o=0;return function e(i){if(i===r.length)a[o++]=t.apply(void 0,w()(n));else for(n[i]=0;n[i]<r[i];n[i]++)e(i+1)}(0),new G(r,a)}function H(r,e,t){if(null==t&&(null==e?(t=r,r=void 0):(t=e,e=void 0,"string"==typeof r&&(e=r,r=void 0))),"length"in t||(t=w()(t)),null==r&&(r=0),null==e&&(e=I.apply(void 0,w()(t.map(function(r){return r.dtype})))),0>r&&(r+=t[0].shape.length),0>r||r>=t[0].shape.length)throw new Error("Axis out of bounds.");for(var n=Int32Array.from(t[0].shape),a=function(e){var a=t[e].shape;if(n.length!=a.length)throw new Error("All shapes must have the same length.");if(!n.every(function(e,t){return n[t]===a[t]||r===t}))throw new Error("Shape along all axes but the concatentation axis must match.");n[r]+=a[r]},o=t.length;--o>0;)a(o);var i=n.slice(r+1).reduce(function(r,e){return r*e},1),f=Int32Array.from(t,function(r){return r.data.length}),u=new M[e](n.reduce(function(r,e){return r*e},1)),s=u.length;return function e(a){if(a===r)for(var o=t.length;o-- >0;)for(var c=t[o].shape[a]*i;c-- >0;)u[--s]=t[o].data[--f[o]];else for(var l=n[a];l-- >0;)e(a+1)}(0),new G(n,u)}function X(r,e,t){if(null==t&&(null==e?(t=r,r=void 0):(t=e,e=void 0,"string"==typeof r&&(e=r,r=void 0))),"length"in t||(t=w()(t)),null==r&&(r=0),0>r&&(r+=t[0].shape.length+1),0>r||r>t[0].shape.length)throw new Error("Axis out of bounds.");return t=t.map(function(e){return e.reshape.apply(e,w()(e.shape.slice(0,r)).concat([1],w()(e.shape.slice(r))))}),H(r,e,t)}var W=t(9),$=t.n(W),V=function(r){function e(){return s()(this,e),F()(this,$()(e).apply(this,arguments))}return U()(e,r),e}(C()(Error)),Z=function(r){function e(){return s()(this,e),F()(this,$()(e).apply(this,arguments))}return U()(e,r),e}(V),K=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=r.c1,t=void 0===e?.4:e,n=r.c2,a=void 0===n?.8:n,o=r.c3,i=void 0===o?1.6:o;if(t<=0)throw new Error("strong_wolfe({c1,c2,c3}): c1 must be positive.");if(t>=a)throw new Error("strong_wolfe({c1,c2,c3}): c1 must less than c2.");if(1<=a)throw new Error("strong_wolfe({c1,c2,c3}): c2 must less than 1.");if(1>=i)throw new Error("strong_wolfe({c1,c2,c3}): c3 must larger than 1.");return function(r){return function(e,n,o,f){if(e=D(e),o=D(o),1!==e.ndim)throw new Error("strong_wolfe()(fg)(X0,f0,G0): X0.ndim must be 1.");if(1!==o.ndim)throw new Error("strong_wolfe()(fg)(X0,f0,G0): G0.ndim must be 1.");if(e.shape[0]!==o.shape[0])throw new Error("strong_wolfe()(fg)(X0,f0,G0): X0 and G0 must have the same shape.");if(isNaN(n))throw new Error("strong_wolfe()(fg)(X0,f0,G0): f0 is NaN.");var u=[e,o].every(function(r){return"float32"===r.dtype})?"float32":"float64",s=function(r){for(var e=0,t=N()(f.shape,1)[0];t-- >0;)e-=f.data[t]*r.data[t];return e},c=s(o);if(c>=0)throw new Error("strong_wolfe: Initial projected gradient not negative.");var l=0,h=1,v=1/0,d=n;r:for(;;){var p=B([e,f],u,function(r,e){return r-h*e}),w=r(p),m=N()(w,2),y=m[0],b=s(E=m[1]);if(y-n>t*h*c||0<l&&y>=d){v=h;break r}if(Math.abs(b)<=-a*c)return[p,y,E];if(b>=0){v=l,l=h,d=y;break r}if(!(h<v))throw new V("strong_wolfe: Strong Wolfe condition not satisfiable in range.");l=h,h*=i,d=y}if(l===v)throw new V("strong_wolfe: bracketing failed.");for(var g=function(){if(0===l)throw new Z("strongWolfeLineSearch(): no progress.");throw new V("strong_wolfe: bisection failed ".concat(JSON.stringify({"αMin":l,"α":h,"αMax":v}),"."))};;){h=(l+v)/2;p=B([e,f],u,function(r,e){return r-h*e});var E,x=r(p),A=N()(x,2);y=A[0],b=s(E=A[1]);if(y-n>t*h*c||y>=d)v===h&&g(),v=h;else{if(Math.abs(b)<=-a*c)return[p,y,E];b*(v-l)>=0&&(v=l),l===h&&g(),l=h,d=y}}}}},_=function(r){arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.pow(2,-12);return function(e){e=D(e);var t=M["float32"===e.dtype?"float32":"float64"],n=e.shape;e=e.data;for(var a=new t(e.length),o=Math.sqrt(Number.EPSILON),i=function(i){for(var f=Math.max(Math.abs(e[i])*o,o),u=[[2*f,-1],[1*f,8],[-1*f,-8],[-2*f,1]],s=function(){var o=N()(u[c],2),f=o[0],s=o[1],l=new G(n,t.from(e,function(r,e){return r+f*(i===e)}));a[i]+=s*r(l)},c=0;c<u.length;c++)s();a[i]/=12*f},f=e.length;f-- >0;)i(f);return new G(n,a)}};function j(r,e,t){var n=r(e),a=r(t);if(n>a){var o=[a,n,t,e];n=o[0],a=o[1],e=o[2],t=o[3]}if(n>0){if(n<=+Number.EPSILON)return e;throw new Error("Assertion failed.")}if(a<0){if(a>=-Number.EPSILON)return t;throw new Error("Assertion failed.")}if(n>0)return e;if(a<0)return t;for(;;){var i=(e+t)/2;if(e==i||t==i)break;var f=r(i);if(isNaN(f))throw new Error("NaN encountered.");f<=0&&(e=i,n=f),f>=0&&(t=i,a=f)}return Math.abs(n)<=Math.abs(a)?e:t}var rr=y.a.mark(tr);function er(r,e){if(r.length!==e.length)throw new Error;for(var t=0,n=r.length;n-- >0;)t+=r[n]*e[n];return t}function tr(r,e){var t,n,a,o,i,f,u,s,c,l,h,v,d,p,w,m,b,g,E,x,A=arguments;return y.a.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:t=A.length>2&&void 0!==A[2]?A[2]:{},n=t.historySize,a=void 0===n?8:n,o=t.lineSearch,i=void 0===o?K():o,f=t.negDir0,u=void 0===f?function(r){return r}:f,s=D(e),c=r(s),l=N()(c,2),h=l[0],v=l[1],d=N()(s.shape,1),p=d[0],w=s.shape,i=i(r),m=[],b=[],g=[],E=function(r){r=Float64Array.from(r.data);for(var e=new Float64Array(m.length),t=b.length;t-- >0;){e[t]=er(m[t],r)/b[t];for(var n=p;n-- >0;)r[n]-=e[t]*g[t][n]}r=u(new G(w,r)),r=Float64Array.from(r.data);for(var a=0;a<b.length;a++)for(var o=er(g[a],r)/b[a],i=p;i-- >0;)r[i]+=(e[a]-o)*m[a][i];return new G(w,r)},x=function(){var r=i(s,h,v,E(v)),e=N()(r,3),t=e[0],n=e[1],o=e[2];s=s.data,v=v.data;var f=Float64Array.from(o.data,function(r,e){return r-v[e]}),u=Float64Array.from(t.data,function(r,e){return r-s[e]});if(g.push(f),b.push(er(f,u)),m.push(u),m.length>a&&(m.shift(),b.shift(),g.shift()),m.length>a)throw new Error("Assertion failed.");if(m.length!==b.length)throw new Error("Assertion failed.");if(m.length!==g.length)throw new Error("Assertion failed.");s=t,h=n,v=o};case 8:if(1===s.ndim){y.next=10;break}throw new Error("Assertion failed.");case 10:if(0===h.ndim){y.next=12;break}throw new Error("Assertion failed.");case 12:if(1===v.ndim){y.next=14;break}throw new Error("Assertion failed.");case 14:if(s.shape[0]===p){y.next=16;break}throw new Error("Assertion failed.");case 16:if(v.shape[0]===p){y.next=18;break}throw new Error("Assertion failed.");case 18:return y.next=20,[s,h,v].map(function(r){return new G(r.shape,r.data.slice())});case 20:y.prev=20,x(),y.next=32;break;case 24:if(y.prev=24,y.t0=y.catch(20),!(y.t0 instanceof Z)){y.next=31;break}m=[],b=[],g=[],x(),y.next=32;break;case 31:throw y.t0;case 32:y.next=8;break;case 34:case"end":return y.stop()}},rr,this,[[20,24]])}function nr(r){if((r=D(r)).ndim<2)throw new Error("A must be at least 2D.");var e,t,n=M["float32"===r.dtype?"float32":"float64"],a=Int32Array.from(r.shape),o=Int32Array.from(a),i=Int32Array.from(a),f=r.shape.slice(-2),u=N()(f,2),s=u[0],c=u[1],l=r.shape.slice(0,-2).reduce(function(r,e){return r*e},1),h=Math.min(s,c),v=s>=c?h:h+1;if(a[a.length-1]=h,o[o.length-2]=h,o[o.length-1]=v,i[i.length-2]=v,s>=c)r=e=n.from(r.data),t=new n(l*c*c);else{t=new n(l*(s+1)*c);for(var d=(r=r.data).length,p=t.length;d-- >0;)t[--p]=r[d];r=t,e=new n(l*s*s)}for(var w=new n(l*h*v),m=new n(h*(s-1+s-h)),y=new n(s<c?h*(c-2+c-h-1):(h-1)*(c-2)),b=new n(Math.max(s-h,c)),g=s>=c?0:l*c,E=0,x=0,A=0;x<w.length;g+=s*c,E+=s*h,x+=h*v,A+=v*c){for(var q=0,S=0,P=0;P<h;P++){for(var I=P+1;I<s;I++){var O=r[g+c*I+P];if(0!=O){var k=r[g+c*P+P],L=Math.hypot(k,O),F=k/L,T=O/L;r[g+c*P+P]=L,r[g+c*I+P]=0;for(var U=P;++U<c;){var z=g+c*P+U,C=r[z],B=g+c*I+U,Y=r[B];r[z]=Y*T+C*F,r[B]=Y*F-C*T}m[q++]=F,m[q++]=T}else m[q++]=1,m[q++]=0}if(!(P+3>c)){for(var J=P+2;J<c;J++){var H=g+c*P+(P+1),X=r[H],W=g+c*P+J,$=r[W],V=Math.hypot(X,$);r[H]=V,r[W]=0,y[S++]=0==V?1:X/V,y[S++]=0==V?0:$/V}for(var Z=P+1;Z<s;Z++){S-=2*(c-P-2);for(var K=P+2;K<c;K++){var R=y[S++],Q=y[S++],_=g+c*Z+(P+1),j=r[_],rr=g+c*Z+K,er=r[rr];r[_]=er*Q+j*R,r[rr]=er*R-j*Q}}}}if(q!=m.length)throw new Error("Assertion failed: (csiU="+q+") != (csU.length="+m.length+")");if(S!=y.length)throw new Error("Assertion failed: (csiV="+S+") != (csV.length="+y.length+")");for(var tr=0;tr<h;tr++)for(var nr=0;nr<v;nr++)w[x+v*tr+nr]=r[g+c*tr+nr];for(var ar=0;ar<s;ar++){q=0;for(var or=0;or<s-h;or++)b[or]=ar!=or+h?0:1;for(var ir=0;ir<h;ir++)e[E+h*ar+ir]=ar!=ir?0:1;for(var fr=0;fr<h;fr++){var ur=Math.max(1,ar-fr);q+=2*(ur-1);for(var sr=fr+ur;sr<h;sr++){var cr=m[q++],lr=m[q++],hr=E+h*ar+fr,vr=e[hr],dr=E+h*ar+sr,pr=e[dr];e[hr]=pr*lr+vr*cr,e[dr]=pr*cr-vr*lr}for(var wr=Math.max(0,fr+ur-h);wr<s-h;wr++){var mr=m[q++],yr=m[q++],br=E+h*ar+fr,gr=e[br];e[br]=b[wr]*yr+gr*mr,b[wr]=b[wr]*mr-gr*yr}}}for(var Er=0;Er<c;Er++){S=0,b.fill(0,0,c),b[Er]=1;for(var xr=0;xr<h;xr++){var Ar=Math.max(2,Er-xr);S+=2*(Ar-2);for(var Mr=xr+Ar;Mr<c;Mr++){var qr=y[S++],Sr=y[S++],Pr=b[xr+1],Ir=b[Mr];b[xr+1]=Ir*Sr+Pr*qr,b[Mr]=Ir*qr-Pr*Sr}}for(var Or=0;Or<v;Or++)t[A+c*Or+Er]=b[Or]}}return[new G(a,e),new G(o,w),new G(i,t)]}function ar(r){var e="float32"===(r=D(r)).dtype?"float32":"float64",t=r.shape,n=t.slice(-2),a=N()(n,2),o=a[0],i=a[1],f=M[e].from(r.data);if(r=void 0,o!=i)throw new Error("Last two dimensions must be quadratic.");for(var u=0;u<f.length;u+=o*o)for(var s=0;s<o;s++)for(var c=0;c<o;c++)if(s<c)f[u+o*s+c]=0;else{for(var l=f[u+o*s+c],h=0,v=0;v<c;v++){var d=h+f[u+o*s+v]*f[u+o*c+v],p=l-d;h=p-l+d,l=p}if(s>c)f[u+o*s+c]=l/f[u+o*c+c];else if(f[u+o*s+s]=Math.sqrt(l),isNaN(f[u+o*s+s]))throw new Error("Matrix contains NaNs or is (near) singular.")}return new G(t,f)}function or(r,e){if(r=D(r),e=D(e),r.ndim<2)throw new Error("L must be at least 2D.");if(e.ndim<2)throw new Error("y must be at least 2D.");var t=r.shape.slice(-2),n=N()(t,2),a=n[0],o=n[1],i=e.shape.slice(-2),f=N()(i,2),u=f[0],s=f[1];if(a!=o)throw new Error("Last two dimensions of L must be quadratic.");if(u!=o)throw new Error("L and y don't match.");var c=Math.max(r.ndim,e.ndim),l=Int32Array.from({length:c},function(){return 1});l[c-2]=u,l[c-1]=s;for(var h=[r,e],v=0;v<h.length;v++)for(var d=h[v],p=c-2,w=d.ndim-2;p-- >0&&w-- >0;)if(1===l[p])l[p]=d.shape[w];else if(l[p]!=d.shape[w]&&1!=d.shape[w])throw new Error("Shapes are not broadcast-compatible.");var m="float32"===r.dtype&&"float32"===e.dtype?"float32":"float64",y=new M[m](l.reduce(function(r,e){return r*e},1)),b=r.data,g=e.data,E=0,x=1,A=0,q=1,S=0;return function t(n){if(n===c-2){x=a*a,q=a*s;for(var o=0;o<q;o++)y[S+o]=g[A+o];for(var i=0;i<u;i++)for(var f=0;f<s;f++){for(var h=0;h<i;h++)y[S+i*s+f]-=b[E+a*i+h]*y[S+h*s+f];y[S+i*s+f]/=b[E+a*i+i]}for(var v=u;v-- >0;)for(var d=s;d-- >0;){y[S+v*s+d]/=b[E+a*v+v];for(var p=v;p-- >0;)y[S+p*s+d]-=b[E+a*v+p]*y[S+v*s+d]}return E+=x,A+=q,void(S+=q)}for(var w=l[n];t(n+1),1!=w;w--)r.shape[n-c+r.ndim]>1||(E-=x),e.shape[n-c+e.ndim]>1||(A-=q);x*=r.shape[n-c+r.ndim]||1,q*=e.shape[n-c+e.ndim]||1}(0),new G(l,y)}function ir(r){if(r.ndim<1)throw new Error("diag_mat(diag): diag.ndim=".concat(r.ndim," is less than 1."));var e=(r=D(r)).shape,t=e[e.length-1],n=r.data,a=M[r.dtype].from({length:e.reduce(function(r,e){return r*e})*t},function(){return 0});if(r=void 0,e.length<1)throw new Error("diag_mat(diag): diag must be at least 1d.");if(t<=0)throw new Error("Assertion Failed!");for(var o=0,i=0;;){for(var f=o+t;a[i]=n[o],++o!==f;)i+=t+1;if(++i==a.length)break}return new G(Int32Array.of.apply(Int32Array,w()(e).concat([t])),a)}function fr(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(r.ndim<2)throw new Error("diag(A, offset): A.ndim=".concat(r.ndim," is less than 2."));var t=(r=D(r)).shape.slice(-2),n=N()(t,2),a=n[0],o=n[1],i=r.shape.slice(0,-1),f=M[r.dtype];if(r=r.data,!(e>-a&&e<+o))throw new Error("diag(A, offset): offset=".concat(e," out of A.shape=[").concat(r.shape,"]."));var u=Math.min(a,a+e,o,o-e);i[i.length-1]=u;for(var s=new f(i.reduce(function(r,e){return r*e})),c=Math.max(0,e,-e*o),l=0,h=0;h<r.length;l+=u,h+=a*o)for(var v=0;v<u;v++)s[l+v]=r[h+c+o*v+v];return new G(i,s)}function ur(r){if((r=D(r)).ndim<2)throw new Error("A must be at least 2D.");var e=M["float32"===r.dtype?"float32":"float64"],t=r.shape,n=t[t.length-1],a=new e(n-1),o=new e(n);if(n!=t[t.length-2])throw new Error("A is not square.");var i=e.from(r.data);r=void 0;for(var f=new e(i.length),u=0;u<i.length;u+=n*n){for(var s=0;s<n;s++)f[u+n*s+s]=1;for(var c=n;--c>1;){for(var l=void 0,h=0,v=0,d=c;d-- >0;){var p=i[u+n*c+d];if(a[d]=p,(p=Math.abs(p))>0){if(p>v){var w=v/p;v=p,h*=w*w}var m=p/v;h+=m*m}}l=isFinite(v)?Math.sqrt(h)*v:v,a[c-1]>0&&(l*=-1),a[c-1]-=l,h=0,v=0;for(var y=c;y-- >0;){var b=Math.abs(a[y]);if(b>0){if(b>v){var g=v/b;v=b,h*=g*g}var E=b/v;h+=E*E}}if(0!=(h=isFinite(v)?Math.sqrt(h)*v:v)){for(var x=c;x-- >0;)a[x]/=h;for(var A=n;A-- >0;)if(A!=c){for(var q=0,S=c;S-- >0;)q+=a[S]*i[u+n*A+S];q*=2;for(var P=c;P-- >0;)i[u+n*A+P]-=a[P]*q}i.fill(0,u+n*c+0,u+n*c+c-1),i[u+n*c+c-1]=l,o.fill(0);for(var I=c;I-- >0;)for(var O=n;O-- >0;)o[O]+=a[I]*i[u+n*I+O];for(var k=c;k-- >0;)for(var N=n;N-- >0;)i[u+n*k+N]-=2*a[k]*o[N];for(var L=n;L-- >0;){for(var F=0,T=c;T-- >0;)F+=a[T]*f[u+n*L+T];F*=2;for(var U=c;U-- >0;)f[u+n*L+U]-=a[U]*F}}}}return[new G(t,f),new G(t,i)]}var sr=y.a.mark(function r(){var e;return y.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e=function(r){return new Function("A_shape","A","B_shape","B","C_shape","C","\n       const I = A_shape[A_shape.length-2],\n             K = A_shape[A_shape.length-1],\n             J = B_shape[B_shape.length-1]\n    \n       let\n        a = 0, aStride = 1,\n        b = 0, bStride = 1,\n        c = 0;\n    \n      const loops = new Int32Array(C_shape.length-2);\n      for( let d=0; d >= 0; )\n        if( d === C_shape.length-2 ) {\n          aStride = I*K;\n          bStride = K*J;\n          for( const cEnd = c + I*J; c < cEnd; c += J, b -= bStride ) \n          for( const aEnd = a + K  ; a < aEnd; c -= J, a++ ) \n          for( const bEnd = b +   J; b < bEnd; c += 1, b++ )\n            ".concat(r,"\n          b += bStride;\n          d -= 1;\n        }\n        else\n        {\n          if( loops[d]++ > 0 ) {\n            if( loops[d] > C_shape[d] ) {\n              aStride *= A_shape[ d - C_shape.length + A_shape.length ] || 1;\n              bStride *= B_shape[ d - C_shape.length + B_shape.length ] || 1;\n              loops[d--] = 0;\n              continue;\n            }\n            if( ! (A_shape[ d - C_shape.length + A_shape.length ] > 1) ) a -= aStride;\n            if( ! (B_shape[ d - C_shape.length + B_shape.length ] > 1) ) b -= bStride;\n          }\n          ++d;\n        }\n    "))},r.next=3,e("C[c] += A[a]*B[b]");case 3:return r.next=5,e("{\n    C[2*c+0] += A[a] * B[2*b+0];\n    C[2*c+1] += A[a] * B[2*b+1];\n  }");case 5:return r.next=7,e("{\n    C[2*c+0] += B[b] * A[2*a+0];\n    C[2*c+1] += B[b] * A[2*a+1];\n  }");case 7:return r.next=9,e("{\n    C[2*c+0] += B[2*b+0] * A[2*a+0]  -  B[2*b+1] * A[2*a+1];\n    C[2*c+1] += B[2*b+0] * A[2*a+1]  +  B[2*b+1] * A[2*a+0];\n  }");case 9:return r.next=11,e("C[c] = this.math.add(C[c], this.math.mul(A[a],B[b]))").bind({math:v});case 11:case"end":return r.stop()}},r,this)})(),cr=N()(sr,5),lr=cr[0],hr=cr[1],vr=cr[2],dr=cr[3],pr=cr[4];function wr(r,e){if(r=D(r),e=D(e),r.ndim<2)throw new Error("A must be at least 2D.");if(e.ndim<2)throw new Error("B must be at least 2D.");var t=r.shape.slice(-2),n=N()(t,2),a=n[0],o=n[1],i=e.shape[e.ndim-1];if(e.shape[e.ndim-2]!=o)throw new Error("The last dimension of A and the 2nd to last dimension of B do not match.");var f=Math.max(r.ndim,e.ndim),u=Int32Array.from({length:f},function(){return 1});u[f-2]=a,u[f-1]=i;for(var s=[r,e],c=0;c<s.length;c++)for(var l=s[c],h=f-2,v=l.ndim-2;h-- >0&&v-- >0;)if(1===u[h])u[h]=l.shape[v];else if(u[h]!=l.shape[v]&&1!=l.shape[v])throw new Error("Shapes are not broadcast-compatible.");var d=new(0,M[I(r.dtype,e.dtype)])(u.reduce(function(r,e){return r*e},1));d instanceof Array&&d.fill(0);for(var p=0,w=[r,e],m=0;m<w.length;m++){switch(p*=3,w[m].dtype){default:p+=1;case"complex128":p+=1;case"int32":case"float32":case"float64":}}switch(p){case 0:lr(r.shape,r.data,e.shape,e.data,u,d);break;case 1:hr(r.shape,r.data,e.shape,e.data._array,u,d._array);break;case 3:vr(r.shape,r.data._array,e.shape,e.data,u,d._array);break;case 4:dr(r.shape,r.data._array,e.shape,e.data._array,u,d._array);break;default:pr(r.shape,r.data,e.shape,e.data,u,d)}return new G(u,d)}function mr(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];if(1==(e=e.map(D)).length)return e[0];if(2==e.length)return wr.apply(void 0,w()(e));function n(r,e){var t=r.slice(-2),n=N()(t,2),a=n[0],o=n[1],i=e[e.length-1];if(e[e.length-2]!=o)throw new Error("Shape mismatch.");var f=Math.max(r.length,e.length),u=Int32Array.from({length:f},function(){return 1});u[f-2]=a,u[f-1]=i;for(var s=[r,e],c=0;c<s.length;c++)for(var l=s[c],h=f-2,v=l.length-2;h-- >0&&v-- >0;)if(1===u[h])u[h]=l[v];else if(u[h]!=l[v]&&1!=l[v])throw new Error("Shapes are not broadcast-compatible.");return[u.reduce(function(r,e){return r*e},1)*o,u]}for(var a=Array.from({length:e.length},function(){return[]}),o=0;o<e.length;o++)a[o][o]=[0,e[o].shape];for(var i=2;i<=e.length;i++)for(var f=0;f<=e.length-i;f++){for(var u=1/0,s=void 0,c=1;c<i;c++){var l=N()(a[f][f+c-1],2),h=l[0],v=l[1],d=N()(a[f+c][f+i-1],2),p=d[0],m=n(v,d[1]),y=N()(m,2),b=y[0],g=y[1];(b+=h+p)<u&&(u=b,s=g)}if(void 0===s)throw new Error("Integer overflow (too many FLOPs).");a[f][f+i-1]=[u,s]}return function r(t,o){if(t==o)return e[t];for(var i,f=1/0,u=t;u<o;u++){var s=N()(a[t][u],2),c=s[0],l=s[1],h=N()(a[u+1][o],2),v=h[0],d=n(l,h[1]),p=N()(d,2),w=p[0];p[1],(w+=c+v)<f&&(f=w,i=u)}return wr(r(t,i),r(i+1,o))}(0,e.length-1)}function yr(r){var e=(r=D(r)).shape.slice(-1),t=N()(e,1)[0],n=r.shape.slice(0,-1),a=new M.complex128(r.data.length/t);if(r.shape[r.ndim-2]!=t)throw new Error("T is not square.");r=r.data;for(var o=0,i=function(e,n){return r[o+t*e+n]},f=0;o<r.length;o+=t*t,f+=t)for(var u=t-1;u>=0;u--){var s=u-1;if(0===u||0==i(u,s))a[f+u]=i(u,u);else{var c=i(s,s),l=i(s,u),v=i(u,s),d=i(u,u),p=h.add(c,d),w=h.sub(h.mul(c,d),h.mul(l,v)),m=void 0,y=void 0,b=h.sqrt(h.sub(h.mul(p,p),h.mul(w,4)));if(p*p>=4*w)throw new Error("schur_eigenvals(T): T must not contain real eigenvalued 2x2 blocks.");m=h.mul(h.add(p,b),.5),y=h.mul(h.sub(p,b),.5),a[f+s]=m,a[f+u--]=y}}return new G(n,a)}function br(r,e){if(r.ndim!=e.ndim)throw new Error("Q.ndim != T.ndim.");for(var t=e.ndim;t-- >0;)if(r.shape[t]!=e.shape[t])throw new Error("Q.shape != T.shape.");var n=e.shape.slice(-1),a=N()(n,1)[0],o=e.shape,i=o.slice(0,-1);if(e.shape[e.ndim-2]!=a)throw new Error("Q is not square.");var f=M.complex128,u=f.from(e.data);e=void 0;var s=new f(u.length/a),c=new f(a),l=new f(a),v=NaN;function d(r,e,t){for(var n=Math.min(a,t+2),o=t;o-- >0;){for(var i=n;--i>o;)e[o]=h.sub(e[o],h.mul(e[i],u[p+a*o+i]));if(0==o||0==w(o,o-1)){var f=h.sub(u[p+a*o+o],r);if(h.abs(f)<=v){if(h.abs(e[o])<=v)return void(e[o]=0);e[o]=1,e.fill(0,o+1,n)}else e[o]=h.div(e[o],f)}else{for(var s=o-1,c=n;--c>o;)e[s]=h.sub(e[s],h.mul(e[c],u[p+a*s+c]));var l=h.sub(w(s,s),r),d=w(s,o),m=h.sub(w(o,o),r),y=w(o,s),b=h.sub(h.mul(l,m),h.mul(d,y));if(0==b)throw new Error("Assertion failed.");var g=h.div(h.sub(h.mul(l,e[o]),h.mul(y,e[s])),b),E=h.div(h.sub(h.mul(m,e[s]),h.mul(d,e[o])),b);e[s]=E,e[o--]=g}}}for(var p=0,w=function(r,e){return u[p+a*r+e]},m=0;p<u.length;p+=a*a,m+=a){if(!((v=Math.sqrt(Number.EPSILON)*function(){for(var r=0,e=0,t=p+a*a,n=p;n<t;n++){var o=h.abs(u[n]);0!=o&&(o>e&&(r*=Math.pow(e/o,2),e=o),r+=Math.pow(o/e,2))}return Math.sqrt(r)*e}())>=0))throw new Error("Assertion failed.");for(var y=a-1;y>=0;y--){var b=y-1;if(0==y||0==w(y,b)){var g=w(y,y);s[m+y]=g,c.fill(0,0,y+2),c[y]=1,d(g,c,y);for(var E=Math.min(a,y+2);E-- >0;)u[p+a*E+y]=c[E]}else{var x=w(b,b),A=w(b,y),q=w(y,b),S=w(y,y),P=h.add(x,S),I=h.sub(h.mul(x,S),h.mul(A,q)),O=void 0,k=void 0,L=h.sqrt(h.sub(h.mul(P,P),h.mul(I,4)));if(P*P>=4*I)throw new Error("The given Schur decomposition must not contain 2x2 diagonal blocks with real eigenvalues.");O=h.mul(h.add(P,L),.5),k=h.mul(h.sub(P,L),.5),c.fill(0,0,y+1),l.fill(0,0,y+1),h.abs(A)>=h.abs(q)?(c[b]=A,c[y]=h.sub(O,x),l[b]=A,l[y]=h.sub(k,x)):(c[y]=q,c[b]=h.sub(O,S),l[y]=q,l[b]=h.sub(k,S)),d(O,c,b),d(k,l,b);for(var F=y+1;F-- >0;)u[p+a*F+b]=c[F],u[p+a*F+y]=l[F];s[m+b]=O,s[m+y--]=k}}var T=c,U=l;T.fill(0),U.fill(0);for(var z=0;z<a;z++)for(var C=0;C<a;C++){var B=h.abs(u[p+a*z+C]);if(B>0){if(B>U[C]){var Y=U[C]/B;U[C]=B,T[C]*=Y*Y}var D=B/U[C];T[C]+=D*D}}for(var J=T,H=0;H<a;H++){var X=U[H];J[H]=isFinite(X)?Math.sqrt(T[H])*X:X}for(var W=0;W<a;W++)for(var $=0;$<a;$++)u[p+a*W+$]=h.div(u[p+a*W+$],J[$])}return[new G(i,s),wr(r,new G(o,u))]}function gr(r){(r=D(r)).shape[r.ndim-1];var e=ur(r),t=N()(e,2),n=t[0],a=t[1];return r=void 0,function(r,e){var t=r.shape[r.ndim-1],n=M[r.dtype],a=new n(t);if(r.shape[r.ndim-2]!=t)throw new Error("Q is not square.");if(r.ndim!=e.ndim)throw new Error("Q.ndim != H.ndim.");for(var o=r.ndim;o-- >0;)if(r.shape[o]!=e.shape[o])throw new Error("Q.shape != H.shape.");r=r.data,e=e.data;for(var i=Number.EPSILON,f=function r(o,f,u,s){for(var c=function(r,n){return e[s+t*r+n]},l=function(r){return!(Math.abs(c(r,r-1))>i*(Math.abs(c(r-1,r-1))+Math.abs(c(r,r))))&&(e[s+t*r+r-1]*=0,!0)},h=function(r,n,a,i){if(n<=r)throw new Error("Assertion failed.");for(var c=Math.max(0,r-1);c<u;c++){var l=e[s+t*r+c],h=e[s+t*n+c];e[s+t*r+c]=i*h+a*l,e[s+t*n+c]=a*h-i*l}for(var v=Math.min(u,n+2);v-- >0;){var d=e[s+t*v+r],p=e[s+t*v+n];e[s+t*v+r]=i*p+a*d,e[s+t*v+n]=a*p-i*d}for(var w=u;w-- >0;){var m=o[f+u*r+w],y=o[f+u*n+w];o[f+u*r+w]=i*y+a*m,o[f+u*n+w]=a*y-i*m}},v=function(i,c){if(c-i>u>>>1)throw new Error("Assertion failed.");var l=c-i;if(l<3)throw new Error("Assertion failed.");for(var h=new n(l*l),v=0;v<l;v++)h[l*v+v]=1;r(h,0,l,s+t*i+i);for(var d=0;d<l;d++)for(var p=0;p<d;p++){var w=h[l*d+p];h[l*d+p]=h[l*p+d],h[l*p+d]=w}for(var m=0;m<u;m++){a.fill(0,0,l);for(var y=0;y<l;y++)for(var b=0;b<l;b++)a[b]+=h[l*y+b]*o[f+u*(i+y)+m];for(var g=0;g<l;g++)o[f+u*(i+g)+m]=a[g]}for(var E=c;E<u;E++){a.fill(0,0,l);for(var x=0;x<l;x++)for(var A=0;A<l;A++)a[A]+=h[l*x+A]*e[s+t*(i+x)+E];for(var M=0;M<l;M++)e[s+t*(i+M)+E]=a[M]}for(var q=0;q<i;q++){a.fill(0,0,l);for(var S=0;S<l;S++)for(var P=0;P<l;P++)a[P]+=h[l*S+P]*e[s+t*q+(i+S)];for(var I=0;I<l;I++)e[s+t*q+(i+I)]=a[I]}},d=0,p=0,w=u;;){for(var m=!1;!m;){if(w-p<3)return;if(w-p<u>>>4)return v(p,w);m=!1,l(p+1)?p+=1:l(w-1)?w-=1:l(p+2)?p+=2:l(w-2)?w-=2:m=!0;for(var y=p+w>>>1,b=p+2;m&&++b<w-2;)l(b)&&(m=!1,b>y?(v(b,w),w=b):(v(p,b),p=b));m||(d=0)}d+=1;var g=w-2,E=w-1,x=c(g,g)+c(E,E),A=c(g,g)*c(E,E)-c(g,E)*c(E,g);if(x*x>4*A){var M=x>=0?1:-1,q=.5*(x+M*Math.sqrt(x*x-4*A)),S=2*A/(x+M*Math.sqrt(x*x-4*A));Math.abs(c(E,E)-q)>Math.abs(c(E,E)-S)&&(q=S),x=2*q,A=q*q}if(d%16==0){if(d>1e9)throw new Error("Too many iterations for a single eigenvalue.");x=Math.abs(c(E,g))+Math.abs(c(g,w-3)),A=x*x,x*=.5*Math.random()+1.25}E=p+1;for(var P=p+2,I=c(g=p+0,g)*c(g,g)+c(g,E)*c(E,g)-x*c(g,g)+A,O=c(E,g)*(c(g,g)+c(E,E)-x),k=c(E,g)*c(P,E),N=2;N-- >0;E=P,O=k)if(0!=O){var L=Math.hypot(I,O),F=I/L,T=O/L;h(g,E,F,T),I=F*I+T*O}for(var U=p;U<w-2;U++){g=U+1;var z=Math.min(w,U+4);for(E=U+2;E<z;E++){var C=c(g,U),B=c(E,U);if(0!=B){var Y=Math.hypot(C,B),D=C/Y,G=B/Y;h(g,E,D,G),e[s+t*E+U]*=0}}}}},u=0;u<r.length;u+=t*t){for(var s=0;s<t;s++)for(var c=0;c<s;c++){var l=r[u+t*s+c];r[u+t*s+c]=r[u+t*c+s],r[u+t*c+s]=l}f(r,u,t,u);for(var h=1;h<t;h++){var v=h-1;if(0!=e[u+t*h+v]){var d=function(){var n=e[u+t*v+v],a=e[u+t*v+h],o=e[u+t*h+v],i=e[u+t*h+h],f=n+i,s=n*i-a*o;if(f*f<4*s)return"continue";for(var c=Math.atan2(i-n,a+o)/2,l=c+Math.PI/2*(c<=0?1:-1),d=j(function(r){return(o*Math.cos(r)-n*Math.sin(r))*Math.cos(r)+(i*Math.cos(r)-a*Math.sin(r))*Math.sin(r)},c,l),p=Math.cos(d),w=Math.sin(d),m=v;m<t;m++){var y=e[u+t*v+m],b=e[u+t*h+m];e[u+t*v+m]=w*b+p*y,e[u+t*h+m]=p*b-w*y}for(var g=h+1;g-- >0;){var E=e[u+t*g+v],x=e[u+t*g+h];e[u+t*g+v]=w*x+p*E,e[u+t*g+h]=p*x-w*E}for(var A=t;A-- >0;){var M=r[u+t*v+A],q=r[u+t*h+A];r[u+t*v+A]=w*q+p*M,r[u+t*h+A]=p*q-w*M}e[u+t*h+v]*=0}();if("continue"===d)continue}}for(var p=0;p<t;p++)for(var w=0;w<p;w++){var m=r[u+t*p+w];r[u+t*p+w]=r[u+t*w+p],r[u+t*w+p]=m}}}(n,a),[n,a]}function Er(r){var e=xr(r,2),t=N()(e,2),n=t[0],a=gr(t[1]),o=N()(a,2),i=br(o[0],o[1]),f=N()(i,2),u=f[0],s=f[1];if(!s.dtype.startsWith("complex"))throw new Error("Assertion failed.");if(!n.dtype.startsWith("float"))throw new Error("Assertion failed.");for(var c=r.shape[r.ndim-1],l=new Float64Array(c),h=new Float64Array(c),v=s.data._array,d=n.data,p=0,w=0;w<v.length;p+=c,w+=2*c*c){l.fill(0),h.fill(0);for(var m=0;m<c;m++)for(var y=d[p+m],b=0;b<2*c;b++){var g=Math.abs(v[w+2*c*m+b]*=y);if(g>0){var E=b>>1;g>h[E]&&(l[E]*=Math.pow(h[E]/g,2),h[E]=g),l[E]+=Math.pow(g/h[E],2)}}for(var x=0;x<c;x++){var A=h[x];l[x]=isFinite(A)?Math.sqrt(l[x])*A:A}for(var M=0;M<c;M++)for(var q=0;q<2*c;q++)v[w+2*c*M+q]/=l[q>>1]}return[u,s]}function xr(r,e){if(null==e&&(e=2),e>Number.MAX_VALUE)return function(r){var e=r.shape[r.ndim-1],t=M["float32"===r.dtype?"float32":"float64"],n=r.shape,a=n.slice(0,-1);if(r.shape[r.ndim-2]!=e)throw new Error("A is not square");r=t.from(r.data);var o=new t(r.length/e);o.fill(1);for(var i=r.length,f=o.length;i>0;){i-=e*e,f-=e;for(var u,s=!1;!s;)for(u=0,s=!0;u<e;u++){for(var c=0,l=0,h=0;h<e;h++)if(u!==h){var v=Math.abs(r[i+e*u+h]);l=Math.max(l,v);var d=Math.abs(r[i+e*h+u]);c=Math.max(c,d)}if(l*c!=0){var p=Math.max(c,l);if(0!=p){if(!isFinite(p))throw new Error("NaN encountered.");for(var w=1;l>=2*c;)c*=2,l/=2,w*=2;for(;c>=2*l;)c/=2,l*=2,w/=2;var m=Math.max(c,l);if(!(m>=p)){s=!1,o[f+u]*=w;for(var y=0;y<e;y++)r[i+e*u+y]/=w,r[i+e*y+u]*=w}}}}}return[new G(a,o),new G(n,r)]}(r);var t=r.shape[r.ndim-1],n=M["float32"===r.dtype?"float32":"float64"],a=r.shape,o=a.slice(0,-1);if(!(e>=1))throw new Error("Invalid norm p=".concat(e,";"));if(r.shape[r.ndim-2]!=t)throw new Error("A is not square");r=n.from(r.data);var i=new n(r.length/t),f=Math.pow(.95,1/e);i.fill(1);for(var u=r.length,s=i.length;u>0;){u-=t*t,s-=t;for(var c,l=!1;!l;)for(c=0,l=!0;c<t;c++){for(var h=0,v=0,d=0,p=0,w=0;w<t;w++)if(c!==w){var m=Math.abs(r[u+t*c+w]);if(m>0){if(m>p){var y=p/m;p=m,d*=Math.pow(y,e)}var b=m/p;d+=Math.pow(b,e)}var g=Math.abs(r[u+t*w+c]);if(g>0){if(g>v){var E=v/g;v=g,h*=Math.pow(E,e)}var x=g/v;h+=Math.pow(x,e)}}if((d=isFinite(d)?Math.pow(d,1/e)*p:d)*(h=isFinite(h)?Math.pow(h,1/e)*v:h)!=0){if(!isFinite(d*h))throw new Error("NaN encountered.");for(var A=h>=d?Math.pow(1+Math.pow(d/h,e),1/e)*h:Math.pow(1+Math.pow(h/d,e),1/e)*d,q=1;d>=2*h;)h*=2,d/=2,q*=2;for(;h>=2*d;)h/=2,d*=2,q/=2;if(!((h>=d?Math.pow(1+Math.pow(d/h,e),1/e)*h:Math.pow(1+Math.pow(h/d,e),1/e)*d)>=f*A)){l=!1,i[s+c]*=q;for(var S=0;S<t;S++)r[u+t*c+S]/=q,r[u+t*S+c]*=q}}}}return[new G(o,i),new G(a,r)]}function Ar(r,e){if(e.ndim<2)throw new Error("eigen_balance_post(D,V): V.ndim must be at least 2.");var t=e.shape.slice(-2),n=N()(t,2),a=n[0],o=n[1];if(a!==o)throw new Error("eigen_balance_post(D,V): V must be square.");var i=M.float64,f=B([e,r.reshape.apply(r,w()(r.shape).concat([1]))],"complex128",v.mul);e=f.data;for(var u=new i(o),s=new i(o),c=0;c<e.length;c+=a*o){u.fill(0),s.fill(0);for(var l=0;l<o;l++)for(var h=0;h<o;h++){var d=v.abs(e[c+o*l+h]);d>0&&(d>s[h]&&(u[h]*=Math.pow(s[h]/d,2),s[h]=d),u[h]+=Math.pow(d/s[h],2))}for(var p=0;p<o;p++){var m=s[p];u[p]=isFinite(m)?Math.sqrt(u[p])*m:m}for(var y=0;y<o;y++)for(var b=0;b<o;b++)e[c+o*y+b]=v.div(e[c+o*y+b],u[b])}return f}function Mr(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];var n=e[0]in M?e.shift():"float64";if(e.length<1)throw new Error("Size parameter missing.");1==e.length&&e.push(e[e.length-1]),e=Int32Array.from(e,function(r){if(0!=r%1)throw new Error("eye(): Invalid shape [".concat(e,"]."));return r});for(var a=new M[n](e.reduce(function(r,e){return r*e})),o=e.slice(-2),i=N()(o,2),f=i[0],u=i[1],s=a.length;(s-=f*u)>=0;)for(var c=Math.min(f,u);c-- >0;)a[s+u*c+c]=1;return new G(e,a)}var qr=function(r){function e(r){var t,n;s()(this,e);for(var a=arguments.length,o=new Array(a>1?a-1:0),i=1;i<a;i++)o[i-1]=arguments[i];if(n=F()(this,(t=$()(e)).call.apply(t,[this].concat(o))),!(r instanceof G))throw new Error("Assertion failed.");return n.x=r,n}return U()(e,r),e}(C()(Error));function Sr(r){if((r=D(r)).ndim<2)throw new Error("A must be at least 2D.");var e=M["float32"===r.dtype?"float32":"float64"],t=r.shape,n=Int32Array.from(t),a=t.slice(-2),o=N()(a,2),i=o[0],f=o[1],u=e.from(r.data);r=void 0,n[n.length-1]=i;var s=new e(u.length/f*i);s.fill(0);for(var c=0,l=0;c<s.length;c+=i*i,l+=i*f){for(var h=0;h<i;h++)s[c+i*h+h]=1;for(var v=1;v<i;v++)for(var d=Math.min(v,f),p=0;p<d;p++){var w=u[l+f*v+p];if(0!=w){var m=u[l+f*p+p],y=Math.hypot(m,w),b=m/y,g=w/y;u[l+f*v+p]=0,u[l+f*p+p]=y;for(var E=p;++E<f;){var x=l+f*v+E,A=u[x],q=l+f*p+E,S=u[q];u[x]=b*A-g*S,u[q]=g*A+b*S}for(var P=0;P<=v;P++){var I=c+i*v+P,O=s[I],k=c+i*p+P,L=s[k];s[I]=b*O-g*L,s[k]=g*O+b*L}}}for(var F=0;F<i;F++)for(var T=F+1;T<i;T++){var U=c+i*F+T,z=c+i*T+F,C=s[U];s[U]=s[z],s[z]=C}}return[new G(n,s),new G(t,u)]}function Pr(r){if((r=D(r)).ndim<2)throw new Error("qr_decomp(A): A.ndim must be at least 2.");var e=M["float32"===r.dtype?"float32":"float64"],t=r.shape,n=Int32Array.from(t),a=t.slice(-2),o=N()(a,2),i=o[0],f=o[1];if(n[n.length-2]=f,i<=f)return Sr(r);var u=e.from(r.data);r=void 0;for(var s=new e(u.length/i*f),c=new e(i*f-(f*(f+1)>>>1)),l=(function(){try{c.subarray(f)}catch(r){return new e(f)}}(),0),h=0;h<u.length;h+=i*f,l+=f*f){for(var v=0,d=1;d<i;d++)for(var p=Math.min(d,f),w=0;w<p;w++){var m=u[h+f*d+w];if(0!==m){var y=u[h+f*w+w],b=Math.hypot(y,m),g=y/b,E=m/b;g<0&&(g*=-1,E*=-1,b*=-1),c[v++]=E,u[h+f*d+w]=0,u[h+f*w+w]=b;for(var x=w;++x<f;){var A=h+f*d+x,q=u[A],S=h+f*w+x,P=u[S];u[A]=g*q-E*P,u[S]=E*q+g*P}}else c[v++]=0}if(v!=c.length)throw new Error("Assertion failed!");for(var I=0;I<f;I++)for(var O=I;O<f;O++)s[l+f*I+O]=u[h+f*I+O],u[h+f*I+O]=I!==O?0:1;for(var k=i;--k>0;)for(var L=Math.min(k,f);L-- >0;){var F=c[--v];if(0!==F)for(var T=Math.sqrt((1-F)*(1+F)),U=L;U<f;U++){var z=h+f*k+U,C=u[z],B=h+f*L+U,Y=u[B];u[z]=F*Y+T*C,u[B]=T*Y-F*C}}if(0!=v)throw new Error("Assertion failed!")}return[new G(t,u),new G(n,s)]}function Ir(r,e,t){if(null==t){t=e;var n=r,a=N()(n,2);r=a[0],e=a[1]}if((r=D(r)).ndim<2)throw new Error("qr_lstsq(Q,R,y): Q.ndim must be at least 2.");if((e=D(e)).ndim<2)throw new Error("qr_lstsq(Q,R,y): R.ndim must be at least 2.");if((t=D(t)).ndim<2)throw new Error("qr_lstsq(Q,R,y): y.ndim must be at least 2.");var o=r.shape.slice(-2),i=N()(o,2),f=i[0],u=i[1],s=e.shape.slice(-1),c=N()(s,1)[0],l=t.shape.slice(-1),h=N()(l,1)[0],v=Math.min(u,c);if(f!=t.shape[t.ndim-2])throw new Error("qr_lstsq(Q,R,y): Q and y don't match.");if(u!=e.shape[e.ndim-2])throw new Error("qr_lstsq(Q,R,y): Q and R don't match.");if(c>f)throw new Error("qr_lstsq(Q,R,y): Under-determined systems not supported. Use rrqr instead.");var d=Math.max(r.ndim,e.ndim,t.ndim),p=Int32Array.from({length:d},function(){return 1});p[d-2]=c,p[d-1]=h;for(var w=[r,e,t],m=0;m<w.length;m++)for(var y=w[m],b=d-2,g=y.ndim-2;b-- >0&&g-- >0;)if(1===p[b])p[b]=y.shape[g];else if(p[b]!=y.shape[g]&&1!=y.shape[g])throw new Error("Q, R, y are not broadcast-compatible.");var E=new(0,M[[r,e,t].every(function(r){return"float32"===r.dtype})?"float32":"float64"])(p.reduce(function(r,e){return r*e},1)),x=r.data,A=e.data,q=t.data,S=0,P=1,I=0,O=1,k=0,L=1,F=0;return function n(a){if(a===d-2){P=f*u,O=u*c,L=f*h;for(var o=0;o<v;o++)for(var i=0;i<h;i++)for(var s=0;s<f;s++)E[F+o*h+i]+=x[S+s*u+o]*q[k+s*h+i];for(var l=v;l-- >0;)for(var w=h;w-- >0;){for(var m=v;--m>l;)E[F+l*h+w]-=A[I+c*l+m]*E[F+m*h+w];E[F+l*h+w]/=A[I+c*l+l]}return S+=P,I+=O,k+=L,void(F+=c*h)}for(var y=p[a];n(a+1),1!=y;y--)r.shape[a-d+r.ndim]>1||(S-=P),e.shape[a-d+e.ndim]>1||(I-=O),t.shape[a-d+t.ndim]>1||(k-=L);P*=r.shape[a-d+r.ndim]||1,O*=e.shape[a-d+e.ndim]||1,L*=t.shape[a-d+t.ndim]||1}(0),new G(p,E)}function Or(r){var e=(r=D(r)).shape,t=e[e.length-2],n=Number.EPSILON*t,a=e[e.length-1];if(t>a){var o=Pr(r),i=N()(o,2),f=i[0],u=Or(i[1]),s=N()(u,3),c=s[0],l=s[1],h=s[2];return[wr(f,c),l,h]}if(t<a){var v=Pr(r.T),d=N()(v,2),p=d[0],w=Or(d[1]),m=N()(w,3),b=m[0],g=m[1],E=m[2];return function(r){var e=r.shape.slice(-2),t=N()(e,2),n=t[0];if(n!=t[1])throw new Error("In-place transposition is only supported for square matrices.");r=r.data;for(var a=0;a<r.length;a+=n*n)for(var o=0;o<n-1;o++)for(var i=1+o;i<n;i++){var f=a+n*o+i,u=a+n*i+o,s=r[f];r[f]=r[u],r[u]=s}}(E),[E,g,wr(p,b).T]}var x=M["float32"===r.dtype?"float32":"float64"],A=x.from(r.data);r=void 0;var q=new x(t*t),S=new x(A.length),P=new x(A.length/t);if(1>t)throw new Error("Assertion failed.");if(1==t){for(var I=A.length;I-- >0;)A[I]<0?(A[I]*=-1,P[I]=-1):P[I]=1;return[new G(e,P),new G(e.slice(0,-1),A),new G(e,S.fill(1))]}for(var O=Int32Array.from(y.a.mark(function r(){var e;return y.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:e=t;case 1:if(!(e>1)){r.next=7;break}return e=e+1>>>1,r.next=5,e;case 5:r.next=1;break;case 7:case"end":return r.stop()}},r,this)})()),k=new x(O.reduce(function(r,e){return r+(e*e+e>>>1)},0)),L=function(r){var e=-1,n=function(n,a){var o=q[t*(n+=2*r)+(a+=2*e)],i=q[t*a+n];return o*o+i*i},a=(r>>>=1)*r+r>>>1;for(e=0;e<r;e++)k[a+e]=Math.max(n(0,0),n(0,1));if(2*r<t-1){for(e=0;e<r;e++)k[a+e]=Math.max(n(1,0),n(1,1),k[(r*r+r>>>1)+e]);k[a+e]=n(1,0)}else k[a+e]=0;for(var o=-1,i=function(t,n){return k[o+((t+=2*r)*t+t>>>1)+(n+=2*e)]},f=0,u=1;u<O.length;u++){var s=O[u-1];for(o=f,f+=s*s+s>>>1,e=r>>>=1;e>=0;e--){var c=i(0,0);2*r<s-1&&(c=Math.max(c,i(1,0),i(1,1))),r!=e&&(c=Math.max(c,i(0,1))),k[f+(r*r+r>>>1)+e]=c}}},F=function(r){r>>>=1;var e=-1,n=function(n,a){var o=q[t*(n+=2*e)+(a+=2*r)],i=q[t*a+n];return o*o+i*i};for(e=O[0];e-- >r;){var a=0;if(2*e<t-1){var o=n(1,0);o>a&&(a=o)}if(2*r<t-1){var i=n(0,1);i>a&&(a=i)}if(e!=r){var f=n(0,0);if(f>a&&(a=f),2*e<t-1){var u=n(1,1);u>a&&(a=u)}}k[(e*e+e>>>1)+r]=a}for(var s=-1,c=function(t,n){return k[s+((t+=2*e)*t+t>>>1)+(n+=2*r)]},l=0,h=1;h<O.length;h++){var v=O[h-1],d=O[h];for(s=l,l+=v*v+v>>>1,e=r>>>=1;e<d;e++){var p=c(0,0);2*e<v-1&&(p=Math.max(p,c(1,0),c(1,1))),e!=r&&(p=Math.max(p,c(0,1))),k[l+(e*e+e>>>1)+r]=p}}},T=0,U=0;U<P.length;T+=t*t,U+=t){for(var z=0;z<t;z++)for(var C=0;C<t;C++)q[t*z+C]=A[T+t*z+C],A[T+t*z+C]=z!=C?0:1;for(var B=0;B<t;B++)for(var Y=0;Y<t;Y++)S[T+t*B+Y]=B!=Y?0:1;for(var J=0;J<t;J+=2)L(J);for(var H=0,X=function(r,e){var a=void 0,o=void 0;if(function(){for(var n=0,i=0,f=function(t,f){var s=function(a,o){return W=r,$=e,u=t,k[t+((a+=n)*a+a>>>1)+(o+=i)]},c=O[f];t-=c*c+c>>>1;var l=s(0,0);if(a=n,o=i,n+1<c){var h=s(1,0);h>l&&(l=h,a=n+1,o=i);var v=s(1,1);v>l&&(l=v,a=n+1,o=i+1)}if(n!=i){var d=s(0,1);d>l&&(l=d,a=n,o=i+1)}n=2*a,i=2*o,u=t},u=k.length,s=O.length;s-- >0;)f(u,s);var c=-1/0,l=function(a,o){var f=q[t*(a+=n)+(o+=i)],u=q[t*o+a];return a=r,o=e,f*f+u*u};if(n+1<t){var h=l(1,0);h>c&&(c=h,a=n+1,o=i)}if(i+1<t){var v=l(0,1);v>c&&(c=v,a=n,o=i+1)}if(n!=i){var d=l(0,0);if(d>c&&(c=d,a=n,o=i),n+1<t)l(1,1)>c&&(a=n+1,o=i+1)}}(),o>a)throw new Error("Assertion failed.");if(r==a&&e==o)return $=e,W=r,"break";r=a,e=o;var i=q[t*a+a],f=q[t*a+o],u=q[t*o+a],s=q[t*o+o];if(!(Math.hypot(f,u)/Math.sqrt(Math.abs(i))/Math.sqrt(Math.abs(s))>n))return $=e,W=r,"break";for(var c=function(){for(var t,n,a,o,c=Math.atan2(u-f,s+i),l=Math.atan2(u+f,s-i),h=(l+c)/2,v=(l-c)/2,d=[[t=Math.cos(h),n=Math.sin(h),a=Math.cos(v),o=Math.sin(v)],[-n,t,o,-a],[-n,t,-o,a],[-t,-n,a,o]],p=0;p<d.length;p++){var w=N()(d[p],4),m=w[0],y=w[1],b=w[2],g=w[3],E=(f*y+i*m)*b+(u*m-s*y)*g;if((f*m-i*y)*g+(u*y+s*m)*b>=Math.abs(E)){if(E>=-0)return $=e,W=r,[m,y,b,g];t=m,n=y,a=b,o=g}}return W=r,$=e,[t,n,a,o]}(),l=N()(c,4),h=l[0],v=l[1],d=l[2],p=l[3],w=t;w-- >0;){var m=q[t*w+a],y=q[t*w+o];q[t*w+a]=m*h-y*v,q[t*w+o]=y*h+m*v}for(var b=t;b-- >0;){var g=q[t*a+b],E=q[t*o+b];q[t*a+b]=g*d-E*p,q[t*o+b]=E*d+g*p}q[t*a+o]=0,q[t*o+a]=0,L(a),L(o),F(a),F(o);for(var x=0;x<t;x++){var M=T+t*a+x,P=A[M],I=T+t*o+x,U=A[I];A[M]=P*d-U*p,A[I]=U*d+P*p}for(var z=0;z<t;z++){var C=T+t*a+z,B=S[C],Y=T+t*o+z,D=S[Y];S[C]=B*h-D*v,S[Y]=D*h+B*v}W=r,$=e},W=-1,$=-1;;H++){if("break"===X(W,$))break}for(var V=0;V<t;V++)P[U+V]=q[t*V+V];for(var Z=0;Z<t;Z++){var K=P[U+Z];if(K<0){K*=-1,P[U+Z]*=-1;for(var R=0;R<t;R++)A[T+t*Z+R]*=-1}for(var Q=Z;Q-- >0;){if(P[U+Q]>=K)break;var _=P[U+Q];P[U+Q]=P[U+Q+1],P[U+Q+1]=_;for(var j=0;j<t;j++){var rr=A[T+t*Q+j];A[T+t*Q+j]=A[T+t*(Q+1)+j],A[T+t*(Q+1)+j]=rr}for(var er=0;er<t;er++){var tr=S[T+t*Q+er];S[T+t*Q+er]=S[T+t*(Q+1)+er],S[T+t*(Q+1)+er]=tr}}}for(var nr=0;nr<t-1;nr++)for(var ar=1+nr;ar<t;ar++){var or=T+t*nr+ar,ir=T+t*ar+nr,fr=A[or];A[or]=A[ir],A[ir]=fr}}return[new G(e,A),new G(e.slice(0,-1),P),new G(e,S)]}function kr(r){var e=(r=D(r)).shape[r.ndim-1],t=r.shape.slice(0,-1),n=v.sqrt(q(r.dtype));r=r.data;for(var a=new M.int32(r.length/e),o=0;o<a.length;o++){var i=n*v.abs(r[e*o]);if(0!==a[o])throw new Error("Assertion failed.");for(;a[o]<e;a[o]++){var f=v.abs(r[e*o+a[o]]);if(!isFinite(f))throw new Error("svd_rank(): NaN or Infinity encountered.");if(f<=i)break}}return new G(t,a)}function Nr(r,e,t,n){if(r=D(r),e=D(e),t=D(t),r.shape[r.ndim-2]!==t.shape[t.ndim-1])throw new Error("rrqr_solve(Q,R,P, y): System not square.");var a=Lr(r,e,t,n),o=v.sqrt(q(e.dtype)),i=e.shape[e.ndim-1];e=e.data;for(var f=0;f<e.length;f+=i)for(var u,s=o*v.abs(e[f]);u<i;u++){var c=v.abs(e[f+u]);if(!isFinite(c))throw new Error("svd_solve(): NaN or Infinity encountered.");if(c<=s)throw new qr(a)}return a}function Lr(r,e,t,n){if(null==n){if(null!=t)throw new Error("svd_lstsq(Q,R,P, y): Either 2 ([Q,R,P], y) or 4 arguments (Q,R,P, y) expected.");n=R[t]=Q}if((r=D(r)).ndim<2)throw new Error("svd_lstsq(U,sv,V, y): U.ndim must be at least 2.");if((e=D(e)).ndim<1)throw new Error("svd_lstsq(U,sv,V, y): sv.ndim must be at least 1.");if((t=D(t)).ndim<2)throw new Error("svd_lstsq(U,sv,V, y): V.ndim must be at least 2.");if((n=D(n)).ndim<2)throw new Error("svd_lstsq(U,sv,V, y): y.ndim must be at least 2.");var a=r.shape.slice(-2),o=N()(a,2),i=o[0],f=o[1],u=t.shape.slice(-1),s=N()(u,1)[0],c=n.shape.slice(-1),l=N()(c,1)[0];if(i!=n.shape[n.ndim-2])throw new Error("svd_lstsq(U,sv,V, y): U and y don't match.");if(f!=e.shape[e.ndim-1])throw new Error("svd_lstsq(U,sv,V, y): U and sv don't match.");if(f!=t.shape[t.ndim-2])throw new Error("svd_lstsq(U,sv,V, y): V and sv don't match.");var h=Math.max(r.ndim,e.ndim+1,t.ndim,n.ndim),d=Int32Array.from({length:h},function(){return 1});d[h-2]=s,d[h-1]=l;for(var p=[r,t,n],w=0;w<p.length;w++)for(var m=p[w],y=h-2,b=m.ndim-2;y-- >0&&b-- >0;)if(1===d[y])d[y]=m.shape[b];else if(d[y]!=m.shape[b]&&1!=m.shape[b])throw new Error("svd_lstsq(U,sv,V, y): U,sv,V,y not broadcast-compatible.");for(var g=h-2,E=e.ndim-1;g-- >0&&E-- >0;)if(1===d[g])d[g]=e.shape[E];else if(d[g]!=e.shape[E]&&1!=e.shape[E])throw new Error("svd_lstsq(U,sv,V, y): U,sv,V,y not broadcast-compatible.");var x=v.sqrt(q(e.dtype)),A=M[[r,e,t,n].every(function(r){return"float32"===r.dtype})?"float32":"float64"],S=new A(f*l),P=new A(d.reduce(function(r,e){return r*e},1)),I=r.data,O=e.data,k=t.data,L=n.data,F=0,T=1,U=0,z=1,C=0,B=1,Y=0,J=1,H=0;return function a(o){if(o===h-2){T=i*f,z=f,B=f*s,J=i*l;var u=function(){for(var r=x*v.abs(O[U]),e=0;e<f;e++){var t=v.abs(O[U+e]);if(!isFinite(t))throw new Error("svd_solve(): NaN or Infinity encountered.");if(t<=r)return e}return f}();S.fill(0);for(var c=0;c<i;c++)for(var p=0;p<u;p++)for(var w=0;w<l;w++)S[l*p+w]+=I[F+f*c+p]*L[Y+l*c+w];for(var m=0;m<u;m++)for(var y=0;y<l;y++)S[l*m+y]/=O[U+m];for(var b=0;b<u;b++)for(var g=0;g<s;g++)for(var E=0;E<l;E++)P[H+l*g+E]+=k[C+s*b+g]*S[l*b+E];return F+=T,U+=z,C+=B,Y+=J,void(H+=s*l)}for(var A=d[o];a(o+1),1!=A;A--)r.shape[o-h+r.ndim]>1||(F-=T),e.shape[o-h+1+e.ndim]>1||(U-=z),t.shape[o-h+t.ndim]>1||(C-=B),n.shape[o-h+n.ndim]>1||(Y-=J);T*=r.shape[o-h+r.ndim]||1,z*=e.shape[o-h+1+e.ndim]||1,B*=t.shape[o-h+t.ndim]||1,J*=n.shape[o-h+n.ndim]||1}(0),new G(d,P)}function Fr(r,e){var t=Or(r),n=N()(t,3);return Lr(n[0],n[1],n[2],e)}function Tr(r){r=D(r);var e=M["float32"===r.dtype?"float32":"float64"].from(r.data),t=r.shape.slice(-2),n=N()(t,2),a=n[0],o=n[1],i=new Int32Array(e.length/o);if(a!=o)throw new Error("Last two dimensions must be quadratic.");for(var f=0,u=0;f<e.length;f+=a*a,u+=a){for(var s=0;s<a;s++)i[u+s]=s;for(var c=0;c<a;c++){for(var l=f+c*a,h=c,v=c+1;v<a;v++)Math.abs(e[f+a*v+c])>Math.abs(e[f+a*h+c])&&(h=v);if(c!=h){var d=i[u+c];i[u+c]=i[u+h],i[u+h]=d;for(var p=f+h*a,w=0;w<a;w++){var m=e[l+w];e[l+w]=e[p+w],e[p+w]=m}}for(var y=c+1;y<a;y++){var b=f+y*a,g=e[b+c]/e[l+c];e[b+c]=g;for(var E=c+1;E<a;E++)e[b+E]-=g*e[l+E]}}}return[new G(r.shape,e),new G(r.shape.slice(0,-1),i)]}function Ur(r,e,t){if(null==t){t=e;var n=r,a=N()(n,2);r=a[0],e=a[1]}if((r=D(r)).ndim<2)throw new Error("LU must be at least 2D.");if((e=D(e)).ndim<1)throw new Error("P must be at least 1D.");if((t=D(t)).ndim<2)throw new Error("y must be at least 2D.");var o=r.shape.slice(-2),i=N()(o,2),f=i[0],u=i[1],s=t.shape.slice(-2),c=N()(s,2),l=c[0],h=c[1];if(u!=f)throw new Error("Last two dimensions of LU must be quadratic.");if(u!=l)throw new Error("LU and y don't match.");if(u!=e.shape.slice(-1))throw new Error("LU and P don't match.");var v=Math.max(r.ndim,e.ndim+1,t.ndim),d=Int32Array.from({length:v},function(){return 1});d[v-2]=l,d[v-1]=h;for(var p=[r,t],w=0;w<p.length;w++)for(var m=p[w],y=v-2,b=m.ndim-2;y-- >0&&b-- >0;)if(1===d[y])d[y]=m.shape[b];else if(d[y]!=m.shape[b]&&1!=m.shape[b])throw new Error("LU and y are not broadcast-compatible.");for(var g=v-2,E=e.ndim-1;g-- >0&&E-- >0;)if(1===d[g])d[g]=e.shape[E];else if(d[g]!=e.shape[E]&&1!=e.shape[E])throw new Error("P is not broadcast-compatible.");var x=new(M[[r,e,t].every(function(r){return"float32"===r.dtype})?"float32":"float64"])(d.reduce(function(r,e){return r*e},1)),A=r.data,q=e.data,S=t.data,P=0,I=1,O=0,k=1,L=0,F=1,T=0;return function n(a){if(a===v-2){I=f*f,k=f,F=f*h;for(var o=0;o<l;o++)for(var i=T+h*o,u=L+h*q[O+o],s=0;s<h;s++)x[i+s]=S[u+s];for(var c=0;c<l;c++)for(var p=0;p<h;p++)for(var w=0;w<c;w++)x[T+c*h+p]-=A[P+f*c+w]*x[T+w*h+p];for(var m=l;m-- >0;)for(var y=h;y-- >0;){for(var b=f;--b>m;)x[T+m*h+y]-=A[P+f*m+b]*x[T+b*h+y];x[T+m*h+y]/=A[P+f*m+m]}return P+=I,O+=k,L+=F,void(T+=F)}for(var g=d[a];n(a+1),1!=g;g--)r.shape[a-v+r.ndim]>1||(P-=I),e.shape[a-v+e.ndim+1]>1||(O-=k),t.shape[a-v+t.ndim]>1||(L-=F);I*=r.shape[a-v+r.ndim]||1,k*=e.shape[a-v+e.ndim+1]||1,F*=t.shape[a-v+t.ndim]||1}(0),new G(d,x)}function zr(r,e){if((r=D(r)).ndim<2)throw new Error("permute_rows(A,P): A.ndim must be at least 2.");if((e=D(e)).ndim<1)throw new Error("permute_rows(A,P): P.ndim must be at least 1.");if("int32"!==e.dtype)throw new Error('permute_rows(A,P): P.dtype must be "int32".');var t=Math.max(r.ndim,e.ndim+1),n=Int32Array.from({length:t},function(){return 1}),a=r.shape.slice(-2),o=N()(a,2),i=o[0],f=o[1];if(i!==e.shape[e.ndim-1])throw new Error("permute_rows(A,P): A.shape[-2] and P.shape[-1] must match.");for(var u=t,s=r.ndim;u-- >0&&s-- >0;)n[u]=r.shape[s];for(var c=t-2,l=e.ndim-1;c-- >0&&l-- >0;)if(1===n[c])n[c]=e.shape[l];else if(n[c]!=e.shape[l]&&1!=e.shape[l])throw new Error("permute_rows(A,P): A and P not broadcast-compatible.");var h=new M[r.dtype](n.reduce(function(r,e){return r*e})),v=r.shape,d=r.ndim,p=e.shape,w=e.ndim;r=r.data,e=e.data;var m=0,y=-1,b=0,g=-1,E=0;return function a(o){if(o===t-2){for(var u=0;u<i;u++){var s=e[b+u];if(!(s>=0))throw new Error("permute_rows(A,P): P.contains invalid indices.");if(!(s<i))throw new Error("permute_rows(A,P): P.contains invalid indices.");for(var c=0;c<f;c++)h[E+f*u+c]=r[m+f*s+c]}return m+=y=i*f,b+=g=i,void(E+=y)}for(var l=n[o];a(o+1),1!==l;l--)v[o-t+d]>1||(m-=y),p[o-t+1+w]>1||(b-=g);y*=v[o-t+d]||1,g*=p[o-t+1+w]||1}(0),new G(n,h)}function Cr(r,e){if((r=D(r)).ndim<2)throw new Error("permute_cols(A,P): A.ndim must be at least 2.");if((e=D(e)).ndim<1)throw new Error("permute_cols(A,P): P.ndim must be at least 1.");if("int32"!==e.dtype)throw new Error('permute_cols(A,P): P.dtype must be "int32".');var t=Math.max(r.ndim,e.ndim+1),n=Int32Array.from({length:t},function(){return 1}),a=r.shape.slice(-2),o=N()(a,2),i=o[0],f=o[1];if(f!==e.shape[e.ndim-1])throw new Error("permute_cols(A,P): A.shape[-1] and P.shape[-1] must match.");for(var u=t,s=r.ndim;u-- >0&&s-- >0;)n[u]=r.shape[s];for(var c=t-2,l=e.ndim-1;c-- >0&&l-- >0;)if(1===n[c])n[c]=e.shape[l];else if(n[c]!=e.shape[l]&&1!=e.shape[l])throw new Error("permute_cols(A,P): A and P not broadcast-compatible.");var h=new M[r.dtype](n.reduce(function(r,e){return r*e})),v=r.shape,d=r.ndim,p=e.shape,w=e.ndim;r=r.data,e=e.data;var m=0,y=-1,b=0,g=-1,E=0;return function a(o){if(o===t-2){for(var u=0;u<i;u++)for(var s=0;s<f;s++){var c=e[b+s];if(!(c>=0))throw new Error("permute_cols(A,P): P.contains invalid indices.");if(!(c<f))throw new Error("permute_cols(A,P): P.contains invalid indices.");h[E+f*u+s]=r[m+f*u+c]}return m+=y=i*f,b+=g=f,void(E+=y)}for(var l=n[o];a(o+1),1!==l;l--)v[o-t+d]>1||(m-=y),p[o-t+1+w]>1||(b-=g);y*=v[o-t+d]||1,g*=p[o-t+1+w]||1}(0),new G(n,h)}function Br(r,e){if((r=D(r)).ndim<2)throw new Error("unpermute_rows(A,P): A.ndim must be at least 2.");if((e=D(e)).ndim<1)throw new Error("unpermute_rows(A,P): P.ndim must be at least 1.");if("int32"!==e.dtype)throw new Error('unpermute_rows(A,P): P.dtype must be "int32".');var t=Math.max(r.ndim,e.ndim+1),n=Int32Array.from({length:t},function(){return 1}),a=r.shape.slice(-2),o=N()(a,2),i=o[0],f=o[1];if(i!==e.shape[e.ndim-1])throw new Error("unpermute_rows(A,P): A.shape[-2] and P.shape[-1] must match.");for(var u=t,s=r.ndim;u-- >0&&s-- >0;)n[u]=r.shape[s];for(var c=t-2,l=e.ndim-1;c-- >0&&l-- >0;)if(1===n[c])n[c]=e.shape[l];else if(n[c]!=e.shape[l]&&1!=e.shape[l])throw new Error("unpermute_rows(A,P): A and P not broadcast-compatible.");var h=new M[r.dtype](n.reduce(function(r,e){return r*e})),v=r.shape,d=r.ndim,p=e.shape,w=e.ndim;r=r.data,e=e.data;var m=0,y=-1,b=0,g=-1,E=0;return function a(o){if(o===t-2){for(var u=0;u<i;u++){var s=e[b+u];if(!(s>=0))throw new Error("unpermute_rows(A,P): P.contains invalid indices.");if(!(s<i))throw new Error("unpermute_rows(A,P): P.contains invalid indices.");for(var c=0;c<f;c++)h[E+f*s+c]=r[m+f*u+c]}return m+=y=i*f,b+=g=i,void(E+=y)}for(var l=n[o];a(o+1),1!==l;l--)v[o-t+d]>1||(m-=y),p[o-t+1+w]>1||(b-=g);y*=v[o-t+d]||1,g*=p[o-t+1+w]||1}(0),new G(n,h)}function Yr(r,e){if((r=D(r)).ndim<2)throw new Error("unpermute_cols(A,P): A.ndim must be at least 2.");if((e=D(e)).ndim<1)throw new Error("unpermute_cols(A,P): P.ndim must be at least 1.");if("int32"!==e.dtype)throw new Error('unpermute_cols(A,P): P.dtype must be "int32".');var t=Math.max(r.ndim,e.ndim+1),n=Int32Array.from({length:t},function(){return 1}),a=r.shape.slice(-2),o=N()(a,2),i=o[0],f=o[1];if(f!==e.shape[e.ndim-1])throw new Error("unpermute_cols(A,P): A.shape[-1] and P.shape[-1] must match.");for(var u=t,s=r.ndim;u-- >0&&s-- >0;)n[u]=r.shape[s];for(var c=t-2,l=e.ndim-1;c-- >0&&l-- >0;)if(1===n[c])n[c]=e.shape[l];else if(n[c]!=e.shape[l]&&1!=e.shape[l])throw new Error("unpermute_cols(A,P): A and P not broadcast-compatible.");var h=new M[r.dtype](n.reduce(function(r,e){return r*e})),v=r.shape,d=r.ndim,p=e.shape,w=e.ndim;r=r.data,e=e.data;var m=0,y=-1,b=0,g=-1,E=0;return function a(o){if(o===t-2){for(var u=0;u<i;u++)for(var s=0;s<f;s++){var c=e[b+s];if(!(c>=0))throw new Error("unpermute_cols(A,P): P.contains invalid indices.");if(!(c<f))throw new Error("unpermute_cols(A,P): P.contains invalid indices.");h[E+f*u+c]=r[m+f*u+s]}return m+=y=i*f,b+=g=f,void(E+=y)}for(var l=n[o];a(o+1),1!==l;l--)v[o-t+d]>1||(m-=y),p[o-t+1+w]>1||(b-=g);y*=v[o-t+d]||1,g*=p[o-t+1+w]||1}(0),new G(n,h)}function Dr(r){var e=Or(r),t=N()(e,3),n=(t[0],t[1]);t[2];return kr(n)}function Gr(r,e,t,n,a){var o=Math.min(r,e);if(!(a.length>=o))throw new Error("Assertion failed.");for(var i=0,f=0,u=o;u-- >0;){for(var s=e;s-- >u;){var c=v.abs(t[n+e*u+s]);0!=c&&(c>f&&(i*=Math.pow(f/c,2),f=c),i+=Math.pow(c/f,2))}if(a[u]=Math.sqrt(i)*f,!isFinite(a[u]))throw new Error("Infinity or NaN encountered during rank estimation.")}for(var l=a instanceof Float32Array?"float32":"float64",h=v.sqrt(q(l))*a[0],d=o;d>0&&a[d-1]<=h;)--d;return d}function Jr(r){if((r=D(r)).ndim<2)throw new Error("A must be at least 2D.");var e=M["float32"===r.dtype?"float32":"float64"],t=r.shape,n=Int32Array.from(t),a=n.slice(0,-1),o=t.slice(-2),i=N()(o,2),f=i[0],u=i[1];n[n.length-1]=f,a[a.length-1]=u;var s=e.from(r.data);r=void 0;for(var c=new e(u),l=new e(u),h=new Int32Array(s.length/f),d=new e(s.length/u*f),p=function(r){if(r<0)throw new Error("Assertion failed.");if(r>=u)throw new Error("Assertion failed.");var e=l[r];return isFinite(e)?Math.sqrt(c[r])*e:e},w=function(r,e){if(r<0)throw new Error("Assertion failed.");if(r>=u)throw new Error("Assertion failed.");(e=v.abs(e))>0&&(e>l[r]&&(c[r]*=Math.pow(l[r]/e,2),l[r]=e),c[r]+=Math.pow(e/l[r],2))},m=0,y=0,b=0;m<d.length;m+=f*f,y+=f*u,b+=u){for(var g=0;g<u;g++)h[b+g]=g;for(var E=0;E<f;E++)d[m+f*E+E]=1;if(!c.every(function(r){return 0===r}))throw new Error("Assertion failed.");if(!l.every(function(r){return 0===r}))throw new Error("Assertion failed.");for(var x=0;x<f;x++)for(var A=0;A<u;A++)w(A,s[y+u*x+A]);for(var q=0;q<u;q++){for(var S=q,P=q;++P<u;)p(P)>p(S)&&(S=P);if(S!==q){for(var I=0;I<f;I++){var O=y+u*I+q,k=y+u*I+S,L=s[O];s[O]=s[k],s[k]=L}var F=h[b+q];h[b+q]=h[b+S],h[b+S]=F}c.fill(0,q),l.fill(0,q);for(var T=q;++T<f;){var U=s[y+u*T+q];if(0!=U){var z=s[y+u*q+q],C=Math.hypot(z,U),B=z/C,Y=U/C;s[y+u*q+q]=C,s[y+u*T+q]=0;for(var J=q;++J<u;){var H=y+u*T+J,X=s[H],W=y+u*q+J,$=s[W];s[H]=B*X-Y*$,s[W]=Y*X+B*$,w(J,s[H])}for(var V=0;V<=T;V++){var Z=m+f*T+V,K=d[Z],R=m+f*q+V,Q=d[R];d[Z]=B*K-Y*Q,d[R]=Y*K+B*Q}}else for(var _=q;++_<u;)w(_,s[y+u*T+_])}}for(var j=0;j<f;j++)for(var rr=0;rr<j;rr++){var er=m+f*rr+j,tr=m+f*j+rr,nr=d[tr];d[tr]=d[er],d[er]=nr}}return[new G(n,d),new G(t,s),new G(a,h)]}function Hr(r){if((r=D(r)).ndim<2)throw new Error("A must be at least 2D.");var e=M["float32"===r.dtype?"float32":"float64"],t=r.shape,n=Int32Array.from(t),a=t.slice(0,-1),o=t.slice(-2),i=N()(o,2),f=i[0],u=i[1];if(n[n.length-2]=u,a[a.length-1]=u,f<=u)return Jr(r);var s=e.from(r.data);r=void 0;for(var c=new e(u),l=new e(u),h=new Int32Array(s.length/f),d=new e(s.length/f*u),p=new e(2*f*u-u*(u+1)),w=function(r){var e=l[r];return isFinite(e)?Math.sqrt(c[r])*e:e},m=function(r,e){(e=v.abs(e))>0&&(e>l[r]&&(c[r]*=Math.pow(l[r]/e,2),l[r]=e),c[r]+=Math.pow(e/l[r],2))},y=0,b=0,g=0;y<s.length;y+=f*u,b+=u*u,g+=u){for(var E=0;E<u;E++)h[g+E]=E;for(var x=0;x<f;x++)for(var A=0;A<u;A++)m(A,s[y+u*x+A]);for(var q=0,S=0;S<u;S++){for(var P=S,I=w(P),O=S;++O<u;){var k=w(O);k>I&&(P=O,I=k)}if(P!==S){for(var L=0;L<f;L++){var F=y+u*L+S,T=y+u*L+P,U=s[F];s[F]=s[T],s[T]=U}var z=h[g+S];h[g+S]=h[g+P],h[g+P]=z}c.fill(0,S),l.fill(0,S);for(var C=S;++C<f;){var B=s[y+u*C+S];if(0!=B){var Y=s[y+u*S+S],J=Math.hypot(Y,B),H=Y/J,X=B/J;s[y+u*S+S]=J,s[y+u*C+S]=0;for(var W=S;++W<u;){var $=y+u*C+W,V=y+u*S+W,Z=s[V],K=s[$];s[$]=H*K-X*Z,s[V]=X*K+H*Z,m(W,s[$])}p[q++]=H,p[q++]=X}else{p[q++]=1,p[q++]=0;for(var R=S;++R<u;)m(R,s[y+u*C+R])}}}if(q!=p.length)throw new Error("Assertion failed!");for(var Q=0;Q<u;Q++)for(var _=Q;_<u;_++)d[b+u*Q+_]=s[y+u*Q+_],s[y+u*Q+_]=Q!==_?0:1;for(var j=u;j-- >0;)for(var rr=f;--rr>j;)for(var er=p[--q],tr=p[--q],nr=u;nr-- >j;){var ar=y+u*rr+nr,or=y+u*j+nr,ir=s[or],fr=s[ar];s[ar]=er*ir+tr*fr,s[or]=tr*ir-er*fr}if(0!=q)throw new Error("Assertion failed!")}return[new G(t,s),new G(n,d),new G(a,h)]}function Xr(r){var e=(r=D(r)).shape.slice(-2),t=N()(e,2),n=t[0],a=t[1],o=r.shape.slice(0,-2);r=r.data;for(var i=new M.int32(r.length/n/a),f=new M["float32"===r.dtype?"float32":"float64"](Math.min(n,a)),u=0,s=0;u<i.length;u++,s+=n*a)i[u]=Gr(n,a,r,s,f);return new G(o,i)}function Wr(r,e,t,n){r=D(r),e=D(e);var a=r.shape[r.ndim-2];if(a!==e.shape[e.ndim-1])throw new Error("rrqr_solve(Q,R,P, y): Q @ R not square.");for(var o=$r(r,e,t,n),i=new M["float32"===e.dtype?"float32":"float64"](a),f=0;f<e.data.length;f+=a*a){if(Gr(a,a,e.data,f,i)<a)throw new qr(o)}return o}function $r(r,e,t,n){if(null==n){if(null!=t)throw new Error("rrqr_lstsq(Q,R,P, y): Either 2 ([Q,R,P], y) or 4 arguments (Q,R,P, y) expected.");n=e[t]=r}if((r=D(r)).ndim<2)throw new Error("rrqr_lstsq(Q,R,P, y): Q.ndim must be at least 2.");if((e=D(e)).ndim<2)throw new Error("rrqr_lstsq(Q,R,P, y): R.ndim must be at least 2.");if((t=D(t)).ndim<1)throw new Error("rrqr_lstsq(Q,R,P, y): P.ndim must be at least 1.");if((n=D(n)).ndim<2)throw new Error("rrqr_lstsq(Q,R,P, y): y.ndim must be at least 2.");if("int32"!==t.dtype)throw new Error('rrqr_lstsq(Q,R,P, y): P.dtype must be "int32".');var a=r.shape.slice(-2),o=N()(a,2),i=o[0],f=o[1],u=e.shape.slice(-1),s=N()(u,1)[0],c=n.shape.slice(-1),l=N()(c,1)[0];if(i!=n.shape[n.ndim-2])throw new Error("rrqr_lstsq(Q,R,P,y): Q and y don't match.");if(f!=e.shape[e.ndim-2])throw new Error("rrqr_lstsq(Q,R,P,y): Q and R don't match.");if(s!=t.shape[t.ndim-1])throw new Error("rrqr_lstsq(Q,R,P,y): R and P don't match.");var h=Math.max(r.ndim,e.ndim,t.ndim+1,n.ndim),v=Int32Array.from({length:h},function(){return 1});v[h-2]=s,v[h-1]=l;for(var d=[r,e,n],p=0;p<d.length;p++)for(var w=d[p],m=h-2,y=w.ndim-2;m-- >0&&y-- >0;)if(1===v[m])v[m]=w.shape[y];else if(v[m]!=w.shape[y]&&1!=w.shape[y])throw new Error("rrqr_lstsq(Q,R,P,y): Q,R,P,y not broadcast-compatible.");for(var b=h-2,g=t.ndim-1;b-- >0&&g-- >0;)if(1===v[b])v[b]=t.shape[g];else if(v[b]!=t.shape[g]&&1!=t.shape[g])throw new Error("rrqr_lstsq(Q,R,P,y): Q,R,P,y not broadcast-compatible.");var E=M[[r,e,n].every(function(r){return"float32"===r.dtype})?"float32":"float64"],x=new E(Math.min(f,s)),A=new Int32Array(s),q=new E(v.reduce(function(r,e){return r*e},1)),S=r.data,P=e.data,I=t.data,O=n.data,k=0,L=1,F=0,T=1,U=0,z=1,C=0,B=1,Y=0;return function a(o){if(o===h-2){L=i*f,T=f*s,z=s,B=i*l;for(var u=Gr(f,s,P,F,x),c=0;c<i;c++)for(var d=0;d<u;d++)for(var p=0;p<l;p++)q[Y+d*l+p]+=S[k+c*f+d]*O[C+c*l+p];for(var w=u;w-- >0;)for(var m=l;m-- >0;){for(var y=u;--y>w;)q[Y+w*l+m]-=P[F+s*w+y]*q[Y+y*l+m];q[Y+w*l+m]/=P[F+s*w+w]}for(var b=s;b-- >0;)A[b]=I[U+b];for(var g=s;g-- >0;)for(var E=void 0;(E=A[g])!==g;){if(A[E]===E)throw new Error("rrqr_lstsq(Q,R,P,y): Invalid indices in P.");A[g]=A[E],A[E]=E;for(var M=l;M-- >0;){var N=q[Y+l*g+M];q[Y+l*g+M]=q[Y+l*E+M],q[Y+l*E+M]=N}}return k+=L,F+=T,U+=z,C+=B,void(Y+=s*l)}for(var D=v[o];a(o+1),1!=D;D--)r.shape[o-h+r.ndim]>1||(k-=L),e.shape[o-h+e.ndim]>1||(F-=T),t.shape[o-h+1+t.ndim]>1||(U-=z),n.shape[o-h+n.ndim]>1||(C-=B);L*=r.shape[o-h+r.ndim]||1,T*=e.shape[o-h+e.ndim]||1,z*=t.shape[o-h+1+t.ndim]||1,B*=n.shape[o-h+n.ndim]||1}(0),new G(v,q)}function Vr(r,e){var t=Hr(r),n=N()(t,3);return Wr(n[0],n[1],n[2],e)}function Zr(r){var e=y.a.mark(S),t=(r=D(r)).shape,n=Int32Array.from(t),a=t.slice(0,-1),o=t.slice(-2),i=N()(o,2),f=i[0],u=i[1];if(f<u){var s=Zr(r.T),c=N()(s,3),l=c[0],h=c[1];return[c[2].T,h,l.T]}var v=M["float32"===r.dtype?"float32":"float64"],d=Number.EPSILON*f,p=Math.sqrt(2);a[a.length-1]=u,n[n.length-2]=u;var w=Hr(f>=u?r:r.T),m=N()(w,3),b=m[0],g=m[1],E=m[2];r=void 0,b=b.data,g=g.data,E=E.data;var x=new v(u*u),A=new v(b.length/f),q=new v(u);function S(r){var t,n,a;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=r>>>2,n=new Int32Array(2),a=0;case 2:if(!(a<2)){e.next=80;break}n[0]=0;case 4:if(!(n[0]<t)){e.next=15;break}n[1]=1+n[0];case 6:if(!(n[1]<t)){e.next=12;break}return e.next=9,n;case 9:n[1]++,e.next=6;break;case 12:n[0]++,e.next=4;break;case 15:n[0]=t;case 16:if(!(n[0]<2*t)){e.next=27;break}n[1]=1+n[0];case 18:if(!(n[1]<2*t)){e.next=24;break}return e.next=21,n;case 21:n[1]++,e.next=18;break;case 24:n[0]++,e.next=16;break;case 27:if(0!=a){e.next=40;break}n[0]=0;case 29:if(!(n[0]<t)){e.next=40;break}n[1]=t;case 31:if(!(n[1]<2*t)){e.next=37;break}return e.next=34,n;case 34:n[1]++,e.next=31;break;case 37:n[0]++,e.next=29;break;case 40:n[0]=2*t;case 41:if(!(n[0]<3*t)){e.next=52;break}n[1]=1+n[0];case 43:if(!(n[1]<3*t)){e.next=49;break}return e.next=46,n;case 46:n[1]++,e.next=43;break;case 49:n[0]++,e.next=41;break;case 52:n[0]=3*t;case 53:if(!(n[0]<r)){e.next=64;break}n[1]=1+n[0];case 55:if(!(n[1]<r)){e.next=61;break}return e.next=58,n;case 58:n[1]++,e.next=55;break;case 61:n[0]++,e.next=53;break;case 64:if(0!=a){e.next=77;break}n[0]=2*t;case 66:if(!(n[0]<3*t)){e.next=77;break}n[1]=3*t;case 68:if(!(n[1]<r)){e.next=74;break}return e.next=71,n;case 71:n[1]++,e.next=68;break;case 74:n[0]++,e.next=66;break;case 77:a++,e.next=2;break;case 80:n[0]=0;case 81:if(!(n[0]<2*t)){e.next=92;break}n[1]=2*t;case 83:if(!(n[1]<r)){e.next=89;break}return e.next=86,n;case 86:n[1]++,e.next=83;break;case 89:n[0]++,e.next=81;break;case 92:case"end":return e.stop()}},e,this)}for(var P=0,I=0,O=0;I<g.length;P+=f*u,I+=u*u,O+=u){for(var k=Gr(f,u,g,I,q),L=u;L-- >k;)for(var F=k;F-- >0;){for(var T=k;--T>F;){var U=x[u*L+T],z=g[I+u*L+T],C=g[I+u*F+L],B=g[I+u*F+T];g[I+u*F+L]=z*C-U*B,g[I+u*F+T]=U*C+z*B}var Y=g[I+u*F+L],J=g[I+u*F+F],H=Math.hypot(Y,J),X=J/H,W=Y/H;if(g[I+u*F+L]=X*Y-W*J,g[I+u*F+F]=W*Y+X*J,g[I+u*L+F]=X,x[u*L+F]=W,!(Math.abs(g[I+u*F+L])<1e-8))throw new Error("Assertion failed.");g[I+u*F+L]=0}for(var $=0;$<k;$++)for(var V=0;V<k;V++)x[u*$+V]=g[I+u*$+V];for(var Z=0,K=1/0;K>d*d;){if(++Z>128)throw new Error("Too many iterations.");K=0;var R=!0,Q=!1,_=void 0;try{for(var rr,er=function(){var r=N()(rr.value,2),e=r[0],t=r[1];if(t<=e)throw new Error("Assertion failed");for(var n=0,a=0,o=0,i=I+u*e+k,f=I+u*e,s=I+u*t;f<i;){var c=g[f++];n+=c*c;var l=g[s++];a+=c*l,o+=l*l}if(n<=0)throw new Error("Unexpected underflow.");if(o<=0)throw new Error("Unexpected underflow.");if((K=Math.max(K,a/n*(a/o)))/d<=d)return"continue";var h=j(function(r){var e=Math.sqrt((1+r)*(1-r))*r;return e*n+a*(1+p*r)*(1-p*r)-e*o},-p/2,+p/2),v=Math.sqrt((1+h)*(1-h));if(n*(1+p*h)*(1-p*h)<o+2*v*h*a){var w=v;v=-h,h=w}for(var m=I+u*e,y=I+u*e+k,b=I+u*t+k;y>m;){var E=g[--y],x=g[--b];g[y]=v*E-h*x,g[b]=v*x+h*E}},tr=S(k)[Symbol.iterator]();!(R=(rr=tr.next()).done);R=!0)er()}catch(r){Q=!0,_=r}finally{try{R||null==tr.return||tr.return()}finally{if(Q)throw _}}}for(var nr=0;nr<k;nr++){for(var ar=0,or=0,ir=0;ir<k;ir++){var fr=Math.abs(g[I+u*nr+ir]);if(0!=fr){if(fr>or){var ur=or/fr;or=fr,ar*=ur*ur}var sr=fr/or;ar+=sr*sr}}var cr=isFinite(or)?Math.sqrt(ar)*or:or;if(0==cr)throw new Error("Unhandled underflow. Ask the developer nicely and bribe him with a couple of beers, then he may address this issue.");for(var lr=k;lr-- >0;)g[I+u*nr+lr]/=cr;A[O+nr]=cr}for(var hr=0;hr<k;hr++){for(var vr=0;vr<k;vr++)q[vr]=x[u*hr+vr],x[u*hr+vr]=0;for(var dr=0;dr<k;dr++){for(var pr=0;pr<k;pr++)x[u*hr+dr]+=g[I+u*dr+pr]*q[pr];x[u*hr+dr]/=A[O+dr]}}for(var wr=k;wr<u;wr++){for(var mr=0;mr<wr;mr++)for(var yr=0;yr<k;yr++){var br=x[u*wr+yr],gr=g[I+u*wr+yr],Er=g[I+u*mr+wr],xr=g[I+u*mr+yr];g[I+u*mr+wr]=gr*Er+br*xr,g[I+u*mr+yr]=-br*Er+gr*xr}for(var Ar=1,Mr=0;Mr<k;Mr++){var qr=x[u*wr+Mr],Sr=g[I+u*wr+Mr];g[I+u*wr+Mr]=-qr*Ar,Ar*=Sr}g[I+u*wr+wr]=Ar}for(var Pr=0;Pr<f;Pr++){for(var Ir=0;Ir<k;Ir++)q[Ir]=b[P+u*Pr+Ir],b[P+u*Pr+Ir]=0;for(var Or=0;Or<k;Or++)for(var kr=0;kr<k;kr++)b[P+u*Pr+kr]+=q[Or]*x[u*Or+kr]}for(var Nr=0;Nr<u;Nr++){for(var Lr=0;Lr<u;Lr++)q[E[O+Lr]]=g[I+u*Nr+Lr];for(var Fr=u;Fr-- >0;)g[I+u*Nr+Fr]=q[Fr]}}return[new G(t,b),new G(a,A),new G(n,g)]}function Kr(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((r=D(r)).ndim<2)throw new Error("Input must be at least 2D.");return r.mapElems(r.dtype,function(r){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var o=n.slice(-2),i=N()(o,2);return i[0]<i[1]-e?0:r})}function Rr(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((r=D(r)).ndim<2)throw new Error("Input must be at least 2D.");return r.mapElems(r.dtype,function(r){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var o=n.slice(-2),i=N()(o,2);return i[0]>i[1]-e?0:r})}function Qr(r,e){if((r=D(r)).ndim<2)throw new Error("tril_solve(L,y): L.ndim must be at least 2.");if((e=D(e)).ndim<2)throw new Error("tril_solve(L,y): y.ndim must be at least 2.");var t=r.shape.slice(-2),n=N()(t,2),a=n[0],o=n[1],i=e.shape.slice(-2),f=N()(i,2),u=f[0],s=f[1];if(a!=o)throw new Error("Last two dimensions of L must be quadratic.");if(u!=o)throw new Error("L and y don't match.");var c=Math.max(r.ndim,e.ndim),l=Int32Array.from({length:c},function(){return 1});l[c-2]=u,l[c-1]=s;for(var h=[r,e],v=0;v<h.length;v++)for(var d=h[v],p=c-2,w=d.ndim-2;p-- >0&&w-- >0;)if(1===l[p])l[p]=d.shape[w];else if(l[p]!=d.shape[w]&&1!=d.shape[w])throw new Error("Shapes are not broadcast-compatible.");var m=[r,e].every(function(r){return"float32"===r.dtype})?"float32":"float64",y=new M[m](l.reduce(function(r,e){return r*e})),b=r.data,g=e.data,E=0,x=1,A=0,q=1,S=0;return function t(n){if(n===c-2){x=a*a,q=a*s;for(var o=0;o<q;o++)y[S+o]=g[A+o];for(var i=0;i<u;i++)for(var f=0;f<s;f++){for(var h=0;h<i;h++)y[S+i*s+f]-=b[E+a*i+h]*y[S+h*s+f];y[S+i*s+f]/=b[E+a*i+i]}return E+=x,A+=q,void(S+=q)}for(var v=l[n];t(n+1),1!=v;v--)r.shape[n-c+r.ndim]>1||(E-=x),e.shape[n-c+e.ndim]>1||(A-=q);x*=r.shape[n-c+r.ndim]||1,q*=e.shape[n-c+e.ndim]||1}(0),new G(l,y)}function _r(r,e){if((r=D(r)).ndim<2)throw new Error("triu_solve(U,y): U.ndim must be at least 2.");if((e=D(e)).ndim<2)throw new Error("triu_solve(U,y): y.ndim must be at least 2.");var t=r.shape.slice(-2),n=N()(t,2),a=n[0],o=n[1],i=e.shape.slice(-2),f=N()(i,2),u=f[0],s=f[1];if(a!=o)throw new Error("Last two dimensions of U must be quadratic.");if(u!=o)throw new Error("U and y don't match.");var c=Math.max(r.ndim,e.ndim),l=Int32Array.from({length:c},function(){return 1});l[c-2]=u,l[c-1]=s;for(var h=[r,e],v=0;v<h.length;v++)for(var d=h[v],p=c-2,w=d.ndim-2;p-- >0&&w-- >0;)if(1===l[p])l[p]=d.shape[w];else if(l[p]!=d.shape[w]&&1!=d.shape[w])throw new Error("Shapes are not broadcast-compatible.");var m=[r,e].every(function(r){return"float32"===r.dtype})?"float32":"float64",y=new M[m](l.reduce(function(r,e){return r*e})),b=r.data,g=e.data,E=0,x=1,A=0,q=1,S=0;return function t(n){if(n===c-2){x=o*o,q=o*s;for(var i=0;i<q;i++)y[S+i]=g[A+i];for(var f=u;f-- >0;)for(var h=s;h-- >0;){for(var v=a;--v>f;)y[S+f*s+h]-=b[E+o*f+v]*y[S+v*s+h];y[S+f*s+h]/=b[E+o*f+f]}return E+=x,A+=q,void(S+=q)}for(var d=l[n];t(n+1),1!=d;d--)r.shape[n-c+r.ndim]>1||(E-=x),e.shape[n-c+e.ndim]>1||(A-=q);x*=r.shape[n-c+r.ndim]||1,q*=e.shape[n-c+e.ndim]||1}(0),new G(l,y)}var jr=y.a.mark(oe),re=y.a.mark(ie),ee="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",te=Int32Array.from({length:256},function(){return-2});if(64!==ee.length)throw new Error("Assertion failed.");for(var ne=ee.length;ne-- >0;)te[ee.charCodeAt(ne)]=ne;for(var ae="\f\n\r\t\v ".length;ae-- >0;)te["\f\n\r\t\v ".charCodeAt(ae)]=-1;function oe(r){var e,t,n,a,o,i,f;return y.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:n=function(){console.warn("_b64_decode(b64_chars): Base64 sequence ended unexpectedly.")},t=function(){for(;;){var t=void 0,n=r.next();if(t=n.value,e=(e=n.done)||"="===t)return NaN;if("string"!=typeof t||1!==t.length)throw new Error("_b64_decode(b64_chars): Invalid token in character sequence: ".concat(t,"."));if(-1!==(t=te[t.charCodeAt(0)])){if(!(t>=0))throw new Error("_b64_decode(b64_chars): Invalid base64 character '".concat(t,"'."));return t}}},r=r[Symbol.iterator]();case 3:if(a=t(),!e){u.next=7;break}return u.abrupt("return");case 7:if(o=t(),!e){u.next=10;break}return u.abrupt("return",n());case 10:return u.next=12,a<<2|o>>4;case 12:if(i=t(),!e){u.next=15;break}return u.abrupt("return");case 15:return u.next=17,(15&o)<<4|i>>2;case 17:if(f=t(),!e){u.next=20;break}return u.abrupt("return");case 20:return u.next=22,(3&i)<<6|63&f;case 22:u.next=3;break;case 24:case"end":return u.stop()}},jr,this)}function ie(r){var e,t,n,a,o,i,f,u,s,c,l,h,v,d,p=arguments;return y.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(e=p.length>1&&void 0!==p[1]?p[1]:{},t=e.pad,n=void 0===t||t,a=e.lineLimit,0<(o=void 0===a?1/0:a)){w.next=3;break}throw new Error("_b64_encode(bytes,{lineLimit}): Invalid lineLimit: ".concat(o,"."));case 3:i=r[Symbol.iterator](),r=y.a.mark(function r(){var e,t,n,a,o,f;return y.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:e=!0,t=!1,n=void 0,r.prev=3,a=i[Symbol.iterator]();case 5:if(e=(o=a.next()).done){r.next=15;break}if(f=o.value,0<=(f*=1)&&f<256){r.next=10;break}throw new Error("_b64_encode(bytes): Invalid token in byte sequence: ".concat(f));case 10:return r.next=12,f;case 12:e=!0,r.next=5;break;case 15:r.next=21;break;case 17:r.prev=17,r.t0=r.catch(3),t=!0,n=r.t0;case 21:r.prev=21,r.prev=22,e||null==a.return||a.return();case 24:if(r.prev=24,!t){r.next=27;break}throw n;case 27:return r.finish(24);case 28:return r.finish(21);case 29:case"end":return r.stop()}},r,this,[[3,17,21,29],[22,,24,28]])})(),f=y.a.mark(function e(){var t,n,a,o,i;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0,a=r.next(),t=a.value,!a.done){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,t>>2;case 9:if(n=(3&t)<<4,o=r.next(),t=o.value,!o.done){e.next=17;break}return e.next=16,n;case 16:return e.abrupt("return");case 17:return e.next=19,t>>4|n;case 19:if(n=(15&t)<<2,i=r.next(),t=i.value,!i.done){e.next=27;break}return e.next=26,n;case 26:return e.abrupt("return");case 27:return e.next=29,t>>6|n;case 29:return e.next=31,63&t;case 31:e.next=0;break;case 33:case"end":return e.stop()}},e,this)})(),u=0,s=!0,c=!1,l=void 0,w.prev=10,h=f[Symbol.iterator]();case 12:if(s=(v=h.next()).done){w.next=26;break}if("number"==typeof(d=v.value)){w.next=16;break}throw new Error("Assertion failed.");case 16:if(0<=d&&d<64){w.next=18;break}throw new Error("Assertion failed.");case 18:return w.next=20,ee[d];case 20:if(0!=++u%o){w.next=23;break}return w.next=23,"\n";case 23:s=!0,w.next=12;break;case 26:w.next=32;break;case 28:w.prev=28,w.t0=w.catch(10),c=!0,l=w.t0;case 32:w.prev=32,w.prev=33,s||null==h.return||h.return();case 35:if(w.prev=35,!c){w.next=38;break}throw l;case 38:return w.finish(35);case 39:return w.finish(32);case 40:if(!n){w.next=46;break}case 41:if(0==u++%4){w.next=46;break}return w.next=44,"=";case 44:w.next=41;break;case 46:case"end":return w.stop()}},re,this,[[10,28,32,40],[33,,35,39]])}var fe=y.a.mark(se);function ue(r){r=r[Symbol.iterator]();for(var e=[];;){var t=r.next(),n=t.value;if(t.done)throw new Error("b64_parse(b64_chars): Invalid b64_chars.");if("["===n)break;e.push(n)}if(""===(e=e.join("")))throw new Error("b64_parse(b64_chars): dtype=object not (yet) supported.");S(e);for(var a=[],o=[];;){var i=r.next();n=i.value;if(i.done)throw new Error("b64_parse(b64_chars): Invalid b64_chars.");if("]"===n&&0===o.length)break;if("]"!==n&&","!==n)o.push(n);else{var f=o.join("");if(isNaN(f))throw new Error('b64_parse(b64_chars): Invalid shape entry: "'.concat(f,'".'));if(a.push(1*f),"]"===n)break;o=[]}}a=Int32Array.from(a),r=oe(r);for(var u=M[e],s=new Uint8Array(a.reduce(function(r,e){return r*e},u.BYTES_PER_ELEMENT)),c=new Uint8Array(u.BYTES_PER_ELEMENT),l=0;l<s.length;){for(var h=0;h<c.length;h++){var v=r.next();n=v.value;if(v.done)throw new Error("b64_parse(b64_chars): b64_chars too short.");c[h]=n}ce||c.reverse();for(var d=0;d<c.length;d++,l++)s[l]=c[d]}return new G(a,new u(s.buffer))}function se(r){var e;return y.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=D(r),e=r.data,"object"!==r.dtype){t.next=4;break}throw new Error("b64_format(A): A.dtype='".concat(r.dtype,"' not supported."));case 4:if(ce){t.next=6;break}throw new Error("Big endianness not (yet) supported.");case 6:return t.delegateYield("".concat(r.dtype,"[").concat(r.shape.join(","),"]\n"),"t0",7);case 7:return t.delegateYield(ie(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),{lineLimit:128}),"t1",8);case 8:case"end":return t.stop()}},fe,this)}var ce=1===new Int16Array(Uint8Array.of(1,0).buffer)[0],le="\f\n\r\t\v ";t.d(e,"math",function(){return h}),t.d(e,"array",function(){return Y}),t.d(e,"asarray",function(){return D}),t.d(e,"NDArray",function(){return G}),t.d(e,"tabulate",function(){return J}),t.d(e,"zip_elems",function(){return B}),t.d(e,"concat",function(){return H}),t.d(e,"stack",function(){return X}),t.d(e,"dt",function(){return n}),t.d(e,"opt",function(){return o}),t.d(e,"la",function(){return i}),t.d(e,"io",function(){return f})}])});